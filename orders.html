    // === Nahrání souborů na GitHub ===
    async function uploadToGitHub(owner, repo, path, fileBlob, message, token) {
      const base64Data = await new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result.split(",")[1]);
        reader.onerror = reject;
        reader.readAsDataURL(fileBlob);
      });

      const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
      const body = {
        message,
        content: base64Data,
        branch: "main"
      };

      const response = await fetch(url, {
        method: "PUT",
        headers: {
          "Authorization": `token ${token}`,
          "Accept": "application/vnd.github.v3+json",
          "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
      });

      if (!response.ok) {
        const errText = await response.text();
        throw new Error("Chyba při nahrávání souboru: " + errText);
      }
    }

    // === Uložení JSON dat do GitHubu ===
    async function submitToGitHub(dataObj, owner, repo, path, message, token) {
      const getUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
      const getResp = await fetch(getUrl, {
        headers: {
          "Authorization": `token ${token}`,
          "Accept": "application/vnd.github.v3+json"
        }
      });

      let existingContent = "[]", sha = null;
      if (getResp.ok) {
        const existing = await getResp.json();
        existingContent = atob(existing.content.replace(/\n/g, ""));
        sha = existing.sha;
      }

      const arr = JSON.parse(existingContent);
      arr.push(dataObj);
      const newContent = JSON.stringify(arr, null, 2);
      const base64 = btoa(unescape(encodeURIComponent(newContent)));

      const body = { message, content: base64, branch: "main" };
      if (sha) body.sha = sha;

      const putResp = await fetch(getUrl, {
        method: "PUT",
        headers: {
          "Authorization": `token ${token}`,
          "Accept": "application/vnd.github.v3+json",
          "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
      });

      if (!putResp.ok) throw new Error(await putResp.text());
    }

    // === Zobrazení fajfky po úspěchu ===
    function showSuccess() {
      const success = document.getElementById("successCheck");
      success.classList.add("active");
      setTimeout(() => { window.location.href = "index.html"; }, 2500);
    }

    // === Odeslání formuláře ===
    document.getElementById("reklamaceForm").addEventListener("submit", async e => {
      e.preventDefault();

      const form = e.target;
      const fields = form.querySelectorAll("input[required], textarea[required], select[required]");
      let valid = true;

      fields.forEach(f => {
        if (!f.value.trim()) {
          f.classList.add("invalid");
          valid = false;
        } else {
          f.classList.remove("invalid");
        }
      });

      if (!validateTelefon()) {
        telefonInput.classList.add("invalid");
        valid = false;
      } else {
        telefonInput.classList.remove("invalid");
      }

      if (!validateEmail()) {
        emailInput.classList.add("invalid");
        valid = false;
      } else {
        emailInput.classList.remove("invalid");
      }

      if (!adresaPlatna) {
        alert("Vyber prosím adresu z našeptávače.");
        uliceInput.classList.add("invalid");
        valid = false;
      }

      if (!valid) {
        alert("Zkontroluj prosím červeně označená pole.");
        return;
      }

      const owner = "radecek222-boop";
      const repo = "reklamace";
      const token = prompt("Zadej GitHub token:");
      const cisloReklamace = form.cislo.value.trim() || "REK";

      const dataObj = {
        typ: "reklamace",
        contract: form.zpracoval.value,
        cislo: form.cislo.value,
        zakaznik: form.zakaznik.value,
        adresa: `${form.ulice.value}, ${form.mesto.value}, ${form.psc.value}`,
        telefon: `${predvolba.value} ${form.telefon.value}`,
        email: form.email.value,
        produkt: form.produkt.value,
        datum_prodeje: form.datum_prodeje.value,
        datum_reklamace: form.datum_reklamace.value,
        popis: form.popis.value,
        fotky: [],
        jinaZadavatel: form.zpracoval.value === "Jiná"
          ? {
              jmeno: form.jinaJmeno.value,
              email: form.jinaEmail.value,
              telefon: form.jinaTelefon.value
            }
          : null
      };

      try {
        // === Nahraj fotky do /foto/ ===
        for (const file of compressedFiles) {
          const safeName = `${cisloReklamace}_${file.name.replace(/\s+/g, "_")}`;
          const path = `foto/${safeName}`;
          const message = `Nová fotka k reklamaci ${cisloReklamace}`;
          await uploadToGitHub(owner, repo, path, file.blob, message, token);
          dataObj.fotky.push(safeName);
        }

        // === Ulož záznam do orders.json ===
        const message = `Nová reklamace ${dataObj.cislo}`;
        await submitToGitHub(dataObj, owner, repo, "orders.json", message, token);

        // === Úspěch ===
        showSuccess();
        form.reset();
      } catch (err) {
        alert("Chyba: " + err.message);
      }
    });
  </script>
</body>
</html>
