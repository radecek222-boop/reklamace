<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nov√° reklamace ‚Äì White Glove Service</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Vanilla Calendar -->
<link rel="stylesheet" href="vanilla-calendar.min.css">
<script src="vanilla-calendar.min.js"></script>

<style>
body{
  font-family:"Inter",system-ui,sans-serif;
  background:#f6f7fb;margin:0;padding:0;
  display:flex;justify-content:center;align-items:flex-start;
  min-height:100vh;
}
.wrapper{
  background:#fff;padding:30px;margin:40px 15px;border-radius:12px;
  box-shadow:0 2px 8px rgba(0,0,0,0.1);
  width:100%;max-width:700px;box-sizing:border-box;
}
h1,h2{text-align:center;margin:0 0 20px;}
h1{font-size:2.6em;font-weight:900;color:#111;}
h2{font-size:1.2em;font-weight:500;color:#666;margin-bottom:25px;}

label{display:block;font-weight:600;margin-top:15px;margin-bottom:5px;}
input,textarea,select{
  width:100%;padding:10px;font-size:1em;border:1px solid #ccc;
  border-radius:6px;box-sizing:border-box;transition:border .2s;
}
input:focus,textarea:focus,select:focus{border-color:#0046ff;outline:none;}
textarea{height:100px;resize:vertical;}

.btn{
  display:inline-block;padding:12px 28px;border-radius:8px;font-weight:600;
  border:none;color:#fff;cursor:pointer;font-size:1em;
  transition:transform .15s ease-in-out,opacity .2s;
  box-shadow:0 3px 8px rgba(0,0,0,0.15);
}
.btn:hover{transform:scale(1.04);opacity:.9;}
.btn-back{background:linear-gradient(135deg,#6c757d,#a0a4a7);}
.btn-send{background:linear-gradient(135deg,#0046ff,#357aff);}
.actions{text-align:center;margin-top:25px;display:flex;justify-content:center;gap:20px;flex-wrap:wrap;}

.address-wrapper{position:relative;}
#mapPreview{width:100%;height:250px;margin-top:10px;border-radius:14px;overflow:hidden;
  box-shadow:0 4px 10px rgba(0,0,0,0.1);}
.suggestions{position:absolute;top:100%;left:0;width:100%;background:#fff;
  border:1px solid #ccc;border-radius:6px;box-shadow:0 4px 10px rgba(0,0,0,0.1);
  max-height:180px;overflow-y:auto;z-index:1000;}
.suggestions div{padding:8px;cursor:pointer;}
.suggestions div:hover{background:#f0f0f0;}

/* üìÖ a üì∑ bannery */
.btn-banner{
  display:block;width:100%;
  background:linear-gradient(135deg,#e7ecff,#f2f4ff);
  color:#0046ff;font-weight:600;font-size:1em;
  border:1px solid #ccd4ff;border-radius:10px;
  padding:14px;text-align:center;
  box-shadow:0 2px 5px rgba(0,0,0,0.05);
  cursor:pointer;transition:background .2s;
}
.btn-banner:hover{background:linear-gradient(135deg,#dde4ff,#eef0ff);}
.btn-banner.selected{background:linear-gradient(135deg,#0046ff,#357aff);color:#fff;border:none;}







  .wait-overlay{display:none;position:fixed;inset:0;background:rgba(255,255,255,.85);
  backdrop-filter:blur(2px);justify-content:center;align-items:center;flex-direction:column;
  font-weight:600;color:#333;z-index:2000;}
.wait-overlay.active{display:flex;}
.hourglass{border:4px solid #ccc;border-top:4px solid #0046ff;
  border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin-bottom:10px;}
@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}

.success-check{display:none;position:fixed;inset:0;justify-content:center;align-items:center;
  background:rgba(255,255,255,0.9);z-index:2100;}
.success-check.active{display:flex;}
.checkmark{width:80px;height:80px;stroke-width:3;stroke:url(#grad1);fill:none;
  stroke-dasharray:48;stroke-dashoffset:48;animation:draw 1s ease forwards;}
@keyframes draw{to{stroke-dashoffset:0;}}

/* mod√°ly kalend√°≈ô + foto */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);
  display:none;justify-content:center;align-items:center;z-index:9999;animation:fadeIn .25s ease;}
.modal.active{display:flex;}
.modal-content{background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,.25);
  animation:popIn .25s ease;max-width:480px;width:90%;}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
@keyframes popIn{from{transform:scale(.9);opacity:0;}to{transform:scale(1);opacity:1;}}

.preview{display:flex;flex-wrap:wrap;gap:10px;margin-top:15px;}
.preview-item{width:90px;height:90px;position:relative;border-radius:8px;overflow:hidden;
  box-shadow:0 2px 6px rgba(0,0,0,.15);}
.preview-item img{width:100%;height:100%;object-fit:cover;}
.remove-btn{position:absolute;top:4px;right:4px;background:rgba(255,255,255,.85);
  border:none;border-radius:50%;width:20px;height:20px;font-weight:bold;cursor:pointer;color:#f00;}
.progress-circle{position:absolute;inset:0;display:flex;justify-content:center;align-items:center;}
</style>
</head>






  <body>
<div class="wrapper">
  <h1>WHITE GLOVE SERVICE</h1>
  <h2>Nov√° reklamace</h2>

  <form id="reklamaceForm" novalidate>
    <label>ƒå√≠slo reklamace / objedn√°vky:</label>
    <input type="text" name="cislo" required placeholder="nap≈ô. NBU25">

    <label>Z√°kazn√≠k:</label>
    <input type="text" name="zakaznik" required placeholder="nap≈ô. Ji≈ô√≠ Nov√°k">

    <label>Ulice a ƒç√≠slo popisn√©:</label>
    <div class="address-wrapper">
      <input type="text" id="ulice" name="ulice" required placeholder="nap≈ô. Vinohradsk√° 120">
      <div id="suggestions" class="suggestions"></div>
    </div>
    <div id="mapPreview"></div>

    <label>Mƒõsto:</label>
    <input type="text" id="mesto" name="mesto" required placeholder="nap≈ô. Praha">

    <label>PSƒå:</label>
    <input type="text" id="psc" name="psc" required pattern="\d{3}\s?\d{2}" placeholder="nap≈ô. 110 00">

    <label>Telefon:</label>
    <div style="display:flex;gap:8px;">
      <select id="predvolba" style="max-width:130px;">
        <option value="+420">+420</option>
        <option value="+421">+421</option>
        <option value="+43">+43</option>
      </select>
      <input type="tel" id="telefon" name="telefon" required placeholder="nap≈ô. 777123456">
    </div>

    <label>E-mail:</label>
    <input type="email" id="email" name="email" required placeholder="nap≈ô. info@firma.cz">

    <label>Model / N√°zev produktu:</label>
    <input type="text" name="produkt" required placeholder="nap≈ô. C142">







        <div class="calendar-row" style="display:flex;gap:20px;flex-wrap:wrap;margin-top:15px;">
      <div style="flex:1;min-width:250px;">
        <label>Datum prodeje:</label>
        <input type="hidden" id="datum_prodeje" name="datum_prodeje" required>
        <button type="button" id="btnProdej" class="btn-banner">Vyberte datum prodeje</button>
      </div>
      <div style="flex:1;min-width:250px;">
        <label>Datum reklamace:</label>
        <input type="hidden" id="datum_reklamace" name="datum_reklamace" required>
        <button type="button" id="btnReklamace" class="btn-banner">Vyberte datum reklamace</button>
      </div>
    </div>

    <!-- Modal kalend√°≈ôe -->
    <div id="calendarModal" class="modal">
      <div class="modal-content">
        <div id="vanillaCalendar"></div>
        <button id="closeCalendar" class="btn btn-send" style="margin-top:15px;width:100%">Zav≈ô√≠t</button>
      </div>
    </div>







        <label>Fotografie k reklamaci:</label>
    <button type="button" id="openPhotoModal" class="btn-banner">Nahr√°t fotografie</button>

    <div id="photoModal" class="modal">
      <div class="modal-content">
        <p><strong>Max 5 fotografi√≠</strong> | form√°t JPG/PNG/HEIC | velikost do 5 MB | automaticky zmen≈°ujeme na 800 px</p>
        <input type="file" id="fotkyInput" accept="image/jpeg,image/png,image/heic" multiple style="margin-top:10px;">
        <div id="preview" class="preview"></div>
        <div style="text-align:center;margin-top:15px;">
          <button type="button" id="uploadPhotosBtn" class="btn btn-send" disabled>Nahr√°t fotografie</button>
          <button type="button" id="closePhotoModal" class="btn btn-back" style="margin-top:10px;">Zav≈ô√≠t</button>
        </div>
      </div>
    </div>






        <label>Objedn√°vku zpracoval:</label>
    <select id="zpracoval" name="zpracoval" required>
      <option value="">Vyber‚Ä¶</option>
      <option value="Natuzzi Editions - Strejcek">Natuzzi Editions ‚Äì Strejcek</option>
      <option value="Natuzzi Editions - Vimrova">Natuzzi Editions ‚Äì Vimrova</option>
      <option value="Natuzzi Italia - Bratislava">Natuzzi Italia ‚Äì Bratislava</option>
      <option value="Natuzzi Italia - Jama">Natuzzi Italia ‚Äì Jama</option>
      <option value="Natuzzi Italia - SOHO">Natuzzi Italia ‚Äì SOHO</option>
      <option value="Softaly - SOHO">Softaly ‚Äì SOHO</option>
      <option value="Phase - Klucarova">Phase ‚Äì Klucarova</option>
      <option value="Phase - Jancova">Phase ‚Äì Jancova</option>
      <option value="Jin√°">Jin√°</option>
    </select>

    <div id="jinaSekce" style="display:none;">
      <label>Zadej nov√Ω z√°pis zadavatele:</label>
      <input type="text" id="jinaJmeno" name="jinaJmeno" placeholder="Jm√©no zadavatele">
      <label>E-mail zadavatele:</label>
      <input type="email" id="jinaEmail" name="jinaEmail" placeholder="nap≈ô. zadavatel@firma.cz">
      <label>Telefon zadavatele:</label>
      <input type="tel" id="jinaTelefon" name="jinaTelefon" placeholder="nap≈ô. 777123456">
    </div>

    <div class="actions">
      <a href="index.html" class="btn btn-back">Zpƒõt</a>
      <button type="submit" class="btn btn-send">Odeslat</button>
    </div>
  </form>
</div>







    <div class="wait-overlay" id="waitOverlay">
  <div class="hourglass"></div>
  <p>Pros√≠m ƒçekejte‚Ä¶</p>
</div>

<div class="success-check" id="successCheck">
  <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
    <defs>
      <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#00d084;stop-opacity:1"/>
        <stop offset="100%" style="stop-color:#00a86b;stop-opacity:1"/>
      </linearGradient>
    </defs>
    <circle cx="26" cy="26" r="25" fill="none"/>
    <path fill="none" d="M14 27l7 7 16-16" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
</div>





    <script>
// üîß Skryt√≠/aktivace sekce "Jin√°"
const selectZpracoval = document.getElementById("zpracoval");
const jinaSekce = document.getElementById("jinaSekce");
selectZpracoval.addEventListener("change", () => {
  if (selectZpracoval.value === "Jin√°") {
    jinaSekce.style.display = "block";
  } else {
    jinaSekce.style.display = "none";
  }
});

// üóìÔ∏è Kalend√°≈ôn√≠ bannery
document.addEventListener("DOMContentLoaded", () => {
  const modal = document.getElementById("calendarModal");
  const closeBtn = document.getElementById("closeCalendar");
  let targetInput = null;
  let targetButton = null;

  const calendar = new VanillaCalendar("#vanillaCalendar", {
    settings: { lang: "cs", selection: { day: "single" }, visibility: { theme: "light" } },
    actions: {
      clickDay: (e) => {
        e.preventDefault();
        e.stopPropagation();
        const chosen = e.target.dataset.calendarDay;
        if (chosen && targetInput && targetButton) {
          targetInput.value = chosen;
          targetButton.textContent = chosen;
          targetButton.classList.add("selected");
        }
      }
    }
  });
  calendar.init();

  document.getElementById("btnProdej").addEventListener("click", () => {
    targetInput = document.getElementById("datum_prodeje");
    targetButton = document.getElementById("btnProdej");
    modal.classList.add("active");
  });

  document.getElementById("btnReklamace").addEventListener("click", () => {
    targetInput = document.getElementById("datum_reklamace");
    targetButton = document.getElementById("btnReklamace");
    modal.classList.add("active");
  });

  closeBtn.addEventListener("click", () => modal.classList.remove("active"));
});

// üì∑ Fotografie ‚Äì mod√°ln√≠ okno
const openPhotoModal = document.getElementById("openPhotoModal");
const photoModal = document.getElementById("photoModal");
const closePhotoModal = document.getElementById("closePhotoModal");
const fotkyInput = document.getElementById("fotkyInput");
const preview = document.getElementById("preview");
const uploadPhotosBtn = document.getElementById("uploadPhotosBtn");

let compressedFiles = [];
openPhotoModal.addEventListener("click", () => {
  photoModal.classList.add("active");
});
closePhotoModal.addEventListener("click", () => {
  photoModal.classList.remove("active");
  preview.innerHTML = "";
  compressedFiles = [];
  uploadPhotosBtn.disabled = true;
});

// üóúÔ∏è Komprese obr√°zku na max. 800 px / 500 kB
async function compressImage(file, maxSizeKB = 500, maxDim = 800) {
  const img = await createImageBitmap(file);
  const canvas = document.createElement("canvas");
  let [w, h] = [img.width, img.height];
  if (w >= h && w > maxDim) { h = Math.round(h * (maxDim / w)); w = maxDim; }
  else if (h > w && h > maxDim) { w = Math.round(w * (maxDim / h)); h = maxDim; }
  canvas.width = w; canvas.height = h;
  const ctx = canvas.getContext("2d");
  ctx.drawImage(img, 0, 0, w, h);
  let q = 0.9;
  let blob = await new Promise(r => canvas.toBlob(r, "image/jpeg", q));
  while (blob.size / 1024 > maxSizeKB && q > 0.4) {
    q -= 0.1;
    blob = await new Promise(r => canvas.toBlob(r, "image/jpeg", q));
  }
  return blob;
}

// üì∏ V√Ωbƒõr fotek
fotkyInput.addEventListener("change", async () => {
  preview.innerHTML = "";
  compressedFiles = [];
  const files = Array.from(fotkyInput.files).slice(0, 5);
  for (const file of files) {
    const item = document.createElement("div");
    item.className = "preview-item";
    const img = document.createElement("img");
    const progress = document.createElement("div");
    progress.className = "progress-circle";
    progress.innerHTML = `<div class="hourglass" style="width:25px;height:25px;border-width:3px;"></div>`;
    const remove = document.createElement("button");
    remove.className = "remove-btn";
    remove.textContent = "√ó";
    remove.onclick = () => { item.remove(); compressedFiles = compressedFiles.filter(f => f.file !== file); };
    item.append(img, progress, remove);
    preview.append(item);

    const reader = new FileReader();
    reader.onload = e => (img.src = e.target.result);
    reader.readAsDataURL(file);

    const blob = await compressImage(file);
    compressedFiles.push({ file, blob, element: item });
    progress.innerHTML = "";
  }
  uploadPhotosBtn.disabled = compressedFiles.length === 0;
});

// üì§ Nahr√°n√≠ fotek na Worker
uploadPhotosBtn.addEventListener("click", async () => {
  uploadPhotosBtn.disabled = true;
  const wait = document.getElementById("waitOverlay");
  wait.classList.add("active");

  const fotkyNames = [];
  for (const fch of compressedFiles) {
    const formData = new FormData();
    formData.append("file", fch.blob, fch.file.name);
    const up = await fetch("https://wgs-token.72nvwf4pb2.workers.dev/upload", { method: "POST", body: formData });
    const r = await up.json();
    fotkyNames.push(r.filename);
  }

  wait.classList.remove("active");
  document.getElementById("successCheck").classList.add("active");
  setTimeout(() => {
    document.getElementById("successCheck").classList.remove("active");
    photoModal.classList.remove("active");
  }, 2000);

  // ulo≈æ√≠me do hidden pole nebo glob√°ln√≠ promƒõnn√© pro pozdƒõj≈°√≠ odesl√°n√≠ formul√°≈ôe
  window.uploadedPhotos = fotkyNames;
});
</script>





    <script>
// üß© Pomocn√© validace
const telefonInput = document.getElementById("telefon");
const predvolba = document.getElementById("predvolba");
const emailInput = document.getElementById("email");
const pscInput = document.getElementById("psc");
function validateTelefon(){return /^[0-9]{8,12}$/.test(telefonInput.value.trim());}
function validateEmail(){return /^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(emailInput.value.trim());}
function validatePSC(){return /^\d{3}\s?\d{2}$/.test(pscInput.value.trim());}
const cisloInput=document.querySelector('input[name="cislo"]');
cisloInput.addEventListener("input",()=>{cisloInput.value=cisloInput.value.toUpperCase();});

// üíæ Odesl√°n√≠ cel√© reklamace
document.getElementById("reklamaceForm").addEventListener("submit", async e => {
  e.preventDefault();
  const wait = document.getElementById("waitOverlay");
  wait.classList.add("active");
  const f = e.target;

  // üìã P≈ô√≠prava dat
  const dataObj = {
    typ: "reklamace",
    contract: f.zpracoval.value,
    cislo: f.cislo.value.trim().toUpperCase(),
    zakaznik: f.zakaznik.value.trim(),
    adresa: `${f.ulice.value}, ${f.mesto.value}, ${f.psc.value}`,
    telefon: `${predvolba.value} ${f.telefon.value}`,
    email: f.email.value.trim(),
    produkt: f.produkt.value.trim(),
    datum_prodeje: f.datum_prodeje.value,
    datum_reklamace: f.datum_reklamace.value,
    popis: f.popis?.value || "",
    fotky: window.uploadedPhotos || []
  };

  // pokud je zvolen "Jin√°", p≈ôid√°me kontakt zadavatele
  if (f.zpracoval.value === "Jin√°") {
    dataObj.jinaZadavatel = {
      jmeno: f.jinaJmeno.value.trim(),
      email: f.jinaEmail.value.trim(),
      telefon: f.jinaTelefon.value.trim()
    };
  }

  try {
    const res = await fetch("https://wgs-token.72nvwf4pb2.workers.dev/orders", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ record: dataObj })
    });
    const json = await res.json();

    wait.classList.remove("active");
    if (json.ok) {
      document.getElementById("successCheck").classList.add("active");
      setTimeout(() => {
        document.getElementById("successCheck").classList.remove("active");
        window.location.href = "index.html";
      }, 2000);
    } else {
      alert("Chyba p≈ôi odesl√°n√≠: " + json.message);
    }
  } catch (err) {
    wait.classList.remove("active");
    alert("Chyba p≈ôi p≈ôipojen√≠: " + err.message);
  }
});
</script>






    </body>
</html>
