<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WHITE GLOVE SERVICE ‚Äì Zalo≈æen√≠ nov√©ho po≈æadavku</title>
  <style>
    :root {
      font-family: "Inter", system-ui, sans-serif;
      color: #111;
    }
    body {
      margin: 0;
      padding: 20px;
      background: #f6f7fb;
    }
    .wrapper {
      max-width: 900px;
      margin: auto;
      background: #fff;
      border-radius: 16px;
      padding: 25px 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }
    h1 { text-align: center; font-size: 1.8em; font-weight: 900; margin: 0; }
    h2 { text-align: center; font-size: 1em; font-weight: 500; color: #666; margin-bottom: 25px; }
    label { display: block; margin-top: 12px; font-weight: 600; color: #333; }
    input, textarea {
      width: 100%; padding: 10px; margin-top: 6px;
      border: 1px solid #ccc; border-radius: 8px; font-family: inherit;
      font-size: 15px; box-sizing: border-box;
    }
    textarea { resize: vertical; min-height: 80px; }
    input:invalid, textarea:invalid { border-color: #d9534f; background: #fff6f6; }
    .buttons { margin-top: 25px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
    .btn {
      border: none; color: white; padding: 10px 25px; border-radius: 12px;
      font-size: 15px; cursor: pointer; font-weight: 600; transition: 0.2s;
    }
    .btn-submit { background: linear-gradient(135deg, #5a8dee, #7b42f6); }
    .btn-back { background: linear-gradient(135deg, #9e9e9e, #6c757d); }
    .message { margin-top: 20px; font-weight: 600; text-align: center; color: #28a745; display: none; }
  </style>
</head>
<body>

<div class="wrapper">
  <h1>Zalo≈æen√≠ nov√©ho po≈æadavku</h1>
  <h2>Formul√°≈ô pro zad√°n√≠ nov√©ho p≈ô√≠padu</h2>

  <form id="orderForm" novalidate>
    <label>ƒå√≠slo objedn√°vky:</label>
    <input type="text" name="cislo_objednavky" required>

    <label>Z√°kazn√≠k:</label>
    <input type="text" name="zakaznik" required>

    <label>Adresa:</label>
    <input type="text" name="adresa" required>

    <label>Telefon:</label>
    <input type="text" name="telefon" required>

    <label>E-mail:</label>
    <input type="email" name="email" required>

    <label>Znaƒçka:</label>
    <input type="text" name="znacka" required>

    <label>Model / N√°zev produktu:</label>
    <input type="text" name="model" required>

    <label>Datum n√°kupu:</label>
    <input type="date" name="datum_nakupu" required>

    <label>Popis z√°vady:</label>
    <textarea name="popis" required></textarea>

    <div class="buttons">
      <button type="button" class="btn btn-back" onclick="window.location.href='index.html'">Zpƒõt na hlavn√≠ str√°nku</button>
      <button type="submit" class="btn btn-submit">Odeslat po≈æadavek</button>
    </div>
  </form>

  <div class="message" id="message">Po≈æadavek byl √∫spƒõ≈°nƒõ odesl√°n ‚úÖ</div>
</div>

<script>
  /*******************************************************
   üîë SEM VLO≈Ω NOV√ù TOKEN (mezi uvozovky n√≠≈æe)
   ‚ö†Ô∏è Tento token nikdy nesm√≠≈° nahr√°t do ve≈ôejn√©ho repozit√°≈ôe!
  *******************************************************/
  const GITHUB_TOKEN = "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;

  const REPO = "radecek222-boop"; // n√°zev repozit√°≈ôe
  const FILE_PATH = "orders.json"; // soubor, kam se zapisuje
  const USERNAME = "radecek222"; // tv√© GitHub u≈æivatelsk√© jm√©no

  const form = document.getElementById("orderForm");
  const message = document.getElementById("message");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // validace pol√≠
    const data = Object.fromEntries(new FormData(form).entries());
    if (Object.values(data).some(v => !v.trim())) {
      alert("Vypl≈à pros√≠m v≈°echna pole.");
      return;
    }

    // p≈ôid√°n√≠ metadat
    data.datum_zalozeni = new Date().toISOString();
    data.id = "REQ-" + Date.now();

    // naƒçten√≠ aktu√°ln√≠ho obsahu orders.json
    const apiUrl = `https://api.github.com/repos/${USERNAME}/${REPO}/contents/${FILE_PATH}`;

    const response = await fetch(apiUrl, {
      headers: { Authorization: `token ${GITHUB_TOKEN}` }
    });
    const file = await response.json();
    const existingData = file.content ? JSON.parse(atob(file.content)) : [];

    // p≈ôid√°n√≠ nov√©ho z√°znamu
    existingData.push(data);

    // nov√Ω obsah jako base64
    const newContent = btoa(JSON.stringify(existingData, null, 2));

    // z√°pis do GitHubu
    const update = await fetch(apiUrl, {
      method: "PUT",
      headers: {
        "Authorization": `token ${GITHUB_TOKEN}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: `Nov√Ω po≈æadavek od ${data.zakaznik}`,
        content: newContent,
        sha: file.sha
      })
    });

    if (update.ok) {
      message.style.display = "block";
      form.reset();
      setTimeout(() => message.style.display = "none", 4000);
    } else {
      alert("Chyba p≈ôi z√°pisu do GitHubu. Zkontroluj token nebo opr√°vnƒõn√≠.");
    }
  });
</script>

</body>
</html>
