<!doctype html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WHITE GLOVE SERVICE ‚Äì Nov√° reklamace</title>
<style>
:root { font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif; color:#111; }
body { margin:0; padding:20px; background:#f6f7fb; }
h1 { text-align:center; font-size:2em; font-weight:900; margin:0 0 10px; }
h2 { text-align:center; font-size:1.1em; font-weight:600; margin:0 0 20px; color:#555; }

form {
  background:white; max-width:700px; margin:0 auto; padding:20px;
  border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);
}
label { display:block; margin-top:10px; font-weight:600; }
input, textarea, select {
  width:100%; padding:10px; margin-top:4px;
  border:1px solid #ccc; border-radius:8px; font-size:15px;
}
textarea { min-height:80px; resize:vertical; }
button {
  display:block; width:100%; margin-top:20px;
  padding:12px; font-size:1em; font-weight:600; color:#fff;
  border:none; border-radius:8px; cursor:pointer;
  background:linear-gradient(135deg,#0046ff,#357aff);
  transition:opacity .2s;
}
button:hover { opacity:.9; }

#suggestions {
  position:absolute; background:#fff; border:1px solid #ddd; border-radius:6px;
  max-height:200px; overflow:auto; z-index:10; width:calc(100% - 22px);
  box-shadow:0 2px 6px rgba(0,0,0,0.15);
}
.suggestion { padding:8px; cursor:pointer; }
.suggestion:hover { background:#eef3ff; }
</style>
</head>
<body>

<h1>WHITE GLOVE SERVICE</h1>
<h2>Nov√° reklamace</h2>

<form id="reklForm">
  <label>ƒå√≠slo objedn√°vky</label>
  <input type="text" id="objednavka" required>

  <label>Z√°kazn√≠k</label>
  <input type="text" id="zakaznik" required>

  <label>Adresa</label>
  <div style="position:relative;">
    <input type="text" id="adresa" autocomplete="off" placeholder="Zaƒçni ps√°t ulici nebo mƒõsto..." required>
    <div id="suggestions"></div>
  </div>

  <label>Telefon</label>
  <input type="text" id="telefon" pattern="[0-9 +]{9,20}" required>

  <label>E-mail</label>
  <input type="email" id="email" required>

  <label>Popis z√°vady</label>
  <textarea id="popis" placeholder="Popi≈° zji≈°tƒõnou z√°vadu..." required></textarea>

  <button type="submit">üíæ Ulo≈æit reklamaci</button>
</form>

<script>
const GITHUB_USER = "radecek222-boop";
const REPO = "reklamace";
const TOKEN = "TV≈ÆJ_TOKEN";  // ‚ö†Ô∏è vlo≈æ sv≈Øj token
const ORDERS_FILE = "orders.json";

// üîç Automatick√© dopl≈àov√°n√≠ adres
const input = document.getElementById("adresa");
const box = document.getElementById("suggestions");
let timeout;
input.addEventListener("input", e => {
  clearTimeout(timeout);
  const q = e.target.value.trim();
  if (q.length < 3) { box.innerHTML=""; return; }
  timeout = setTimeout(async () => {
    try {
      const res = await fetch(`https://api.mapy.cz/geocode?query=${encodeURIComponent(q)}&format=json`);
      const data = await res.json();
      const list = data.result?.items || [];
      if (!list.length) { box.innerHTML=""; return; }
      box.innerHTML = list.map(i =>
        `<div class="suggestion" data-full="${i.name}">${i.name}</div>`
      ).join("");
    } catch { box.innerHTML=""; }
  }, 300);
});
box.addEventListener("click", e => {
  const el = e.target.closest(".suggestion");
  if (!el) return;
  input.value = el.dataset.full;
  box.innerHTML = "";
});
document.addEventListener("click", e => {
  if (!box.contains(e.target) && e.target !== input) box.innerHTML = "";
});

// üì§ Odesl√°n√≠ formul√°≈ôe
document.getElementById("reklForm").addEventListener("submit", async e => {
  e.preventDefault();
  const form = e.target;
  const newItem = {
    "ƒå√≠slo objedn√°vky": form.objednavka.value.trim(),
    "ƒå√≠slo reklamace": "NBU-" + Date.now().toString().slice(-7),
    "Z√°kazn√≠k": form.zakaznik.value.trim(),
    "Adresa": form.adresa.value.trim(),
    "Telefon": form.telefon.value.trim(),
    "Email": form.email.value.trim(),
    "Popis CZ": form.popis.value.trim(),
    "Stav": "Nov√° reklamace",
    "Vy≈ôe≈°eno": "NE",
    "Datum pod√°n√≠ reklamace": new Date().toISOString().split("T")[0]
  };

  try {
    const res = await fetch(`https://raw.githubusercontent.com/${GITHUB_USER}/${REPO}/main/${ORDERS_FILE}?${Date.now()}`);
    const data = await res.json().catch(()=>[]);
    data.push(newItem);
    await updateFile(ORDERS_FILE, JSON.stringify(data, null, 2));
    alert("Reklamace byla ulo≈æena.");
    form.reset();
  } catch (err) {
    alert("Chyba p≈ôi ukl√°d√°n√≠: " + err.message);
  }
});

async function updateFile(filename, content) {
  const getRes = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${REPO}/contents/${filename}`, {
    headers: { Authorization: `token ${TOKEN}` }
  });
  const fileData = await getRes.json();
  await fetch(`https://api.github.com/repos/${GITHUB_USER}/${REPO}/contents/${filename}`, {
    method: "PUT",
    headers: {
      Authorization: `token ${TOKEN}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      message: `P≈ôid√°na nov√° reklamace do ${filename}`,
      content: btoa(unescape(encodeURIComponent(content))),
      sha: fileData.sha
    })
  });
}
</script>
</body>
</html>
