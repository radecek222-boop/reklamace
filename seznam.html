<!doctype html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WHITE GLOVE SERVICE – Seznam reklamací</title>
<style>
:root { font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif; color:#111; }
body { margin:0; padding:20px; background:#f6f7fb; }
h1 { text-align:center; font-size:2em; font-weight:900; margin:0 0 10px; }
h2 { text-align:center; font-size:1.1em; font-weight:600; margin:0 0 20px; color:#555; }

.btn-gradient { display:inline-block; text-decoration:none; padding:10px 22px; border-radius:8px;
font-weight:600; font-size:1em; color:#fff; border:none; cursor:pointer;
box-shadow:0 2px 8px rgba(0,0,0,0.15); transition:transform 0.15s ease-in-out, opacity 0.2s; margin:4px; }
.btn-gradient:hover { transform:scale(1.04); opacity:0.9; }

.btn-green { background:linear-gradient(135deg,#00b36b,#3cd67a); }
.btn-gray { background:linear-gradient(135deg,#6c757d,#a0a4a7); }
.btn-blue { background:linear-gradient(135deg,#0046ff,#357aff); }

.top-actions { text-align:center; margin-bottom:20px; }
.searchbox { width:100%; max-width:400px; margin:0 auto 20px; display:block; padding:10px;
border:1px solid #ccc; border-radius:8px; font-size:1em; background:#fff; }

table { width:100%; border-collapse:collapse; background:white; border-radius:8px; overflow:hidden; }
th, td { padding:10px 12px; text-align:left; border-bottom:1px solid #ddd; font-size:0.95em; }
th { background:#eee; font-weight:700; }
tr:hover { background:#f1f3f5; cursor:pointer; }

@media (max-width:768px){ th:nth-child(n+5), td:nth-child(n+5){display:none;} }
#detailModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;justify-content:center;align-items:center;padding:20px;z-index:1000;}
#detailContent{background:white;border-radius:10px;padding:20px;max-width:600px;width:100%;max-height:85vh;overflow-y:auto;box-shadow:0 4px 15px rgba(0,0,0,0.2);}
#detailButtons{text-align:center;margin-top:20px;}
#detailButtons button{margin:5px;padding:10px 16px;border:none;border-radius:8px;cursor:pointer;color:#fff;font-weight:600;transition:transform 0.15s ease,opacity 0.2s;}
#detailButtons button:hover{transform:scale(1.05);opacity:0.9;}
.btn-close{background:linear-gradient(135deg,#6c757d,#a0a4a7);}
.btn-done{background:linear-gradient(135deg,#00b36b,#3cd67a);}
</style>
</head>
<body>
<h1>WHITE GLOVE SERVICE</h1>
<h2>Seznam reklamací a servisních požadavků</h2>

<div class="top-actions">
<a href="hotove.html" class="btn-gradient btn-green">Hotové reklamace</a>
<button onclick="loadOrders()" class="btn-gradient btn-blue">Načíst znovu</button>
</div>

<input type="text" id="searchInput" class="searchbox" placeholder="Hledat podle jména, adresy nebo telefonu...">

<table id="dataTable">
<thead>
<tr><th>#</th><th>OBJEDNÁVKA</th><th>JMÉNO</th><th>ADRESA</th><th>TELEFON</th><th>E-MAIL</th><th>POPIS</th><th>STAV</th></tr>
</thead>
<tbody id="tableBody"><tr><td colspan="8" style="text-align:center;padding:20px;">Načítání dat...</td></tr></tbody>
</table>

<div id="detailModal">
<div id="detailContent">
<h3 id="detailName" style="margin-top:0;"></h3>
<div id="detailInfo"></div>
<div id="detailButtons">
<button id="markDone" class="btn-done">Označit jako hotové</button>
<button id="closeDetail" class="btn-close">Zavřít</button>
</div>
</div>
</div>

<script>
const GITHUB_USER="radecek222-boop",REPO="reklamace",TOKEN="TVŮJ_TOKEN",ORDERS_FILE="orders.json",HOTOVE_FILE="hotove.json";

async function loadOrders(){
 try{
  const res=await fetch(`https://raw.githubusercontent.com/${GITHUB_USER}/${REPO}/main/${ORDERS_FILE}?${Date.now()}`);
  const data=await res.json();
  renderTable(data);
 }catch(e){document.getElementById("tableBody").innerHTML=`<tr><td colspan="8" style="text-align:center;color:red;">Chyba: ${e.message}</td></tr>`;}
}

function renderTable(data){
 const tbody=document.getElementById("tableBody");tbody.innerHTML="";
 data.forEach((item,i)=>{
  const tr=document.createElement("tr");
  tr.innerHTML=`<td>${i+1}</td><td>${item["Číslo objednávky"]||""}</td><td>${item["Zákazník"]||""}</td>
  <td>${item["Adresa"]||""}</td><td>${item["Telefon"]||""}</td><td>${item["Email"]||""}</td>
  <td>${item["Popis CZ"]||""}</td><td>${item["Stav"]||"Nová reklamace"}</td>`;
  tr.addEventListener("click",()=>openDetail(item));
  tbody.appendChild(tr);
 });
}

function openDetail(item){
 const modal=document.getElementById("detailModal");modal.style.display="flex";
 document.getElementById("detailName").textContent=item["Zákazník"]||"Neznámý zákazník";
 document.getElementById("detailInfo").innerHTML=`
  <p><b>Adresa:</b> ${item["Adresa"]||""}</p>
  <p><b>Telefon:</b> ${item["Telefon"]||""}</p>
  <p><b>E-mail:</b> ${item["Email"]||""}</p>
  <p><b>Popis:</b> ${item["Popis CZ"]||""}</p>`;
 document.getElementById("markDone").onclick=()=>markAsDone(item);
}

document.getElementById("closeDetail").onclick=()=>document.getElementById("detailModal").style.display="none";

async function markAsDone(item){
 if(!confirm("Označit jako hotové?"))return;
 try{
  const [ordersRes,hotoveRes]=await Promise.all([
   fetch(`https://raw.githubusercontent.com/${GITHUB_USER}/${REPO}/main/${ORDERS_FILE}?${Date.now()}`),
   fetch(`https://raw.githubusercontent.com/${GITHUB_USER}/${REPO}/main/${HOTOVE_FILE}?${Date.now()}`)
  ]);
  const [orders,hotove]=await Promise.all([ordersRes.json().catch(()=>[]),hotoveRes.json().catch(()=>[])]);
  
  const deleteTime=new Date(Date.now()+48*60*60*1000).toISOString();
  item["Stav"]="Hotovo"; item["Vyřešeno"]="ANO"; item["SmazatFotkyPo"]=deleteTime;

  const updatedOrders=orders.filter(o=>o["Číslo reklamace"]!==item["Číslo reklamace"]);
  hotove.push(item);

  await updateFile(ORDERS_FILE,JSON.stringify(updatedOrders,null,2));
  await updateFile(HOTOVE_FILE,JSON.stringify(hotove,null,2));

  alert("Reklamace označena jako hotová. Fotky budou smazány po 48 hodinách.");
  document.getElementById("detailModal").style.display="none";
  loadOrders();
 }catch(e){alert("Chyba při označení: "+e.message);}
}

async function updateFile(filename,content){
 const metaRes=await fetch(`https://api.github.com/repos/${GITHUB_USER}/${REPO}/contents/${filename}`,{headers:{Authorization:`token ${TOKEN}`}});
 const meta=await metaRes.json();
 await fetch(`https://api.github.com/repos/${GITHUB_USER}/${REPO}/contents/${filename}`,{
  method:"PUT",headers:{Authorization:`token ${TOKEN}`,"Content-Type":"application/json"},
  body:JSON.stringify({message:`Aktualizace ${filename}`,content:btoa(unescape(encodeURIComponent(content))),sha:meta.sha})
 });
}

window.addEventListener("pageshow",loadOrders);
loadOrders();
</script>
</body>
</html>
