<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seznam reklamac√≠ ‚Äì White Glove Service</title>

<!-- Leaflet mapa -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

<!-- Vanilla Calendar -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vanilla-calendar-pro@2.8.1/build/vanilla-calendar.min.css">
<script src="https://cdn.jsdelivr.net/npm/vanilla-calendar-pro@2.8.1/build/vanilla-calendar.min.js"></script>

<!-- PDF Export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
  font-family: "Inter", system-ui, sans-serif;
  background: #f6f7fb;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
}
.wrapper {
  background: #fff;
  padding: 25px;
  margin: 40px 15px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 1200px;
  box-sizing: border-box;
}
h1 {
  text-align: center;
  font-size: 2.2em;
  font-weight: 900;
  color: #111;
  margin: 0 0 8px;
}
h2 {
  text-align: center;
  font-size: 1.1em;
  font-weight: 500;
  color: #666;
  margin: 0 0 25px;
}
.actions {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 15px;
  margin-bottom: 25px;
}
.btn {
  display: inline-block;
  text-decoration: none;
  padding: 10px 24px;
  border-radius: 8px;
  font-weight: 600;
  font-size: 1em;
  border: none;
  cursor: pointer;
  transition: transform 0.15s ease-in-out, opacity 0.2s;
  color: white;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
  min-width: 160px;
}
.btn:hover { transform: scale(1.04); opacity: 0.9; }
.btn-back { background: linear-gradient(135deg, #6c757d, #a0a4a7); }
.btn-refresh { background: linear-gradient(135deg, #b80000, #ff3838); }
.btn-green { background: linear-gradient(135deg, #28a745, #60d06a); }
.btn-plan { background: linear-gradient(135deg, #0046ff, #357aff); }

#search {
  width: 100%;
  padding: 10px;
  margin-bottom: 15px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 1em;
  box-sizing: border-box;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
th, td {
  padding: 10px 8px;
  border-bottom: 1px solid #eee;
  text-align: center;
  font-size: 0.95em;
  white-space: normal;
  line-height: 1.4em;
}
th { background: #f8f8f8; font-weight: 700; }
tr:hover { background: #f1f6ff; cursor: pointer; }

/* üîπ Stavy */
.stav-novy { animation: blikani 1s infinite alternate; background: #ffd600 !important; }
.stav-domluveno { background: #355bff !important; color: #fff !important; }
.stav-zruseno { background: #d93025 !important; color: #fff !important; }
.stav-nezveda { background: #ff9100 !important; color: #000 !important; }

@keyframes blikani {
  from { background-color: #fff176; }
  to { background-color: #ffeb3b; }
}

/* üì± Stejn√° tlaƒç√≠tka na mobilu */
@media (max-width:700px){
  table { display:none; }
  .btn {
    width:100%;
    min-width:unset;
    text-align:center;
  }
}
</style>
</head>
<body>
  <div class="wrapper">
    <h1>WHITE GLOVE SERVICE</h1>
    <h2>Seznam reklamac√≠ a servisn√≠ch po≈æadavk≈Ø</h2>

    <div class="actions">
      <a href="index.html" class="btn btn-back">Zpƒõt</a>
      <button id="reloadBtn" class="btn btn-refresh">Naƒç√≠st znovu</button>
      <a href="hotove.html" class="btn btn-green">Hotov√© reklamace</a>
      <button id="planBtn" class="btn btn-plan">Pl√°n dne</button>
    </div>

    <input type="text" id="search" placeholder="üîç Hledat podle jm√©na, adresy nebo zadavatele...">
    <div id="tableContainer" class="loading">Naƒç√≠t√°m data...</div>
<script>
const API_URL = "https://wgs-token.72nvwf4pb2.workers.dev/orders";
const tableContainer = document.getElementById("tableContainer");
const searchInput = document.getElementById("search");
const reloadBtn = document.getElementById("reloadBtn");
let dataAll = [];
let stavy = JSON.parse(localStorage.getItem("stavyReklamaci") || "{}");

/* üîÑ Naƒç√≠t√°n√≠ dat ka≈æd√© 2 minuty */
setInterval(loadData, 120000);
reloadBtn.onclick = () => loadData(true);
window.addEventListener("DOMContentLoaded", loadData);

/* üß≠ Z√°kladn√≠ funkce */
function simplifyAddress(addr) {
  if (!addr) return "";
  const praha = addr.match(/Praha\s*\d+/i);
  if (praha) return praha[0];
  if (addr.toLowerCase().includes("bƒõchovice")) return "Praha 9";
  return addr.replace(/\d{3}\s?\d{2}$/, "").trim();
}
function formatNoYear(iso) {
  if (!iso) return "";
  const d = new Date(iso);
  if (isNaN(d)) return iso;
  return `${String(d.getDate()).padStart(2,"0")}.${String(d.getMonth()+1).padStart(2,"0")}.`;
}
function sortSmart(a){return a}

/* üßÆ V√Ωpoƒçet vzd√°lenosti */
function calcDistanceCoords(lat1,lon1,lat2,lon2){
  const R=6371;
  const dLat=(lat2-lat1)*Math.PI/180;
  const dLon=(lon2-lon1)*Math.PI/180;
  const aa=Math.sin(dLat/2)**2+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
  return R*2*Math.atan2(Math.sqrt(aa),Math.sqrt(1-aa));
}

/* üìã Naƒçten√≠ a zobrazen√≠ tabulky */
async function loadData(){
  tableContainer.innerHTML="<div class='loading'>Naƒç√≠t√°m data‚Ä¶</div>";
  try{
    const res=await fetch(API_URL,{mode:"cors",cache:"no-store"});
    const data=await res.json();
    if(!Array.isArray(data))throw new Error("Neplatn√Ω form√°t dat");
    dataAll=data.reverse();
    renderTable(dataAll);
  }catch(e){
    tableContainer.innerHTML=`<div style='color:red'>${e.message}</div>`;
  }
}

/* üìÑ Tabulka reklamac√≠ */
function renderTable(arr){
  <script>
// üß≠ Detail z√°kazn√≠ka ‚Äì mus√≠ b√Ωt ve stejn√©m bloku, aby byl p≈ô√≠stupn√Ω z renderTable()
function openDetail(index){
  const item=dataAll[index];
  if(!item)return;

  const overlay=document.createElement("div");
  overlay.className="detail-overlay";
  overlay.innerHTML=`
    <div class="detail-modal">
      <div class="detail-content">
        <div class="detail-info">
          <h2>${item.zakaznik||"Z√°kazn√≠k"}</h2>
          <p><strong>Adresa:</strong>
            <a href="https://waze.com/ul?q=${encodeURIComponent(item.adresa||"")}" target="_blank">
              ${item.adresa||"Neuvedeno"}
            </a>
          </p>
          <p><strong>Telefon:</strong>
            <a href="tel:${(item.telefon||"").replace("+420","").trim()}">
              ${(item.telefon||"").replace("+420","").trim()}
            </a>
          </p>
          <p><strong>Email:</strong> ${item.email||"‚Äì"}</p>
          <p><strong>Produkt / model:</strong> ${item.produkt||"‚Äì"}</p>
          <p><strong>Popis z√°vady:</strong> ${item.popis||"‚Äì"}</p>
          <p><strong>Typ:</strong> ${item.typ||"‚Äì"}</p>
          ${item.typ && item.typ.toLowerCase().includes("poz√°ruƒçn√≠") ? "" :
            `<p><strong>Datum prodeje:</strong> ${item.datum_prodeje||"‚Äì"} |
             <strong>Datum reklamace:</strong> ${item.datum_reklamace||"‚Äì"}</p>`}
          ${
            item.fotky&&item.fotky.length?
              `<div class="foto-container">
                ${item.fotky.map(f=>`<img src="foto/${f}" alt="${f}" onclick="showPhoto(this.src)">`).join("")}
              </div>`:
              `<p style="color:#777;">üì∑ ≈Ω√°dn√© p≈ôilo≈æen√© fotografie</p>`
          }
          <div class="btn-row">
            <button id="termBtn" class="btn-action btn-blue">Domluvit term√≠n</button>
            <button id="protoBtn" class="btn-action btn-green">P≈ôej√≠t na protokol</button>
            <button id="closeBtn" class="btn-action btn-red">Zav≈ô√≠t</button>
          </div>

          <div id="termSection" class="term-section">
            <h3>Domluvit / Zmƒõnit term√≠n</h3>
            <div class="term-center">
              <input type="date" id="datumTerminu" class="term-date">
              <div class="custom-time-picker">
                <select id="hours"></select><span>:</span><select id="minutes"></select>
              </div>
            </div>
            <div class="btn-row">
              <button id="saveTermBtn" class="btn-action btn-green">Ulo≈æit term√≠n</button>
              <button id="noAnswerBtn" class="btn-action btn-orange">Nezved√° to</button>
              <button id="cancelBtn" class="btn-action btn-gray">Z√°kazn√≠k zru≈°il</button>
              <button id="backBtn" class="btn-action btn-red">Zpƒõt</button>
            </div>
          </div>
        </div>
        <div class="detail-map">
          <div id="mapDetail"></div>
          <div id="mapDistance" class="map-distance"></div>
        </div>
      </div>
    </div>
  `;
  document.body.appendChild(overlay);
  setTimeout(()=>overlay.classList.add("active"),10);

  // üó∫Ô∏è mapa z√°kazn√≠ka
  if(item.adresa){
    const map=L.map(overlay.querySelector("#mapDetail")).setView([50.05,14.52],9);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap"}).addTo(map);
    const wgsMarker=L.marker([50.05,14.52]).addTo(map).bindPopup("<b>WGS Praha 9</b>");
    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(item.adresa)}`)
      .then(r=>r.json())
      .then(data=>{
        if(data[0]){
          const coords=[parseFloat(data[0].lat),parseFloat(data[0].lon)];
          const custMarker=L.marker(coords).addTo(map)
            .bindPopup(`<b>${item.zakaznik||"Z√°kazn√≠k"}</b><br>${item.adresa}`);
          const g=L.featureGroup([wgsMarker,custMarker]);
          map.fitBounds(g.getBounds().pad(0.3));
          const dist=calcDistanceCoords(50.05,14.52,coords[0],coords[1]);
          overlay.querySelector("#mapDistance").innerHTML=`üìç Vzd√°lenost: <b>${dist.toFixed(1)} km</b>`;
        }
      });
  }

  overlay.querySelector("#closeBtn").onclick=()=>{
    overlay.classList.remove("active");
    setTimeout(()=>overlay.remove(),200);
  };
}
</script>

  if(!arr.length){tableContainer.innerHTML="≈Ω√°dn√© z√°znamy";return;}
  let html=`<table><thead><tr>
      <th>Z√°kazn√≠k</th><th>Adresa</th><th>Telefon</th><th>Stav</th>
    </tr></thead><tbody>`;
  arr.forEach((r,i)=>{
    const id=r.cislo||`radek-${i}`;
    const stav=stavy[id]||"novy";
    const adresa=r.adresa?`<a href='https://waze.com/ul?q=${encodeURIComponent(r.adresa)}' target='_blank'>${simplifyAddress(r.adresa)}</a>`:"‚Äì";
    const telefon=r.telefon?`<a href='tel:${r.telefon.replace('+420','').trim()}'>${r.telefon.replace('+420','').trim()}</a>`:"‚Äì";
    const stavDetail=(stav==="domluveno"&&r.datum)?`<div style='font-size:.8em'>${formatNoYear(r.datum)} ${r.cas||""}</div>`:"";
    html+=`<tr class='stav-${stav}' data-index='${i}'><td>${r.zakaznik||"‚Äì"}</td><td>${adresa}</td><td>${telefon}</td><td>${stav}${stavDetail}</td></tr>`;
  });
  html+="</tbody></table>";
  tableContainer.innerHTML=html;
  document.querySelectorAll("tbody tr").forEach(row=>{
    row.onclick=()=>openDetail(row.dataset.index);
  });
}

/* üîç Vyhled√°v√°n√≠ */
searchInput.oninput=()=>{
  const q=searchInput.value.toLowerCase();
  const f=dataAll.filter(r=>(r.zakaznik||"").toLowerCase().includes(q)||(r.adresa||"").toLowerCase().includes(q));
  renderTable(f);
};

/* ====================================================== */
/* üí¨ DETAIL REKLAMACE + ULO≈ΩEN√ç TERM√çNU DO localStorage  */
/* ====================================================== */
function openDetail(i){
  const item=dataAll[i];
  if(!item)return;
  const overlay=document.createElement("div");
  overlay.className="detail-overlay";
  overlay.innerHTML=`
  <div class="detail-modal">
    <h2>${item.zakaznik||"Z√°kazn√≠k"}</h2>
    <p><b>Adresa:</b> ${item.adresa||"‚Äì"}</p>
    <p><b>Telefon:</b> ${item.telefon||"‚Äì"}</p>
    <button id="termBtn">Domluvit term√≠n</button>
    <button id="closeBtn">Zav≈ô√≠t</button>
    <div id="termSec" style="display:none;">
      <input type="date" id="datumTerminu">
      <input type="time" id="casTerminu">
      <button id="ulozitTerm">Ulo≈æit</button>
    </div>
    <div id="mapDetail" style="height:250px;margin-top:10px;"></div>
  </div>`;
  document.body.appendChild(overlay);

  const map=L.map("mapDetail").setView([50.05,14.52],8);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
  setTimeout(()=>map.invalidateSize(),300);

  overlay.querySelector("#termBtn").onclick=()=>overlay.querySelector("#termSec").style.display="block";
  overlay.querySelector("#closeBtn").onclick=()=>overlay.remove();
  overlay.querySelector("#ulozitTerm").onclick=()=>{
    const d=overlay.querySelector("#datumTerminu").value;
    const c=overlay.querySelector("#casTerminu").value;
    if(!d||!c)return alert("Vypl≈àte datum i ƒças");
    const id=item.cislo||`radek-${i}`;
    stavy[id]="domluveno";item.datum=d;item.cas=c;
    localStorage.setItem("stavyReklamaci",JSON.stringify(stavy));

    // ulo≈æit i do term√≠n≈Ø pro pl√°n dne
    const terminy=JSON.parse(localStorage.getItem("terminyReklamaci")||"[]");
    terminy.push({datum:d,cas:c,zakaznik:item.zakaznik,adresa:item.adresa});
    localStorage.setItem("terminyReklamaci",JSON.stringify(terminy));

    overlay.remove();renderTable(dataAll);
  };
}
/* ====================================================== */
/* üóìÔ∏è PL√ÅN DNE ‚Äì KALEND√Å≈ò, MAPA A VZD√ÅLENOSTI OD WGS     */
/* ====================================================== */
const planBtn = document.getElementById("planBtn");
function disableBodyScroll(){document.body.style.overflow="hidden";}
function enableBodyScroll(){document.body.style.overflow="";}

planBtn.addEventListener("click",showPlanModal);

function showPlanModal(){
  let modal=document.getElementById("planModal");
  if(!modal){
    modal=document.createElement("div");
    modal.id="planModal";
    modal.innerHTML=`
    <div class="modal-inner">
      <h2>üìÖ Pl√°n dne</h2>
      <div class="plan-content">
        <div>
          <div id="calendar"></div>
          <div class="plan-list" id="planList">Vyberte den v kalend√°≈ôi‚Ä¶</div>
        </div>
        <div id="map"></div>
      </div>
      <div class="plan-actions">
        <button class="btn-action btn-red" onclick="closePlanModal()">Zav≈ô√≠t</button>
      </div>
    </div>`;
    document.body.appendChild(modal);
  }
  modal.classList.add("active");
  disableBodyScroll();

  const calendarElem=document.getElementById("calendar");
  const planList=document.getElementById("planList");
  const terminy=JSON.parse(localStorage.getItem("terminyReklamaci")||"[]");

  const daysWithPlan=new Set(terminy.map(t=>t.datum));
  const calendar=new VanillaCalendar(calendarElem,{
    settings:{lang:"cs"},
    actions:{
      clickDay(e,day){
        const datum=day.date;
        const vybrane=terminy.filter(t=>t.datum===datum);
        if(!vybrane.length){
          planList.innerHTML="üì≠ ≈Ω√°dn√© n√°v≈°tƒõvy pro tento den.";
          showPlanMap([]);
          return;
        }
        // v√Ωpis se vzd√°lenost√≠
        const wgs=[50.05,14.52];
        planList.innerHTML=vybrane.map(t=>{
          const distTxt=t.lat&&t.lon
            ? ` ‚Äì ${calcDistanceCoords(wgs[0],wgs[1],t.lat,t.lon).toFixed(1)} km`
            : "";
          return `<div><b>${t.cas}</b> ‚Äì ${t.zakaznik||""}<br>${t.adresa||""}${distTxt}</div>`;
        }).join("");
        showPlanMap(vybrane);
      }
    }
  });
  calendar.init();
  // zv√Ωrazni dny s pl√°nem
  setTimeout(()=>{
    document.querySelectorAll(".vanilla-calendar-day__btn").forEach(btn=>{
      const d=btn.dataset.calendarDay;
      if(daysWithPlan.has(d))btn.setAttribute("data-has-plan","true");
    });
  },300);
}

function closePlanModal(){
  const m=document.getElementById("planModal");
  if(m){m.classList.remove("active");setTimeout(()=>m.remove(),200);enableBodyScroll();}
}

/* üó∫Ô∏è Mapa v pl√°nu dne + v√Ωpoƒçet vzd√°lenosti od WGS */
async function showPlanMap(zaznamy){
  const mapElem=document.getElementById("map");
  mapElem.innerHTML="";
  const map=L.map(mapElem,{zoomControl:true}).setView([49.8,15.4],7);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap"}).addTo(map);
  setTimeout(()=>map.invalidateSize(),400);

  if(!zaznamy.length)return;

  const wgs=[50.05,14.52];
  L.marker(wgs).addTo(map).bindPopup("<b>WGS ‚Äì Praha 9, Do Dubƒçe</b>");
  const cache=JSON.parse(localStorage.getItem("geoCache")||"{}");
  for(const t of zaznamy){
    let coords;
    if(t.lat&&t.lon){coords=[t.lat,t.lon];}
    else{
      if(cache[t.adresa])coords=cache[t.adresa];
      else{
        const res=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t.adresa)}`);
        const data=await res.json();
        if(data[0]){
          coords=[parseFloat(data[0].lat),parseFloat(data[0].lon)];
          cache[t.adresa]=coords;
          localStorage.setItem("geoCache",JSON.stringify(cache));
          t.lat=coords[0];t.lon=coords[1];
        }
      }
    }
    if(coords){
      const dist=calcDistanceCoords(wgs[0],wgs[1],coords[0],coords[1]);
      L.marker(coords).addTo(map)
        .bindPopup(`<b>${t.zakaznik||"Z√°kazn√≠k"}</b><br>${t.adresa||""}<br>${t.cas||""}<br>üìç ${dist.toFixed(1)} km od WGS`);
    }
  }
}
</script>
<style>
/* ‚ú® Pl√°n dne ‚Äì modal */
#planModal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  justify-content:center;
  align-items:center;
  z-index:99999;
  opacity:0;
  transition:opacity .25s ease;
}
#planModal.active{
  display:flex;
  opacity:1;
}
#planModal .modal-inner{
  background:white;
  border-radius:14px;
  padding:20px;
  width:95%;
  max-width:1100px;
  box-shadow:0 10px 25px rgba(0,0,0,0.3);
  display:flex;
  flex-direction:column;
  gap:20px;
}
#planModal h2{
  text-align:center;
  font-size:1.5em;
  font-weight:800;
  margin:5px 0 15px;
  color:#111;
}
.plan-content{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
}
#calendar{
  border:1px solid #ddd;
  border-radius:10px;
  overflow:hidden;
  background:#fafafa;
  min-height:330px;
}
.vanilla-calendar-day__btn[data-has-plan="true"]{
  background:#357aff!important;
  color:#fff!important;
  border-radius:6px!important;
}
.plan-list{
  max-height:240px;
  overflow-y:auto;
  font-size:0.95em;
  padding:10px;
  border:1px solid #ddd;
  border-radius:10px;
  background:#f9fafc;
  box-shadow:inset 0 1px 3px rgba(0,0,0,0.05);
}
.plan-list div{
  margin-bottom:7px;
  padding:5px 6px;
  border-bottom:1px solid #eee;
  line-height:1.3em;
}
.plan-list div b{
  color:#111;
}
.plan-list div span.dist{
  font-size:0.85em;
  color:#0046ff;
  font-weight:600;
}
#map{
  height:450px;
  border-radius:10px;
  border:1px solid #ddd;
  box-shadow:0 2px 6px rgba(0,0,0,0.08);
}
.plan-actions{
  display:flex;
  justify-content:center;
  gap:15px;
}
.btn-action{
  text-decoration:none;
  padding:10px 20px;
  border-radius:8px;
  font-weight:600;
  color:#fff;
  border:none;
  cursor:pointer;
  transition:transform .15s ease,opacity .2s ease;
  box-shadow:0 3px 8px rgba(0,0,0,0.15);
}
.btn-action:hover{transform:scale(1.05);opacity:.9;}
.btn-red{
  background:linear-gradient(135deg,#dc3545,#f87171);
}
.btn-green{
  background:linear-gradient(135deg,#28a745,#6fdd72);
}

/* üì± Mobiln√≠ rozlo≈æen√≠ */
@media(max-width:750px){
  .plan-content{
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  #calendar{
    width:100%;
    max-width:360px;
    margin:0 auto;
  }
  #map{
    width:100%;
    height:320px;
  }
  .plan-list{
    width:100%;
    margin-top:10px;
  }
  #planModal .modal-inner{
    width:94%;
    padding:15px;
  }
}
</style>
<style>
/* ============================= */
/* üí¨ DETAIL MODAL STYL          */
/* ============================= */
.detail-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  display:flex;
  justify-content:center;
  align-items:center;
  opacity:0;
  transition:opacity .25s ease;
  z-index:9999;
}
.detail-overlay.active{opacity:1;}

.detail-modal{
  background:#fff;
  border-radius:16px;
  width:90%;
  max-width:950px;
  padding:25px 30px;
  box-shadow:0 10px 25px rgba(0,0,0,0.3);
  overflow-y:auto;
  max-height:90vh;
  animation:fadeIn .3s ease;
}
@keyframes fadeIn{
  from{transform:translateY(20px);opacity:0;}
  to{transform:translateY(0);opacity:1;}
}
.detail-content{
  display:flex;
  flex-direction:row;
  gap:20px;
}
.detail-info{
  flex:1.2;
}
.detail-map{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:10px;
}
#mapDetail{
  height:280px;
  width:100%;
  border-radius:10px;
  border:1px solid #ddd;
}
.map-distance{
  font-size:0.95em;
  text-align:center;
  color:#333;
  padding-top:5px;
}
.detail-modal h2{
  text-align:center;
  font-size:1.6em;
  font-weight:800;
  margin:0 0 10px;
}
.detail-modal p{
  font-size:0.95em;
  margin:6px 0;
  color:#333;
}
.detail-modal a{
  color:#0046ff;
  text-decoration:none;
}
.detail-modal a:hover{text-decoration:underline;}

/* üñºÔ∏è Fotky */
.foto-container{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  justify-content:center;
  margin:15px 0;
}
.foto-container img{
  width:120px;
  height:120px;
  object-fit:cover;
  border-radius:8px;
  cursor:pointer;
  transition:transform .2s ease;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
.foto-container img:hover{transform:scale(1.06);}

/* üéõÔ∏è Sekce term√≠nu */
.term-section{
  display:none;
  margin-top:25px;
  padding-top:15px;
  border-top:1px solid #ddd;
}
.term-section h3{
  text-align:center;
  font-size:1.2em;
  margin-bottom:18px;
}
.term-center{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:18px;
}
.term-date{
  font-size:1.5em;
  padding:12px 16px;
  border-radius:10px;
  border:1px solid #ccc;
  text-align:center;
  font-weight:600;
  outline:none;
  transition:border-color .2s,box-shadow .2s;
}
.term-date:focus{
  border-color:#0046ff;
  box-shadow:0 0 0 2px rgba(0,70,255,.25);
}
.custom-time-picker{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:8px;
}
.custom-time-picker select{
  font-size:1.3em;
  font-weight:600;
  border-radius:10px;
  padding:6px 12px;
  border:1px solid #ccc;
  outline:none;
}
.custom-time-picker select:focus{
  border-color:#0046ff;
  box-shadow:0 0 0 2px rgba(0,70,255,.25);
}

/* üß≠ Tlaƒç√≠tka v modalu */
.btn-row{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
  margin-top:20px;
}
.btn-action{
  flex:1;
  min-width:150px;
  text-align:center;
  padding:10px;
  border:none;
  border-radius:8px;
  font-weight:600;
  color:white;
  cursor:pointer;
  transition:transform .15s ease,opacity .2s ease;
  box-shadow:0 3px 8px rgba(0,0,0,.15);
}
.btn-action:hover{transform:scale(1.05);opacity:.9;}
.btn-blue{background:linear-gradient(135deg,#007bff,#399bff);}
.btn-green{background:linear-gradient(135deg,#28a745,#6fdd72);}
.btn-gray{background:linear-gradient(135deg,#6c757d,#9ca3af);}
.btn-orange{background:linear-gradient(135deg,#ff9800,#ffc270);color:#222;}
.btn-red{background:linear-gradient(135deg,#dc3545,#f87171);}

/* üì± Mobiln√≠ zobrazen√≠ */
@media(max-width:750px){
  .detail-content{flex-direction:column;}
  .detail-modal{width:94%;padding:20px;}
  .btn-row{flex-direction:column;}
  .btn-action{width:100%;font-size:.95em;}
  #mapDetail{height:300px;}
}

/* üß≠ Fix pro iPhone/Safari */
@supports(-webkit-touch-callout:none){
  .detail-overlay{
    top:0;left:0;width:100vw;height:100dvh;
    overflow-y:auto;-webkit-overflow-scrolling:touch;
  }
  .detail-modal{max-height:100dvh;overflow-y:auto;}
  body.modal-open{position:fixed;width:100%;overflow:hidden;}
}
</style>
<script>
/* =============================== */
/* üì∏ N√ÅHLED FOTKY NA CELOU OBRAZOVKU */
/* =============================== */
function showPhoto(src){
  const viewer=document.createElement("div");
  viewer.className="photo-viewer";
  viewer.innerHTML=`
    <div class="photo-viewer-inner">
      <img src="${src}" alt="">
      <button class="close-viewer">√ó</button>
    </div>`;
  document.body.appendChild(viewer);
  viewer.querySelector(".close-viewer").onclick=()=>viewer.remove();
  viewer.onclick=e=>{if(e.target===viewer)viewer.remove();};
}

/* =============================== */
/* ‚ö° BLINK dne≈°n√≠ch term√≠n≈Ø v tabulce */
/* =============================== */
function highlightTodayRows(){
  const today=new Date().toISOString().split("T")[0];
  document.querySelectorAll("tbody tr").forEach(row=>{
    const index=row.dataset.index;
    const item=dataAll[index];
    if(item && item.datum===today && stavy[item.cislo||`radek-${index}`]==="domluveno"){
      row.classList.add("blink-today");
    }else{
      row.classList.remove("blink-today");
    }
  });
}

/* üíæ Ulo≈æen√≠ term√≠nu do localStorage */
function ulozTermin(zaznam){
  let data=JSON.parse(localStorage.getItem("terminyReklamaci")||"[]");
  const id=zaznam.cislo||zaznam.id;
  data=data.filter(z=>z.cislo!==id);
  data.push(zaznam);
  localStorage.setItem("terminyReklamaci",JSON.stringify(data));
}

/* ‚è±Ô∏è Kontrola p≈ôekryvu term√≠n≈Ø (2 h rozd√≠l) */
function checkOverlap(datum,cas){
  const ulozene=JSON.parse(localStorage.getItem("terminyReklamaci")||"[]");
  const nove=new Date(`${datum}T${cas}`);
  return ulozene.filter(z=>{
    if(z.datum!==datum)return false;
    const exist=new Date(`${z.datum}T${z.cas}`);
    const diff=Math.abs((exist-nove)/36e5);
    return diff<2;
  });
}

/* üîÑ Automatick√© zv√Ωraznƒõn√≠ dne≈°n√≠ch term√≠n≈Ø */
setInterval(highlightTodayRows,30000);
window.addEventListener("storage",e=>{
  if(e.key==="stavyReklamaci"||e.key==="terminyReklamaci"){
    setTimeout(highlightTodayRows,300);
  }
});
window.addEventListener("DOMContentLoaded",()=>setTimeout(highlightTodayRows,500));
</script>

<style>
/* üî¥ Blik√°n√≠ dne≈°n√≠ch term√≠n≈Ø */
@keyframes blinkToday{
  0%{background-color:#fff2f2;}
  50%{background-color:#ffdada;}
  100%{background-color:#fff2f2;}
}
.blink-today{
  animation:blinkToday 1.4s infinite;
}

/* üì∏ Fullscreen n√°hled fotky */
.photo-viewer{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.85);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:10000;
}
.photo-viewer-inner{
  position:relative;
  max-width:90vw;
  max-height:85vh;
}
.photo-viewer-inner img{
  width:100%;
  height:auto;
  border-radius:10px;
}
.close-viewer{
  position:absolute;
  top:-15px;
  right:-15px;
  background:#ff3b30;
  color:white;
  border:none;
  border-radius:50%;
  width:32px;
  height:32px;
  cursor:pointer;
  font-size:1.2em;
  font-weight:bold;
}
</style>

</body>
</html>
