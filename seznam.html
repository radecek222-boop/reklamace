<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Seznam reklamac√≠ ‚Äì White Glove Service</title>
<style>
body {
  font-family: "Inter", system-ui, sans-serif;
  background: #f6f7fb;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
}
.wrapper {
  background: #fff;
  padding: 25px;
  margin: 40px 15px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 1000px;
  position: relative;
}
h1 {
  text-align: center;
  font-size: 2.2em;
  font-weight: 900;
  color: #111;
  margin: 0 0 8px;
}
h2 {
  text-align: center;
  font-size: 1.1em;
  font-weight: 500;
  color: #666;
  margin: 0 0 25px;
}
.actions {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}
.btn {
  padding: 10px 24px;
  border-radius: 8px;
  font-weight: 600;
  color: #fff;
  cursor: pointer;
  border: none;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: 0.2s;
}
.btn:hover { transform: scale(1.05); opacity: 0.9; }
.btn-back { background: linear-gradient(135deg,#6c757d,#a0a4a7); }
.btn-refresh { background: linear-gradient(135deg,#0046ff,#357aff); }
.btn-green { background: linear-gradient(135deg,#28a745,#5bd85b); }
.btn-gray { background: linear-gradient(135deg,#6c757d,#9ca3af); }
.btn-blue { background: linear-gradient(135deg,#007bff,#4da3ff); }
.btn-orange { background: linear-gradient(135deg,#ff9800,#ffb74d); }
.btn-red { background: linear-gradient(135deg,#dc3545,#f87171); }

#search {
  width: 100%;
  padding: 10px;
  margin-bottom: 20px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 1em;
}

/* üìã Tabulka */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
th, td {
  padding: 10px;
  border-bottom: 1px solid #eee;
  text-align: left;
}
th { background: #f8f8f8; font-weight: 700; }
tr:hover { background: #f1f6ff; cursor: pointer; }

/* ü©µ Modal */
.modal-overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
.modal {
  background: #fff;
  border-radius: 12px;
  padding: 25px;
  max-width: 800px;
  width: 90%;
  max-height: 85vh;
  overflow-y: auto;
  box-shadow: 0 10px 25px rgba(0,0,0,0.3);
  animation: fadeIn 0.3s ease;
}
@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.95); }
  to { opacity: 1; transform: scale(1); }
}

/* üïì Rolovac√≠ v√Ωbƒõr ƒçasu */
.custom-time {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
}
.custom-time select {
  font-size: 1.3em;
  font-weight: 600;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 6px 10px;
  background: #fff;
}

/* üîÅ Galerie */
.thumb-img {
  width: 90px; height: 90px;
  object-fit: cover;
  border-radius: 8px;
  margin: 4px;
  cursor: pointer;
  transition: transform 0.2s;
}
.thumb-img:hover { transform: scale(1.05); }
.fullscreen {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.9);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10000;
}
.fullscreen img {
  max-width: 90%;
  max-height: 85%;
  border-radius: 12px;
}

/* üí° Blik√°n√≠ dne≈°n√≠ch term√≠n≈Ø */
@keyframes blinkRed {
  0% { background-color: #ffe0e0; }
  50% { background-color: #ffb3b3; }
  100% { background-color: #ffe0e0; }
}
.blink-today {
  animation: blinkRed 1.2s infinite;
}
</style>
</head>

<body>
<div class="wrapper">
  <h1>WHITE GLOVE SERVICE</h1>
  <h2>Seznam reklamac√≠ a servisn√≠ch po≈æadavk≈Ø</h2>

  <div class="actions">
    <a href="index.html" class="btn btn-back">Zpƒõt</a>
    <button id="reloadBtn" class="btn btn-refresh">Naƒç√≠st znovu</button>
  </div>

  <input type="text" id="search" placeholder="üîç Hledat z√°kazn√≠ka, adresu nebo ƒç√≠slo...">

  <div id="tableContainer" class="loading">Naƒç√≠t√°m data...</div>
</div>

<script>
const API_URL = "https://wgs-token.72nvwf4pb2.workers.dev/orders";
let dataAll = [];
let stavy = JSON.parse(localStorage.getItem("stavyReklamaci") || "{}");

async function loadData() {
  const res = await fetch(API_URL);
  const data = await res.json();
  dataAll = data.reverse();
  renderTable(dataAll);
}

/* üßæ Tabulka se 4 sloupci */
function renderTable(arr) {
  if (!arr.length) {
    tableContainer.innerHTML = "<div class='loading'>≈Ω√°dn√© z√°znamy</div>";
    return;
  }
  let html = `
  <table>
    <thead><tr><th>#</th><th>Z√°kazn√≠k</th><th>Adresa</th><th>Telefon</th><th>Stav</th></tr></thead>
    <tbody>`;
  arr.forEach((r,i)=>{
    const id = r.cislo || `radek-${i}`;
    const stav = stavy[id] || "nov√Ω";
    html += `<tr data-index="${i}" class="${stav==='domluveno' && r.datum===today() ? 'blink-today':''}">
      <td>${i+1}</td>
      <td>${r.zakaznik||""}</td>
      <td>${r.adresa||""}</td>
      <td><a href="tel:${r.telefon||''}">${r.telefon||""}</a></td>
      <td>${stav}</td></tr>`;
  });
  html += "</tbody></table>";
  tableContainer.innerHTML = html;
  document.querySelectorAll("tbody tr").forEach(tr => {
    tr.addEventListener("click",()=>openDetail(tr.dataset.index));
  });
}

/* üß≠ Dne≈°n√≠ datum */
function today(){ return new Date().toISOString().split("T")[0]; }

/* üí¨ Detail */
function openDetail(index){
  const r=dataAll[index]; if(!r)return;
  const overlay=document.createElement("div");
  overlay.className="modal-overlay"; overlay.style.display="flex";

  // üñº galerie
  let photos="";
  if(r.foto&&r.foto.length){
    photos=r.foto.map(src=>`<img src="${src}" class="thumb-img" onclick="openFull('${src}')">`).join("");
  }

  overlay.innerHTML=`
  <div class="modal">
    <h2 style="text-align:center;margin-top:0;">${r.zakaznik||"Z√°kazn√≠k"}</h2>
    <p><strong>Adresa:</strong> ${r.adresa||""}</p>
    <p><strong>Telefon:</strong> <a href="tel:${r.telefon||""}">${r.telefon||""}</a></p>
    <p><strong>E-mail:</strong> ${r.email||"neuveden"}</p>
    <p><strong>Zadavatel:</strong> ${r.contract||""}</p>
    <p><strong>Typ:</strong> ${r.typ||""}</p>
    <p><strong>Popis:</strong> ${r.popis||"‚Äî"}</p>
    <div style="margin:10px 0;text-align:center;">${photos}</div>

    <div class="actions" style="margin-top:25px;">
      <button id="termBtn" class="btn btn-blue">üîµ Domluvit term√≠n</button>
      <button id="protoBtn" class="btn btn-green">üü¢ P≈ôej√≠t na protokol</button>
      <button id="closeBtn" class="btn btn-gray">‚úñ Zav≈ô√≠t</button>
    </div>

    <div id="termSection" style="display:none;margin-top:20px;border-top:1px solid #ddd;padding-top:15px;">
      <p><strong>Zadej term√≠n n√°v≈°tƒõvy:</strong></p>
      <input type="date" id="datumTerminu">
      <div class="custom-time" id="casPicker"></div>
      <div class="actions" style="margin-top:15px;">
        <button id="saveBtn" class="btn btn-green">üü¢ Ulo≈æit term√≠n</button>
        <button id="noBtn" class="btn btn-orange">üü† Nezved√° to</button>
        <button id="cancelBtn" class="btn btn-red">üî¥ Z√°kazn√≠k zru≈°il</button>
        <button id="backBtn" class="btn btn-gray">‚Ü© Zpƒõt</button>
      </div>
    </div>
  </div>`;

  document.body.appendChild(overlay);

  /* Hodiny rolovac√≠ */
  const casPicker=document.getElementById("casPicker");
  const hours=document.createElement("select");
  const mins=document.createElement("select");
  for(let h=0;h<24;h++) hours.innerHTML+=`<option>${String(h).padStart(2,"0")}</option>`;
  for(let m=0;m<60;m+=5) mins.innerHTML+=`<option>${String(m).padStart(2,"0")}</option>`;
  casPicker.append(hours,document.createTextNode(":"),mins);

  const section=document.getElementById("termSection");
  document.getElementById("termBtn").onclick=()=>section.style.display="block";
  document.getElementById("backBtn").onclick=()=>section.style.display="none";

  document.getElementById("saveBtn").onclick=()=>{
    const d=document.getElementById("datumTerminu").value;
    const t=`${hours.value}:${mins.value}`;
    if(!d)return alert("Vypl≈à datum!");
    const id=r.cislo||`radek-${index}`;
    stavy[id]="domluveno"; r.datum=d; r.cas=t;
    localStorage.setItem("stavyReklamaci",JSON.stringify(stavy));
    overlay.remove(); renderTable(dataAll);
  };
  document.getElementById("noBtn").onclick=()=>{updateStav(index,"nezveda");overlay.remove();};
  document.getElementById("cancelBtn").onclick=()=>{updateStav(index,"zruseno");overlay.remove();};
  document.getElementById("protoBtn").onclick=()=>{
    localStorage.setItem("selectedRecord",JSON.stringify(r));
    window.location.href="protokol.html";
  };
  document.getElementById("closeBtn").onclick=()=>overlay.remove();
}

/* üì∏ Zvƒõt≈°en√≠ fotky */
function openFull(src){
  const full=document.createElement("div");
  full.className="fullscreen";
  full.innerHTML=`<img src="${src}" alt=""><button style="position:absolute;top:20px;right:20px;font-size:2em;color:white;background:none;border:none;">‚úñ</button>`;
  document.body.appendChild(full);
  full.querySelector("button").onclick=()=>full.remove();
}

/* üîÅ Stav */
function updateStav(i,s){
  const id=dataAll[i].cislo||`radek-${i}`;
  stavy[id]=s; localStorage.setItem("stavyReklamaci",JSON.stringify(stavy)); renderTable(dataAll);
}

/* üîç Vyhled√°v√°n√≠ */
search.addEventListener("input",()=>{
  const q=search.value.toLowerCase();
  const f=dataAll.filter(r=>(r.zakaznik||"").toLowerCase().includes(q)||(r.adresa||"").toLowerCase().includes(q)||(r.telefon||"").includes(q));
  renderTable(f);
});

reloadBtn.onclick=loadData;
window.addEventListener("DOMContentLoaded",loadData);
</script>
</body>
</html>
