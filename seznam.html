<!-- 
====================================================================
üíé WHITE GLOVE SERVICE ‚Äì SEZNAM REKLAMAC√ç
====================================================================
Verze syst√©mu:       v1.0
Datum sestaven√≠:     2025-10-08
Autor:               Hugo (White Glove Service) & GPT-5
Projekt:             WGS reklamace / servisn√≠ pl√°nov√°n√≠
Soubory:             seznam.html (hlavn√≠ p≈ôehled), orders.json (data)
Worker:              https://wgs-token.72nvwf4pb2.workers.dev/orders
Repozit√°≈ô:           https://github.com/radecek222-boop/reklamace
Popis:
  Kompletn√≠ rozhran√≠ pro zobrazen√≠ a spr√°vu reklamac√≠.
  - P≈ô√≠m√© naƒç√≠t√°n√≠ dat z GitHub JSON p≈ôes Cloudflare Worker
  - Mapa, kalend√°≈ô, pl√°n dne a ukl√°d√°n√≠ term√≠n≈Ø
  - Kompatibiln√≠ s iPhone Safari a desktop prohl√≠≈æeƒçi

Struktura souboru:
  A ‚Äì Struktura str√°nky a tlaƒç√≠tka
  B ‚Äì Naƒç√≠t√°n√≠ dat a tabulka + debug
  C ‚Äì Detail z√°kazn√≠ka
  D ‚Äì Ulo≈æen√≠ term√≠nu (GitHub + toast)
  E ‚Äì Pl√°n dne (mapa + trasa)
  F ‚Äì Pomocn√© funkce a utilitky
  G ‚Äì Extern√≠ knihovny a glob√°ln√≠ inicializace

Posledn√≠ √∫prava:     2025-10-08 / 14:00  
====================================================================
-->



<!-- üü® SEKCE A ‚Äì Z√ÅKLAD (struktura str√°nky, styly, tlaƒç√≠tka, vyhled√°v√°n√≠) -->
<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seznam reklamac√≠ ‚Äì White Glove Service</title>

<!-- üåç Leaflet mapa -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

<!-- üìÑ PDF Export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* ============================= */
/* üß± Z√ÅKLADN√ç VZHLED STR√ÅNKY     */
/* ============================= */
body {
  font-family: "Inter", system-ui, sans-serif;
  background: #f6f7fb;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
}
.wrapper {
  background: #fff;
  padding: 25px;
  margin: 40px 15px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 1200px;
  box-sizing: border-box;
}

/* ============================= */
/* üè∑Ô∏è NADPISY                    */
/* ============================= */
h1 {
  text-align: center;
  font-size: 2.2em;
  font-weight: 900;
  color: #111;
  margin: 0 0 8px;
}
h2 {
  text-align: center;
  font-size: 1.1em;
  font-weight: 500;
  color: #666;
  margin: 0 0 25px;
}

/* ============================= */
/* üîò HLAVN√ç TLAƒå√çTKA (akce)     */
/* ============================= */
.actions {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 15px;
  margin-bottom: 25px;
}
.btn {
  display: inline-block;
  text-decoration: none;
  padding: 10px 24px;
  border-radius: 8px;
  font-weight: 600;
  font-size: 1em;
  border: none;
  cursor: pointer;
  transition: transform 0.15s ease-in-out, opacity 0.2s;
  color: white;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
  min-width: 160px;
}
.btn:hover { transform: scale(1.04); opacity: 0.9; }

/* üé® Barvy tlaƒç√≠tek */
.btn-back    { background: linear-gradient(135deg, #6c757d, #a0a4a7); }
.btn-refresh { background: linear-gradient(135deg, #b80000, #ff3838); }
.btn-green   { background: linear-gradient(135deg, #28a745, #60d06a); text-align:center; }
.btn-plan    { background: linear-gradient(135deg, #0046ff, #357aff); }

/* ============================= */
/* üîç VYHLED√ÅV√ÅN√ç                */
/* ============================= */
#search {
  width: 100%;
  padding: 10px;
  margin-bottom: 15px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 1em;
  box-sizing: border-box;
}

/* ============================= */
/* üìã TABULKA Z√ÅZNAM≈Æ            */
/* ============================= */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
th, td {
  padding: 10px 8px;
  border-bottom: 1px solid #eee;
  text-align: center;
  font-size: 0.95em;
  white-space: normal;
  line-height: 1.4em;
  color: #000;
  font-weight: 400;
}
th {
  background: #f8f8f8;
  font-weight: 700;
  color: #000;
}
td.adresa,
td.telefon { font-weight: 600; }
tr:hover { background: #f1f6ff; cursor: pointer; }

/* ============================= */
/* üü¢ STAVY REKLAMAC√ç            */
/* ============================= */
.stav-novy      { background: #fff9b1 !important; }
.stav-domluveno { background: #99b3ff !important; }
.stav-zruseno   { background: #ff6666 !important; }
.stav-nezveda   { background: #ffad33 !important; }

/* ============================= */
/* üì± MOBILN√ç ZOBRAZEN√ç          */
/* ============================= */
@media (max-width:700px){
  table { display:none; }
  .btn {
    width:100%;
    min-width:unset;
    text-align:center;
  }
}
</style>
</head>

<body>
  <div class="wrapper">
    <!-- üßæ HLAVIƒåKA STR√ÅNKY -->
    <h1>WHITE GLOVE SERVICE</h1>
    <h2>Seznam reklamac√≠ a servisn√≠ch po≈æadavk≈Ø</h2>

    <!-- üß≠ OVL√ÅDAC√ç TLAƒå√çTKA -->
    <div class="actions">
      <a href="index.html" class="btn btn-back">Zpƒõt</a>
      <button id="reloadBtn" class="btn btn-refresh">Naƒç√≠st znovu</button>
      <a href="hotove.html" class="btn btn-green">Hotov√© reklamace</a>
      <button id="planBtn" class="btn btn-plan">Pl√°n dne</button>
    </div>

    <!-- üîç VYHLED√ÅV√ÅN√ç -->
    <input type="text" id="search" placeholder="üîç Hledat podle jm√©na, adresy nebo zadavatele...">

<!-- üì¶ M√çSTO PRO TABULKU -->
<div id="tableContainer" class="loading">Naƒç√≠t√°m data...</div>
</div>

<!-- üîù Automatick√Ω posun p≈ôi otev≈ôen√≠ kalend√°≈ôe -->
<script>
document.addEventListener("click", e => {
  if (e.target && e.target.id === "termBtn") {
    setTimeout(() => {
      window.scrollTo({ top: 0, behavior: "smooth" });
    }, 150);
  }
});
</script>

<!-- üü¢ Stabiln√≠ barva pro hotov√© reklamace -->
<style>
tr.stav-hotovo td {
  background: #b6f2c0 !important;
  color: #116d2b !important;
  font-weight: 700;
}
tr.stav-hotovo:hover td {
  background: #a5e8b1 !important;
}
</style>

</body>
</html>
<!-- üü® KONEC SEKCE A -->

<!-- üü© ZAƒå√ÅTEK STYL ‚Äì MOBILN√ç BLOKY -->
<style>
/* üì± Kontejner pro mobiln√≠ bloky */
.mob-container {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 10px;
}

/* üì¶ Jeden mobiln√≠ z√°znam */
.mob-block {
  background: #fff;
  border-radius: 10px;
  padding: 10px 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  border-left: 5px solid transparent;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}
.mob-block:hover {
  transform: scale(1.01);
  box-shadow: 0 3px 10px rgba(0,0,0,0.12);
}

/* 1. ≈ô√°dek ‚Äì jm√©no a adresa */
.mob-line1 {
  font-weight: 600;
  color: #111;
  font-size: 1.05em;
  display: flex;
  flex-wrap: wrap;
}
.mob-addr {
  color: #444;
  font-weight: 400;
}

/* 2. ≈ô√°dek ‚Äì datum, ƒças, Waze, telefon */
.mob-line2 {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 6px;
  font-size: 0.92em;
  color: #333;
}
.mob-actions {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Tlaƒç√≠tko WAZE */
.waze-btn {
  display: inline-block;
  border: 1px solid #0066ff;
  border-radius: 6px;
  padding: 2px 10px 3px;
  font-size: 0.85em;
  font-weight: 600;
  color: #0066ff;
  background: #eaf1ff;
  text-decoration: none;
}

/* Telefonn√≠ tlaƒç√≠tko */
.phone-btn {
  display: inline-flex;
  justify-content: center;
  align-items: center;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: #f4f4f4;
  text-decoration: none;
  font-size: 1.1em;
  box-shadow: 0 1px 3px rgba(0,0,0,0.15);
}

/* üü¢ Barvy dle stavu */
.mob-block.stav-novy { border-left-color: #ffea70; }
.mob-block.stav-domluveno { border-left-color: #80aaff; }
.mob-block.stav-nezveda { border-left-color: #ffa84d; }
.mob-block.stav-zruseno { border-left-color: #ff5c5c; }
.mob-block.stav-hotovo { border-left-color: #5cd65c; }
</style>
<!-- üü© KONEC STYL ‚Äì MOBILN√ç BLOKY -->





<!-- üü¶ SEKCE B ‚Äì NAƒå√çT√ÅN√ç DAT + TABULKA + DEBUG (opraven√° verze) -->
<script>
/* ============================= */
/* ‚öôÔ∏è KONSTANTY A PROMƒöNN√â       */
/* ============================= */
const API_URL = "https://wgs-token.72nvwf4pb2.workers.dev/orders";
const tableContainer = document.getElementById("tableContainer");
const searchInput = document.getElementById("search");
const reloadBtn = document.getElementById("reloadBtn");

let dataAll = [];
let stavy = JSON.parse(localStorage.getItem("stavyReklamaci") || "{}");

/* ============================= */
/* üîÑ AUTOMATICK√â NAƒå√çT√ÅN√ç DAT   */
/* ============================= */
setInterval(loadData, 120000); // ka≈æd√© 2 minuty

/* ============================= */
/* üß≠ NAƒå√çT√ÅN√ç DAT Z API          */
/* ============================= */
async function loadData() {
  console.log("üì• Naƒç√≠t√°m data z Workeru‚Ä¶");
  tableContainer.innerHTML = "<div class='loading'>Naƒç√≠t√°m data...</div>";

  try {
    const res = await fetch(API_URL, { mode: "cors", cache: "no-store" });
    if (!res.ok) throw new Error(`Chyba HTTP ${res.status}`);
    let data = await res.json();

    if (!Array.isArray(data)) {
      if (typeof data === "object" && Object.keys(data).length > 0) {
        data = Object.values(data);
      } else throw new Error("Worker nevrac√≠ platn√© z√°znamy");
    }

    console.log("üì¶ Worker data:", data);
    updateDebug(data.length);

    if (!data.length) {
      tableContainer.innerHTML = "<div>≈Ω√°dn√© z√°znamy</div>";
      return;
    }

    // üíæ doplnƒõn√≠ ulo≈æen√Ωch term√≠n≈Ø
    const ulozene = JSON.parse(localStorage.getItem("stavyReklamaciData") || "[]");
    data.forEach(z => {
      const u = ulozene.find(x => x.cislo === z.cislo);
      if (u) { z.datum = u.datum; z.cas = u.cas; }
    });

    dataAll = data.reverse();
    renderTable(dataAll);

  } catch (err) {
    console.error("‚ùå Chyba p≈ôi naƒç√≠t√°n√≠:", err);
    tableContainer.innerHTML =
      `<div style='color:red;font-weight:600;'>Chyba naƒç√≠t√°n√≠ dat: ${err.message}</div>`;
    updateDebug(0);
  }
}

/* ============================= */
/* üìã VYKRESLEN√ç TABULKY / BLOK≈Æ */
/* ============================= */
function renderTable(arr) {
  if (!arr || !arr.length) {
    tableContainer.innerHTML = "<div>≈Ω√°dn√© z√°znamy</div>";
    return;
  }

  // üì± Mobiln√≠ zobrazen√≠
  if (window.innerWidth < 700) {
    console.log("üì± Mobiln√≠ re≈æim ‚Äì vykresluji bloky");
    renderMobileBlocks(arr);
    return;
  }

  // üíª Desktop tabulka
  let html = `
  <table>
    <thead>
      <tr>
        <th>Z√°kazn√≠k</th>
        <th>Adresa</th>
        <th>Telefon</th>
        <th>Stav</th>
      </tr>
    </thead>
    <tbody>`;

  arr.forEach((r, i) => {
    const id = r.cislo || `radek-${i}`;
    const stav = stavy[id] || r.stav || "novy";

    const adresa = r.adresa
      ? `<a href="https://waze.com/ul?q=${encodeURIComponent(r.adresa)}" target="_blank"
         style="color:#000;font-weight:600;">${r.adresa}</a>` : "‚Äì";
    const telefon = r.telefon
      ? `<a href="tel:${r.telefon.replace('+420','').trim()}"
         style="color:#000;font-weight:600;">${r.telefon.replace('+420','').trim()}</a>` : "‚Äì";

    // üé® Stav + barva + text
    let barva = "";
    let stavText = stav;
    if (stav === "domluveno" && r.datum && r.cas) {
      const d = new Date(r.datum);
      stavText = `${d.toLocaleDateString("cs-CZ",{weekday:"short",day:"numeric",month:"numeric"})} ${r.cas}`;
      barva = "background:#dfe8ff;color:#0046ff;font-weight:700;";
    } else if (stav === "ceka") {
      stavText = "ƒåek√° na d√≠ly";
      barva = "background:#ede0ff;color:#5c00b8;font-weight:700;";
    } else if (stav === "nezveda") {
      stavText = "Z√°kazn√≠k nezved√° ‚Äì posl√°na SMS";
      barva = "background:#ffe6b3;color:#cc7a00;font-weight:700;";
    } else if (stav === "zruseno") {
      stavText = "Zru≈°eno";
      barva = "background:#ffcccc;color:#a30000;font-weight:700;";
    } else if (stav === "novy") {
      stavText = "Nov√°";
      barva = "background:#fff9b1;color:#000;font-weight:700;animation:blinkRow 1.2s infinite;";
    }

    html += `
      <tr class="stav-${stav}" data-index="${i}">
        <td>${r.zakaznik || "‚Äì"}</td>
        <td>${adresa}</td>
        <td>${telefon}</td>
        <td style="${barva}text-align:center;">${stavText}</td>
      </tr>`;
  });

  html += "</tbody></table>";
  tableContainer.innerHTML = html;

  document.querySelectorAll("tbody tr").forEach(row => {
    row.addEventListener("click", () => openDetail(row.dataset.index));
  });
}

/* ============================= */
/* üîç VYHLED√ÅV√ÅN√ç                */
/* ============================= */
searchInput.addEventListener("input", () => {
  const q = searchInput.value.trim().toLowerCase();
  if (!q) return renderTable(dataAll);
  renderTable(dataAll.filter(r =>
    (r.zakaznik || "").toLowerCase().includes(q) ||
    (r.adresa || "").toLowerCase().includes(q)
  ));
});

/* ============================= */
/* üîÅ RUƒåN√ç NAƒåTEN√ç DAT           */
/* ============================= */
reloadBtn.addEventListener("click", loadData);

/* ============================= */
/* üß© DEBUG PANEL                 */
/* ============================= */
function updateDebug(count) {
  const c = document.getElementById("debugCount");
  const t = document.getElementById("debugTime");
  if (!c || !t) return;
  c.textContent = count;
  t.textContent = new Date().toLocaleTimeString("cs-CZ",
    { hour:"2-digit", minute:"2-digit", second:"2-digit" });
}
</script>

<style>
@keyframes blinkRow {
  0%,100% { background:#fff9b1; }
  50% { background:#fff06b; }
}
</style>

<!-- üß© DEBUG PANEL (vizu√°ln√≠ info) -->
<div id="debugBox"
     style="font-family:Inter,sans-serif;font-size:12px;color:#333;
            position:fixed;bottom:10px;right:12px;background:#f7f7f7;
            border:1px solid #ccc;border-radius:8px;padding:8px 12px;
            box-shadow:0 2px 6px rgba(0,0,0,0.1);z-index:9999;">
  Naƒçteno: <span id="debugCount">0</span> z√°znam≈Ø<br>
  <small>Aktualizace: <span id="debugTime">‚Äì</span></small>
</div>
<!-- üü¶ KONEC SEKCE B -->


<!-- üü¶ ZAƒå√ÅTEK B-2 ‚Äì MOBILN√ç BLOKY (FIN√ÅLN√ç ZAROVN√ÅN√ç A BARVY) -->
<script>
function normalizeAddress(address) {
  if (!address) return "Nezn√°m√° adresa";
  let parts = address.split(",");
  parts = parts.map(p => p.trim()).filter(p => !/^\d{3}\s?\d{2}/.test(p) && !/ƒåesko|Czech/i.test(p));
  let ulice = parts[0] || "";
  let mesto = parts[1] || "";
  const m = address.match(/\b1\d{2}\s?(\d{2})\b/);
  if (/Praha/i.test(mesto) && m) {
    const obvod = m[1]?.[0];
    if (obvod) mesto = `Praha ${obvod}`;
  }
  return `${ulice}${mesto ? ", " + mesto : ""}`;
}

function renderMobileBlocks(arr) {
  if (!arr || !arr.length) {
    tableContainer.innerHTML = "<div>≈Ω√°dn√© z√°znamy</div>";
    return;
  }

  const html = arr.map((r, i) => {
    const stav = (r.stav || "novy").toLowerCase();
    const adresa = normalizeAddress(r.adresa);
    const datum = r.datum
      ? new Date(r.datum).toLocaleDateString("cs-CZ", { day: "2-digit", month: "2-digit", year: "numeric" })
      : "";
    const cas = r.cas || "";
    const wazeUrl = r.adresa ? `https://waze.com/ul?q=${encodeURIComponent(r.adresa)}` : "";
    const phoneUrl = r.telefon ? `tel:${r.telefon.replace(/\s+/g, '')}` : "";

    let stavText = "";
    let barva = "";
    switch (stav) {
      case "domluveno":
        stavText = `${datum}${cas ? " ¬∑ " + cas : ""}`;
        barva = "background:#dfe8ff;";
        break;
      case "ceka":
        stavText = "ƒåek√° na d√≠ly";
        barva = "background:#ede0ff;";
        break;
      case "nezveda":
        stavText = "Z√°kazn√≠k nezved√° ‚Äì posl√°na SMS";
        barva = "background:#ffe6b3;";
        break;
      case "zruseno":
        stavText = "Zru≈°eno";
        barva = "background:#ffcccc;";
        break;
      case "hotovo":
        stavText = "Hotovo";
        barva = "background:#b6f2c0;";
        break;
      default:
        stavText = "Nov√°";
        barva = "background:#fff9b1;animation:blinkRow 1.3s infinite;";
    }

    return `
      <div class="mob-block" style="${barva}" onclick="openDetail(${i})">
        <div class="mob-top">
          <div class="mob-addr">${adresa}</div>
          ${wazeUrl ? `<a href="${wazeUrl}" target="_blank" class="waze-btn">WAZE</a>` : ""}
        </div>
        <div class="mob-name">${r.zakaznik || "Nezn√°m√Ω z√°kazn√≠k"}</div>
        <div class="mob-mid">
          <div class="mob-date">${stavText}</div>
          ${phoneUrl ? `<a href="${phoneUrl}" class="phone-btn">üìû</a>` : ""}
        </div>
      </div>`;
  }).join("");

  tableContainer.innerHTML = `<div class="mob-container">${html}</div>`;
}
</script>

<style>
/* üì± Kontejner ‚Äì p≈ôesn√° ≈°√≠≈ôka jako tlaƒç√≠tka */
.mob-container {
  display: flex;
  flex-direction: column;
  gap: 10px;
  width: calc(100% + 50px);
  margin-left: -25px;
  margin-right: -25px;
  margin-top: 5px;
}

/* üì¶ Jeden blok */
.mob-block {
  width: 100%;
  border-radius: 10px;
  padding: 10px 14px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.08);
  color: #000;
  text-align: left;
  box-sizing: border-box;
  transition: transform .15s ease, box-shadow .15s ease;
}
.mob-block:hover {
  transform: scale(1.01);
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
}

/* üè∑Ô∏è Horn√≠ ≈ô√°dek ‚Äì adresa + Waze */
.mob-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 6px;
}
.mob-addr {
  font-weight: 600;
  font-size: 0.95em;
  flex: 1;
  word-break: break-word;
}
.waze-btn {
  border: 1px solid #0066ff;
  border-radius: 6px;
  padding: 1px 7px 2px;
  font-size: 0.8em;
  font-weight: 600;
  color: #0066ff;
  background: #eaf1ff;
  text-decoration: none;
}

/* üìÖ Prost≈ôedn√≠ ≈ô√°dek ‚Äì stav + telefon */
.mob-mid {
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  margin-top: 6px;
}
.mob-date {
  font-size: 0.9em;
  font-weight: 600;
  color: #000;
  flex: 1;
}
.phone-btn {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 38px;
  height: 38px;
  border-radius: 50%;
  background: rgba(255,255,255,0.85);
  text-decoration: none;
  font-size: 1.1em;
  box-shadow: 0 2px 5px rgba(0,0,0,0.25);
  position: relative;
  bottom: 0;
}

/* üë§ Spodn√≠ ≈ô√°dek ‚Äì jm√©no */
.mob-name {
  margin-top: 2px;
  font-size: 0.95em;
  font-weight: 700;
  color: #000;
}

/* ‚ú® Efekt blik√°n√≠ pro nov√© */
@keyframes blinkRow {
  0%,100% { background:#fff9b1; }
  50% { background:#fff06b; }
}
</style>
<!-- üü¶ KONEC B-2 ‚Äì MOBILN√ç BLOKY (FIN√ÅLN√ç ZAROVN√ÅN√ç A BARVY) -->







<!-- üü© SEKCE C ‚Äì DETAIL Z√ÅKAZN√çKA (rozdƒõlen√° verze) -->
<!-- ================================================= -->

<!-- üü© C-1 + C-4: DETAIL Z√ÅKAZN√çKA ‚Äì ≈ΩIV√â HODINY VEDLE KALEND√Å≈òE (OPRAVENO) -->
<script>
function openDetail(index) {
  const item = dataAll[index];
  if (!item) return;

  const overlay = document.createElement("div");
  overlay.className = "detail-overlay";
  const adresaUpravena = normalizePrahaAddress(item.adresa || "");

  overlay.innerHTML = `
    <div class="detail-modal">
      <div class="grid-layout">
        <!-- üß≠ LEV√ù PANEL -->
        <div class="left-panel">

          <!-- üóìÔ∏è Kalend√°≈ô vlevo + ≈æiv√© hodiny vpravo -->
          <div class="date-time-row">
            <div id="miniCalendar"></div>

            <div class="date-right-column">
              <div class="live-clock" id="liveClock">
                <div class="clock-face">
                  <div class="hand hour"></div>
                  <div class="hand minute"></div>
                  <div class="hand second"></div>
                  <div class="center-dot"></div>
                </div>
              </div>
              <div class="term-info-box" id="termInfoBox">Nen√≠ vybr√°n datum</div>
            </div>
          </div>

          <!-- üü© DLA≈ΩDICE 3√ó2 -->
          <div class="tile-grid">
            <button id="contactBtn" class="tile-btn btn-grayContact">Kontaktovat z√°kazn√≠ka</button>
            <button id="closeBtn" class="tile-btn btn-lightgray">Zpƒõt</button>

            <button id="saveTermBtn" class="tile-btn btn-green">Ulo≈æit / Zmƒõnit term√≠n</button>
            <button id="waitBtn" class="tile-btn btn-purple">Z√°kazn√≠k ƒçek√° na d√≠ly</button>

            <button id="startVisitBtn" class="tile-btn btn-redBlink">Zah√°jit n√°v≈°tƒõvu</button>
            <button id="createProtocolBtn" class="tile-btn btn-blue">Vytvo≈ôit protokol</button>
          </div>
        </div>

        <!-- üßæ PRAV√ù PANEL -->
        <div class="right-panel">
          <div class="info-box clickable" id="customerBox">
            <div class="box-header"><strong>Z√°kazn√≠k</strong></div>
            <div class="box-content">
              <p><strong>Jm√©no:</strong> ${item.zakaznik || "‚Äì"}</p>
              <p><strong>Adresa:</strong> ${adresaUpravena}</p>
              <p><strong>Telefon:</strong> ${item.telefon || "‚Äì"}</p>
              <p><strong>Email:</strong> ${item.email || "‚Äì"}</p>
              <p><strong>Produkt / model:</strong> ${item.produkt || "‚Äì"}</p>
            </div>
          </div>

          <div class="info-box clickable" id="popisBox">
            <div class="box-header"><strong>Popis z√°vady</strong></div>
            <div class="box-content" id="popisContent">${item.popis || "‚Äì"}</div>
          </div>

          <div class="distance-banner" id="mapDistance">üìç Poƒç√≠t√°m vzd√°lenost‚Ä¶</div>
          <div id="mapDetail"></div>
        </div>
      </div>
    </div>`;

  document.body.appendChild(overlay);
  setTimeout(() => overlay.classList.add("active"), 10);

  // Inicializace podp≈Ørn√Ωch ƒç√°st√≠
  initCalendarAndTime(overlay, item, index);
  initMapForDetail(overlay, item);
  initDetailButtons(overlay, item, index);

  // Klikac√≠ boxy
  overlay.querySelector("#customerBox").onclick = () => openCustomerDetail(item, overlay);
  overlay.querySelector("#popisBox").onclick = () => openPopisEditor(item, overlay);

  // Spu≈°tƒõn√≠ ≈æiv√Ωch hodin
  startLiveClock(overlay.querySelector("#liveClock"));
}

// üïí Funkce pro ≈æiv√© hodiny
function startLiveClock(clockContainer) {
  const hourHand = clockContainer.querySelector(".hand.hour");
  const minuteHand = clockContainer.querySelector(".hand.minute");
  const secondHand = clockContainer.querySelector(".hand.second");

  function updateClock() {
    const now = new Date();
    const h = now.getHours() % 12;
    const m = now.getMinutes();
    const s = now.getSeconds();

    const hourDeg = (h + m / 60) * 30;
    const minuteDeg = (m + s / 60) * 6;
    const secondDeg = s * 6;

    hourHand.style.transform = `rotate(${hourDeg}deg)`;
    minuteHand.style.transform = `rotate(${minuteDeg}deg)`;
    secondHand.style.transform = `rotate(${secondDeg}deg)`;
  }

  updateClock();
  setInterval(updateClock, 1000);
}
</script>

<!-- üé® Styl ≈æiv√Ωch hodin -->
<style>
.live-clock {
  width: 70px;
  height: 70px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto;
}

.clock-face {
  position: relative;
  width: 70px;
  height: 70px;
  border: 2px solid #ccc;
  border-radius: 50%;
  background: #fff;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

.hand {
  position: absolute;
  width: 50%;
  height: 2px;
  background: #333;
  top: 50%;
  transform-origin: 100%;
  transform: rotate(0deg);
  transition: transform 0.5s cubic-bezier(.4,2.3,.3,1);
}
.hand.hour {
  width: 30%;
  height: 3px;
  background: #222;
}
.hand.minute {
  width: 40%;
  background: #444;
}
.hand.second {
  width: 45%;
  background: #e53935;
  height: 1.5px;
}

.center-dot {
  position: absolute;
  width: 6px;
  height: 6px;
  background: #333;
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
</style>
<!-- üü© KONEC C-1 + C-4 (≈ΩIV√â HODINY, OPRAVENO) -->




<!-- üü© C-2: MAPA A VZD√ÅLENOST -->
<script>
function initMapForDetail(overlay, item) {
  if (!item.adresa) return;
  const wgs = [50.049, 14.523];
  const map = L.map(overlay.querySelector("#mapDetail")).setView(wgs, 9);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
    { attribution: "¬© OpenStreetMap" }).addTo(map);
  const wgsM = L.marker(wgs, { title: "WGS" }).addTo(map);

  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(item.adresa)}`)
    .then(r => r.json())
    .then(d => {
      if (d[0]) {
        const c = [+d[0].lat, +d[0].lon];
        const cust = L.marker(c, { title: "Z√°kazn√≠k" }).addTo(map);
        L.polyline([wgs, c], { color: "#0046ff", weight: 3 }).addTo(map);
        const dist = calcDistanceCoords(wgs[0], wgs[1], c[0], c[1]);
        overlay.querySelector("#mapDistance").innerHTML =
          `Vzd√°lenost od WGS: ${dist.toFixed(1)} km`;
        map.fitBounds(L.featureGroup([wgsM, cust]).getBounds().pad(0.3));
      }
    });
}
</script>
<!-- üü© KONEC C-2 -->


<!-- üü© C-3: KALEND√Å≈ò A ƒåAS -->
<script>
function initCalendarAndTime(overlay, item, index) {
  const infoBox = overlay.querySelector("#termInfoBox");
  const miniCal = new VanillaCalendar("#miniCalendar", {
    settings: { lang: "cs", selection: { day: "single" }, visibility: { theme: "light" } },
    actions: { clickDay: e => {
      const chosen = e.target.dataset.calendarDay;
      if (chosen) {
        overlay.dataset.datum = chosen;
        updateTermInfoBox(infoBox, chosen, null);
        flashBox(infoBox, "gray");
      }
    } }
  });
  miniCal.init();

  // hodiny
  const hSel = overlay.querySelector("#hours"), mSel = overlay.querySelector("#minutes");
  for (let h = 7; h < 20; h++) hSel.innerHTML += `<option>${String(h).padStart(2,"0")}</option>`;
  for (let m = 0; m < 60; m += 5) mSel.innerHTML += `<option>${String(m).padStart(2,"0")}</option>`;
  hSel.addEventListener("change", () => updateTime(infoBox, overlay));
  mSel.addEventListener("change", () => updateTime(infoBox, overlay));
}
</script>
<!-- üü© KONEC C-3 -->








<!-- üü© C-5: POMOCN√â FUNKCE -->
<script>
function updateTermInfoBox(b, d, c) {
  const date = new Date(d);
  const den = date.toLocaleDateString("cs-CZ", { weekday: "long", day: "numeric", month: "long" });
  b.textContent = c ? `${den} ‚Äì ${c}` : `${den}`;
}
function updateTime(b, o) {
  const d = o.dataset.datum; if (!d) return;
  const c = `${o.querySelector("#hours").value}:${o.querySelector("#minutes").value}`;
  updateTermInfoBox(b, d, c); flashBox(b, "green");
}
function flashBox(b, color) {
  b.classList.remove("flash-gray", "flash-green"); void b.offsetWidth;
  b.classList.add(color === "green" ? "flash-green" : "flash-gray");
}
function calcDistanceCoords(a, b, c, d) {
  const R = 6371, dL = (c - a) * Math.PI / 180, dO = (d - b) * Math.PI / 180;
  const x = Math.sin(dL/2)**2 + Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(dO/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(x), Math.sqrt(1 - x));
}
</script>
<!-- üü© KONEC C-5 -->


<!-- üü© C-STYLE: CSS DETAILU -->
<style>
/* üü¶ P≈ôekryv ‚Äì vycentrovan√Ω modal uprost≈ôed */
.detail-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.55);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  opacity: 0;
  transition: opacity 0.25s ease;
}
.detail-overlay.active { opacity: 1; }

.detail-modal {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.25);
  padding: 20px;
  width: 95%;
  max-width: 1100px;
  max-height: 90vh;
  overflow-y: auto;
}

/* üü¶ Rozlo≈æen√≠ dvou panel≈Ø */
.grid-layout {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}
.left-panel, .right-panel {
  background: #fff;
  border-radius: 10px;
  padding: 10px;
}

/* üóìÔ∏è Kalend√°≈ô + ƒças */
#miniCalendar { margin-bottom: 12px; }
.custom-time-picker {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 6px;
  margin-bottom: 10px;
}
.custom-time-picker select {
  font-size: 1.1em;
  font-weight: 600;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 5px 10px;
}

/* üü® Informaƒçn√≠ boxy */
.info-box {
  background: #f4f5f7;
  border-radius: 10px;
  padding: 12px 14px;
  margin-bottom: 14px;
  cursor: pointer;
  transition: background .2s;
}
.info-box:hover { background: #e9ecf1; }
.box-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: 700;
  color: #333;
  margin-bottom: 6px;
}
.box-content p {
  margin: 3px 0;
  font-size: 0.92em;
}
.icon {
  font-size: 1.1em;
  color: #555;
}

/* üü¶ Tlaƒç√≠tka vlevo */
.left-buttons {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 10px;
}
.btn-action {
  padding: 10px;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  color: #fff;
  cursor: pointer;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
}
.btn-green  { background: linear-gradient(135deg, #28a745, #6fdd72); }
.btn-orange { background: linear-gradient(135deg, #ff9800, #ffc270); color: #222; }
.btn-red    { background: linear-gradient(135deg, #dc3545, #f87171); }
.btn-gray   { background: linear-gradient(135deg, #6c757d, #a0a4a7); }
.btn-blue   { background: linear-gradient(135deg, #0046ff, #357aff); color: #fff; }

/* üß© Prostor mapy */
.distance-banner {
  background: #f6f6f6;
  border-radius: 8px;
  padding: 8px;
  text-align: center;
  font-weight: 600;
  margin: 10px 0;
}
#mapDetail {
  height: 280px;
  border-radius: 10px;
  border: 1px solid #ddd;
  margin-top: 8px;
}

/* üîÅ Animace term-info boxu */
.term-info-box {
  background: #f0f0f0;
  padding: 10px;
  text-align: center;
  font-weight: 600;
  border-radius: 8px;
  margin-top: 8px;
  transition: background .3s;
}
.flash-gray { animation: flashGray .4s; }
.flash-green { animation: flashGreen .5s 2; }
@keyframes flashGray { 0%{background:#d6d6d6;}100%{background:#f0f0f0;} }
@keyframes flashGreen { 0%,100%{background:#b6f7a8;}50%{background:#d8ffd2;} }

/* üì± Mobiln√≠ √∫pravy */
@media (max-width: 700px) {
  .grid-layout { grid-template-columns: 1fr; }
  .left-buttons { flex-direction: column; }
  #mapDetail { height: 240px; }
  .detail-modal { padding: 10px; }
}
</style>
<!-- üü© KONEC C-STYLE -->







<!-- üü© C-6: EDITACE Z√ÅKAZN√çKA A POPISU (modern√≠ mod√°ln√≠ styl) -->
<script>
function openCustomerDetail(item, overlay) {
  const modal = document.createElement("div");
  modal.className = "edit-modal";

  modal.innerHTML = `
    <div class="edit-window">
      <h3>‚úèÔ∏è √öprava √∫daj≈Ø z√°kazn√≠ka</h3>
      <div class="form-row"><label>Jm√©no</label><input id="editZakaznik" value="${item.zakaznik || ""}" /></div>
      <div class="form-row"><label>Adresa</label><input id="editAdresa" value="${item.adresa || ""}" /></div>
      <div class="form-row"><label>Telefon</label><input id="editTelefon" value="${item.telefon || ""}" /></div>
      <div class="form-row"><label>Email</label><input id="editEmail" value="${item.email || ""}" /></div>
      <div class="form-row"><label>Produkt / model</label><input id="editProdukt" value="${item.produkt || ""}" /></div>

      <div class="btn-row">
        <button id="saveCustomerBtn" class="btn-green">üíæ Ulo≈æit</button>
        <button id="cancelCustomerBtn" class="btn-gray">Zru≈°it</button>
      </div>
    </div>
  `;

  document.body.appendChild(modal);
  setTimeout(() => modal.classList.add("active"), 10);

  modal.querySelector("#cancelCustomerBtn").onclick = () => modal.remove();
  modal.querySelector("#saveCustomerBtn").onclick = async () => {
    item.zakaznik = modal.querySelector("#editZakaznik").value.trim();
    item.adresa = modal.querySelector("#editAdresa").value.trim();
    item.telefon = modal.querySelector("#editTelefon").value.trim();
    item.email = modal.querySelector("#editEmail").value.trim();
    item.produkt = modal.querySelector("#editProdukt").value.trim();

    try {
      const res = await fetch("https://wgs-token.72nvwf4pb2.workers.dev/orders", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "update", record: item })
      });
      if (!res.ok) throw new Error("HTTP " + res.status);
      setNextToast("‚úÖ √ödaje z√°kazn√≠ka byly ulo≈æeny", "success");
      modal.remove();
      overlay.remove();
      renderTable(dataAll);
    } catch (err) {
      alert("‚ùå Chyba p≈ôi ukl√°d√°n√≠: " + err.message);
    }
  };
}

function openPopisEditor(item, overlay) {
  const modal = document.createElement("div");
  modal.className = "edit-modal";

  modal.innerHTML = `
    <div class="edit-window">
      <h3>üõ†Ô∏è √öprava popisu z√°vady</h3>
      <textarea id="editPopis" class="edit-textarea" placeholder="Zadejte popis probl√©mu">${item.popis || ""}</textarea>
      <div class="btn-row">
        <button id="savePopisBtn" class="btn-green">üíæ Ulo≈æit</button>
        <button id="cancelPopisBtn" class="btn-gray">Zru≈°it</button>
      </div>
    </div>
  `;

  document.body.appendChild(modal);
  setTimeout(() => modal.classList.add("active"), 10);

  modal.querySelector("#cancelPopisBtn").onclick = () => modal.remove();
  modal.querySelector("#savePopisBtn").onclick = async () => {
    item.popis = modal.querySelector("#editPopis").value.trim();

    try {
      const res = await fetch("https://wgs-token.72nvwf4pb2.workers.dev/orders", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "update", record: item })
      });
      if (!res.ok) throw new Error("HTTP " + res.status);
      setNextToast("‚úÖ Popis z√°vady ulo≈æen", "success");
      modal.remove();
      overlay.remove();
      renderTable(dataAll);
    } catch (err) {
      alert("‚ùå Chyba p≈ôi ukl√°d√°n√≠: " + err.message);
    }
  };
}
</script>

<style>
/* üåô P≈ôekryv edit okna */
.edit-modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10000;
  opacity: 0;
  transition: opacity .25s ease;
}
.edit-modal.active { opacity: 1; }

/* üíé Okno */
.edit-window {
  background: #fff;
  border-radius: 14px;
  padding: 22px 26px;
  width: 90%;
  max-width: 460px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  font-family: "Inter", sans-serif;
  animation: fadeIn .3s ease;
}
@keyframes fadeIn { from{transform:scale(.95);opacity:.6;} to{transform:scale(1);opacity:1;} }

.edit-window h3 {
  margin-top: 0;
  margin-bottom: 16px;
  text-align: center;
  font-weight: 700;
  color: #222;
}

/* üìã Formul√°≈ôov√© ≈ô√°dky */
.form-row {
  display: flex;
  flex-direction: column;
  margin-bottom: 10px;
}
.form-row label {
  font-size: 0.9em;
  color: #444;
  margin-bottom: 4px;
}
.form-row input {
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 7px 10px;
  font-size: 1em;
  transition: border .2s;
}
.form-row input:focus {
  outline: none;
  border-color: #4caf50;
}

/* ‚úèÔ∏è Textarea */
.edit-textarea {
  width: 100%;
  min-height: 120px;
  border: 1px solid #ccc;
  border-radius: 10px;
  padding: 8px 10px;
  font-family: "Inter", sans-serif;
  resize: vertical;
  transition: border .2s;
}
.edit-textarea:focus { border-color: #4caf50; outline: none; }

/* üîò Tlaƒç√≠tka */
.btn-row {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 12px;
}
.btn-green {
  background: linear-gradient(135deg,#4caf50,#6fdd72);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  padding: 8px 16px;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: transform .2s;
}
.btn-green:hover { transform: scale(1.05); }
.btn-gray {
  background: linear-gradient(135deg,#999,#bbb);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  padding: 8px 16px;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}
</style>
<!-- üü© KONEC C-6 -->









<!-- üüß SEKCE D ‚Äì ULO≈ΩEN√ç TERM√çNU NA GITHUB + TOAST + LOADER -->
<script>
/* ========================================================= */
/* üíæ ULO≈ΩEN√ç TERM√çNU P≈òES WORKER (GITHUB)                   */
/* ========================================================= */
async function ulozitTerminNaGitHub(item, id, datum, cas, overlay, btn, infoBox) {
  stavy[id] = "domluveno";
  item.datum = datum;
  item.cas = cas;

  // ‚è≥ Loader ‚Äûƒåekejte‚Äú
  const loader = document.createElement("div");
  loader.className = "loader-overlay";
  loader.innerHTML = `
    <div class="loader-inner">
      <div class="hourglass"></div>
      <div>‚è≥ ƒåekejte, ukl√°d√°m term√≠n‚Ä¶</div>
    </div>`;
  document.body.appendChild(loader);

  try {
    // üíæ Ulo≈æen√≠ p≈ôes Worker na GitHub
    const res = await fetch("https://wgs-token.72nvwf4pb2.workers.dev/orders", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action: "update", record: item })
    });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);

    // ‚úÖ Potvrzen√≠
    setTimeout(() => {
      loader.remove();
      showSuccessOverlay("‚úÖ Term√≠n √∫spƒõ≈°nƒõ ulo≈æen",
        "Data byla odesl√°na a potvrzena v GitHub repozit√°≈ôi.");
      ulozTermin(item);
      localStorage.setItem("stavyReklamaci", JSON.stringify(stavy));
      flashBox(infoBox, "green");
      setNextToast("‚úÖ Term√≠n √∫spƒõ≈°nƒõ ulo≈æen", "success");

      setTimeout(() => {
        overlay.remove();
        renderTable(dataAll);
      }, 1400);
    }, 800);

  } catch (err) {
    loader.remove();
    alert("‚ùå Chyba p≈ôi ukl√°d√°n√≠ term√≠nu: " + err.message);
    showToast("Chyba p≈ôi ukl√°d√°n√≠!", "error");
  }
}

/* ========================================================= */
/* üåü TOAST A SUCCESS OVERLAY                                */
/* ========================================================= */
function showToast(msg, type = "success") {
  const toast = document.createElement("div");
  toast.className = `wgs-toast ${type}`;
  toast.innerHTML = `<span>${msg}</span>`;
  document.body.appendChild(toast);
  setTimeout(() => toast.classList.add("active"), 50);
  setTimeout(() => {
    toast.classList.remove("active");
    setTimeout(() => toast.remove(), 400);
  }, 3500);
}

// pro p≈ôenos zpr√°vy do dal≈°√≠ho naƒçten√≠
function setNextToast(msg, type = "success") {
  sessionStorage.setItem("wgsToastMsg", msg);
  sessionStorage.setItem("wgsToastType", type);
}

// po reloadu zobraz toast z p≈ôedchoz√≠ akce
window.addEventListener("DOMContentLoaded", () => {
  const toastMsg = sessionStorage.getItem("wgsToastMsg");
  const toastType = sessionStorage.getItem("wgsToastType");
  if (toastMsg) {
    showToast(toastMsg, toastType);
    sessionStorage.removeItem("wgsToastMsg");
    sessionStorage.removeItem("wgsToastType");
  }
});

/* ========================================================= */
/* üéâ SUCCESS OVERLAY (velk√° b√≠l√° hl√°≈°ka uprost≈ôed)          */
/* ========================================================= */
function showSuccessOverlay(title, text) {
  const ok = document.createElement("div");
  ok.className = "successOverlay";
  ok.innerHTML = `
    <div class="successInner">
      <div class="icon">‚úÖ</div>
      <div class="title">${title}</div>
      <div class="text">${text}</div>
    </div>`;
  document.body.appendChild(ok);
  setTimeout(() => ok.classList.add("active"), 50);
  setTimeout(() => {
    ok.classList.remove("active");
    setTimeout(() => ok.remove(), 400);
  }, 1800);
}
</script>

<!-- üüß D-STYLE: LOADER + TOAST + SUCCESS OVERLAY -->
<style>
.loader-overlay {
  position: fixed; inset: 0;
  background: rgba(255,255,255,0.88);
  display: flex; flex-direction: column;
  justify-content: center; align-items: center;
  font-family: "Inter", sans-serif;
  color: #0046ff; font-weight: 700;
  font-size: 1.2em; z-index: 99999;
}
.hourglass {
  width: 44px; height: 44px;
  border: 4px solid #0046ff;
  border-radius: 50%;
  border-top-color: transparent;
  animation: spin 1.1s linear infinite;
  margin-bottom: 12px;
}
@keyframes spin { from {transform:rotate(0)} to {transform:rotate(360deg)} }

.successOverlay {
  position: fixed; inset: 0;
  background: rgba(255,255,255,0.9);
  display: flex; justify-content: center; align-items: center;
  opacity: 0; transition: opacity 0.3s ease; z-index: 100000;
}
.successOverlay.active { opacity: 1; }
.successInner {
  background: #fff;
  border-left: 6px solid #28a745;
  border-radius: 12px;
  padding: 25px 30px;
  text-align: center;
  font-family: "Inter", sans-serif;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  max-width: 360px;
}
.successInner .icon { font-size: 2em; margin-bottom: 10px; }
.successInner .title { font-size: 1.3em; font-weight: 800; color: #28a745; margin-bottom: 6px; }
.successInner .text { font-size: 0.95em; color: #333; }

/* Toast vpravo naho≈ôe */
.wgs-toast {
  position: fixed; top: 20px; right: 20px;
  background: #fff;
  padding: 14px 22px;
  border-radius: 8px;
  box-shadow: 0 3px 12px rgba(0,0,0,0.15);
  font-family: "Inter", sans-serif;
  font-size: 0.95em;
  font-weight: 600;
  color: #111;
  opacity: 0; transform: translateY(-10px);
  transition: all 0.35s ease; z-index: 100001;
}
.wgs-toast.active { opacity: 1; transform: translateY(0); }
.wgs-toast.success { border-left: 5px solid #28a745; }
.wgs-toast.error { border-left: 5px solid #dc3545; }
.wgs-toast.warning { border-left: 5px solid #ff9800; }
</style>
<!-- üüß KONEC SEKCE D -->






<!-- üü¶ SEKCE E ‚Äì PL√ÅN DNE (kalend√°≈ô, mapa, trasa, legenda) -->
<!-- ====================================================== -->

<!-- üü¶ E-1: OTEV≈òEN√ç OKNA PL√ÅNU DNE -->
<script>
function openPlanModal() {
  const overlay = document.createElement("div");
  overlay.id = "planModal";
  overlay.innerHTML = `
    <div class="planContent">
      <div class="planLeft">
        <div id="planCalendar"></div>
        <div id="planLegend"></div>
        <button id="planCloseBtn" class="btn-close">Zpƒõt</button>
      </div>
      <div class="planRight">
        <div id="planMap"></div>
        <div id="planList"></div>
      </div>
    </div>`;
  document.body.appendChild(overlay);
  setTimeout(()=>overlay.classList.add("active"),20);

  initPlanCalendar(overlay);
  overlay.querySelector("#planCloseBtn").onclick = ()=>overlay.remove();
}
</script>
<!-- üü¶ KONEC E-1 -->


<!-- üü¶ E-2: KALEND√Å≈ò A NAƒåTEN√ç DN√ç -->
<script>
function initPlanCalendar(overlay){
  const cal = new VanillaCalendar("#planCalendar",{
    settings:{ lang:"cs", selection:{ day:"single" }, visibility:{ theme:"light" }},
    actions:{ clickDay:e=>{
      const d = e.target.dataset.calendarDay;
      if(!d)return;
      loadPlanForDay(d,overlay);
    }}
  });
  cal.init();

  // vyznaƒçit dny s term√≠nem modr√Ωm punt√≠kem
  const data = dataAll.filter(x=>x.datum);
  data.forEach(r=>{
    const el=document.querySelector(`[data-calendar-day="${r.datum}"]`);
    if(el) el.classList.add("vanilla-calendar-day__btn_selected");
  });
}
</script>
<!-- üü¶ KONEC E-2 -->


<!-- üü¶ E-3: NAƒåTEN√ç A ZOBRAZEN√ç DNƒö -->
<script>
async function loadPlanForDay(date,overlay){
  const list=dataAll.filter(r=>r.datum===date && r.stav!=="zruseno");
  const planList=overlay.querySelector("#planList");
  const planLegend=overlay.querySelector("#planLegend");
  const planMap=overlay.querySelector("#planMap");

  if(!list.length){
    planList.innerHTML="<div class='empty'>≈Ω√°dn√© zak√°zky pro tento den</div>";
    planLegend.innerHTML="";
    planMap.innerHTML="";
    return;
  }

  // se≈ôadit podle ƒçasu
  list.sort((a,b)=>(a.cas||"").localeCompare(b.cas||""));
  planList.innerHTML="";
  planLegend.innerHTML="";

  let legendHTML="<table class='legendTable'><tr><th>#</th><th>ƒåas</th><th>Z√°kazn√≠k</th></tr>";
  list.forEach((r,i)=>{
    legendHTML+=`<tr><td>${i+1}</td><td>${r.cas||"-"}</td><td>${r.zakaznik}</td></tr>`;
  });
  legendHTML+="</table>";
  planLegend.innerHTML=legendHTML;

  planList.innerHTML=list.map((r,i)=>`
    <div class="planItem">
      <div class="planNum">${i+1}</div>
      <div class="planName">${r.zakaznik}</div>
      <div class="planAddr">${r.adresa}</div>
      <div class="planTime">${r.cas}</div>
    </div>`).join("");

  await showPlanMap(list,planMap);
}
</script>
<!-- üü¶ KONEC E-3 -->


<!-- üü¶ E-4: MAPA A TRASA -->
<script>
async function showPlanMap(list,container){
  const wgs=[50.049,14.523];
  const map=L.map(container).setView(wgs,9);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap"}).addTo(map);
  const points=[wgs];
  const markers=[L.marker(wgs,{title:"WGS"})];
  const geos=[];

  for(const r of list){
    if(!r.adresa)continue;
    const geo=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(r.adresa)}`).then(x=>x.json());
    if(geo[0]){
      const p=[+geo[0].lat,+geo[0].lon];
      geos.push(p);
      points.push(p);
      markers.push(L.marker(p,{title:r.zakaznik}).addTo(map).bindPopup(`${r.zakaznik}<br>${r.adresa}<br>${r.cas}`));
    }
  }

  if(points.length>1){
    L.polyline(points,{color:"#0046ff",weight:3}).addTo(map);
    map.fitBounds(L.featureGroup(markers).getBounds().pad(0.3));
  }
}
</script>
<!-- üü¶ KONEC E-4 -->


<!-- üü¶ E-STYLE: MAPA + LEGENDA + ROZLO≈ΩEN√ç -->
<style>
#planModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.55);
  justify-content:center;align-items:center;z-index:9999;opacity:0;transition:opacity .25s ease;}
#planModal.active{display:flex;opacity:1;}
.planContent{background:#fff;border-radius:14px;display:grid;
  grid-template-columns:340px 1fr;gap:15px;padding:20px;max-width:90vw;max-height:90vh;overflow:auto;}
.planLeft{display:flex;flex-direction:column;align-items:center;}
#planCalendar{width:100%;}
.legendTable{border-collapse:collapse;width:100%;margin-top:10px;font-size:.9em;}
.legendTable th,.legendTable td{border-bottom:1px solid #ddd;padding:4px;text-align:left;}
.legendTable th{background:#f2f2f2;font-weight:700;}
.btn-close{margin-top:10px;background:linear-gradient(135deg,#dc3545,#f87171);color:#fff;
  border:none;border-radius:8px;padding:8px 16px;font-weight:600;cursor:pointer;}
.planRight{display:flex;flex-direction:column;gap:10px;}
#planMap{height:360px;border-radius:10px;border:1px solid #ccc;}
.planItem{background:#f8f9fa;padding:8px 10px;border-radius:8px;margin-bottom:6px;
  display:grid;grid-template-columns:30px 1fr 1fr 60px;align-items:center;gap:8px;}
.planNum{font-weight:800;color:#0046ff;}
.planName{font-weight:600;}
.planAddr{font-size:.9em;color:#333;}
.planTime{text-align:right;font-weight:600;}
.empty{text-align:center;color:#555;margin-top:30px;}
@media(max-width:900px){.planContent{grid-template-columns:1fr;max-width:100vw;}}
</style>
<!-- üü¶ KONEC SEKCE E -->










<!-- üü® SEKCE F ‚Äì POMOCN√â FUNKCE A UTILITIES -->
<!-- ======================================= -->

<!-- 
====================================================================
üß≠ F-1: POMOCN√â FUNKCE ‚Äì NORMALIZACE ADRES
====================================================================
√öƒçel:
  - sjednocuje z√°pisy adres z r≈Øzn√Ωch zdroj≈Ø
  - dopl≈àuje chybƒõj√≠c√≠ mƒõstsk√© ƒç√°sti Prahy pro p≈ôesnou geolokaci
  - zaji≈°≈•uje spr√°vn√© v√Ωsledky pro OpenStreetMap (Nominatim)
  - pou≈æ√≠v√° se p≈ôi zobrazov√°n√≠ adres ve Waze, mapƒõ i detailu z√°kazn√≠ka

Posledn√≠ √∫prava: 2025-10-08
====================================================================
-->
<script>
function normalizePrahaAddress(a) {
  if (!a) return "";
  let t = a.trim();

  // üí° odstranƒõn√≠ duplicitn√≠ch oznaƒçen√≠ a sjednocen√≠ mezery
  t = t.replace(/\bHlavn√≠ mƒõsto Praha\b/gi, "Praha");
  t = t.replace(/\bPraha\s*\d*\b/gi, "Praha");
  t = t.replace(/\s+/g, " ");

  // üß© speci√°ln√≠ pra≈æsk√© ƒçtvrti, kter√© Nominatim ƒçasto zamƒõ≈àuje:
  const doplnky = [
    { match: /do dubƒçe/i, add: "Praha 9 - Bƒõchovice" },
    { match: /bƒõchovic/i, add: "Praha 9 - Bƒõchovice" },
    { match: /horn√≠ poƒçernic/i, add: "Praha 9 - Horn√≠ Poƒçernice" },
    { match: /doln√≠ mƒõcholup/i, add: "Praha 10 - Doln√≠ Mƒõcholupy" },
    { match: /uh≈ô√≠nƒõves/i, add: "Praha 22 - Uh≈ô√≠nƒõves" },
    { match: /≈ôepy/i, add: "Praha 17 - ≈òepy" },
    { match: /zliƒç√≠n/i, add: "Praha 5 - Zliƒç√≠n" },
    { match: /kolodƒõj/i, add: "Praha 9 - Kolodƒõje" },
    { match: /kyje/i, add: "Praha 14 - Kyje" },
    { match: /dubeƒç/i, add: "Praha 10 - Dubeƒç" }
  ];

  // üß† kontrola a doplnƒõn√≠ mƒõstsk√© ƒç√°sti, pokud v adrese chyb√≠
  for (const d of doplnky) {
    if (d.match.test(t) && !t.toLowerCase().includes(d.add.toLowerCase())) {
      if (!/praha\s*\d/i.test(t)) t += ", " + d.add;
    }
  }

  // üß≠ doplnƒõn√≠ defaultn√≠ ƒç√°sti pro Prahu, pokud nen√≠ uvedena
  if (/praha/i.test(t) && !/praha\s*\d/i.test(t)) {
    t += ", Praha 1";
  }

  return t.trim();
}
</script>
<!-- üü© KONEC SEKCE F-1 -->


<!-- üü® F-2: LOK√ÅLN√ç UKL√ÅD√ÅN√ç TERM√çN≈Æ -->
<script>
function ulozTermin(item) {
  const ulozene = JSON.parse(localStorage.getItem("stavyReklamaciData") || "[]");
  const exist = ulozene.find(x => x.cislo === item.cislo);
  if (exist) {
    exist.datum = item.datum;
    exist.cas = item.cas;
  } else {
    ulozene.push({ cislo: item.cislo, datum: item.datum, cas: item.cas });
  }
  localStorage.setItem("stavyReklamaciData", JSON.stringify(ulozene));
}
</script>
<!-- üü® KONEC F-2 -->


<!-- üü® F-3: V√ùPOƒåET HASH A KONTROLA DUPLIK√ÅT≈Æ -->
<script>
function computeDataHash(arr) {
  try {
    const s = JSON.stringify(arr);
    let hash = 0;
    for (let i = 0; i < s.length; i++) {
      hash = (hash << 5) - hash + s.charCodeAt(i);
      hash |= 0;
    }
    return hash;
  } catch (e) { return 0; }
}
</script>
<!-- üü® KONEC F-3 -->


<!-- üü® F-4: KONTROLA RELOADU A P≈òENOS TOASTU -->
<script>
window.addEventListener("DOMContentLoaded", () => {
  const msg = sessionStorage.getItem("wgsToastMsg");
  const type = sessionStorage.getItem("wgsToastType");
  if (msg) {
    showToast(msg, type);
    sessionStorage.removeItem("wgsToastMsg");
    sessionStorage.removeItem("wgsToastType");
  }

  // voliteln√©: zobraz info o poƒçtu z√°znam≈Ø
  if (typeof dataAll !== "undefined" && dataAll.length) {
    console.log(`‚ÑπÔ∏è Naƒçteno ${dataAll.length} z√°znam≈Ø z Workera.`);
  }
});
</script>
<!-- üü® KONEC F-4 -->


<!-- üü® F-5: GENERICK√â FUNKCE ‚Äì BARVY, FORM√ÅTY -->
<script>
function formatDateCzech(dateStr) {
  const d = new Date(dateStr);
  return d.toLocaleDateString("cs-CZ", { day: "2-digit", month: "2-digit", year: "numeric" });
}
function formatTimeShort(h, m) {
  return `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}`;
}
</script>
<!-- üü® KONEC F-5 -->


<!-- üü® F-STYLE: DOPL≈áKOV√â STYLY -->
<style>
.flash-green {animation:flashGreen .6s;}
@keyframes flashGreen {
  0% {background:#c0f9b8;} 50% {background:#e8ffe3;} 100% {background:#f0f0f0;}
}
.loading {text-align:center;padding:20px;color:#555;font-family:Inter,sans-serif;}
</style>
<!-- üü® KONEC F-STYLE -->






<!-- üü™ SEKCE G ‚Äì EXTERN√ç KNIHOVNY + GLOB√ÅLN√ç INICIALIZACE -->
<!-- ===================================================== -->

<!-- üü™ G-1: IMPORTY KNIHOVEN -->
<!-- üó∫Ô∏è Leaflet (mapa) -->
<link rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      crossorigin="">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        crossorigin=""></script>
<script src="wgs-config-map.js"></script>

<!-- üìÖ Vanilla Calendar (tv√° verze z GitHubu) -->
<link rel="stylesheet"
      href="https://radecek222-boop.github.io/reklamace/vanilla-calendar.min.css">
<script src="https://radecek222-boop.github.io/reklamace/vanilla-calendar.min.js"></script>

<!-- üìÑ jsPDF (pro export PDF ‚Äì voliteln√©) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- üü™ KONEC G-1 -->

<!-- üü™ G-2: GLOB√ÅLN√ç INICIALIZACE A OCHRANA -->
<script>
window.addEventListener("DOMContentLoaded", () => {
  console.log("‚úÖ White Glove Service ‚Äì syst√©m spu≈°tƒõn");
  console.log("üåç Worker API:", API_URL);
  console.log("üì¶ P≈ôipojen√≠ k GitHub repozit√°≈ôi aktivn√≠.");

  // 1Ô∏è‚É£ Naƒçten√≠ dat z Workera
  loadData();

  // 2Ô∏è‚É£ Zobrazen√≠ toastu z minul√© akce (po reloadu)
  const toastMsg = sessionStorage.getItem("wgsToastMsg");
  const toastType = sessionStorage.getItem("wgsToastType");
  if (toastMsg) {
    showToast(toastMsg, toastType);
    sessionStorage.removeItem("wgsToastMsg");
    sessionStorage.removeItem("wgsToastType");
  }

  // 3Ô∏è‚É£ Napojen√≠ hlavn√≠ch tlaƒç√≠tek
  const planBtn = document.getElementById("planBtn");
  if (planBtn) planBtn.onclick = openPlanModal; // üîµ ‚ÄûPl√°n dne‚Äú

  const reloadBtn = document.getElementById("reloadBtn");
  if (reloadBtn) reloadBtn.onclick = loadData;  // üîÑ ‚ÄûNaƒç√≠st znovu‚Äú

  // 4Ô∏è‚É£ Kontrola naƒçten√Ωch knihoven
  if (typeof L === "undefined") {
    console.error("‚ùå Leaflet se nonaƒçetl ‚Äì zkontroluj CDN.");
  } else {
    console.log("üó∫Ô∏è Leaflet OK");
  }

  if (typeof VanillaCalendar === "undefined") {
    console.error("‚ùå Vanilla Calendar se nonaƒçetl ‚Äì zkontroluj link v sekci G-1.");
  } else {
    console.log("üìÖ Vanilla Calendar inicializov√°n (v2.8.1 ‚Äì GitHub lok√°ln√≠ verze)");
  }

  console.log("üß≠ Naƒçteny v≈°echny sekce A‚ÄìG (verze v1.0 ‚Äì 10/2025)");
});

window.addEventListener("error", e => {
  console.error("‚ö†Ô∏è Chyba:", e.message, "‚Üí", e.filename, ":", e.lineno);
});
window.addEventListener("unhandledrejection", e => {
  console.error("‚ö†Ô∏è Nezpracovan√© Promise:", e.reason);
});
</script>
<!-- üü™ KONEC G-2 -->

<!-- üü™ KONEC G-2 -->


<!-- üü™ G-3: Z√ÅVƒöREƒåN√â STYLY A INFO -->
<style>
body {
  font-family: "Inter", system-ui, sans-serif;
  background: #f6f7fb;
  color: #111;
  margin: 0;
  padding: 0;
}

/* P≈ôechody pro mod√°ln√≠ vrstvy a p≈ôekryvy */
.detail-overlay,
#planModal,
.loader-overlay,
.successOverlay {
  transition: opacity 0.3s ease;
}

/* Mobiln√≠ optimalizace */
@media (max-width:600px) {
  .detail-modal, .planContent { max-width: 95vw; }
  #planMap { height: 260px; }
}

/* V√Ωbƒõr textu */
::selection { background:#0046ff; color:#fff; }
</style>
<!-- üü™ KONEC G-3 -->

<!-- üü© TOAST potvrzen√≠ -->
<style>
.toast {
  position: fixed;
  bottom: 25px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(90deg, #00a86b, #00d084);
  color: #fff;
  font-weight: 600;
  padding: 12px 22px;
  border-radius: 30px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease, transform 0.4s ease;
  z-index: 9999;
}
.toast.show {
  opacity: 1;
  transform: translate(-50%, -10px);
}
.toast.error {
  background: linear-gradient(90deg, #c93030, #e74c3c);
}
</style>

<div id="toast" class="toast"></div>

<script>
window.addEventListener("DOMContentLoaded", () => {
  const toast = document.getElementById("toast");
  const msg = sessionStorage.getItem("wgsToastMsg");
  const type = sessionStorage.getItem("wgsToastType");

  if (msg) {
    toast.textContent = msg;
    if (type === "error") toast.classList.add("error");
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 4000);
    setTimeout(() => {
      sessionStorage.removeItem("wgsToastMsg");
      sessionStorage.removeItem("wgsToastType");
    }, 4200);
  }
});
</script>







<!-- 
============================================================
üß≠ WHITE GLOVE SERVICE ‚Äì SEZNAM REKLAMAC√ç (mapa sekc√≠ A‚ÄìG)
Verze: 1.0 (≈ô√≠jen 2025)
Autor: Hugo & GPT-5
============================================================

üî∏ SEKCE A ‚Äì STRUKTURA STR√ÅNKY
  - HTML rozlo≈æen√≠ (hlaviƒçka, tlaƒç√≠tka, vyhled√°v√°n√≠, tabulka)
  - z√°kladn√≠ CSS vzhled
  - v≈°echny viditeln√© prvky u≈æivatelsk√©ho rozhran√≠

üîπ SEKCE B ‚Äì NAƒå√çT√ÅN√ç DAT
  - Fetch z Cloudflare Workera (https://wgs-token.72nvwf4pb2.workers.dev/orders)
  - funkce loadData() + renderTable()
  - vyhled√°v√°n√≠ z√°kazn√≠k≈Ø, filtrov√°n√≠
  - debug panel (B-DEBUG) ‚Äì poƒçet z√°znam≈Ø + ƒças naƒçten√≠

üîπ SEKCE C ‚Äì DETAIL Z√ÅKAZN√çKA
  - openDetail(index) ‚Äì zobrazen√≠ detailu z tabulky
  - lev√Ω panel: kalend√°≈ô, ƒças, tlaƒç√≠tka (Ulo≈æit / Nezved√° / Zru≈°il / Zpƒõt)
  - prav√Ω panel: √∫daje z√°kazn√≠ka, mapa (Leaflet), vzd√°lenost od WGS
  - rozdƒõleno do C-1 a≈æ C-5 + styly

üîπ SEKCE D ‚Äì ULO≈ΩEN√ç TERM√çNU
  - ulo≈æit p≈ôes Worker (GitHub update)
  - loader ‚è≥ + toast üîî + success overlay ‚úÖ
  - funkce showToast(), showSuccessOverlay(), setNextToast()
  - ukl√°d√°n√≠ do localStorage + p≈ôenos mezi relacemi

üîπ SEKCE E ‚Äì PL√ÅN DNE
  - openPlanModal() ‚Äì mƒõs√≠ƒçn√≠ kalend√°≈ô + mapa dne
  - zobrazen√≠ z√°kazn√≠k≈Ø podle ƒçasu
  - vykreslen√≠ trasy WGS ‚Üí z√°kazn√≠ci (Leaflet)
  - legenda (ƒças, po≈ôad√≠, jm√©no)
  - responzivn√≠ pro mobil i desktop

üîπ SEKCE F ‚Äì POMOCN√â FUNKCE
  - normalizePrahaAddress() ‚Äì √∫prava adres
  - ulozTermin() ‚Äì ulo≈æen√≠ term√≠nu do localStorage
  - computeDataHash() ‚Äì kontroln√≠ hash pro zmƒõny
  - form√°tov√°n√≠ ƒçasu, datumu, animace flash
  - p≈ôenos toastu po reloadu

üîπ SEKCE G ‚Äì EXTERN√ç KNIHOVNY + GLOB√ÅLN√ç INIT
  - import Leaflet + Vanilla Calendar + jsPDF
  - kontrola naƒçten√≠ knihoven (konzolov√© logy)
  - glob√°ln√≠ styly, ochrana proti chyb√°m (error / rejection)

============================================================
üìÇ Celkov√° struktura:
A  ‚Äì HTML UI
B  ‚Äì Data & Tabulka
C  ‚Äì Detail z√°kazn√≠ka
D  ‚Äì Ulo≈æen√≠ term√≠nu
E  ‚Äì Pl√°n dne
F  ‚Äì Pomocn√© funkce
G  ‚Äì Extern√≠ knihovny & Init
============================================================

üß† Pozn√°mka:
Tento blok je pouze dokumentaƒçn√≠ (HTML koment√°≈ô).
Nem√° ≈æ√°dn√Ω vliv na funkci k√≥du a m≈Ø≈æe b√Ωt volnƒõ p≈ôesouv√°n
nebo dopl≈àov√°n podle pot≈ôeby v√Ωvoje.

============================================================
-->


<!-- 
============================================================
‚öôÔ∏è WHITE GLOVE SERVICE ‚Äì TECHNICK√ù INDEX FUNKC√ç
============================================================

üì¶ SEKCE A ‚Äì STRUKTURA A OVL√ÅD√ÅN√ç
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ window.scrollTo()                  ‚Üí posun p≈ôi otev≈ôen√≠ kalend√°≈ôe
‚Ä¢ (DOM event listener)               ‚Üí kliknut√≠ na tlaƒç√≠tko term√≠nu

üì° SEKCE B ‚Äì NAƒå√çT√ÅN√ç DAT + DEBUG
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ loadData()                         ‚Üí naƒçten√≠ dat z Workera (JSON)
‚Ä¢ renderTable(arr)                   ‚Üí vykreslen√≠ tabulky z√°znam≈Ø
‚Ä¢ normalizePrahaAddress(addr)        ‚Üí √∫prava adres Praha bez PSƒå
‚Ä¢ sortSmart(data)                    ‚Üí chytr√© ≈ôazen√≠ dat
‚Ä¢ hashData(arr)                      ‚Üí hash pro detekci zmƒõn
‚Ä¢ playNotification()                 ‚Üí zvuk p≈ôi nov√Ωch z√°znamech
‚Ä¢ searchInput.oninput                ‚Üí filtrov√°n√≠ v√Ωsledk≈Ø
‚Ä¢ reloadBtn.onclick                  ‚Üí ruƒçn√≠ obnoven√≠ dat

üë§ SEKCE C ‚Äì DETAIL Z√ÅKAZN√çKA
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ openDetail(index)                  ‚Üí otev≈ôe detail z√°kazn√≠ka (modal)
‚Ä¢ updateTermInfoBox()                ‚Üí aktualizace textu s datem/ƒçasem
‚Ä¢ updateTime()                       ‚Üí p≈ôepoƒçet ƒçasu p≈ôi zmƒõnƒõ hodin/minut
‚Ä¢ flashBox()                         ‚Üí kr√°tk√° animace p≈ôi potvrzen√≠
‚Ä¢ calcDistanceCoords()               ‚Üí v√Ωpoƒçet vzd√°lenosti mezi body
‚Ä¢ (Leaflet map init)                 ‚Üí zobrazen√≠ mapy z√°kazn√≠ka
‚Ä¢ (VanillaCalendar init)             ‚Üí mal√Ω kalend√°≈ô v detailu
‚Ä¢ (Event listeners)                  ‚Üí tlaƒç√≠tka Ulo≈æit / Nezved√° / Zru≈°it / Zpƒõt

üíæ SEKCE D ‚Äì ULO≈ΩEN√ç TERM√çNU
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ ulozitTerminNaGitHub()             ‚Üí ukl√°d√° zmƒõny p≈ôes Worker ‚Üí GitHub
‚Ä¢ ulozTermin()                       ‚Üí zapisuje term√≠n do localStorage
‚Ä¢ showToast(msg, type)               ‚Üí kr√°tk√° zpr√°va v rohu
‚Ä¢ setNextToast(msg, type)            ‚Üí ulo≈æ√≠ toast pro p≈ô√≠≈°t√≠ zobrazen√≠
‚Ä¢ (Loader overlay)                   ‚Üí vizu√°ln√≠ animace ‚è≥ bƒõhem ukl√°d√°n√≠

üóìÔ∏è SEKCE E ‚Äì PL√ÅN DNE
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ initCalendar()                     ‚Üí zobrazen√≠ Vanilla Calendaru
‚Ä¢ addBlueDots()                      ‚Üí oznaƒçen√≠ dn≈Ø s ulo≈æen√Ωmi term√≠ny
‚Ä¢ showPlanForDay(date)               ‚Üí vykresl√≠ mapu a legendu pro vybran√Ω den
‚Ä¢ recalcDeparture()                  ‚Üí p≈ôepoƒç√≠t√° ƒças odjezdu
‚Ä¢ highlightTodayRows()               ‚Üí zv√Ωrazn√≠ dne≈°n√≠ term√≠ny (blik√°n√≠)
‚Ä¢ exportPlanToPDF()                  ‚Üí export pl√°nu dne do PDF

üß© SEKCE F ‚Äì POMOCN√â FUNKCE
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ normalizePrahaAddress()            ‚Üí (z√°kladn√≠ verze) zkr√°cen√≠ adres
‚Ä¢ ulozTermin(item)                   ‚Üí ukl√°d√°n√≠ lok√°ln√≠ch term√≠n≈Ø
‚Ä¢ computeDataHash()                  ‚Üí hash kontrola
‚Ä¢ formatDateCzech()                  ‚Üí p≈ôevod ISO data do ƒçesk√©ho form√°tu
‚Ä¢ formatTimeShort(h, m)              ‚Üí form√°tov√°n√≠ ƒçasu HH:MM
‚Ä¢ (flashGreen animace)               ‚Üí potvrzen√≠ ulo≈æen√Ωch dat

üåç SEKCE G ‚Äì EXTERN√ç KNIHOVNY + INIT
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ Leaflet (L.*)                      ‚Üí mapy, trasy, znaƒçky
‚Ä¢ VanillaCalendar()                  ‚Üí kalend√°≈ô (verze 2.8.1)
‚Ä¢ jsPDF()                            ‚Üí export PDF
‚Ä¢ window.addEventListener("DOMContentLoaded")  ‚Üí glob√°ln√≠ start log≈Ø
‚Ä¢ window.addEventListener("error")   ‚Üí zachyt√≠ JS chyby
‚Ä¢ window.addEventListener("unhandledrejection") ‚Üí zachyt√≠ chyby Promise

============================================================
üß† DOPORUƒåEN√ç PRO LADƒöN√ç
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚Ä¢ Pokud se data nenaƒç√≠taj√≠ ‚Üí zkontroluj Worker (sekce B)
‚Ä¢ Pokud mapa nefunguje ‚Üí zkontroluj Leaflet import (sekce G)
‚Ä¢ Pokud kalend√°≈ô nefunguje ‚Üí Vanilla Calendar (sekce G)
‚Ä¢ Pokud toast miz√≠ ‚Üí kontrola sessionStorage (sekce D/F)
‚Ä¢ Pokud detail zamrz√° ‚Üí zkontroluj funkce openDetail() a ulozitTerminNaGitHub()

============================================================
üìò VERZE: 1.0 ‚Äì ≈ô√≠jen 2025
============================================================
-->
