<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Seznam reklamací</title>
  <style>
    body { font-family: Inter, sans-serif; margin:20px; background:#f6f7fb; }
    h2 { margin-top:0; }
    input[type="text"] {
      padding:8px; border-radius:6px; border:1px solid #ccc; width:100%; max-width:400px;
    }
    .table-wrapper { overflow-x:auto; margin-top:20px; }
    table {
      width:100%; border-collapse:collapse; background:#fff;
      border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1);
    }
    th, td { padding:10px 12px; border:1px solid #ccc; font-size:0.9em; text-align:left; }
    th { background:#f0f0f0; }
    tr:nth-child(even) { background:#fafafa; }
    tr:hover { background:#e9f0ff; cursor:pointer; }
    .btn {
      background:#e0e0e0; color:#111; padding:10px 20px; margin-top:20px;
      border:none; border-radius:8px; cursor:pointer; font-size:1em;
      box-shadow:0 2px 5px rgba(0,0,0,0.15);
    }
    .btn:hover { background:#d5d5d5; }
  </style>
</head>
<body>
  <h2>Seznam reklamací</h2>
  <input type="text" id="search" placeholder="Hledat podle jména, adresy, telefonu nebo objednávky">
  <div id="results" class="table-wrapper">Načítám data...</div>
  <button class="btn" onclick="window.close()">Zpět na hlavní obrazovku</button>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQzpP83wIYZPcnb1NI9pPSPixzcEQuRVrTOyPD7SRbgYZSrQs7QdcLNwPJ5lQleGbVVK29nr2-bMo6Y/pub?gid=0&single=true&output=csv";

let allData = [];

async function loadData() {
  try {
    const res = await fetch(sheetUrl);
    const text = await res.text();
    allData = text.split("\n").map(r => r.split(",")).filter(r => r.join("").trim() !== "");
    renderTable(allData.slice(1)); // vynecháme hlavičku
  } catch (err) {
    document.getElementById("results").innerHTML = "Chyba při načítání dat: " + err;
  }
}

function renderTable(rows){
  if (!rows.length){ document.getElementById("results").innerHTML = "Žádná data"; return; }
  let html = "<table><thead><tr>";
  allData[0].forEach(h => { html += "<th>"+h+"</th>"; });
  html += "</tr></thead><tbody>";
  rows.forEach((r,idx) => {
    html += `<tr onclick="selectRow(${idx+1})">`;
    r.forEach(c => { html += "<td>"+c+"</td>"; });
    html += "</tr>`;
  });
  html += "</tbody></table>";
  document.getElementById("results").innerHTML = html;
}

function selectRow(rowIndex){
  const row = allData[rowIndex];
  if (!row) return;
  // Pošleme data zpět do hlavního okna (index.html)
  window.opener.postMessage({ type:"openProtocol", row }, "*");
  window.close();
}

document.getElementById("search").addEventListener("input", e => {
  const q = e.target.value.toLowerCase();
  const rows = allData.slice(1).filter(r => r.join(" ").toLowerCase().includes(q));
  renderTable(rows);
});

loadData();
</script>
</body>
</html>
