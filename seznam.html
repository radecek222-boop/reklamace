<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WHITE GLOVE SERVICE ‚Äì Seznam reklamac√≠</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    :root { font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif; color:#111 }
    body { margin:0; padding:20px; background:#f6f7fb }
    h1 { text-align:center; font-size:2em; font-weight:900; margin:0 0 10px; }
    h2 { text-align:center; font-size:1.2em; font-weight:600; margin:0 0 20px; color:#555; }

    .btn-top {
      display:inline-block; background:#6c757d; color:white; padding:10px 20px;
      border-radius:6px; text-decoration:none; font-weight:600; margin-bottom:20px;
      box-shadow:0 2px 5px rgba(0,0,0,0.15);
    }
    .btn-top:hover { opacity:0.9; }

    table { width:100%; border-collapse:collapse; margin:auto; max-width:1200px; background:white; box-shadow:0 0 10px rgba(0,0,0,0.1); }
    th, td { padding:8px 10px; text-align:left; border-bottom:1px solid #ddd; font-size:0.9em; }
    th { background:#e9ecef; font-weight:700; }
    tr:hover { background:#f1f3f5; }
    tr.new-row { background:#fff8dc !important; }

    .btn-protocol {
      background:#004080; color:white; padding:6px 12px; border:none;
      border-radius:6px; cursor:pointer; font-size:0.85em; font-weight:600;
      transition:all 0.2s ease-in-out;
    }
    .btn-protocol:hover { background:#1e90ff; }

    .clickable { color:#007bff; text-decoration:none; }
    .clickable:hover { text-decoration:underline; }
  </style>
</head>

<body>
  <h1>WHITE GLOVE SERVICE</h1>
  <h2>Seznam reklamac√≠</h2>
  <div style="text-align:center;">
    <a class="btn-top" href="hotove.html">üìÅ Hotov√© reklamace</a>
  </div>

  <table id="claims-table">
    <thead>
      <tr>
        <th>ƒå√≠slo objedn√°vky</th>
        <th>ƒå√≠slo reklamace</th>
        <th>Z√°kazn√≠k</th>
        <th>Adresa</th>
        <th>Telefon</th>
        <th>Email</th>
        <th>Znaƒçka</th>
        <th>Model</th>
        <th>Stav</th>
        <th>Akce</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
const csvUrl = "https://tvuj-repozitar.github.io/data/reklamace.csv"; // ‚Üê sem pozdƒõji vlo≈æ√≠≈° spr√°vnou GitHub adresu CSV

// === Naƒçten√≠ CSV z GitHubu ===
fetch(csvUrl)
  .then(response => response.text())
  .then(csvText => {
    const parsed = Papa.parse(csvText, { header: true });
    const tbody = document.querySelector("#claims-table tbody");

    parsed.data.forEach(row => {
      if (!row["ƒå√≠slo objedn√°vky"]) return; // p≈ôeskoƒç√≠ pr√°zdn√© ≈ô√°dky

      const tr = document.createElement("tr");
      const stav = (row["Stav"] || "").toLowerCase();
      if (stav.includes("nov√°")) tr.classList.add("new-row");

      tr.innerHTML = `
        <td>${row["ƒå√≠slo objedn√°vky"] || ""}</td>
        <td>${row["ƒå√≠slo reklamace"] || ""}</td>
        <td>${row["Z√°kazn√≠k"] || ""}</td>
        <td>${row["Adresa"] || ""}</td>
        <td>${makePhone(row["Telefon"])}</td>
        <td>${row["Email"] || ""}</td>
        <td>${row["Znaƒçka"] || ""}</td>
        <td>${row["Model"] || ""}</td>
        <td>${row["Stav"] || ""}</td>
        <td><button class="btn-protocol" onclick="openProtocol(this.closest('tr'))">üìã Otev≈ô√≠t protokol</button></td>
      `;

      tbody.appendChild(tr);
    });
  })
  .catch(err => console.error("Chyba p≈ôi naƒç√≠t√°n√≠ CSV:", err));

// === Telefon ‚Üí klikac√≠ link ===
function makePhone(num) {
  if (!num) return "";
  const clean = num.replace(/\s+/g,"");
  return `<a class="clickable" href="tel:${clean}">${num}</a>`;
}

// === P≈ôenos dat do protokolu ===
function openProtocol(row) {
  const cells = row.querySelectorAll("td");
  const data = {
    "order-number": cells[0]?.innerText.trim(),
    "claim-number": cells[1]?.innerText.trim(),
    "customer": cells[2]?.innerText.trim(),
    "address": cells[3]?.innerText.trim(),
    "phone": cells[4]?.innerText.replace(/[\n\r]/g,"").trim(),
    "email": cells[5]?.innerText.trim(),
    "brand": cells[6]?.innerText.trim(),
    "model": cells[7]?.innerText.trim(),
  };
  localStorage.setItem("selectedCustomer", JSON.stringify(data));
  window.location.href = "protokol.html";
}
</script>
</body>
</html>
