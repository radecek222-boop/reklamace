<!-- 
====================================================================
ğŸ’ WHITE GLOVE SERVICE â€“ SEZNAM REKLAMACÃ
====================================================================
Verze systÃ©mu:       v1.0
Datum sestavenÃ­:     2025-10-08
Autor:               Hugo (White Glove Service) & GPT-5
Projekt:             WGS reklamace / servisnÃ­ plÃ¡novÃ¡nÃ­
Soubory:             seznam.html (hlavnÃ­ pÅ™ehled), orders.json (data)
Worker:              https://wgs-token.72nvwf4pb2.workers.dev/orders
RepozitÃ¡Å™:           https://github.com/radecek222-boop/reklamace
Popis:
  KompletnÃ­ rozhranÃ­ pro zobrazenÃ­ a sprÃ¡vu reklamacÃ­.
  - PÅ™Ã­mÃ© naÄÃ­tÃ¡nÃ­ dat z GitHub JSON pÅ™es Cloudflare Worker
  - Mapa, kalendÃ¡Å™, plÃ¡n dne a uklÃ¡dÃ¡nÃ­ termÃ­nÅ¯
  - KompatibilnÃ­ s iPhone Safari a desktop prohlÃ­Å¾eÄi

Struktura souboru:
  A â€“ Struktura strÃ¡nky a tlaÄÃ­tka
  B â€“ NaÄÃ­tÃ¡nÃ­ dat a tabulka + debug
  C â€“ Detail zÃ¡kaznÃ­ka
  D â€“ UloÅ¾enÃ­ termÃ­nu (GitHub + toast)
  E â€“ PlÃ¡n dne (mapa + trasa)
  F â€“ PomocnÃ© funkce a utilitky
  G â€“ ExternÃ­ knihovny a globÃ¡lnÃ­ inicializace

PoslednÃ­ Ãºprava:     2025-10-08 / 14:00  
====================================================================
-->



<!-- ğŸŸ¨ SEKCE A â€“ ZÃKLAD (struktura strÃ¡nky, styly, tlaÄÃ­tka, vyhledÃ¡vÃ¡nÃ­) -->
<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seznam reklamacÃ­ â€“ White Glove Service</title>

<!-- ğŸŒ Leaflet mapa -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

<!-- ğŸ“„ PDF Export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* ============================= */
/* ğŸ§± ZÃKLADNÃ VZHLED STRÃNKY     */
/* ============================= */
body {
  font-family: "Inter", system-ui, sans-serif;
  background: #f6f7fb;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
}
.wrapper {
  background: #fff;
  padding: 25px;
  margin: 40px 15px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 1200px;
  box-sizing: border-box;
}

/* ============================= */
/* ğŸ·ï¸ NADPISY                    */
/* ============================= */
h1 {
  text-align: center;
  font-size: 2.2em;
  font-weight: 900;
  color: #111;
  margin: 0 0 8px;
}
h2 {
  text-align: center;
  font-size: 1.1em;
  font-weight: 500;
  color: #666;
  margin: 0 0 25px;
}

/* ============================= */
/* ğŸ”˜ HLAVNÃ TLAÄŒÃTKA (akce)     */
/* ============================= */
.actions {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 15px;
  margin-bottom: 25px;
}
.btn {
  display: inline-block;
  text-decoration: none;
  padding: 10px 24px;
  border-radius: 8px;
  font-weight: 600;
  font-size: 1em;
  border: none;
  cursor: pointer;
  transition: transform 0.15s ease-in-out, opacity 0.2s;
  color: white;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
  min-width: 160px;
}
.btn:hover { transform: scale(1.04); opacity: 0.9; }

/* ğŸ¨ Barvy tlaÄÃ­tek */
.btn-back    { background: linear-gradient(135deg, #6c757d, #a0a4a7); }
.btn-refresh { background: linear-gradient(135deg, #b80000, #ff3838); }
.btn-green   { background: linear-gradient(135deg, #28a745, #60d06a); text-align:center; }
.btn-plan    { background: linear-gradient(135deg, #0046ff, #357aff); }

/* ============================= */
/* ğŸ” VYHLEDÃVÃNÃ                */
/* ============================= */
#search {
  width: 100%;
  padding: 10px;
  margin-bottom: 15px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 1em;
  box-sizing: border-box;
}

/* ============================= */
/* ğŸ“‹ TABULKA ZÃZNAMÅ®            */
/* ============================= */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
th, td {
  padding: 10px 8px;
  border-bottom: 1px solid #eee;
  text-align: center;
  font-size: 0.95em;
  white-space: normal;
  line-height: 1.4em;
  color: #000;
  font-weight: 400;
}
th {
  background: #f8f8f8;
  font-weight: 700;
  color: #000;
}
td.adresa,
td.telefon { font-weight: 600; }
tr:hover { background: #f1f6ff; cursor: pointer; }

/* ============================= */
/* ğŸŸ¢ STAVY REKLAMACÃ            */
/* ============================= */
.stav-novy      { background: #fff9b1 !important; }
.stav-domluveno { background: #99b3ff !important; }
.stav-zruseno   { background: #ff6666 !important; }
.stav-nezveda   { background: #ffad33 !important; }

/* ============================= */
/* ğŸ“± MOBILNÃ ZOBRAZENÃ          */
/* ============================= */
@media (max-width:700px){
  table { display:none; }
  .btn {
    width:100%;
    min-width:unset;
    text-align:center;
  }
}
</style>
</head>

<body>
  <div class="wrapper">
    <!-- ğŸ§¾ HLAVIÄŒKA STRÃNKY -->
    <h1>WHITE GLOVE SERVICE</h1>
    <h2>Seznam reklamacÃ­ a servisnÃ­ch poÅ¾adavkÅ¯</h2>

    <!-- ğŸ§­ OVLÃDACÃ TLAÄŒÃTKA -->
    <div class="actions">
      <a href="index.html" class="btn btn-back">ZpÄ›t</a>
      <button id="reloadBtn" class="btn btn-refresh">NaÄÃ­st znovu</button>
      <a href="hotove.html" class="btn btn-green">HotovÃ© reklamace</a>
      <button id="planBtn" class="btn btn-plan">PlÃ¡n dne</button>
    </div>

    <!-- ğŸ” VYHLEDÃVÃNÃ -->
    <input type="text" id="search" placeholder="ğŸ” Hledat podle jmÃ©na, adresy nebo zadavatele...">

<!-- ğŸ“¦ MÃSTO PRO TABULKU -->
<div id="tableContainer" class="loading">NaÄÃ­tÃ¡m data...</div>
</div>

<!-- ğŸ” AutomatickÃ½ posun pÅ™i otevÅ™enÃ­ kalendÃ¡Å™e -->
<script>
document.addEventListener("click", e => {
  if (e.target && e.target.id === "termBtn") {
    setTimeout(() => {
      window.scrollTo({ top: 0, behavior: "smooth" });
    }, 150);
  }
});
</script>

<!-- ğŸŸ¢ StabilnÃ­ barva pro hotovÃ© reklamace -->
<style>
tr.stav-hotovo td {
  background: #b6f2c0 !important;
  color: #116d2b !important;
  font-weight: 700;
}
tr.stav-hotovo:hover td {
  background: #a5e8b1 !important;
}
</style>

</body>
</html>
<!-- ğŸŸ¨ KONEC SEKCE A -->

<!-- ğŸŸ© ZAÄŒÃTEK STYL â€“ MOBILNÃ BLOKY -->
<style>
/* ğŸ“± Kontejner pro mobilnÃ­ bloky */
.mob-container {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 10px;
}

/* ğŸ“¦ Jeden mobilnÃ­ zÃ¡znam */
.mob-block {
  background: #fff;
  border-radius: 10px;
  padding: 10px 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  border-left: 5px solid transparent;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}
.mob-block:hover {
  transform: scale(1.01);
  box-shadow: 0 3px 10px rgba(0,0,0,0.12);
}

/* 1. Å™Ã¡dek â€“ jmÃ©no a adresa */
.mob-line1 {
  font-weight: 600;
  color: #111;
  font-size: 1.05em;
  display: flex;
  flex-wrap: wrap;
}
.mob-addr {
  color: #444;
  font-weight: 400;
}

/* 2. Å™Ã¡dek â€“ datum, Äas, Waze, telefon */
.mob-line2 {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 6px;
  font-size: 0.92em;
  color: #333;
}
.mob-actions {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* TlaÄÃ­tko WAZE */
.waze-btn {
  display: inline-block;
  border: 1px solid #0066ff;
  border-radius: 6px;
  padding: 2px 10px 3px;
  font-size: 0.85em;
  font-weight: 600;
  color: #0066ff;
  background: #eaf1ff;
  text-decoration: none;
}

/* TelefonnÃ­ tlaÄÃ­tko */
.phone-btn {
  display: inline-flex;
  justify-content: center;
  align-items: center;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: #f4f4f4;
  text-decoration: none;
  font-size: 1.1em;
  box-shadow: 0 1px 3px rgba(0,0,0,0.15);
}

/* ğŸŸ¢ Barvy dle stavu */
.mob-block.stav-novy { border-left-color: #ffea70; }
.mob-block.stav-domluveno { border-left-color: #80aaff; }
.mob-block.stav-nezveda { border-left-color: #ffa84d; }
.mob-block.stav-zruseno { border-left-color: #ff5c5c; }
.mob-block.stav-hotovo { border-left-color: #5cd65c; }
</style>
<!-- ğŸŸ© KONEC STYL â€“ MOBILNÃ BLOKY -->





<!-- ğŸŸ¦ SEKCE B â€“ NAÄŒÃTÃNÃ DAT + TABULKA + DEBUG (opravenÃ¡ verze) -->
<script>
/* ============================= */
/* âš™ï¸ KONSTANTY A PROMÄšNNÃ‰       */
/* ============================= */
const API_URL = "https://wgs-token.72nvwf4pb2.workers.dev/orders";
const tableContainer = document.getElementById("tableContainer");
const searchInput = document.getElementById("search");
const reloadBtn = document.getElementById("reloadBtn");

let dataAll = [];
let stavy = JSON.parse(localStorage.getItem("stavyReklamaci") || "{}");

/* ============================= */
/* ğŸ”„ AUTOMATICKÃ‰ NAÄŒÃTÃNÃ DAT   */
/* ============================= */
setInterval(loadData, 120000); // kaÅ¾dÃ© 2 minuty

/* ============================= */
/* ğŸ§­ NAÄŒÃTÃNÃ DAT Z API          */
/* ============================= */
async function loadData() {
  console.log("ğŸ“¥ NaÄÃ­tÃ¡m data z Workeruâ€¦");
  tableContainer.innerHTML = "<div class='loading'>NaÄÃ­tÃ¡m data...</div>";

  try {
    const res = await fetch(API_URL, { mode: "cors", cache: "no-store" });
    if (!res.ok) throw new Error(`Chyba HTTP ${res.status}`);
    let data = await res.json();

    if (!Array.isArray(data)) {
      if (typeof data === "object" && Object.keys(data).length > 0) {
        data = Object.values(data);
      } else throw new Error("Worker nevracÃ­ platnÃ© zÃ¡znamy");
    }

    console.log("ğŸ“¦ Worker data:", data);
    updateDebug(data.length);

    if (!data.length) {
      tableContainer.innerHTML = "<div>Å½Ã¡dnÃ© zÃ¡znamy</div>";
      return;
    }

    // ğŸ’¾ doplnÄ›nÃ­ uloÅ¾enÃ½ch termÃ­nÅ¯
    const ulozene = JSON.parse(localStorage.getItem("stavyReklamaciData") || "[]");
    data.forEach(z => {
      const u = ulozene.find(x => x.cislo === z.cislo);
      if (u) { z.datum = u.datum; z.cas = u.cas; }
    });

    dataAll = data.reverse();
    renderTable(dataAll);

  } catch (err) {
    console.error("âŒ Chyba pÅ™i naÄÃ­tÃ¡nÃ­:", err);
    tableContainer.innerHTML =
      `<div style='color:red;font-weight:600;'>Chyba naÄÃ­tÃ¡nÃ­ dat: ${err.message}</div>`;
    updateDebug(0);
  }
}

/* ============================= */
/* ğŸ“‹ VYKRESLENÃ TABULKY / BLOKÅ® */
/* ============================= */
function renderTable(arr) {
  if (!arr || !arr.length) {
    tableContainer.innerHTML = "<div>Å½Ã¡dnÃ© zÃ¡znamy</div>";
    return;
  }

  // ğŸ“± MobilnÃ­ zobrazenÃ­
  if (window.innerWidth < 700) {
    console.log("ğŸ“± MobilnÃ­ reÅ¾im â€“ vykresluji bloky");
    renderMobileBlocks(arr);
    return;
  }

  // ğŸ’» Desktop tabulka
  let html = `
  <table>
    <thead>
      <tr>
        <th>ZÃ¡kaznÃ­k</th>
        <th>Adresa</th>
        <th>Telefon</th>
        <th>Stav</th>
      </tr>
    </thead>
    <tbody>`;

  arr.forEach((r, i) => {
    const id = r.cislo || `radek-${i}`;
    const stav = stavy[id] || r.stav || "novy";

    const adresa = r.adresa
      ? `<a href="https://waze.com/ul?q=${encodeURIComponent(r.adresa)}" target="_blank"
         style="color:#000;font-weight:600;">${r.adresa}</a>` : "â€“";
    const telefon = r.telefon
      ? `<a href="tel:${r.telefon.replace('+420','').trim()}"
         style="color:#000;font-weight:600;">${r.telefon.replace('+420','').trim()}</a>` : "â€“";

    // ğŸ¨ Stav + barva + text
    let barva = "";
    let stavText = stav;
    if (stav === "domluveno" && r.datum && r.cas) {
      const d = new Date(r.datum);
      stavText = `${d.toLocaleDateString("cs-CZ",{weekday:"short",day:"numeric",month:"numeric"})} ${r.cas}`;
      barva = "background:#dfe8ff;color:#0046ff;font-weight:700;";
    } else if (stav === "ceka") {
      stavText = "ÄŒekÃ¡ na dÃ­ly";
      barva = "background:#ede0ff;color:#5c00b8;font-weight:700;";
    } else if (stav === "nezveda") {
      stavText = "ZÃ¡kaznÃ­k nezvedÃ¡ â€“ poslÃ¡na SMS";
      barva = "background:#ffe6b3;color:#cc7a00;font-weight:700;";
    } else if (stav === "zruseno") {
      stavText = "ZruÅ¡eno";
      barva = "background:#ffcccc;color:#a30000;font-weight:700;";
    } else if (stav === "novy") {
      stavText = "NovÃ¡";
      barva = "background:#fff9b1;color:#000;font-weight:700;animation:blinkRow 1.2s infinite;";
    }

    html += `
      <tr class="stav-${stav}" data-index="${i}">
        <td>${r.zakaznik || "â€“"}</td>
        <td>${adresa}</td>
        <td>${telefon}</td>
        <td style="${barva}text-align:center;">${stavText}</td>
      </tr>`;
  });

  html += "</tbody></table>";
  tableContainer.innerHTML = html;

  document.querySelectorAll("tbody tr").forEach(row => {
    row.addEventListener("click", () => openDetail(row.dataset.index));
  });
}

/* ============================= */
/* ğŸ” VYHLEDÃVÃNÃ                */
/* ============================= */
searchInput.addEventListener("input", () => {
  const q = searchInput.value.trim().toLowerCase();
  if (!q) return renderTable(dataAll);
  renderTable(dataAll.filter(r =>
    (r.zakaznik || "").toLowerCase().includes(q) ||
    (r.adresa || "").toLowerCase().includes(q)
  ));
});

/* ============================= */
/* ğŸ” RUÄŒNÃ NAÄŒTENÃ DAT           */
/* ============================= */
reloadBtn.addEventListener("click", loadData);

/* ============================= */
/* ğŸ§© DEBUG PANEL                 */
/* ============================= */
function updateDebug(count) {
  const c = document.getElementById("debugCount");
  const t = document.getElementById("debugTime");
  if (!c || !t) return;
  c.textContent = count;
  t.textContent = new Date().toLocaleTimeString("cs-CZ",
    { hour:"2-digit", minute:"2-digit", second:"2-digit" });
}
</script>

<style>
@keyframes blinkRow {
  0%,100% { background:#fff9b1; }
  50% { background:#fff06b; }
}
</style>

<!-- ğŸ§© DEBUG PANEL (vizuÃ¡lnÃ­ info) -->
<div id="debugBox"
     style="font-family:Inter,sans-serif;font-size:12px;color:#333;
            position:fixed;bottom:10px;right:12px;background:#f7f7f7;
            border:1px solid #ccc;border-radius:8px;padding:8px 12px;
            box-shadow:0 2px 6px rgba(0,0,0,0.1);z-index:9999;">
  NaÄteno: <span id="debugCount">0</span> zÃ¡znamÅ¯<br>
  <small>Aktualizace: <span id="debugTime">â€“</span></small>
</div>
<!-- ğŸŸ¦ KONEC SEKCE B -->


<!-- ğŸŸ¦ ZAÄŒÃTEK B-2: MOBILNÃ BLOKY (upravenÃ½ layout â€“ adresa nahoÅ™e, jmÃ©no dole) -->
<script>
function renderMobileBlocks(arr) {
  if (!arr || !arr.length) {
    tableContainer.innerHTML = "<div>Å½Ã¡dnÃ© zÃ¡znamy</div>";
    return;
  }

  const html = arr.map((r, i) => {
    const stav = r.stav || "novy";
    const adresa = r.adresa || "";
    const datum = r.datum ? new Date(r.datum).toLocaleDateString("cs-CZ", { day:"2-digit", month:"2-digit", year:"numeric" }) : "";
    const cas = r.cas || "";
    const wazeUrl = r.adresa ? `https://waze.com/ul?q=${encodeURIComponent(r.adresa)}` : "";
    const phoneUrl = r.telefon ? `tel:${r.telefon.replace(/\s+/g, '')}` : "";

    return `
      <div class="mob-block stav-${stav}" onclick="openDetail(${i})">
        <div class="mob-top">
          <div class="mob-addr">${adresa || "NeznÃ¡mÃ¡ adresa"}</div>
          ${wazeUrl ? `<a href="${wazeUrl}" target="_blank" class="waze-btn">WAZE</a>` : ""}
        </div>
        <div class="mob-mid">
          <div class="mob-date">${datum}${cas ? " Â· " + cas : ""}</div>
          ${phoneUrl ? `<a href="${phoneUrl}" class="phone-btn">ğŸ“</a>` : ""}
        </div>
        <div class="mob-name">${r.zakaznik || "NeznÃ¡mÃ½ zÃ¡kaznÃ­k"}</div>
      </div>`;
  }).join("");

  tableContainer.innerHTML = `<div class="mob-container">${html}</div>`;
}
</script>

<style>
/* ğŸ“± Kontejner pro mobilnÃ­ bloky */
.mob-container {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 10px;
  width: 100%;
}

/* ğŸ“¦ Jeden zÃ¡znam */
.mob-block {
  width: 100%;
  background: #fff;
  border-radius: 12px;
  padding: 12px 16px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.08);
  border-left: 6px solid transparent;
  transition: transform .15s ease, box-shadow .15s ease;
  box-sizing: border-box;
}
.mob-block:hover { transform: scale(1.01); box-shadow: 0 4px 12px rgba(0,0,0,0.12); }

/* ğŸ·ï¸ HornÃ­ Å™Ã¡dek â€“ adresa + Waze */
.mob-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
}
.mob-addr {
  font-weight: 600;
  font-size: 1em;
  color: #222;
  flex: 1;
  word-break: break-word;
}
.waze-btn {
  display: inline-block;
  border: 1px solid #0066ff;
  border-radius: 6px;
  padding: 3px 10px 4px;
  font-size: 0.85em;
  font-weight: 600;
  color: #0066ff;
  background: #eaf1ff;
  text-decoration: none;
  flex-shrink: 0;
}

/* ğŸ“… ProstÅ™ednÃ­ Å™Ã¡dek â€“ datum + telefonnÃ­ ikona */
.mob-mid {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 6px;
}
.mob-date {
  font-size: 1.05em;
  font-weight: 600;
  color: #111;
}
.phone-btn {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: #f0f0f0;
  text-decoration: none;
  font-size: 1.3em;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  flex-shrink: 0;
}

/* ğŸ‘¤ SpodnÃ­ Å™Ã¡dek â€“ jmÃ©no */
.mob-name {
  margin-top: 8px;
  font-size: 1.1em;
  font-weight: 700;
  color: #000;
}

/* ğŸŸ¢ Barvy dle stavu */
.mob-block.stav-novy { border-left-color: #ffea70; }
.mob-block.stav-domluveno { border-left-color: #80aaff; }
.mob-block.stav-nezveda { border-left-color: #ffa84d; }
.mob-block.stav-zruseno { border-left-color: #ff5c5c; }
.mob-block.stav-hotovo { border-left-color: #5cd65c; }
</style>
<!-- ğŸŸ¦ KONEC -2: MOBILNÃ BLOBKY (upravenÃ½ layout) -->


â€¨



<!-- ğŸŸ© SEKCE C â€“ DETAIL ZÃKAZNÃKA (rozdÄ›lenÃ¡ verze) -->
<!-- ================================================= -->




<!-- ğŸŸ¥ C-1: DETAIL ZÃKAZNÃKA â€“ Å¡edÃ© kontaktovat + blikajÃ­cÃ­ ÄervenÃ© zahÃ¡jit nÃ¡vÅ¡tÄ›vu -->
<script>
function openDetail(index) {
  const item = dataAll[index];
  if (!item) return;

  const overlay = document.createElement("div");
  overlay.className = "detail-overlay";
  const adresaUpravena = normalizePrahaAddress(item.adresa || "");

  overlay.innerHTML = `
    <div class="detail-modal">
      <div class="grid-layout">

        <!-- ğŸ§­ LEVÃ PANEL -->
        <div class="left-panel">
          <div id="miniCalendar"></div>

          <div class="custom-time-picker">
            <select id="hours"></select><span>:</span><select id="minutes"></select>
          </div>

          <div class="term-info-box" id="termInfoBox">Vyberte datum a Äas</div>

          <!-- ğŸŸ© BLOK TLAÄŒÃTEK -->
          <div class="left-buttons">

            <!-- ğŸ©¶ ÃšzkÃ© tlaÄÃ­tko kontaktovat zÃ¡kaznÃ­ka -->
            <button id="contactBtn" class="btn-action btn-grayContact">
              Kontaktovat zÃ¡kaznÃ­ka
            </button>

            <div class="btn-grid">
              <div class="btn-col">
                <button id="saveTermBtn" class="btn-action btn-green">UloÅ¾it / ZmÄ›nit termÃ­n</button>
                <button id="waitBtn" class="btn-action btn-purple">ZÃ¡kaznÃ­k ÄekÃ¡ na dÃ­ly</button>
              </div>
              <div class="btn-col">
                <button id="createProtocolBtn" class="btn-action btn-blue">VytvoÅ™it protokol</button>
                <button id="closeBtn" class="btn-action btn-lightgray">ZpÄ›t</button>
              </div>
            </div>

            <!-- ğŸ”´ VelkÃ© blikajÃ­cÃ­ tlaÄÃ­tko dole -->
            <button id="startVisitBtn" class="btn-action btn-redBlink">
              ZAHÃJIT NÃVÅ TÄšVU U ZÃKAZNÃKA
            </button>
          </div>
        </div>

        <!-- ğŸ§¾ PRAVÃ PANEL -->
        <div class="right-panel">
          <!-- ğŸ§â€â™‚ï¸ Ãšdaje zÃ¡kaznÃ­ka -->
          <div class="info-box clickable" id="customerBox">
            <div class="box-header"><strong>ZÃ¡kaznÃ­k</strong><span class="icon">âœï¸</span></div>
            <div class="box-content">
              <p><strong>JmÃ©no:</strong> ${item.zakaznik || "â€“"}</p>
              <p><strong>Adresa:</strong> ${adresaUpravena}</p>
              <p><strong>Telefon:</strong> ${(item.telefon || "â€“")}</p>
              <p><strong>Email:</strong> ${item.email || "â€“"}</p>
              <p><strong>Produkt / model:</strong> ${item.produkt || "â€“"}</p>
            </div>
          </div>

          <!-- ğŸ§° Popis zÃ¡vady -->
          <div class="info-box clickable" id="popisBox">
            <div class="box-header"><strong>Popis zÃ¡vady</strong><span class="icon">ğŸ“</span></div>
            <div class="box-content" id="popisContent">${item.popis || "â€“"}</div>
          </div>

          <!-- ğŸŒ Mapa -->
          <div class="distance-banner" id="mapDistance">ğŸ“ PoÄÃ­tÃ¡m vzdÃ¡lenostâ€¦</div>
          <div id="mapDetail"></div>
        </div>
      </div>
    </div>`;

  document.body.appendChild(overlay);
  setTimeout(() => overlay.classList.add("active"), 10);

  initCalendarAndTime(overlay, item, index);
  initMapForDetail(overlay, item);
  initDetailButtons(overlay, item, index);

  overlay.querySelector("#customerBox").onclick = () => openCustomerDetail(item, overlay);
  overlay.querySelector("#popisBox").onclick = () => openPopisEditor(item, overlay);
}
</script>

<style>
.left-buttons {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 12px;
}
.btn-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.btn-col {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* ğŸ¨ JednotnÃ½ vzhled vÅ¡ech tlaÄÃ­tek */
.btn-action {
  width: 100%;
  padding: 11px 0;
  font-family: "Inter", sans-serif;
  font-size: 0.95em;
  font-weight: 400;      /* ne tuÄnÃ© */
  border: none;
  border-radius: 8px;
  color: #fff !important; /* bÃ­lÃ© pÃ­smo */
  cursor: pointer;
  transition: opacity 0.2s ease, transform 0.2s ease;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}
.btn-action:hover { opacity: 0.85; transform: scale(1.02); }

/* ğŸ©¶ Kontaktovat zÃ¡kaznÃ­ka (stejnÃ© jako ostatnÃ­) */
.btn-grayContact {
  background: linear-gradient(135deg, #888, #aaa);
}

/* ğŸ”´ ZahÃ¡jit nÃ¡vÅ¡tÄ›vu â€“ ÄervenÃ© blikajÃ­cÃ­, dvojnÃ¡sobnÃ¡ vÃ½Å¡ka i Å¡Ã­Å™ka */
@keyframes blinkRed {
  0%, 100% { background: linear-gradient(135deg, #ff4d4d, #ff8080); }
  50%      { background: linear-gradient(135deg, #ff7373, #ffa0a0); }
}
.btn-redBlink {
  animation: blinkRed 1.5s infinite;
  height: calc(2 * 42px);
  font-size: 1.05em;
  letter-spacing: 0.3px;
  border-radius: 10px;
}

/* ğŸ¨ OstatnÃ­ barvy */
.btn-green     { background: linear-gradient(135deg, #4caf50, #6fdd72); }
.btn-purple    { background: linear-gradient(135deg, #b993ff, #d4b5ff); }
.btn-blue      { background: linear-gradient(135deg, #357aff, #6fa8ff); }
.btn-lightgray { background: linear-gradient(135deg, #aaa, #ccc); }
</style>
<!-- ğŸŸ¥ KONEC C-1 -->



<!-- ğŸŸ© C-2: MAPA A VZDÃLENOST -->
<script>
function initMapForDetail(overlay, item) {
  if (!item.adresa) return;
  const wgs = [50.049, 14.523];
  const map = L.map(overlay.querySelector("#mapDetail")).setView(wgs, 9);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
    { attribution: "Â© OpenStreetMap" }).addTo(map);
  const wgsM = L.marker(wgs, { title: "WGS" }).addTo(map);

  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(item.adresa)}`)
    .then(r => r.json())
    .then(d => {
      if (d[0]) {
        const c = [+d[0].lat, +d[0].lon];
        const cust = L.marker(c, { title: "ZÃ¡kaznÃ­k" }).addTo(map);
        L.polyline([wgs, c], { color: "#0046ff", weight: 3 }).addTo(map);
        const dist = calcDistanceCoords(wgs[0], wgs[1], c[0], c[1]);
        overlay.querySelector("#mapDistance").innerHTML =
          `VzdÃ¡lenost od WGS: ${dist.toFixed(1)} km`;
        map.fitBounds(L.featureGroup([wgsM, cust]).getBounds().pad(0.3));
      }
    });
}
</script>
<!-- ğŸŸ© KONEC C-2 -->


<!-- ğŸŸ© C-3: KALENDÃÅ˜ A ÄŒAS -->
<script>
function initCalendarAndTime(overlay, item, index) {
  const infoBox = overlay.querySelector("#termInfoBox");
  const miniCal = new VanillaCalendar("#miniCalendar", {
    settings: { lang: "cs", selection: { day: "single" }, visibility: { theme: "light" } },
    actions: { clickDay: e => {
      const chosen = e.target.dataset.calendarDay;
      if (chosen) {
        overlay.dataset.datum = chosen;
        updateTermInfoBox(infoBox, chosen, null);
        flashBox(infoBox, "gray");
      }
    } }
  });
  miniCal.init();

  // hodiny
  const hSel = overlay.querySelector("#hours"), mSel = overlay.querySelector("#minutes");
  for (let h = 7; h < 20; h++) hSel.innerHTML += `<option>${String(h).padStart(2,"0")}</option>`;
  for (let m = 0; m < 60; m += 5) mSel.innerHTML += `<option>${String(m).padStart(2,"0")}</option>`;
  hSel.addEventListener("change", () => updateTime(infoBox, overlay));
  mSel.addEventListener("change", () => updateTime(infoBox, overlay));
}
</script>
<!-- ğŸŸ© KONEC C-3 -->




<!-- ğŸŸ© C-4: LOGIKA TLAÄŒÃTEK â€“ ÄervenÃ© Kontaktovat zÃ¡kaznÃ­ka + ÄernÃ© pÃ­smo -->
<script>
function initDetailButtons(overlay, item, index) {
  const id = item.cislo || `radek-${index}`;
  const infoBox = overlay.querySelector("#termInfoBox");

  // ğŸ’¾ UloÅ¾it / ZmÄ›nit termÃ­n
  overlay.querySelector("#saveTermBtn").onclick = () => {
    const datum = overlay.dataset.datum;
    const cas = `${overlay.querySelector("#hours").value}:${overlay.querySelector("#minutes").value}`;
    if (!datum || !cas) return alert("Vyberte datum a Äas!");
    ulozitTerminNaGitHub(item, id, datum, cas, overlay, overlay.querySelector("#saveTermBtn"), infoBox);
  };

  // ğŸŸ£ ZÃ¡kaznÃ­k ÄekÃ¡ na dÃ­ly
  overlay.querySelector("#waitBtn").onclick = async () => {
    try {
      stavy[id] = "ceka";
      item.stav = "ceka";
      const res = await fetch("https://wgs-token.72nvwf4pb2.workers.dev/orders", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "update", record: item })
      });
      if (!res.ok) throw new Error("HTTP " + res.status);
      setNextToast("ğŸŸ£ ZÃ¡kaznÃ­k ÄekÃ¡ na dÃ­ly", "warning");
      overlay.remove();
      renderTable(dataAll);
    } catch (err) {
      alert("âŒ Chyba pÅ™i uklÃ¡dÃ¡nÃ­: " + err.message);
    }
  };

  // ğŸ§¾ VytvoÅ™it protokol
  overlay.querySelector("#createProtocolBtn").onclick = () => {
    localStorage.setItem("protokolData", JSON.stringify(item));
    window.location.href = "protokol.html";
  };

  // ğŸŸ¢ ZahÃ¡jit nÃ¡vÅ¡tÄ›vu
  overlay.querySelector("#startVisitBtn").onclick = () => {
    localStorage.setItem("currentCustomer", JSON.stringify(item));
    window.location.href = "photocustomer.html";
  };

  // â˜ï¸ Kontaktovat zÃ¡kaznÃ­ka
  overlay.querySelector("#contactBtn").onclick = () => openContactModal(item, index, overlay);

  // ğŸ”™ ZpÄ›t
  overlay.querySelector("#closeBtn").onclick = () => overlay.remove();
}
</script>

<style>
/* ğŸ¨ Vzhled tlaÄÃ­tek â€“ jednotnÃ© rozmÄ›ry a ÄernÃ© pÃ­smo */
.btn-action {
  width: 100%;
  padding: 11px 0;
  font-family: "Inter", sans-serif;
  font-size: 0.95em;
  font-weight: 500;
  border: none;
  border-radius: 8px;
  color: #000 !important; /* âœ… pevnÄ› ÄernÃ© pÃ­smo */
  cursor: pointer;
  transition: opacity 0.2s ease, transform 0.2s ease;
  box-shadow: 0 2px 6px rgba(0,0,0,0.12);
}
.btn-action:hover { opacity: 0.88; transform: scale(1.02); }

/* ğŸŸ¥ Kontaktovat zÃ¡kaznÃ­ka â€“ dvojnÃ¡sobnÃ¡ vÃ½Å¡ka, ÄervenÃ½ gradient */
.btn-redContact {
  background: linear-gradient(135deg, #ff6666, #ff9999);
  height: calc(2 * 42px); /* pÅ™ibliÅ¾nÄ› vÃ½Å¡ka dvou tlaÄÃ­tek */
  font-size: 1.05em;
  letter-spacing: 0.3px;
  border-radius: 10px;
}

/* ğŸ¨ OstatnÃ­ barvy */
.btn-green   { background: linear-gradient(135deg, #8bf58b, #b6ffb6); }
.btn-purple  { background: linear-gradient(135deg, #d4b5ff, #b993ff); }
.btn-blue    { background: linear-gradient(135deg, #bcd5ff, #8fb7ff); }
.btn-gray    { background: linear-gradient(135deg, #dadada, #eeeeee); }
.btn-darkgray{ background: linear-gradient(135deg, #c0c0c0, #d8d8d8); }
.btn-reflex  { background: linear-gradient(135deg, #aaff00, #c8ff4d); }

/* RozloÅ¾enÃ­ sloupcÅ¯ */
.btn-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.btn-col {
  display: flex;
  flex-direction: column;
  gap: 10px;
}
</style>
<!-- ğŸŸ© KONEC C-4 -->




<!-- ğŸŸ© C-5: POMOCNÃ‰ FUNKCE -->
<script>
function updateTermInfoBox(b, d, c) {
  const date = new Date(d);
  const den = date.toLocaleDateString("cs-CZ", { weekday: "long", day: "numeric", month: "long" });
  b.textContent = c ? `${den} â€“ ${c}` : `${den}`;
}
function updateTime(b, o) {
  const d = o.dataset.datum; if (!d) return;
  const c = `${o.querySelector("#hours").value}:${o.querySelector("#minutes").value}`;
  updateTermInfoBox(b, d, c); flashBox(b, "green");
}
function flashBox(b, color) {
  b.classList.remove("flash-gray", "flash-green"); void b.offsetWidth;
  b.classList.add(color === "green" ? "flash-green" : "flash-gray");
}
function calcDistanceCoords(a, b, c, d) {
  const R = 6371, dL = (c - a) * Math.PI / 180, dO = (d - b) * Math.PI / 180;
  const x = Math.sin(dL/2)**2 + Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(dO/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(x), Math.sqrt(1 - x));
}
</script>
<!-- ğŸŸ© KONEC C-5 -->


<!-- ğŸŸ© C-STYLE: CSS DETAILU -->
<style>
/* ğŸŸ¦ PÅ™ekryv â€“ vycentrovanÃ½ modal uprostÅ™ed */
.detail-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.55);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  opacity: 0;
  transition: opacity 0.25s ease;
}
.detail-overlay.active { opacity: 1; }

.detail-modal {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.25);
  padding: 20px;
  width: 95%;
  max-width: 1100px;
  max-height: 90vh;
  overflow-y: auto;
}

/* ğŸŸ¦ RozloÅ¾enÃ­ dvou panelÅ¯ */
.grid-layout {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}
.left-panel, .right-panel {
  background: #fff;
  border-radius: 10px;
  padding: 10px;
}

/* ğŸ—“ï¸ KalendÃ¡Å™ + Äas */
#miniCalendar { margin-bottom: 12px; }
.custom-time-picker {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 6px;
  margin-bottom: 10px;
}
.custom-time-picker select {
  font-size: 1.1em;
  font-weight: 600;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 5px 10px;
}

/* ğŸŸ¨ InformaÄnÃ­ boxy */
.info-box {
  background: #f4f5f7;
  border-radius: 10px;
  padding: 12px 14px;
  margin-bottom: 14px;
  cursor: pointer;
  transition: background .2s;
}
.info-box:hover { background: #e9ecf1; }
.box-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: 700;
  color: #333;
  margin-bottom: 6px;
}
.box-content p {
  margin: 3px 0;
  font-size: 0.92em;
}
.icon {
  font-size: 1.1em;
  color: #555;
}

/* ğŸŸ¦ TlaÄÃ­tka vlevo */
.left-buttons {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 10px;
}
.btn-action {
  padding: 10px;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  color: #fff;
  cursor: pointer;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
}
.btn-green  { background: linear-gradient(135deg, #28a745, #6fdd72); }
.btn-orange { background: linear-gradient(135deg, #ff9800, #ffc270); color: #222; }
.btn-red    { background: linear-gradient(135deg, #dc3545, #f87171); }
.btn-gray   { background: linear-gradient(135deg, #6c757d, #a0a4a7); }
.btn-blue   { background: linear-gradient(135deg, #0046ff, #357aff); color: #fff; }

/* ğŸ§© Prostor mapy */
.distance-banner {
  background: #f6f6f6;
  border-radius: 8px;
  padding: 8px;
  text-align: center;
  font-weight: 600;
  margin: 10px 0;
}
#mapDetail {
  height: 280px;
  border-radius: 10px;
  border: 1px solid #ddd;
  margin-top: 8px;
}

/* ğŸ” Animace term-info boxu */
.term-info-box {
  background: #f0f0f0;
  padding: 10px;
  text-align: center;
  font-weight: 600;
  border-radius: 8px;
  margin-top: 8px;
  transition: background .3s;
}
.flash-gray { animation: flashGray .4s; }
.flash-green { animation: flashGreen .5s 2; }
@keyframes flashGray { 0%{background:#d6d6d6;}100%{background:#f0f0f0;} }
@keyframes flashGreen { 0%,100%{background:#b6f7a8;}50%{background:#d8ffd2;} }

/* ğŸ“± MobilnÃ­ Ãºpravy */
@media (max-width: 700px) {
  .grid-layout { grid-template-columns: 1fr; }
  .left-buttons { flex-direction: column; }
  #mapDetail { height: 240px; }
  .detail-modal { padding: 10px; }
}
</style>
<!-- ğŸŸ© KONEC C-STYLE -->







<!-- ğŸŸ§ SEKCE D â€“ ULOÅ½ENÃ TERMÃNU NA GITHUB + TOAST + LOADER -->
<script>
/* ========================================================= */
/* ğŸ’¾ ULOÅ½ENÃ TERMÃNU PÅ˜ES WORKER (GITHUB)                   */
/* ========================================================= */
async function ulozitTerminNaGitHub(item, id, datum, cas, overlay, btn, infoBox) {
  stavy[id] = "domluveno";
  item.datum = datum;
  item.cas = cas;

  // â³ Loader â€ÄŒekejteâ€œ
  const loader = document.createElement("div");
  loader.className = "loader-overlay";
  loader.innerHTML = `
    <div class="loader-inner">
      <div class="hourglass"></div>
      <div>â³ ÄŒekejte, uklÃ¡dÃ¡m termÃ­nâ€¦</div>
    </div>`;
  document.body.appendChild(loader);

  try {
    // ğŸ’¾ UloÅ¾enÃ­ pÅ™es Worker na GitHub
    const res = await fetch("https://wgs-token.72nvwf4pb2.workers.dev/orders", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action: "update", record: item })
    });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);

    // âœ… PotvrzenÃ­
    setTimeout(() => {
      loader.remove();
      showSuccessOverlay("âœ… TermÃ­n ÃºspÄ›Å¡nÄ› uloÅ¾en",
        "Data byla odeslÃ¡na a potvrzena v GitHub repozitÃ¡Å™i.");
      ulozTermin(item);
      localStorage.setItem("stavyReklamaci", JSON.stringify(stavy));
      flashBox(infoBox, "green");
      setNextToast("âœ… TermÃ­n ÃºspÄ›Å¡nÄ› uloÅ¾en", "success");

      setTimeout(() => {
        overlay.remove();
        renderTable(dataAll);
      }, 1400);
    }, 800);

  } catch (err) {
    loader.remove();
    alert("âŒ Chyba pÅ™i uklÃ¡dÃ¡nÃ­ termÃ­nu: " + err.message);
    showToast("Chyba pÅ™i uklÃ¡dÃ¡nÃ­!", "error");
  }
}

/* ========================================================= */
/* ğŸŒŸ TOAST A SUCCESS OVERLAY                                */
/* ========================================================= */
function showToast(msg, type = "success") {
  const toast = document.createElement("div");
  toast.className = `wgs-toast ${type}`;
  toast.innerHTML = `<span>${msg}</span>`;
  document.body.appendChild(toast);
  setTimeout(() => toast.classList.add("active"), 50);
  setTimeout(() => {
    toast.classList.remove("active");
    setTimeout(() => toast.remove(), 400);
  }, 3500);
}

// pro pÅ™enos zprÃ¡vy do dalÅ¡Ã­ho naÄtenÃ­
function setNextToast(msg, type = "success") {
  sessionStorage.setItem("wgsToastMsg", msg);
  sessionStorage.setItem("wgsToastType", type);
}

// po reloadu zobraz toast z pÅ™edchozÃ­ akce
window.addEventListener("DOMContentLoaded", () => {
  const toastMsg = sessionStorage.getItem("wgsToastMsg");
  const toastType = sessionStorage.getItem("wgsToastType");
  if (toastMsg) {
    showToast(toastMsg, toastType);
    sessionStorage.removeItem("wgsToastMsg");
    sessionStorage.removeItem("wgsToastType");
  }
});

/* ========================================================= */
/* ğŸ‰ SUCCESS OVERLAY (velkÃ¡ bÃ­lÃ¡ hlÃ¡Å¡ka uprostÅ™ed)          */
/* ========================================================= */
function showSuccessOverlay(title, text) {
  const ok = document.createElement("div");
  ok.className = "successOverlay";
  ok.innerHTML = `
    <div class="successInner">
      <div class="icon">âœ…</div>
      <div class="title">${title}</div>
      <div class="text">${text}</div>
    </div>`;
  document.body.appendChild(ok);
  setTimeout(() => ok.classList.add("active"), 50);
  setTimeout(() => {
    ok.classList.remove("active");
    setTimeout(() => ok.remove(), 400);
  }, 1800);
}
</script>

<!-- ğŸŸ§ D-STYLE: LOADER + TOAST + SUCCESS OVERLAY -->
<style>
.loader-overlay {
  position: fixed; inset: 0;
  background: rgba(255,255,255,0.88);
  display: flex; flex-direction: column;
  justify-content: center; align-items: center;
  font-family: "Inter", sans-serif;
  color: #0046ff; font-weight: 700;
  font-size: 1.2em; z-index: 99999;
}
.hourglass {
  width: 44px; height: 44px;
  border: 4px solid #0046ff;
  border-radius: 50%;
  border-top-color: transparent;
  animation: spin 1.1s linear infinite;
  margin-bottom: 12px;
}
@keyframes spin { from {transform:rotate(0)} to {transform:rotate(360deg)} }

.successOverlay {
  position: fixed; inset: 0;
  background: rgba(255,255,255,0.9);
  display: flex; justify-content: center; align-items: center;
  opacity: 0; transition: opacity 0.3s ease; z-index: 100000;
}
.successOverlay.active { opacity: 1; }
.successInner {
  background: #fff;
  border-left: 6px solid #28a745;
  border-radius: 12px;
  padding: 25px 30px;
  text-align: center;
  font-family: "Inter", sans-serif;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  max-width: 360px;
}
.successInner .icon { font-size: 2em; margin-bottom: 10px; }
.successInner .title { font-size: 1.3em; font-weight: 800; color: #28a745; margin-bottom: 6px; }
.successInner .text { font-size: 0.95em; color: #333; }

/* Toast vpravo nahoÅ™e */
.wgs-toast {
  position: fixed; top: 20px; right: 20px;
  background: #fff;
  padding: 14px 22px;
  border-radius: 8px;
  box-shadow: 0 3px 12px rgba(0,0,0,0.15);
  font-family: "Inter", sans-serif;
  font-size: 0.95em;
  font-weight: 600;
  color: #111;
  opacity: 0; transform: translateY(-10px);
  transition: all 0.35s ease; z-index: 100001;
}
.wgs-toast.active { opacity: 1; transform: translateY(0); }
.wgs-toast.success { border-left: 5px solid #28a745; }
.wgs-toast.error { border-left: 5px solid #dc3545; }
.wgs-toast.warning { border-left: 5px solid #ff9800; }
</style>
<!-- ğŸŸ§ KONEC SEKCE D -->






<!-- ğŸŸ¦ SEKCE E â€“ PLÃN DNE (kalendÃ¡Å™, mapa, trasa, legenda) -->
<!-- ====================================================== -->

<!-- ğŸŸ¦ E-1: OTEVÅ˜ENÃ OKNA PLÃNU DNE -->
<script>
function openPlanModal() {
  const overlay = document.createElement("div");
  overlay.id = "planModal";
  overlay.innerHTML = `
    <div class="planContent">
      <div class="planLeft">
        <div id="planCalendar"></div>
        <div id="planLegend"></div>
        <button id="planCloseBtn" class="btn-close">ZpÄ›t</button>
      </div>
      <div class="planRight">
        <div id="planMap"></div>
        <div id="planList"></div>
      </div>
    </div>`;
  document.body.appendChild(overlay);
  setTimeout(()=>overlay.classList.add("active"),20);

  initPlanCalendar(overlay);
  overlay.querySelector("#planCloseBtn").onclick = ()=>overlay.remove();
}
</script>
<!-- ğŸŸ¦ KONEC E-1 -->


<!-- ğŸŸ¦ E-2: KALENDÃÅ˜ A NAÄŒTENÃ DNÃ -->
<script>
function initPlanCalendar(overlay){
  const cal = new VanillaCalendar("#planCalendar",{
    settings:{ lang:"cs", selection:{ day:"single" }, visibility:{ theme:"light" }},
    actions:{ clickDay:e=>{
      const d = e.target.dataset.calendarDay;
      if(!d)return;
      loadPlanForDay(d,overlay);
    }}
  });
  cal.init();

  // vyznaÄit dny s termÃ­nem modrÃ½m puntÃ­kem
  const data = dataAll.filter(x=>x.datum);
  data.forEach(r=>{
    const el=document.querySelector(`[data-calendar-day="${r.datum}"]`);
    if(el) el.classList.add("vanilla-calendar-day__btn_selected");
  });
}
</script>
<!-- ğŸŸ¦ KONEC E-2 -->


<!-- ğŸŸ¦ E-3: NAÄŒTENÃ A ZOBRAZENÃ DNÄš -->
<script>
async function loadPlanForDay(date,overlay){
  const list=dataAll.filter(r=>r.datum===date && r.stav!=="zruseno");
  const planList=overlay.querySelector("#planList");
  const planLegend=overlay.querySelector("#planLegend");
  const planMap=overlay.querySelector("#planMap");

  if(!list.length){
    planList.innerHTML="<div class='empty'>Å½Ã¡dnÃ© zakÃ¡zky pro tento den</div>";
    planLegend.innerHTML="";
    planMap.innerHTML="";
    return;
  }

  // seÅ™adit podle Äasu
  list.sort((a,b)=>(a.cas||"").localeCompare(b.cas||""));
  planList.innerHTML="";
  planLegend.innerHTML="";

  let legendHTML="<table class='legendTable'><tr><th>#</th><th>ÄŒas</th><th>ZÃ¡kaznÃ­k</th></tr>";
  list.forEach((r,i)=>{
    legendHTML+=`<tr><td>${i+1}</td><td>${r.cas||"-"}</td><td>${r.zakaznik}</td></tr>`;
  });
  legendHTML+="</table>";
  planLegend.innerHTML=legendHTML;

  planList.innerHTML=list.map((r,i)=>`
    <div class="planItem">
      <div class="planNum">${i+1}</div>
      <div class="planName">${r.zakaznik}</div>
      <div class="planAddr">${r.adresa}</div>
      <div class="planTime">${r.cas}</div>
    </div>`).join("");

  await showPlanMap(list,planMap);
}
</script>
<!-- ğŸŸ¦ KONEC E-3 -->


<!-- ğŸŸ¦ E-4: MAPA A TRASA -->
<script>
async function showPlanMap(list,container){
  const wgs=[50.049,14.523];
  const map=L.map(container).setView(wgs,9);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap"}).addTo(map);
  const points=[wgs];
  const markers=[L.marker(wgs,{title:"WGS"})];
  const geos=[];

  for(const r of list){
    if(!r.adresa)continue;
    const geo=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(r.adresa)}`).then(x=>x.json());
    if(geo[0]){
      const p=[+geo[0].lat,+geo[0].lon];
      geos.push(p);
      points.push(p);
      markers.push(L.marker(p,{title:r.zakaznik}).addTo(map).bindPopup(`${r.zakaznik}<br>${r.adresa}<br>${r.cas}`));
    }
  }

  if(points.length>1){
    L.polyline(points,{color:"#0046ff",weight:3}).addTo(map);
    map.fitBounds(L.featureGroup(markers).getBounds().pad(0.3));
  }
}
</script>
<!-- ğŸŸ¦ KONEC E-4 -->


<!-- ğŸŸ¦ E-STYLE: MAPA + LEGENDA + ROZLOÅ½ENÃ -->
<style>
#planModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.55);
  justify-content:center;align-items:center;z-index:9999;opacity:0;transition:opacity .25s ease;}
#planModal.active{display:flex;opacity:1;}
.planContent{background:#fff;border-radius:14px;display:grid;
  grid-template-columns:340px 1fr;gap:15px;padding:20px;max-width:90vw;max-height:90vh;overflow:auto;}
.planLeft{display:flex;flex-direction:column;align-items:center;}
#planCalendar{width:100%;}
.legendTable{border-collapse:collapse;width:100%;margin-top:10px;font-size:.9em;}
.legendTable th,.legendTable td{border-bottom:1px solid #ddd;padding:4px;text-align:left;}
.legendTable th{background:#f2f2f2;font-weight:700;}
.btn-close{margin-top:10px;background:linear-gradient(135deg,#dc3545,#f87171);color:#fff;
  border:none;border-radius:8px;padding:8px 16px;font-weight:600;cursor:pointer;}
.planRight{display:flex;flex-direction:column;gap:10px;}
#planMap{height:360px;border-radius:10px;border:1px solid #ccc;}
.planItem{background:#f8f9fa;padding:8px 10px;border-radius:8px;margin-bottom:6px;
  display:grid;grid-template-columns:30px 1fr 1fr 60px;align-items:center;gap:8px;}
.planNum{font-weight:800;color:#0046ff;}
.planName{font-weight:600;}
.planAddr{font-size:.9em;color:#333;}
.planTime{text-align:right;font-weight:600;}
.empty{text-align:center;color:#555;margin-top:30px;}
@media(max-width:900px){.planContent{grid-template-columns:1fr;max-width:100vw;}}
</style>
<!-- ğŸŸ¦ KONEC SEKCE E -->










<!-- ğŸŸ¨ SEKCE F â€“ POMOCNÃ‰ FUNKCE A UTILITIES -->
<!-- ======================================= -->

<!-- 
====================================================================
ğŸ§­ F-1: POMOCNÃ‰ FUNKCE â€“ NORMALIZACE ADRES
====================================================================
ÃšÄel:
  - sjednocuje zÃ¡pisy adres z rÅ¯znÃ½ch zdrojÅ¯
  - doplÅˆuje chybÄ›jÃ­cÃ­ mÄ›stskÃ© ÄÃ¡sti Prahy pro pÅ™esnou geolokaci
  - zajiÅ¡Å¥uje sprÃ¡vnÃ© vÃ½sledky pro OpenStreetMap (Nominatim)
  - pouÅ¾Ã­vÃ¡ se pÅ™i zobrazovÃ¡nÃ­ adres ve Waze, mapÄ› i detailu zÃ¡kaznÃ­ka

PoslednÃ­ Ãºprava: 2025-10-08
====================================================================
-->
<script>
function normalizePrahaAddress(a) {
  if (!a) return "";
  let t = a.trim();

  // ğŸ’¡ odstranÄ›nÃ­ duplicitnÃ­ch oznaÄenÃ­ a sjednocenÃ­ mezery
  t = t.replace(/\bHlavnÃ­ mÄ›sto Praha\b/gi, "Praha");
  t = t.replace(/\bPraha\s*\d*\b/gi, "Praha");
  t = t.replace(/\s+/g, " ");

  // ğŸ§© speciÃ¡lnÃ­ praÅ¾skÃ© Ätvrti, kterÃ© Nominatim Äasto zamÄ›Åˆuje:
  const doplnky = [
    { match: /do dubÄe/i, add: "Praha 9 - BÄ›chovice" },
    { match: /bÄ›chovic/i, add: "Praha 9 - BÄ›chovice" },
    { match: /hornÃ­ poÄernic/i, add: "Praha 9 - HornÃ­ PoÄernice" },
    { match: /dolnÃ­ mÄ›cholup/i, add: "Praha 10 - DolnÃ­ MÄ›cholupy" },
    { match: /uhÅ™Ã­nÄ›ves/i, add: "Praha 22 - UhÅ™Ã­nÄ›ves" },
    { match: /Å™epy/i, add: "Praha 17 - Å˜epy" },
    { match: /zliÄÃ­n/i, add: "Praha 5 - ZliÄÃ­n" },
    { match: /kolodÄ›j/i, add: "Praha 9 - KolodÄ›je" },
    { match: /kyje/i, add: "Praha 14 - Kyje" },
    { match: /dubeÄ/i, add: "Praha 10 - DubeÄ" }
  ];

  // ğŸ§  kontrola a doplnÄ›nÃ­ mÄ›stskÃ© ÄÃ¡sti, pokud v adrese chybÃ­
  for (const d of doplnky) {
    if (d.match.test(t) && !t.toLowerCase().includes(d.add.toLowerCase())) {
      if (!/praha\s*\d/i.test(t)) t += ", " + d.add;
    }
  }

  // ğŸ§­ doplnÄ›nÃ­ defaultnÃ­ ÄÃ¡sti pro Prahu, pokud nenÃ­ uvedena
  if (/praha/i.test(t) && !/praha\s*\d/i.test(t)) {
    t += ", Praha 1";
  }

  return t.trim();
}
</script>
<!-- ğŸŸ© KONEC SEKCE F-1 -->


<!-- ğŸŸ¨ F-2: LOKÃLNÃ UKLÃDÃNÃ TERMÃNÅ® -->
<script>
function ulozTermin(item) {
  const ulozene = JSON.parse(localStorage.getItem("stavyReklamaciData") || "[]");
  const exist = ulozene.find(x => x.cislo === item.cislo);
  if (exist) {
    exist.datum = item.datum;
    exist.cas = item.cas;
  } else {
    ulozene.push({ cislo: item.cislo, datum: item.datum, cas: item.cas });
  }
  localStorage.setItem("stavyReklamaciData", JSON.stringify(ulozene));
}
</script>
<!-- ğŸŸ¨ KONEC F-2 -->


<!-- ğŸŸ¨ F-3: VÃPOÄŒET HASH A KONTROLA DUPLIKÃTÅ® -->
<script>
function computeDataHash(arr) {
  try {
    const s = JSON.stringify(arr);
    let hash = 0;
    for (let i = 0; i < s.length; i++) {
      hash = (hash << 5) - hash + s.charCodeAt(i);
      hash |= 0;
    }
    return hash;
  } catch (e) { return 0; }
}
</script>
<!-- ğŸŸ¨ KONEC F-3 -->


<!-- ğŸŸ¨ F-4: KONTROLA RELOADU A PÅ˜ENOS TOASTU -->
<script>
window.addEventListener("DOMContentLoaded", () => {
  const msg = sessionStorage.getItem("wgsToastMsg");
  const type = sessionStorage.getItem("wgsToastType");
  if (msg) {
    showToast(msg, type);
    sessionStorage.removeItem("wgsToastMsg");
    sessionStorage.removeItem("wgsToastType");
  }

  // volitelnÃ©: zobraz info o poÄtu zÃ¡znamÅ¯
  if (typeof dataAll !== "undefined" && dataAll.length) {
    console.log(`â„¹ï¸ NaÄteno ${dataAll.length} zÃ¡znamÅ¯ z Workera.`);
  }
});
</script>
<!-- ğŸŸ¨ KONEC F-4 -->


<!-- ğŸŸ¨ F-5: GENERICKÃ‰ FUNKCE â€“ BARVY, FORMÃTY -->
<script>
function formatDateCzech(dateStr) {
  const d = new Date(dateStr);
  return d.toLocaleDateString("cs-CZ", { day: "2-digit", month: "2-digit", year: "numeric" });
}
function formatTimeShort(h, m) {
  return `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}`;
}
</script>
<!-- ğŸŸ¨ KONEC F-5 -->


<!-- ğŸŸ¨ F-STYLE: DOPLÅ‡KOVÃ‰ STYLY -->
<style>
.flash-green {animation:flashGreen .6s;}
@keyframes flashGreen {
  0% {background:#c0f9b8;} 50% {background:#e8ffe3;} 100% {background:#f0f0f0;}
}
.loading {text-align:center;padding:20px;color:#555;font-family:Inter,sans-serif;}
</style>
<!-- ğŸŸ¨ KONEC F-STYLE -->






<!-- ğŸŸª SEKCE G â€“ EXTERNÃ KNIHOVNY + GLOBÃLNÃ INICIALIZACE -->
<!-- ===================================================== -->

<!-- ğŸŸª G-1: IMPORTY KNIHOVEN -->
<!-- ğŸ—ºï¸ Leaflet (mapa) -->
<link rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      crossorigin="">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        crossorigin=""></script>
<script src="wgs-config-map.js"></script>

<!-- ğŸ“… Vanilla Calendar (tvÃ¡ verze z GitHubu) -->
<link rel="stylesheet"
      href="https://radecek222-boop.github.io/reklamace/vanilla-calendar.min.css">
<script src="https://radecek222-boop.github.io/reklamace/vanilla-calendar.min.js"></script>

<!-- ğŸ“„ jsPDF (pro export PDF â€“ volitelnÃ©) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- ğŸŸª KONEC G-1 -->

<!-- ğŸŸª G-2: GLOBÃLNÃ INICIALIZACE A OCHRANA -->
<script>
window.addEventListener("DOMContentLoaded", () => {
  console.log("âœ… White Glove Service â€“ systÃ©m spuÅ¡tÄ›n");
  console.log("ğŸŒ Worker API:", API_URL);
  console.log("ğŸ“¦ PÅ™ipojenÃ­ k GitHub repozitÃ¡Å™i aktivnÃ­.");

  // 1ï¸âƒ£ NaÄtenÃ­ dat z Workera
  loadData();

  // 2ï¸âƒ£ ZobrazenÃ­ toastu z minulÃ© akce (po reloadu)
  const toastMsg = sessionStorage.getItem("wgsToastMsg");
  const toastType = sessionStorage.getItem("wgsToastType");
  if (toastMsg) {
    showToast(toastMsg, toastType);
    sessionStorage.removeItem("wgsToastMsg");
    sessionStorage.removeItem("wgsToastType");
  }

  // 3ï¸âƒ£ NapojenÃ­ hlavnÃ­ch tlaÄÃ­tek
  const planBtn = document.getElementById("planBtn");
  if (planBtn) planBtn.onclick = openPlanModal; // ğŸ”µ â€PlÃ¡n dneâ€œ

  const reloadBtn = document.getElementById("reloadBtn");
  if (reloadBtn) reloadBtn.onclick = loadData;  // ğŸ”„ â€NaÄÃ­st znovuâ€œ

  // 4ï¸âƒ£ Kontrola naÄtenÃ½ch knihoven
  if (typeof L === "undefined") {
    console.error("âŒ Leaflet se nonaÄetl â€“ zkontroluj CDN.");
  } else {
    console.log("ğŸ—ºï¸ Leaflet OK");
  }

  if (typeof VanillaCalendar === "undefined") {
    console.error("âŒ Vanilla Calendar se nonaÄetl â€“ zkontroluj link v sekci G-1.");
  } else {
    console.log("ğŸ“… Vanilla Calendar inicializovÃ¡n (v2.8.1 â€“ GitHub lokÃ¡lnÃ­ verze)");
  }

  console.log("ğŸ§­ NaÄteny vÅ¡echny sekce Aâ€“G (verze v1.0 â€“ 10/2025)");
});

window.addEventListener("error", e => {
  console.error("âš ï¸ Chyba:", e.message, "â†’", e.filename, ":", e.lineno);
});
window.addEventListener("unhandledrejection", e => {
  console.error("âš ï¸ NezpracovanÃ© Promise:", e.reason);
});
</script>
<!-- ğŸŸª KONEC G-2 -->

<!-- ğŸŸª KONEC G-2 -->


<!-- ğŸŸª G-3: ZÃVÄšREÄŒNÃ‰ STYLY A INFO -->
<style>
body {
  font-family: "Inter", system-ui, sans-serif;
  background: #f6f7fb;
  color: #111;
  margin: 0;
  padding: 0;
}

/* PÅ™echody pro modÃ¡lnÃ­ vrstvy a pÅ™ekryvy */
.detail-overlay,
#planModal,
.loader-overlay,
.successOverlay {
  transition: opacity 0.3s ease;
}

/* MobilnÃ­ optimalizace */
@media (max-width:600px) {
  .detail-modal, .planContent { max-width: 95vw; }
  #planMap { height: 260px; }
}

/* VÃ½bÄ›r textu */
::selection { background:#0046ff; color:#fff; }
</style>
<!-- ğŸŸª KONEC G-3 -->

<!-- ğŸŸ© TOAST potvrzenÃ­ -->
<style>
.toast {
  position: fixed;
  bottom: 25px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(90deg, #00a86b, #00d084);
  color: #fff;
  font-weight: 600;
  padding: 12px 22px;
  border-radius: 30px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease, transform 0.4s ease;
  z-index: 9999;
}
.toast.show {
  opacity: 1;
  transform: translate(-50%, -10px);
}
.toast.error {
  background: linear-gradient(90deg, #c93030, #e74c3c);
}
</style>

<div id="toast" class="toast"></div>

<script>
window.addEventListener("DOMContentLoaded", () => {
  const toast = document.getElementById("toast");
  const msg = sessionStorage.getItem("wgsToastMsg");
  const type = sessionStorage.getItem("wgsToastType");

  if (msg) {
    toast.textContent = msg;
    if (type === "error") toast.classList.add("error");
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 4000);
    setTimeout(() => {
      sessionStorage.removeItem("wgsToastMsg");
      sessionStorage.removeItem("wgsToastType");
    }, 4200);
  }
});
</script>







<!-- 
============================================================
ğŸ§­ WHITE GLOVE SERVICE â€“ SEZNAM REKLAMACÃ (mapa sekcÃ­ Aâ€“G)
Verze: 1.0 (Å™Ã­jen 2025)
Autor: Hugo & GPT-5
============================================================

ğŸ”¸ SEKCE A â€“ STRUKTURA STRÃNKY
  - HTML rozloÅ¾enÃ­ (hlaviÄka, tlaÄÃ­tka, vyhledÃ¡vÃ¡nÃ­, tabulka)
  - zÃ¡kladnÃ­ CSS vzhled
  - vÅ¡echny viditelnÃ© prvky uÅ¾ivatelskÃ©ho rozhranÃ­

ğŸ”¹ SEKCE B â€“ NAÄŒÃTÃNÃ DAT
  - Fetch z Cloudflare Workera (https://wgs-token.72nvwf4pb2.workers.dev/orders)
  - funkce loadData() + renderTable()
  - vyhledÃ¡vÃ¡nÃ­ zÃ¡kaznÃ­kÅ¯, filtrovÃ¡nÃ­
  - debug panel (B-DEBUG) â€“ poÄet zÃ¡znamÅ¯ + Äas naÄtenÃ­

ğŸ”¹ SEKCE C â€“ DETAIL ZÃKAZNÃKA
  - openDetail(index) â€“ zobrazenÃ­ detailu z tabulky
  - levÃ½ panel: kalendÃ¡Å™, Äas, tlaÄÃ­tka (UloÅ¾it / NezvedÃ¡ / ZruÅ¡il / ZpÄ›t)
  - pravÃ½ panel: Ãºdaje zÃ¡kaznÃ­ka, mapa (Leaflet), vzdÃ¡lenost od WGS
  - rozdÄ›leno do C-1 aÅ¾ C-5 + styly

ğŸ”¹ SEKCE D â€“ ULOÅ½ENÃ TERMÃNU
  - uloÅ¾it pÅ™es Worker (GitHub update)
  - loader â³ + toast ğŸ”” + success overlay âœ…
  - funkce showToast(), showSuccessOverlay(), setNextToast()
  - uklÃ¡dÃ¡nÃ­ do localStorage + pÅ™enos mezi relacemi

ğŸ”¹ SEKCE E â€“ PLÃN DNE
  - openPlanModal() â€“ mÄ›sÃ­ÄnÃ­ kalendÃ¡Å™ + mapa dne
  - zobrazenÃ­ zÃ¡kaznÃ­kÅ¯ podle Äasu
  - vykreslenÃ­ trasy WGS â†’ zÃ¡kaznÃ­ci (Leaflet)
  - legenda (Äas, poÅ™adÃ­, jmÃ©no)
  - responzivnÃ­ pro mobil i desktop

ğŸ”¹ SEKCE F â€“ POMOCNÃ‰ FUNKCE
  - normalizePrahaAddress() â€“ Ãºprava adres
  - ulozTermin() â€“ uloÅ¾enÃ­ termÃ­nu do localStorage
  - computeDataHash() â€“ kontrolnÃ­ hash pro zmÄ›ny
  - formÃ¡tovÃ¡nÃ­ Äasu, datumu, animace flash
  - pÅ™enos toastu po reloadu

ğŸ”¹ SEKCE G â€“ EXTERNÃ KNIHOVNY + GLOBÃLNÃ INIT
  - import Leaflet + Vanilla Calendar + jsPDF
  - kontrola naÄtenÃ­ knihoven (konzolovÃ© logy)
  - globÃ¡lnÃ­ styly, ochrana proti chybÃ¡m (error / rejection)

============================================================
ğŸ“‚ CelkovÃ¡ struktura:
A  â€“ HTML UI
B  â€“ Data & Tabulka
C  â€“ Detail zÃ¡kaznÃ­ka
D  â€“ UloÅ¾enÃ­ termÃ­nu
E  â€“ PlÃ¡n dne
F  â€“ PomocnÃ© funkce
G  â€“ ExternÃ­ knihovny & Init
============================================================

ğŸ§  PoznÃ¡mka:
Tento blok je pouze dokumentaÄnÃ­ (HTML komentÃ¡Å™).
NemÃ¡ Å¾Ã¡dnÃ½ vliv na funkci kÃ³du a mÅ¯Å¾e bÃ½t volnÄ› pÅ™esouvÃ¡n
nebo doplÅˆovÃ¡n podle potÅ™eby vÃ½voje.

============================================================
-->


<!-- 
============================================================
âš™ï¸ WHITE GLOVE SERVICE â€“ TECHNICKÃ INDEX FUNKCÃ
============================================================

ğŸ“¦ SEKCE A â€“ STRUKTURA A OVLÃDÃNÃ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ window.scrollTo()                  â†’ posun pÅ™i otevÅ™enÃ­ kalendÃ¡Å™e
â€¢ (DOM event listener)               â†’ kliknutÃ­ na tlaÄÃ­tko termÃ­nu

ğŸ“¡ SEKCE B â€“ NAÄŒÃTÃNÃ DAT + DEBUG
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ loadData()                         â†’ naÄtenÃ­ dat z Workera (JSON)
â€¢ renderTable(arr)                   â†’ vykreslenÃ­ tabulky zÃ¡znamÅ¯
â€¢ normalizePrahaAddress(addr)        â†’ Ãºprava adres Praha bez PSÄŒ
â€¢ sortSmart(data)                    â†’ chytrÃ© Å™azenÃ­ dat
â€¢ hashData(arr)                      â†’ hash pro detekci zmÄ›n
â€¢ playNotification()                 â†’ zvuk pÅ™i novÃ½ch zÃ¡znamech
â€¢ searchInput.oninput                â†’ filtrovÃ¡nÃ­ vÃ½sledkÅ¯
â€¢ reloadBtn.onclick                  â†’ ruÄnÃ­ obnovenÃ­ dat

ğŸ‘¤ SEKCE C â€“ DETAIL ZÃKAZNÃKA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ openDetail(index)                  â†’ otevÅ™e detail zÃ¡kaznÃ­ka (modal)
â€¢ updateTermInfoBox()                â†’ aktualizace textu s datem/Äasem
â€¢ updateTime()                       â†’ pÅ™epoÄet Äasu pÅ™i zmÄ›nÄ› hodin/minut
â€¢ flashBox()                         â†’ krÃ¡tkÃ¡ animace pÅ™i potvrzenÃ­
â€¢ calcDistanceCoords()               â†’ vÃ½poÄet vzdÃ¡lenosti mezi body
â€¢ (Leaflet map init)                 â†’ zobrazenÃ­ mapy zÃ¡kaznÃ­ka
â€¢ (VanillaCalendar init)             â†’ malÃ½ kalendÃ¡Å™ v detailu
â€¢ (Event listeners)                  â†’ tlaÄÃ­tka UloÅ¾it / NezvedÃ¡ / ZruÅ¡it / ZpÄ›t

ğŸ’¾ SEKCE D â€“ ULOÅ½ENÃ TERMÃNU
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ ulozitTerminNaGitHub()             â†’ uklÃ¡dÃ¡ zmÄ›ny pÅ™es Worker â†’ GitHub
â€¢ ulozTermin()                       â†’ zapisuje termÃ­n do localStorage
â€¢ showToast(msg, type)               â†’ krÃ¡tkÃ¡ zprÃ¡va v rohu
â€¢ setNextToast(msg, type)            â†’ uloÅ¾Ã­ toast pro pÅ™Ã­Å¡tÃ­ zobrazenÃ­
â€¢ (Loader overlay)                   â†’ vizuÃ¡lnÃ­ animace â³ bÄ›hem uklÃ¡dÃ¡nÃ­

ğŸ—“ï¸ SEKCE E â€“ PLÃN DNE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ initCalendar()                     â†’ zobrazenÃ­ Vanilla Calendaru
â€¢ addBlueDots()                      â†’ oznaÄenÃ­ dnÅ¯ s uloÅ¾enÃ½mi termÃ­ny
â€¢ showPlanForDay(date)               â†’ vykreslÃ­ mapu a legendu pro vybranÃ½ den
â€¢ recalcDeparture()                  â†’ pÅ™epoÄÃ­tÃ¡ Äas odjezdu
â€¢ highlightTodayRows()               â†’ zvÃ½raznÃ­ dneÅ¡nÃ­ termÃ­ny (blikÃ¡nÃ­)
â€¢ exportPlanToPDF()                  â†’ export plÃ¡nu dne do PDF

ğŸ§© SEKCE F â€“ POMOCNÃ‰ FUNKCE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ normalizePrahaAddress()            â†’ (zÃ¡kladnÃ­ verze) zkrÃ¡cenÃ­ adres
â€¢ ulozTermin(item)                   â†’ uklÃ¡dÃ¡nÃ­ lokÃ¡lnÃ­ch termÃ­nÅ¯
â€¢ computeDataHash()                  â†’ hash kontrola
â€¢ formatDateCzech()                  â†’ pÅ™evod ISO data do ÄeskÃ©ho formÃ¡tu
â€¢ formatTimeShort(h, m)              â†’ formÃ¡tovÃ¡nÃ­ Äasu HH:MM
â€¢ (flashGreen animace)               â†’ potvrzenÃ­ uloÅ¾enÃ½ch dat

ğŸŒ SEKCE G â€“ EXTERNÃ KNIHOVNY + INIT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Leaflet (L.*)                      â†’ mapy, trasy, znaÄky
â€¢ VanillaCalendar()                  â†’ kalendÃ¡Å™ (verze 2.8.1)
â€¢ jsPDF()                            â†’ export PDF
â€¢ window.addEventListener("DOMContentLoaded")  â†’ globÃ¡lnÃ­ start logÅ¯
â€¢ window.addEventListener("error")   â†’ zachytÃ­ JS chyby
â€¢ window.addEventListener("unhandledrejection") â†’ zachytÃ­ chyby Promise

============================================================
ğŸ§  DOPORUÄŒENÃ PRO LADÄšNÃ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Pokud se data nenaÄÃ­tajÃ­ â†’ zkontroluj Worker (sekce B)
â€¢ Pokud mapa nefunguje â†’ zkontroluj Leaflet import (sekce G)
â€¢ Pokud kalendÃ¡Å™ nefunguje â†’ Vanilla Calendar (sekce G)
â€¢ Pokud toast mizÃ­ â†’ kontrola sessionStorage (sekce D/F)
â€¢ Pokud detail zamrzÃ¡ â†’ zkontroluj funkce openDetail() a ulozitTerminNaGitHub()

============================================================
ğŸ“˜ VERZE: 1.0 â€“ Å™Ã­jen 2025
============================================================
-->
