<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seznam reklamac√≠ ‚Äì White Glove Service</title>

<style>
body {
  font-family: "Inter", system-ui, sans-serif;
  background: #f6f7fb;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
}
.wrapper {
  background: #fff;
  padding: 25px;
  margin: 40px 15px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 1200px;
  position: relative;
  box-sizing: border-box;
}
h1 {
  text-align: center;
  font-size: 2.2em;
  font-weight: 900;
  color: #111;
  margin: 0 0 8px;
}
h2 {
  text-align: center;
  font-size: 1.1em;
  font-weight: 500;
  color: #666;
  margin: 0 0 25px;
}
.actions {
  text-align: center;
  margin-bottom: 20px;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 15px;
}
.btn {
  display: inline-block;
  text-decoration: none;
  padding: 10px 24px;
  border-radius: 8px;
  font-weight: 600;
  font-size: 1em;
  border: none;
  cursor: pointer;
  transition: transform 0.15s ease-in-out, opacity 0.2s;
  color: white;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
  min-width: 160px;
  text-align: center;
}
.btn:hover { transform: scale(1.04); opacity: 0.9; }
.btn-back { background: linear-gradient(135deg, #6c757d, #a0a4a7); }
.btn-refresh { background: linear-gradient(135deg, #0046ff, #357aff); }
.btn-green { background: linear-gradient(135deg, #28a745, #5bd85b); }

#search {
  width: 100%;
  padding: 10px;
  margin-bottom: 15px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 1em;
  box-sizing: border-box;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
th, td {
  padding: 10px 8px;
  border-bottom: 1px solid #eee;
  text-align: left;
  font-size: 0.95em;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
th {
  background: #f8f8f8;
  font-weight: 700;
}
tr:hover {
  background: #f1f6ff;
  cursor: pointer;
}

/* üì± Mobiln√≠ zobrazen√≠ */
@media (max-width:700px){
  th, td { font-size: 0.8em; padding: 6px 4px; }
  .btn { min-width: 120px; padding: 8px 18px; font-size: 0.9em; }
  table, thead, tbody, th, td, tr {
    display: block;
  }
  thead { display: none; }
  tr {
    background: white;
    margin-bottom: 12px;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    padding: 8px 10px;
  }
  td {
    display: flex;
    justify-content: space-between;
    border: none;
    padding: 4px 0;
  }
  td::before {
    content: attr(data-label);
    font-weight: 600;
    color: #444;
  }
}
/* üîπ Stavov√© barvy */
.stav-novy { background: #fffbe6 !important; }
.stav-domluveno { background: #e7f0ff !important; }
.stav-zruseno { background: #ffeaea !important; }
.stav-nezveda { background: #fff4e1 !important; }
.stav-hotovo { background: #eaffea !important; }

/* üî• Blik√°n√≠ dne≈°n√≠ch term√≠n≈Ø */
@keyframes blinkRed {
  0% { background-color: #ffe0e0; }
  50% { background-color: #ffb3b3; }
  100% { background-color: #ffe0e0; }
}
.blink-today { animation: blinkRed 1.5s infinite; }

/* üí¨ Modal ‚Äì detail reklamace */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
.modal-overlay.active { display: flex; }

.modal {
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
  padding: 25px;
  width: 66%;
  max-width: 700px;
  max-height: 85vh;
  overflow-y: auto;
  text-align: center;
}
.modal h3 {
  margin-top: 0;
  font-size: 1.4em;
  font-weight: 800;
  color: #111;
}
.modal p {
  margin: 6px 0;
  color: #333;
}
.modal strong {
  color: #000;
}
.modal a {
  color: #0046ff;
  text-decoration: none;
}
.modal a:hover {
  text-decoration: underline;
}

/* üîò Tlaƒç√≠tka v detailu */
.btn-row {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 20px;
}
.btn-action {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  color: white;
  cursor: pointer;
  transition: transform 0.15s ease-in-out;
  min-width: 140px;
}
.btn-action:hover { transform: scale(1.05); }

.btn-blue { background: linear-gradient(135deg, #007bff, #399bff); }
.btn-green { background: linear-gradient(135deg, #28a745, #5bd85b); }
.btn-gray { background: linear-gradient(135deg, #6c757d, #9ca3af); }
.btn-orange { background: linear-gradient(135deg, #ff9800, #ffb74d); color: #222; }
.btn-red { background: linear-gradient(135deg, #dc3545, #f87171); }

/* üì± Modal responsivn√≠ */
@media (max-width:700px) {
  .modal { width: 94%; padding: 18px; }
  .btn-row { flex-direction: column; }
  .btn-action { width: 100%; }
}

/* üì∏ N√°hled fotek */
.foto-preview {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 10px;
}
.foto-preview img {
  width: 90px;
  height: 90px;
  object-fit: cover;
  border-radius: 8px;
  cursor: pointer;
  transition: transform 0.2s;
}
.foto-preview img:hover { transform: scale(1.1); }

/* üîç Fullscreen galerie */
.fullscreen-foto {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.9);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10000;
}
.fullscreen-foto img {
  max-width: 90%;
  max-height: 90%;
  border-radius: 10px;
}
.fullscreen-foto .close-full,
.fullscreen-foto .left,
.fullscreen-foto .right {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(255,255,255,0.25);
  border: none;
  color: white;
  font-size: 2em;
  padding: 10px 15px;
  border-radius: 50%;
  cursor: pointer;
}
.fullscreen-foto .close-full {
  top: 20px;
  right: 20px;
  transform: none;
}
.fullscreen-foto .left { left: 30px; }
.fullscreen-foto .right { right: 30px; }

</style>
</head>
<body>
<div class="wrapper">
  <h1>WHITE GLOVE SERVICE</h1>
  <h2>Seznam reklamac√≠ a servisn√≠ch po≈æadavk≈Ø</h2>

  <div class="actions">
    <a href="index.html" class="btn btn-back">Zpƒõt</a>
    <button id="reloadBtn" class="btn btn-refresh">Naƒç√≠st znovu</button>
    <a href="hotove.html" class="btn btn-green">Hotov√© reklamace</a>
  </div>

  <input type="text" id="search" placeholder="üîç Hledat podle z√°kazn√≠ka nebo adresy...">
  <div id="tableContainer" class="loading">Naƒç√≠t√°m data...</div>
</div>

<!-- üí¨ Modal detail -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal" id="detailModal">
    <h3>Detail reklamace</h3>
    <div id="modalContent"></div>

    <div class="btn-row">
      <button id="termBtn" class="btn-action btn-blue">üîµ Domluvit term√≠n</button>
      <button id="protoBtn" class="btn-action btn-green">üü¢ P≈ôej√≠t na protokol</button>
      <button id="closeBtn" class="btn-action btn-gray">‚ùå Zav≈ô√≠t</button>
    </div>

    <div id="termSection" style="display:none; margin-top:20px; border-top:1px solid #ddd; padding-top:15px;">
      <p style="font-weight:600;">Zadej term√≠n n√°v≈°tƒõvy:</p>

      <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
        <input type="date" id="datumTerminu" onchange="this.blur()">
        <input type="time" id="casTerminu">
      </div>

      <div class="btn-row" style="margin-top:15px;">
        <button id="noAnswerBtn" class="btn-action btn-orange">üü† Nezved√°</button>
        <button id="cancelBtn" class="btn-action btn-red">üî¥ Zru≈°il</button>
        <button id="saveTermBtn" class="btn-action btn-green">üü¢ Ulo≈æit term√≠n</button>
        <button id="backTermBtn" class="btn-action btn-gray">‚Ü©Ô∏è Zpƒõt</button>
      </div>
    </div>
  </div>
</div>
<script>
const API_URL = "https://wgs-token.72nvwf4pb2.workers.dev/orders";
const tableContainer = document.getElementById("tableContainer");
const searchInput = document.getElementById("search");
const reloadBtn = document.getElementById("reloadBtn");

let dataAll = [];
let stavy = JSON.parse(localStorage.getItem("stavyReklamaci") || "{}");

/* ============ Naƒçten√≠ dat z Workeru ============ */
async function loadData() {
  tableContainer.innerHTML = "<div class='loading'>Naƒç√≠t√°m data...</div>";
  try {
    const res = await fetch(API_URL);
    if (!res.ok) throw new Error("Chyba p≈ôi naƒç√≠t√°n√≠ dat");
    const data = await res.json();
    if (!Array.isArray(data)) throw new Error("Neplatn√Ω form√°t dat");

    dataAll = data.reverse();
    renderTable(dataAll);
  } catch (err) {
    console.error(err);
    tableContainer.innerHTML = `<div class='loading' style='color:red;'>Chyba naƒç√≠t√°n√≠: ${err.message}</div>`;
  }
}

/* ============ Zobrazen√≠ tabulky ============ */
function renderTable(arr) {
  if (!arr.length) {
    tableContainer.innerHTML = "<div class='loading'>≈Ω√°dn√© z√°znamy k zobrazen√≠</div>";
    return;
  }

  let html = `
  <table>
    <thead>
      <tr>
        <th>Z√°kazn√≠k</th>
        <th>Adresa</th>
        <th>Telefon</th>
        <th>Stav</th>
      </tr>
    </thead>
    <tbody>
  `;

  arr.forEach((r, i) => {
    const id = r.cislo || `radek-${i}`;
    const stav = stavy[id] || "novy";
    const trClass = `stav-${stav}`;
    const wazeLink = r.adresa ? `https://waze.com/ul?q=${encodeURIComponent(r.adresa)}` : "#";
    const tel = (r.telefon || "").replace(/\s+/g, "").replace(/^(\+420|00420)/, "");

    html += `
      <tr class="${trClass}" data-index="${i}" data-id="${id}">
        <td>${r.zakaznik || r["Jm√©no a p≈ô√≠jmen√≠ z√°kazn√≠ka"] || ""}</td>
        <td><a href="${wazeLink}" target="_blank">${r.adresa || ""}</a></td>
        <td><a href="tel:+420${tel}">${tel}</a></td>
        <td style="font-weight:600;text-transform:capitalize;">${stav}</td>
      </tr>
    `;
  });

  html += "</tbody></table>";
  tableContainer.innerHTML = html;

  document.querySelectorAll("tbody tr").forEach(row => {
    row.addEventListener("click", () => {
      const index = row.getAttribute("data-index");
      openModal(index);
    });
  });

  highlightTodayRows();
}

/* ============ MODAL DETAIL ============ */
const modalOverlay = document.getElementById("modalOverlay");
const modalContent = document.getElementById("modalContent");
const termSection = document.getElementById("termSection");
let selectedItemIndex = null;

function openModal(index) {
  selectedItemIndex = index;
  const item = dataAll[index];
  if (!item) return;

  const tel = (item.telefon || "").replace(/\s+/g, "").replace(/^(\+420|00420)/, "");
  const wazeLink = item.adresa ? `https://waze.com/ul?q=${encodeURIComponent(item.adresa)}` : "#";

  modalContent.innerHTML = `
    <p><strong>Z√°kazn√≠k:</strong> ${item.zakaznik || item["Jm√©no a p≈ô√≠jmen√≠ z√°kazn√≠ka"] || ""}</p>
    <p><strong>Adresa:</strong> <a href="${wazeLink}" target="_blank">${item.adresa || ""}</a></p>
    <p><strong>Telefon:</strong> <a href="tel:+420${tel}">${tel}</a></p>
    <p><strong>E-mail:</strong> ${item.email || ""}</p>
    <p><strong>Popis:</strong> ${item.popis || item["Popis probl√©mu"] || "neuvedeno"}</p>
    <p><strong>Zadavatel:</strong> ${item.contract || (item.jinaZadavatel?.jmeno || "")}</p>
    <div class="foto-preview">
      ${(item.foto || [])
        .map((f, idx) => `<img src="${f}" data-idx="${idx}" onclick="openGallery(${index}, ${idx})">`)
        .join("") || "‚Äì"}
    </div>
  `;

  termSection.style.display = "none";
  modalOverlay.classList.add("active");
}

/* ‚úñ Zav≈ôen√≠ modalu */
document.getElementById("closeBtn").onclick = () => {
  modalOverlay.classList.remove("active");
};

/* üîµ Domluvit term√≠n */
document.getElementById("termBtn").onclick = () => {
  termSection.style.display = termSection.style.display === "none" ? "block" : "none";
};

/* üî¥ Z√°kazn√≠k zru≈°il */
document.getElementById("cancelBtn").onclick = () => {
  const id = dataAll[selectedItemIndex].cislo || `radek-${selectedItemIndex}`;
  stavy[id] = "zruseno";
  localStorage.setItem("stavyReklamaci", JSON.stringify(stavy));
  modalOverlay.classList.remove("active");
  renderTable(dataAll);
};

/* üü† Nezved√° */
document.getElementById("noAnswerBtn").onclick = () => {
  const id = dataAll[selectedItemIndex].cislo || `radek-${selectedItemIndex}`;
  stavy[id] = "nezveda";
  localStorage.setItem("stavyReklamaci", JSON.stringify(stavy));
  modalOverlay.classList.remove("active");
  renderTable(dataAll);
};

/* üü¢ Ulo≈æit term√≠n */
document.getElementById("saveTermBtn").onclick = () => {
  const datum = document.getElementById("datumTerminu").value;
  const cas = document.getElementById("casTerminu").value;
  if (!datum || !cas) {
    alert("Vypl≈à datum i ƒças term√≠nu");
    return;
  }

  const id = dataAll[selectedItemIndex].cislo || `radek-${selectedItemIndex}`;
  stavy[id] = "domluveno";
  dataAll[selectedItemIndex].datum = datum;
  dataAll[selectedItemIndex].cas = cas;
  localStorage.setItem("stavyReklamaci", JSON.stringify(stavy));

  modalOverlay.classList.remove("active");
  renderTable(dataAll);
};

/* ‚Ü©Ô∏è Zpƒõt */
document.getElementById("backTermBtn").onclick = () => {
  termSection.style.display = "none";
};

/* üü¢ P≈ôej√≠t na protokol */
document.getElementById("protoBtn").onclick = () => {
  const item = dataAll[selectedItemIndex];
  localStorage.setItem("selectedRecord", JSON.stringify(item));
  window.location.href = "protokol.html";
};

/* ============ Fullscreen galerie ============ */
function openGallery(index, photoIndex) {
  const item = dataAll[index];
  const photos = item.foto || [];
  if (!photos.length) return;

  let current = photoIndex;

  const overlay = document.createElement("div");
  overlay.className = "fullscreen-foto";
  overlay.innerHTML = `
    <button class="close-full">√ó</button>
    <button class="left">‚ùÆ</button>
    <img src="${photos[current]}">
    <button class="right">‚ùØ</button>
  `;
  document.body.appendChild(overlay);

  const img = overlay.querySelector("img");
  const close = overlay.querySelector(".close-full");
  const left = overlay.querySelector(".left");
  const right = overlay.querySelector(".right");

  const show = (i) => {
    if (i < 0) i = photos.length - 1;
    if (i >= photos.length) i = 0;
    current = i;
    img.src = photos[current];
  };

  close.onclick = () => overlay.remove();
  left.onclick = () => show(current - 1);
  right.onclick = () => show(current + 1);
}
<script>
/* üïì Rolovac√≠ v√Ωbƒõr ƒçasu (jen na desktopu) */
document.addEventListener("DOMContentLoaded", () => {
  const timeInput = document.getElementById("casTerminu");
  if (!timeInput) return;

  // Pouze desktop
  if (!/Mobi|Android/i.test(navigator.userAgent)) {
    const container = document.createElement("div");
    container.className = "custom-time-picker";

    const hours = document.createElement("select");
    for (let h = 0; h < 24; h++) {
      const opt = document.createElement("option");
      opt.value = String(h).padStart(2, "0");
      opt.textContent = String(h).padStart(2, "0");
      hours.appendChild(opt);
    }

    const minutes = document.createElement("select");
    for (let m = 0; m < 60; m += 5) {
      const opt = document.createElement("option");
      opt.value = String(m).padStart(2, "0");
      opt.textContent = String(m).padStart(2, "0");
      minutes.appendChild(opt);
    }

    const sep = document.createElement("span");
    sep.textContent = ":";

    container.appendChild(hours);
    container.appendChild(sep);
    container.appendChild(minutes);

    timeInput.style.display = "none";
    timeInput.parentNode.insertBefore(container, timeInput.nextSibling);

    const syncTime = () => {
      timeInput.value = `${hours.value}:${minutes.value}`;
    };
    hours.addEventListener("change", syncTime);
    minutes.addEventListener("change", syncTime);
    syncTime();
  }
});

/* üìÖ Kalend√°≈ô ‚Äì vƒõt≈°√≠, schov√° se po kliknut√≠ */
const dateInput = document.getElementById("datumTerminu");
if (dateInput) {
  dateInput.addEventListener("focus", () => {
    dateInput.style.transform = "scale(1.15)";
    dateInput.style.zIndex = "10";
  });
  dateInput.addEventListener("change", () => {
    dateInput.style.transform = "scale(1)";
    dateInput.blur();
  });
}

/* üî• Zv√Ωraznƒõn√≠ dne≈°n√≠ch term√≠n≈Ø */
function highlightTodayRows() {
  const today = new Date().toISOString().split("T")[0];
  const rows = document.querySelectorAll("tbody tr[data-index]");

  rows.forEach(row => {
    const index = row.getAttribute("data-index");
    const item = dataAll[index];
    if (!item || !item.datum) return;

    if (item.datum === today && stavy[item.cislo || `radek-${index}`] === "domluveno") {
      row.classList.add("blink-today");
    } else {
      row.classList.remove("blink-today");
    }
  });
}
</script>

<style>
/* üé° Blik√°n√≠ dne≈°n√≠ch zak√°zek */
@keyframes blinkRed {
  0% { background-color: #ffe0e0; }
  50% { background-color: #ffb3b3; }
  100% { background-color: #ffe0e0; }
}
.blink-today {
  animation: blinkRed 1.5s infinite;
}

/* üïì Styl pro rolovac√≠ ƒças */
.custom-time-picker {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  font-size: 1.4em;
  margin-top: 10px;
}
.custom-time-picker select {
  appearance: none;
  -webkit-appearance: none;
  font-size: 1.2em;
  font-weight: 600;
  border-radius: 10px;
  padding: 8px 12px;
  background: #fff;
  border: 1px solid #ccc;
  text-align: center;
  outline: none;
  transition: all 0.2s;
}
.custom-time-picker select:focus {
  border-color: #0046ff;
  box-shadow: 0 0 0 2px rgba(0,70,255,0.25);
}
.custom-time-picker span {
  font-weight: 700;
  color: #555;
}

/* üñºÔ∏è Galerie fotek v detailu */
.foto-preview {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 10px;
}
.foto-preview img {
  width: 90px;
  height: 90px;
  object-fit: cover;
  border-radius: 6px;
  cursor: pointer;
  transition: transform 0.2s;
}
.foto-preview img:hover {
  transform: scale(1.1);
}

/* üîç Fullscreen galerie */
.fullscreen-foto {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.9);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
.fullscreen-foto img {
  max-width: 90%;
  max-height: 85%;
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(255,255,255,0.3);
}
.fullscreen-foto button {
  position: absolute;
  background: rgba(255,255,255,0.2);
  color: white;
  border: none;
  font-size: 2em;
  padding: 8px 14px;
  cursor: pointer;
  border-radius: 8px;
  transition: background 0.2s;
}
.fullscreen-foto button:hover { background: rgba(255,255,255,0.4); }
.fullscreen-foto .close-full { top: 20px; right: 20px; }
.fullscreen-foto .left { left: 40px; }
.fullscreen-foto .right { right: 40px; }

/* üíª Responsivita tlaƒç√≠tek v modalu */
.modal .btn-row {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
}
@media (max-width: 700px) {
  .modal .btn-row { flex-direction: column; }
  .modal .btn-action { width: 100%; }
}
</style>
