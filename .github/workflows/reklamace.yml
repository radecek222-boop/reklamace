name: Reklamace ‚Äì p≈ôesun a √∫dr≈æba fotek

on:
  push:
    paths:
      - "data/orders.json"
      - "data/hotove.json"
      - "uploads/**"

permissions:
  contents: write

jobs:
  manage-reklamace:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 18

    - name: Install jq (JSON processor)
      run: sudo apt-get install -y jq

    - name: Process reklamace files
      run: |
        echo "Kontrola p≈ôesunut√Ωch reklamac√≠..."
        if [ -f data/orders.json ] && [ -f data/hotove.json ]; then
          # Najdi v≈°echny ƒç√≠sla reklamac√≠ v hotove.json
          HOTOVE_IDS=$(jq -r '.[].cislo' data/hotove.json)
          echo "Hotov√© reklamace: $HOTOVE_IDS"
          
          for ID in $HOTOVE_IDS; do
            if [ -d "uploads/$ID" ]; then
              echo "üóëÔ∏è Ma≈æu fotky k reklamaci $ID"
              rm -rf "uploads/$ID"
            fi
          done
        else
          echo "Soubor orders.json nebo hotove.json chyb√≠."
        fi

    - name: Commit and push changes
      run: |
        git config user.name "WGS Bot"
        git config user.email "bot@whiteglove.cz"
        git add -A
        if git diff --staged --quiet; then
          echo "≈Ω√°dn√© zmƒõny k ulo≈æen√≠."
        else
          git commit -m "Automatick√° √∫dr≈æba: odstranƒõny fotky z hotov√Ωch reklamac√≠"
          git push
        fi
