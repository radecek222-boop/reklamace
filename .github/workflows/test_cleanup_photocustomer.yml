name: Test cleanup photocustomer.json

on:
  workflow_dispatch:  # ruƒçn√≠ spu≈°tƒõn√≠

permissions:
  contents: read

jobs:
  test-cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Simulate cleanup (no commit)
        run: |
          file="photocustomer.json"
          echo "üß™ TEST ƒåI≈†TƒöN√ç SOUBORU: $file"
          now=$(date +%s)

          if [ -f "$file" ]; then
            echo "üìÑ Poƒçet p≈Øvodn√≠ch z√°znam≈Ø: $(jq length $file)"
            echo ""
            echo "üßπ N√°sleduj√≠c√≠ z√°znamy jsou star≈°√≠ ne≈æ 24h a byly by odstranƒõny:"
            jq --argjson now "$now" \
              '[.[] | select(.datum != null and (($now - (try ((.datum | fromdateiso8601) // 0))) >= 86400)) | {cislo, zakaznik, datum}]' \
              "$file"

            echo ""
            echo "‚úÖ Z√°znamy, kter√© by z≈Østaly:"
            jq --argjson now "$now" \
              '[.[] | select(.datum != null and (($now - (try ((.datum | fromdateiso8601) // 0))) < 86400)) | {cislo, zakaznik, datum}]' \
              "$file"
          else
            echo "‚ùå Soubor $file nebyl nalezen."
          fi
