<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Claim Protocol - White Glove Service</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: 20px auto; background: #f9f9f9; padding: 20px; border-radius: 10px; }
    h2 { text-align: center; margin-bottom: 20px; }
    .logo { text-align: center; margin-bottom: 20px; }
    .logo img { max-width: 220px; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, textarea { width: 100%; padding: 6px; margin-top: 4px; border: 1px solid #ccc; border-radius: 4px; }
    textarea { height: 70px; }
    #signature { border: 1px solid #ccc; width: 100%; height: 150px; background: white; }
    .btn { margin-top: 15px; padding: 12px; cursor: pointer; border: none; border-radius: 6px; background: #333; color: white; font-weight: bold; }
    .btn:hover { background: #555; }
    .section { background: #fff; padding: 15px; margin-bottom: 15px; border-radius: 6px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    .checkbox-group { margin: 5px 0; }
  </style>
</head>
<body>
  <div class="logo">
    <img src="https://dummyimage.com/200x50/000/fff&text=White+Glove+Service" alt="Logo firmy">
  </div>
  
  <h2>CLAIM PROTOCOL</h2>

  <div class="section">
    <label>ƒå√≠slo objedn√°vky / Order number</label>
    <input id="cislo_objednavky">
    <button type="button" class="btn" onclick="fetchData()">Naƒç√≠st z Google Sheets</button>

    <label>ƒå√≠slo reklamace / Claim number</label>
    <input id="cislo_reklamace">
  </div>

  <div class="section">
    <label>Z√°kazn√≠k / Customer</label>
    <input id="zakaznik">

    <label>Adresa z√°kazn√≠ka / Address customer</label>
    <input id="adresa">

    <label>Kontakt / Contact</label>
    <input id="kontakt">

    <label>Stav ‚Äì term√≠n n√°v≈°tƒõvy / Status ‚Äì visit date</label>
    <input id="stav">
  </div>

  <div class="section">
    <label>Znaƒçka / Label</label>
    <input id="znacka">

    <label>Model</label>
    <input id="model">

    <label>Popis reklamace / Complaint description</label>
    <textarea id="zakaznik_reklamace"></textarea>
  </div>

  <div class="section">
    <label>Datum doruƒçen√≠ / Delivery date</label>
    <input id="datum_doruceni" type="date">

    <label>Datum pod√°n√≠ reklamace / Complaint date</label>
    <input id="datum_reklamace" type="date">

    <label>MILAN</label>
    <input id="milan">

    <label>RADEK</label>
    <input id="radek">
  </div>

  <div class="section">
    <label>Cena / Price</label>
    <input id="celkem">
  </div>

  <div class="section">
    <label>Podpis z√°kazn√≠ka / Customer signature:</label>
    <canvas id="signature"></canvas>
    <button class="btn" onclick="clearSig()">Smazat podpis</button>
  </div>

  <button class="btn" onclick="generatePDF()">Ulo≈æit PDF</button>

  <script>
    const { jsPDF } = window.jspdf;
    const canvas = document.getElementById('signature');
    const signaturePad = new SignaturePad(canvas);

    function resizeCanvas() {
      const ratio = Math.max(window.devicePixelRatio || 1, 1);
      canvas.width = canvas.offsetWidth * ratio;
      canvas.height = canvas.offsetHeight * ratio;
      canvas.getContext("2d").scale(ratio, ratio);
      signaturePad.clear();
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    function clearSig() { signaturePad.clear(); }

    // üëá sem vlo≈æ svou Apps Script URL
    const API_URL = "https://script.google.com/macros/s/AKfycbwCL5s2dLRygGE3OzOJm50IaSSLGOeCr0fwi70UKBI-73D-WvA0brcrNFXSCaObDVM-SA/exec";

    async function fetchData() {
      const order = document.getElementById("cislo_objednavky").value;
      if (!order) { alert("Zadej ƒç√≠slo objedn√°vky!"); return; }

      const url = API_URL + "?order=" + encodeURIComponent(order) + "&sheet=SEZNAM%20REKLAMAC√ç";

      try {
        const response = await fetch(url);
        const data = await response.json();

        if (data.length > 0) {
          const row = data[0];

          document.getElementById("zakaznik").value = row["Customer"] || "";
          document.getElementById("adresa").value   = row["Address"] || "";
          document.getElementById("kontakt").value  = row["KONTAKT"] || "";
          document.getElementById("stav").value     = row["STAV - term√≠n n√°v≈°tƒõvy"] || "";
          document.getElementById("znacka").value   = row["Label"] || "";
          document.getElementById("model").value    = row["Model"] || "";
          document.getElementById("zakaznik_reklamace").value = row["POPIS REKLAMACE - OPRAVY"] || "";

          if (row["Delivery date"]) {
            document.getElementById("datum_doruceni").value = new Date(row["Delivery date"]).toISOString().split("T")[0];
          }
          if (row["Complaint date"]) {
            document.getElementById("datum_reklamace").value = new Date(row["Complaint date"]).toISOString().split("T")[0];
          }

          document.getElementById("milan").value = row["MILAN"] || "";
          document.getElementById("radek").value = row["RADEK"] || "";
          document.getElementById("celkem").value = row["CENA"] || "";

        } else {
          alert("Objedn√°vka nenalezena v listu SEZNAM REKLAMAC√ç");
        }
      } catch (err) {
        alert("Chyba p≈ôi naƒç√≠t√°n√≠: " + err);
      }
    }

    function generatePDF() {
      const doc = new jsPDF({ unit: "mm", format: "a4" });

      doc.setFontSize(16);
      doc.text("WHITE GLOVE SERVICE s.r.o.", 105, 15, { align: "center" });
      doc.setFontSize(10);
      doc.text("Do Dubƒçe 364, Bƒõchovice 190 11 | +420 725 965 826 | reklamace-wgs@email.cz | IƒåO: 09769684", 105, 20, { align: "center" });
      doc.setFontSize(14);
      doc.text("CLAIM PROTOCOL", 105, 30, { align: "center" });

      // tabulky
      doc.autoTable({ startY: 40, head: [['Order number','Label','Model','Price']], body: [[
        document.getElementById("cislo_objednavky").value,
        document.getElementById("znacka").value,
        document.getElementById("model").value,
        document.getElementById("celkem").value
      ]]});

      doc.autoTable({ startY: doc.lastAutoTable.finalY+5, head: [['Customer','Address','Contact','Status']], body: [[
        document.getElementById("zakaznik").value,
        document.getElementById("adresa").value,
        document.getElementById("kontakt").value,
        document.getElementById("stav").value
      ]]});

      doc.autoTable({ startY: doc.lastAutoTable.finalY+5, head: [['Complaint description']], body: [[
        document.getElementById("zakaznik_reklamace").value
      ]]});

      doc.autoTable({ startY: doc.lastAutoTable.finalY+5, head: [['Delivery date','Complaint date','MILAN','RADEK']], body: [[
        document.getElementById("datum_doruceni").value,
        document.getElementById("datum_reklamace").value,
        document.getElementById("milan").value,
        document.getElementById("radek").value
      ]]});

      let y = doc.lastAutoTable.finalY + 15;
      if (!signaturePad.isEmpty()) {
        const imgData = signaturePad.toDataURL();
        doc.addImage(imgData, "PNG", 20, y, 80, 30);
        doc.text("Customer signature", 20, y+40);
      } else {
        doc.text("Customer signature: [not provided]", 20, y);
      }

      doc.save("claim_protocol.pdf");
    }
  </script>
</body>
</html>
