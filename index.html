<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>White Glove Service</title>
  <style>
    :root { font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif; color:#111; }
    body { margin:0; padding:0; background:#f6f7fb; }
    .screen { display:none; min-height:100vh; padding:20px; }
    .active { display:block; }

    /* Úvodní obrazovka */
    .home { display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; min-height:100vh; }
    .home h1 { font-size:3.5em; font-weight:900; margin:0 0 15px; }
    .home p { font-size:1.3em; margin:0 0 40px; color:#555; }
    .btn {
      background:#e0e0e0; color:#111; padding:15px 30px; margin:10px;
      border:none; border-radius:10px; cursor:pointer; font-size:1.1em;
      min-width:220px; box-shadow:0 2px 5px rgba(0,0,0,0.15); transition:0.2s;
    }
    .btn:hover { background:#d5d5d5; }

    /* Karta protokolu */
    .card {
      background:#fff; padding:20px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,.08);
      max-width:800px; margin:auto;
    }
    .form-group { margin-bottom:12px; }
    label { font-weight:600; display:block; margin:10px 0 5px; }
    input, textarea {
      width:100%; padding:8px; border:1px solid #ccc; border-radius:6px; font-size:14px;
    }
    textarea { resize:vertical; }

    /* Podpis */
    .signature-container {
      border:2px solid #555; border-radius:8px; width:100%; height:180px; touch-action:none; margin-top:5px;
    }
    canvas { width:100%; height:100%; }

    /* Úpravy pro mobilní telefony */
    @media (max-width: 600px) {
      .home h1 {
        font-size: 2.2em;
        line-height: 1.2;
      }
      .home p {
        font-size: 1em;
        margin: 0 0 25px;
      }
      .btn {
        font-size: 1em;
        padding: 12px 20px;
        min-width: 160px;
        margin: 8px 0;
      }
    }
  </style>
</head>
<body>

<!-- Úvodní obrazovka -->
<div id="home" class="screen home active">
  <h1>WHITE GLOVE SERVIS</h1>
  <p>specializovaný autorizovaný servis Natuzzi</p>
  <button class="btn" onclick="openList()">Seznam reklamací</button>
  <button class="btn" onclick="showScreen('protocol')">Protokol oprav</button>
</div>

<!-- Protokol oprav -->
<div id="protocol" class="screen">
  <h2>Protokol oprav</h2>
  <div class="card">
    <div class="form-group">
      <label>Zákazník</label>
      <input type="text" id="formCustomer" name="customer">
    </div>
    <div class="form-group">
      <label>Adresa</label>
      <input type="text" id="formAddress" name="address">
    </div>
    <div class="form-group">
      <label>Telefon</label>
      <input type="text" id="formPhone" name="phone">
    </div>
    <div class="form-group">
      <label>Číslo objednávky</label>
      <input type="text" id="formOrder" name="order">
    </div>
    <div class="form-group">
      <label>Datum reklamace</label>
      <input type="text" id="formComplaintDate" name="complaint_date">
    </div>
    <div class="form-group">
      <label>Datum dodání</label>
      <input type="text" id="formDeliveryDate" name="delivery_date">
    </div>
    <div class="form-group">
      <label>Popis závady / opravy</label>
      <textarea id="formDescription" name="description" rows="4"></textarea>
    </div>

    <div class="form-group">
      <label>Podpis zákazníka</label>
      <div class="signature-container">
        <canvas id="signature"></canvas>
      </div>
      <button class="btn" onclick="clearSignature()">Smazat podpis</button>
    </div>

    <button class="btn" onclick="exportPDF()">Exportovat do PDF</button>
    <button class="btn" onclick="showScreen('home')">Zpět</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
function openList(){
  window.open("seznam.html", "_blank", "width=1000,height=700");
}

// --- podpis přímo v protokolu ---
const canvas = document.getElementById("signature");
const ctx = canvas.getContext("2d");
let drawing = false;

function resizeCanvas() {
  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

function getPos(e) {
  if (e.touches) {
    return {
      x: e.touches[0].clientX - canvas.getBoundingClientRect().left,
      y: e.touches[0].clientY - canvas.getBoundingClientRect().top
    };
  }
  return {
    x: e.clientX - canvas.getBoundingClientRect().left,
    y: e.clientY - canvas.getBoundingClientRect().top
  };
}
function startDraw(e) {
  e.preventDefault();
  drawing = true;
  const pos = getPos(e);
  ctx.beginPath();
  ctx.moveTo(pos.x, pos.y);
}
function endDraw(e) {
  e.preventDefault();
  drawing = false;
}
function draw(e) {
  if (!drawing) return;
  e.preventDefault();
  const pos = getPos(e);
  ctx.lineWidth = 2;
  ctx.lineCap = "round";
  ctx.strokeStyle = "#000";
  ctx.lineTo(pos.x, pos.y);
  ctx.stroke();
}
canvas.addEventListener("mousedown", startDraw);
canvas.addEventListener("mouseup", endDraw);
canvas.addEventListener("mousemove", draw);
canvas.addEventListener("touchstart", startDraw, { passive: false });
canvas.addEventListener("touchend", endDraw, { passive: false });
canvas.addEventListener("touchmove", draw, { passive: false });

function clearSignature() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

async function exportPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const customer = document.getElementById("formCustomer").value;
  const address = document.getElementById("formAddress").value;
  const phone = document.getElementById("formPhone").value;
  const order = document.getElementById("formOrder").value;
  const complaintDate = document.getElementById("formComplaintDate").value;
  const deliveryDate = document.getElementById("formDeliveryDate").value;
  const description = document.getElementById("formDescription").value;

  // HLAVIČKA
  doc.setFontSize(18);
  doc.setFont("helvetica","bold");
  doc.text("White Glove Service", 105, 15, { align:"center" });
  doc.setLineWidth(0.5);
  doc.line(10, 20, 200, 20);

  // OBSAH
  doc.setFontSize(14);
  doc.setFont("helvetica","normal");
  doc.text(`Zákazník: ${customer}`, 10, 35);
  doc.text(`Adresa: ${address}`, 10, 45);
  doc.text(`Telefon: ${phone}`, 10, 55);
  doc.text(`Objednávka: ${order}`, 10, 65);
  doc.text(`Datum reklamace: ${complaintDate}`, 10, 75);
  doc.text(`Datum dodání: ${deliveryDate}`, 10, 85);

  doc.text(`Popis opravy:`, 10, 100);
  doc.setFontSize(12);
  doc.text(description, 10, 110, { maxWidth:180 });

  // PODPIS
  const signatureImage = canvas.toDataURL("image/png");
  doc.setFontSize(14);
  doc.text("Podpis zákazníka:", 10, 140);
  doc.addImage(signatureImage, "PNG", 10, 145, 100, 40);

  // PATIČKA
  doc.setFontSize(10);
  doc.text("Děkujeme za využití služeb White Glove Service", 105, 290, { align:"center" });

  doc.save("protokol.pdf");
}

// --- příjem dat ze seznam.html ---
window.addEventListener("message", function(event){
  if (event.data && event.data.type === "openProtocol"){
    const row = event.data.row;
    document.getElementById("formCustomer").value     = row[0] || "";
    document.getElementById("formAddress").value      = row[1] || "";
    document.getElementById("formPhone").value        = row[2] || "";
    document.getElementById("formOrder").value        = row[4] || "";
    document.getElementById("formDescription").value  = row[10]|| "";
    document.getElementById("formComplaintDate").value= row[11]|| "";
    document.getElementById("formDeliveryDate").value = row[12]|| "";
    showScreen("protocol");
  }
});
</script>

</body>
</html>
