<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>White Glove Service</title>
  <style>
    :root {
      font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif;
      color: #111;
    }
    body { margin:0; padding:0; background:#f6f7fb; }
    .screen { display:none; min-height:100vh; padding:20px; }
    .active { display:block; }

    /* Úvodní obrazovka */
    .home {
      display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center;
    }
    .home h1 {
      font-size:3.5em;
      font-weight:900;
      margin:0 0 15px;
    }
    .home p {
      font-size:1.3em;
      margin:0 0 40px;
      color:#555;
    }
    .btn {
      background:#e0e0e0;
      color:#111;
      padding:15px 30px;
      margin:10px;
      border:none;
      border-radius:10px;
      cursor:pointer;
      font-size:1.1em;
      min-width:220px;
      box-shadow:0 2px 5px rgba(0,0,0,0.15);
      transition:0.2s;
    }
    .btn:hover { background:#d5d5d5; }

    /* Protokol */
    .form-group { margin-bottom:12px; }
    label { display:block; font-weight:bold; margin-bottom:4px; }
    input, textarea {
      width:100%; padding:8px; border-radius:6px; border:1px solid #ccc; font-size:0.95em;
    }
    #signature { border:1px solid #ccc; background:#fff; width:100%; height:200px; }
  </style>
</head>
<body>

<!-- Úvodní obrazovka -->
<div id="home" class="screen home active">
  <h1>WHITE GLOVE SERVIS</h1>
  <p>specializovaný autorizovaný servis Natuzzi</p>
  <button class="btn" onclick="openList()">Seznam reklamací</button>
  <button class="btn" onclick="showScreen('protocol')">Protokol oprav</button>
</div>

<!-- Protokol oprav -->
<div id="protocol" class="screen">
  <h2>Protokol oprav</h2>
  <form id="repairForm">
    <div class="form-group">
      <label>Zákazník</label>
      <input type="text" id="formCustomer" name="customer">
    </div>
    <div class="form-group">
      <label>Adresa</label>
      <input type="text" id="formAddress" name="address">
    </div>
    <div class="form-group">
      <label>Telefon</label>
      <input type="text" id="formPhone" name="phone">
    </div>
    <div class="form-group">
      <label>Číslo objednávky</label>
      <input type="text" id="formOrder" name="order">
    </div>
    <div class="form-group">
      <label>Popis závady / opravy</label>
      <textarea name="description"></textarea>
    </div>
    <div class="form-group">
      <label>Podpis zákazníka</label>
      <canvas id="signature"></canvas><br>
      <button type="button" class="btn" onclick="clearSignature()">Vymazat podpis</button>
    </div>
  </form>
  <button class="btn" onclick="exportPDF()">Exportovat do PDF</button>
  <button class="btn" onclick="showScreen('home')">Zpět</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// otevře seznam v novém okně
function openList(){
  window.open("seznam.html", "_blank", "width=1000,height=700");
}

// podpis (canvas)
let canvas = document.getElementById("signature");
let ctx = canvas.getContext("2d");
let drawing = false;
canvas.addEventListener("mousedown", e => {drawing=true; ctx.beginPath(); ctx.moveTo(e.offsetX,e.offsetY);});
canvas.addEventListener("mousemove", e => {if(drawing){ctx.lineTo(e.offsetX,e.offsetY); ctx.stroke();}});
canvas.addEventListener("mouseup", ()=> drawing=false);
canvas.addEventListener("mouseleave", ()=> drawing=false);
function clearSignature(){ ctx.clearRect(0,0,canvas.width,canvas.height); }

// Export do PDF
async function exportPDF(){
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  const element = document.getElementById("repairForm");
  const canvasEl = await html2canvas(element);
  const imgData = canvasEl.toDataURL("image/png");
  pdf.addImage(imgData, 'PNG', 10, 10, 190, 0);
  pdf.save("protokol.pdf");
}

// nasloucháme zprávám z seznam.html
window.addEventListener("message", function(event){
  if (event.data && event.data.type === "openProtocol"){
    const row = event.data.row;
    const headers = event.data.headers;

    const idxCustomer = headers.findIndex(h => h.toLowerCase().includes("customer") || h.toLowerCase().includes("zákazník"));
    const idxAddress  = headers.findIndex(h => h.toLowerCase().includes("address")  || h.toLowerCase().includes("adresa"));
    const idxPhone    = headers.findIndex(h => h.toLowerCase().includes("kontakt"));
    const idxOrder    = headers.findIndex(h => h.toLowerCase().includes("order"));

    if (idxCustomer >= 0) document.getElementById("formCustomer").value = row[idxCustomer];
    if (idxAddress  >= 0) document.getElementById("formAddress").value  = row[idxAddress];
    if (idxPhone    >= 0) document.getElementById("formPhone").value    = row[idxPhone];
    if (idxOrder    >= 0) document.getElementById("formOrder").value    = row[idxOrder];

    showScreen("protocol");
  }
});
</script>

</body>
</html>
