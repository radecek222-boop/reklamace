<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>White Glove Service – Servisní protokol</title>
  <style>
    :root { --bg:#f6f7fb; --card:#fff; --ink:#0e1116; --muted:#6b7280; --line:#e5e7eb; --brand:#0b69ff; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;overflow-x:hidden;}
    h1{font-size:18px;margin:16px 16px 0}
    .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:16px;padding:16px}
    .card{background:var(--card);border-radius:12px;box-shadow:0 8px 28px rgba(0,0,0,.06);padding:14px}
    label{display:block;font-size:12px;color:#374151;margin-top:6px}
    input,select,textarea{width:100%;margin-top:6px;border:1px solid var(--line);border-radius:8px;padding:9px 10px;font-size:14px;background:#fff}
    textarea{min-height:80px;resize:vertical}
    .controls{display:flex;gap:8px;align-items:center;margin-top:10px;flex-wrap:wrap}
    button{appearance:none;border:0;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
    .primary{background:var(--brand);color:#fff}
    .ghost{background:#eef2ff;color:#1d4ed8;border:1px solid #dbeafe}
    table{width:100%;border-collapse:collapse;table-layout:auto;word-wrap:break-word}
    th,td{padding:8px;border-bottom:1px solid var(--line);text-align:left;vertical-align:top;max-width:120px;overflow-wrap:break-word}
    th{font-size:12px;color:var(--muted);font-weight:600;position:sticky;top:0;background:#fafafa}
    .protocol{padding:16px;border:1px solid var(--line);border-radius:10px;background:#fff}
    #sigCanvas{border:1px dashed #cbd5e1;border-radius:8px;background:#fff;max-width:100%;height:auto}
    .scroll{max-height:360px;overflow:auto;border:1px solid var(--line);border-radius:10px}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}.row{flex-direction:column}th, td {max-width:none}}
  </style>
</head>
<body>
  <h1>White Glove Service – Servisní protokol</h1>
  <div class="grid">
    <!-- LEVÁ STRANA -->
    <div>
      <div class="card">
        <h3>Nová reklamace</h3>
        <label>Zákazník<input id="customer" required></label>
        <label>Adresa<input id="address" required></label>
        <label>Telefon<input id="phone" required></label>
        <label>E-mail<input id="email" type="email" required></label>
        <label>Číslo objednávky<input id="order" required></label>
        <label>Stav reklamace
          <select id="status" required>
            <option value="">— vyberte —</option>
            <option>Nová</option>
            <option>Čekáme na díly</option>
            <option>Nemůžeme se dovolat zákazníkovi</option>
            <option>Čekáme na informace od zadavatele</option>
            <option>Zákazník nezvedá</option>
          </select>
        </label>
        <label>Zadavatel
          <select id="issuer" required>
            <option value="">— vyberte —</option>
            <option>Natuzzi Česká republika</option>
            <option>Natuzzi Slovensko</option>
            <option>Natuzzi Italia JAMA</option>
            <option>Natuzzi Italia RIVER</option>
            <option>Natuzzi Italia SOHO</option>
            <option>SOFTALY</option>
            <option>Natuzzi Italia FASE</option>
            <option>Pozáruční servis</option>
          </select>
        </label>
        <label>Technik
          <select id="tech" required>
            <option value="">— vyberte —</option>
            <option>Milan Kolín</option>
            <option>Radek Zikmund</option>
            <option>Oba</option>
          </select>
        </label>
        <label>Model<input id="model" required></label>
        <label>Popis reklamace<textarea id="complaint" required></textarea></label>
        <label>Cena práce (EUR)<input id="price_work" type="number" value="0" required></label>
        <label>Cena materiálu (EUR)<input id="price_mat" type="number" value="0" required></label>
        <label>Cena druhého technika (EUR)<input id="price_tech" type="number" value="0" required></label>
        <label>Cena doprava (EUR)<input id="price_trans" type="number" value="0" required></label>
        <label>Cena vyzvednutí dílu (EUR)<input id="price_pickup" type="number" value="0" required></label>
        <label>Datum návštěvy<input id="visit_date" type="date"></label>
        <div class="controls">
          <button class="primary" id="saveBtn">Uložit</button>
          $("saveBtn").onclick = async ()=>{
  const obj = {
    customer:$("customer").value,
    address:$("address").value,
    phone:$("phone").value,
    email:$("email").value,
    order:$("order").value,
    status:$("status").value,
    issuer:$("issuer").value,
    tech:$("tech").value,
    model:$("model").value,
    complaint:$("complaint").value,
    price_work:$("price_work").value,
    price_mat:$("price_mat").value,
    price_tech:$("price_tech").value,
    price_trans:$("price_trans").value,
    price_pickup:$("price_pickup").value,
    visit_date:$("visit_date").value
  };

  try {
    // 1️⃣ uložení do Sheet
    let res = await fetch(API_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(obj)
    });
    let text = await res.text();
    console.log("Odpověď ze serveru:", text);

    // 2️⃣ hned zobrazit v protokolu
    updateProtocol(obj);

    // 3️⃣ přidat do tabulky lokálně
    claims.push(obj);
    renderTable();

    // 4️⃣ vymazání formuláře
    ["customer","address","phone","email","status","order","issuer","tech","model","complaint",
     "price_work","price_mat","price_tech","price_trans","price_pickup","visit_date"].forEach(id=>{
      const el = $(id); if(el) el.value = (id.startsWith("price")) ? "0" : "";
    });

  } catch(err){
    console.error("Chyba při uložení:", err);
  }
};

          <button class="ghost" id="clearBtn">Vymazat</button>
        </div>
      </div>
      <div class="card" style="margin-top:12px">
        <h3>Seznam reklamací</h3>
        <div class="scroll">
          <table id="claimsTable">
            <thead>
              <tr><th>Zákazník</th><th>Adresa</th><th>Telefon</th><th>Model</th><th>Stav</th><th>Technik</th><th>Cena celkem</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
    <!-- PRAVÁ STRANA -->
    <div>
      <div class="card protocol" id="protocol">
        <h2>CLAIM PROTOCOL</h2>
        <p><strong>Zákazník:</strong> <span id="p_customer">—</span></p>
        <p><strong>Adresa:</strong> <a id="p_address" href="#" target="_blank">—</a></p>
        <p><strong>Telefon:</strong> <span id="p_phone">—</span></p>
        <p><strong>E-mail:</strong> <span id="p_email">—</span></p>
        <p><strong>Číslo objednávky:</strong> <span id="p_order">—</span></p>
        <p><strong>Zadavatel:</strong> <span id="p_issuer">—</span></p>
        <p><strong>Technik:</strong> <span id="p_tech">—</span></p>
        <p><strong>Model:</strong> <span id="p_model">—</span></p>
        <p><strong>Popis:</strong> <span id="p_complaint">—</span></p>
        <p><strong>Cena celkem:</strong> <span id="p_total">0</span> EUR</p>
        <canvas id="sigCanvas" width="600" height="150"></canvas>
      </div>
    </div>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbw-htklmdoSSl9aMwC8T7FhDIZBdycUpumPuYsIfzm1Ty45YhAkDrg42-RxHHpnmebo/exec"; // nahraď svou URL z Apps Scriptu
const claims = [];
const $ = id=>document.getElementById(id);

// aktualizace protokolu
function updateProtocol(data){
  $("p_customer").textContent = data.customer;
  $("p_address").textContent = data.address;
  $("p_address").href = "https://waze.com/ul?q=" + encodeURIComponent(data.address);
  $("p_phone").textContent = data.phone;
  $("p_email").textContent = data.email;
  $("p_order").textContent = data.order;
  $("p_issuer").textContent = data.issuer;
  $("p_tech").textContent = data.tech;
  $("p_model").textContent = data.model;
  $("p_complaint").textContent = data.complaint;
  $("p_total").textContent = (
    Number(data.price_work)+Number(data.price_mat)+Number(data.price_tech)+Number(data.price_trans)+Number(data.price_pickup)
  ).toFixed(2);
}

// uložení do Sheet
async function saveToSheet(obj){
  await fetch(API_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(obj)});
}

// načtení ze Sheet
async function loadFromSheet(){
  const res = await fetch(API_URL);
  const data = await res.json();
  claims.length = 0;
  data.forEach(r => claims.push(r));
  renderTable();
}

$("saveBtn").onclick = async ()=>{
  const obj = {
    customer:$("customer").value,
    address:$("address").value,
    phone:$("phone").value,
    email:$("email").value,
    order:$("order").value,
    status:$("status").value,
    issuer:$("issuer").value,
    tech:$("tech").value,
    model:$("model").value,
    complaint:$("complaint").value,
    price_work:$("price_work").value,
    price_mat:$("price_mat").value,
    price_tech:$("price_tech").value,
    price_trans:$("price_trans").value,
    price_pickup:$("price_pickup").value,
    visit_date:$("visit_date").value
  };

  // 1️⃣ uložení do Sheet
  await saveToSheet(obj);

  // 2️⃣ hned zobrazit v protokolu
  updateProtocol(obj);

  // 3️⃣ přidat do tabulky lokálně
  claims.push(obj);
  renderTable();

  // 4️⃣ vymazání formuláře
  ["customer","address","phone","email","status","order","issuer","tech","model","complaint",
   "price_work","price_mat","price_tech","price_trans","price_pickup","visit_date"].forEach(id=>{
    const el = $(id); if(el) el.value = (id.startsWith("price")) ? "0" : "";
  });
};

$("clearBtn").onclick = ()=>{
  ["customer","address","phone","email","status","order","issuer","tech","model","complaint",
   "price_work","price_mat","price_tech","price_trans","price_pickup","visit_date"].forEach(id=>{
    const el = $(id); if(el) el.value = (id.startsWith("price")) ? "0" : "";
  });
};

// render tabulky
function renderTable(){
  const tbody=$("claimsTable").querySelector("tbody");
  tbody.innerHTML="";
  claims.forEach(c=>{
    const total=(+c.price_work+ +c.price_mat+ +c.price_tech+ +c.price_trans+ +c.price_pickup).toFixed(2);
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${c.customer}</td>
                  <td><a href="https://waze.com/ul?q=${encodeURIComponent(c.address)}" target="_blank">${c.address}</a></td>
                  <td><a href="tel:${c.phone}">${c.phone}</a></td>
                  <td>${c.model}</td>
                  <td>${c.status}</td>
                  <td>${c.tech}</td>
                  <td>${total}</td>`;
    tbody.appendChild(tr);
  });
}

// podpis
const canvas=$("sigCanvas"),ctx=canvas.getContext("2d");let drawing=false;
canvas.addEventListener("mousedown",()=>drawing=true);
canvas.addEventListener("mouseup",()=>drawing=false);
canvas.addEventListener("mousemove",e=>{if(!drawing)return;ctx.fillStyle="black";ctx.beginPath();ctx.arc(e.offsetX,e.offsetY,2,0,Math.PI*2);ctx.fill();});

// při startu stránky načíst data
window.onload = ()=>{
  loadFromSheet();
};
</script>
</body>
</html>
