<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nov√° reklamace ‚Äì White Glove Service</title>
  <style>
    body {
      font-family: "Inter", system-ui, sans-serif;
      background: #f6f7fb;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      color: #111;
    }
    .wrapper {
      background: #fff;
      padding: 40px 50px;
      border-radius: 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 720px;
      margin-top: 40px;
      box-sizing: border-box;
    }
    h1 { text-align: center; font-size: 2.8em; font-weight: 900; margin-bottom: 10px; }
    h2 { text-align: center; font-size: 1.2em; font-weight: 500; color: #666; margin-bottom: 30px; }
    label { display: block; font-weight: 600; margin-top: 15px; margin-bottom: 6px; }
    input, textarea, select {
      width: 100%; padding: 10px 12px; font-size: 1em;
      border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box;
      font-family: "Inter", sans-serif; transition: border-color 0.25s ease, box-shadow 0.25s ease;
    }
    input:focus, textarea:focus, select:focus {
      border-color: #0046ff; box-shadow: 0 0 0 3px rgba(0,70,255,0.1); outline: none;
    }
    textarea { height: 100px; resize: vertical; }
    .invalid { border: 2px solid; border-image: linear-gradient(135deg, #ff4d4d, #ff7b7b) 1; }

    .address-wrapper { position: relative; }
    .suggestions {
      position: absolute; top: 100%; left: 0; width: 100%; background: #fff;
      border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 6px 14px rgba(0,0,0,0.1);
      z-index: 10; overflow-y: auto; max-height: 200px;
    }
    .suggestions div { padding: 10px; cursor: pointer; transition: background 0.15s; }
    .suggestions div:hover { background: #f2f4f8; }

    .map-preview {
      width: 100%; height: 250px; margin-top: 14px; border-radius: 12px; overflow: hidden;
      background: linear-gradient(145deg, #f9f9fb, #e8eaef); border: 1px solid #d2d4da;
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
      opacity: 0; transform: translateY(8px);
      transition: opacity 0.6s ease, transform 0.4s ease;
    }
    .map-preview.visible { opacity: 1; transform: translateY(0); }
    .hidden { display: none; }

    .preview { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .preview-item {
      width: 80px; height: 80px; position: relative;
      border-radius: 8px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .preview-item img { width: 100%; height: 100%; object-fit: cover; }
    .progress-bar {
      position: absolute; bottom: 0; left: 0; height: 6px;
      background: linear-gradient(90deg, #00d084, #00a86b); width: 0%; transition: width 0.4s ease;
    }

    .btn {
      display: inline-block; padding: 12px 28px; border-radius: 8px;
      font-weight: 600; font-size: 1em; border: none; cursor: pointer;
      text-decoration: none; color: #fff;
      transition: transform 0.15s ease-in-out, opacity 0.25s;
      min-width: 150px; box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    .btn:hover { transform: scale(1.04); opacity: 0.9; }
    .btn-back { background: linear-gradient(135deg, #6c757d, #a0a4a7); }
    .btn-send { background: linear-gradient(135deg, #0046ff, #357aff); }

    .actions { margin-top: 35px; display: flex; justify-content: center; gap: 20px; }

    /* ‚úÖ animace fajfky */
    .success-check {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(255,255,255,0.9);
      display: flex; justify-content: center; align-items: center;
      z-index: 9999; opacity: 0; transition: opacity 0.4s; pointer-events: none;
    }
    .success-check.active { opacity: 1; pointer-events: all; }
    .checkmark {
      width: 120px; height: 120px; border-radius: 50%;
      display: block; stroke-width: 5; stroke: url(#grad1); stroke-miterlimit: 10;
      margin: 10% auto; box-shadow: inset 0 0 0 #7ac142;
      animation: fill 0.4s ease-in-out 0.4s forwards, scale 0.3s ease-in-out 0.9s both;
    }
    @keyframes fill { 100% { box-shadow: inset 0 0 0 60px #00d084; } }
    @keyframes scale { 0%,100% { transform: none; } 50% { transform: scale3d(1.1,1.1,1); } }

    /* ‚è≥ overlay s hodinami */
    .wait-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(255, 255, 255, 0.85);
      display: flex; justify-content: center; align-items: center;
      z-index: 9998; opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
    }
    .wait-overlay.active { opacity: 1; pointer-events: all; }
    .wait-content { text-align: center; font-family: "Inter", sans-serif; color: #333; font-weight: 600; font-size: 1.2em; }
    .wait-content p { margin-top: 18px; font-size: 1.1em; color: #444; }
    .hourglass {
      display: inline-block; position: relative; width: 36px; height: 60px;
      background: linear-gradient(to bottom, #00d084, #00a86b);
      border-radius: 8px; animation: flip 2s infinite ease-in-out; transform-origin: center center;
    }
    .hourglass::before, .hourglass::after {
      content: ""; position: absolute; left: 0; width: 100%; height: 50%;
      background: #fff; border-radius: 8px;
    }
    .hourglass::before { top: 0; clip-path: polygon(0 0, 100% 0, 50% 100%); }
    .hourglass::after { bottom: 0; clip-path: polygon(0 100%, 100% 100%, 50% 0); }
    @keyframes flip { 0%,100% { transform: rotate(0deg); } 50% { transform: rotate(180deg); } }
  </style>

  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
</head>

<body>
  <div class="wrapper">
    <h1>WHITE GLOVE SERVICE</h1>
    <h2>Nov√° reklamace</h2>

    <form id="reklamaceForm" novalidate>
      <label>ƒå√≠slo reklamace / objedn√°vky:</label>
      <input type="text" name="cislo" required />

      <label>Z√°kazn√≠k:</label>
      <input type="text" name="zakaznik" required />

      <label>Ulice a ƒç√≠slo popisn√©:</label>
      <div class="address-wrapper">
        <input type="text" id="ulice" name="ulice" required placeholder="nap≈ô. Vinohradsk√° 120" />
        <div id="suggestions" class="suggestions"></div>
      </div>

      <div id="mapPreview" class="map-preview hidden"></div>

      <label>Mƒõsto:</label>
      <input type="text" id="mesto" name="mesto" required />
      <label>PSƒå:</label>
      <input type="text" id="psc" name="psc" required pattern="^\d{3}\s?\d{2}$" title="Zadej PSƒå ve form√°tu 12345 nebo 123 45" />

      <label>Telefon:</label>
      <div style="display:flex;gap:8px">
        <select id="predvolba" style="max-width:130px">
          <option value="+420">üá®üáø +420</option>
          <option value="+421">üá∏üá∞ +421</option>
          <option value="+43">üá¶üáπ +43</option>
        </select>
        <input type="tel" id="telefon" name="telefon" required placeholder="nap≈ô. 777123456" />
      </div>

      <label>E-mail:</label>
      <input type="email" id="email" name="email" required placeholder="nap≈ô. info@firma.cz" />

      <label>Model / N√°zev produktu:</label>
      <input type="text" name="produkt" required />

      <label>Datum prodeje:</label>
      <input type="date" name="datum_prodeje" required />
      <label>Datum reklamace:</label>
      <input type="date" name="datum_reklamace" required />
      <label>Popis z√°vady:</label>
      <textarea name="popis" required></textarea>

      <label>P≈ôilo≈æit fotografie (max. 5):</label>
      <small>Podporovan√© form√°ty: JPG, PNG, HEIC (max. 5 MB / soubor)</small>
      <input type="file" id="fotky" accept="image/jpeg,image/png,image/heic" multiple />
      <div id="preview" class="preview"></div>

      <label>Objedn√°vku zpracoval:</label>
      <select id="zpracoval" name="zpracoval" required>
        <option value="">Vyber...</option>
        <option value="Natuzzi Editions - Strejcek">Natuzzi Editions ‚Äì Strejcek</option>
        <option value="Natuzzi Editions - Vimrova">Natuzzi Editions ‚Äì Vimrova</option>
        <option value="Natuzzi Italia - Bratislava">Natuzzi Italia ‚Äì Bratislava</option>
        <option value="Natuzzi Italia - Jama">Natuzzi Italia ‚Äì Jama</option>
        <option value="Natuzzi Italia - River">Natuzzi Italia ‚Äì River</option>
        <option value="Natuzzi Italia - SOHO">Natuzzi Italia ‚Äì SOHO</option>
        <option value="Softaly - SOHO">Softaly ‚Äì SOHO</option>
        <option value="Phase - Klucarova">Phase ‚Äì Klucarova</option>
        <option value="Phase - Jancova">Phase ‚Äì Jancova</option>
        <option value="Jin√°">Jin√°</option>
      </select>

      <div id="jinaSekce" class="hidden">
        <label>Zadej nov√Ω z√°pis zadavatele:</label>
        <input type="text" id="jinaJmeno" name="jinaJmeno" />
        <label>E-mail zadavatele:</label>
        <input type="email" id="jinaEmail" name="jinaEmail" />
        <label>Telefon zadavatele:</label>
        <input type="tel" id="jinaTelefon" name="jinaTelefon" />
      </div>

      <div class="actions">
        <a href="index.html" class="btn btn-back">Zpƒõt</a>
        <button type="submit" class="btn btn-send">Odeslat</button>
      </div>
    </form>
  </div>

  <!-- ‚è≥ Overlay -->
  <div class="wait-overlay" id="waitOverlay">
    <div class="wait-content">
      <div class="hourglass"></div>
      <p>WAIT / pros√≠m ƒçekejte...</p>
    </div>
  </div>

  <!-- ‚úÖ Fajfka -->
  <div class="success-check" id="successCheck">
    <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
      <defs><linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#00d084;stop-opacity:1" />
        <stop offset="100%" style="stop-color:#00a86b;stop-opacity:1" />
      </linearGradient></defs>
      <circle cx="26" cy="26" r="25" fill="none" />
      <path fill="none" d="M14 27l7 7 16-16" stroke-linecap="round" stroke-linejoin="round" />
    </svg>
  </div>

  <script>
    /* === Automatick√° velk√° p√≠smena === */
    const cisloInput=document.querySelector('input[name="cislo"]');
    cisloInput.addEventListener("input",()=>{cisloInput.value=cisloInput.value.toUpperCase();});

    /* === Na≈°ept√°vaƒç s mapou === */
    const uliceInput=document.getElementById("ulice"),mestoInput=document.getElementById("mesto"),pscInput=document.getElementById("psc"),suggestionContainer=document.getElementById("suggestions");let adresaPlatna=false;
    uliceInput.addEventListener("input",async()=>{
      const query=uliceInput.value.trim();adresaPlatna=false;suggestionContainer.innerHTML="";if(query.length<2)return;
      try{const url=`https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&countrycodes=cz,sk,at&limit=5&dedupe=1&q=${encodeURIComponent(query)}`;
        const res=await fetch(url);const data=await res.json();const q=query.toLowerCase();
        const filtered=data.filter(item=>(item.display_name&&item.display_name.toLowerCase().includes(q))||(item.address&&Object.values(item.address).some(v=>v&&v.toLowerCase().includes(q))));
        if(!filtered.length)return;
        filtered.forEach(item=>{
          const div=document.createElement("div");div.textContent=item.display_name;
          div.addEventListener("click",()=>{
            uliceInput.value=(item.address.road||"")+" "+(item.address.house_number||"");
            mestoInput.value=item.address.city||item.address.town||item.address.village||"";
            pscInput.value=item.address.postcode||"";
            adresaPlatna=true;suggestionContainer.innerHTML="";
            const mapDiv=document.getElementById("mapPreview");mapDiv.classList.remove("hidden");setTimeout(()=>mapDiv.classList.add("visible"),20);
            mapDiv.innerHTML="";const lat=parseFloat(item.lat),lon=parseFloat(item.lon);
            const map=L.map(mapDiv,{center:[lat,lon],zoom:16,zoomControl:false,attributionControl:false});
            L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(map);
            L.marker([lat,lon]).addTo(map);
          });suggestionContainer.appendChild(div);});
      }catch(err){console.error("Chyba p≈ôi naƒç√≠t√°n√≠ adres:",err);}});
    document.addEventListener("click",e=>{if(!suggestionContainer.contains(e.target)&&e.target!==uliceInput)suggestionContainer.innerHTML="";});

    const telefonInput=document.getElementById("telefon"),predvolba=document.getElementById("predvolba"),emailInput=document.getElementById("email");
    function validateTelefon(){return/^[0-9]{8,12}$/.test(telefonInput.value.trim());}
    function validateEmail(){return/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(emailInput.value.trim());}

    async function compressImage(file,maxSizeMB=1,maxDim=1280){const img=await createImageBitmap(file);const canvas=document.createElement("canvas");let[w,h]=[img.width,img.height];if(w>h&&w>maxDim){h*=maxDim/w;w=maxDim;}else if(h>w&&h>maxDim){w*=maxDim/h;h=maxDim;}canvas.width=w;canvas.height=h;const ctx=canvas.getContext("2d");ctx.drawImage(img,0,0,w,h);let q=0.9,blob=await new Promise(r=>canvas.toBlob(r,"image/jpeg",q));while(blob.size/1024/1024>maxSizeMB&&q>0.4){q-=0.1;blob=await new Promise(r=>canvas.toBlob(r,"image/jpeg",q));}return blob;}
    const fotkyInput=document.getElementById("fotky"),preview=document.getElementById("preview");let compressedFiles=[];
    fotkyInput.addEventListener("change",async()=>{preview.innerHTML="";compressedFiles=[];const files=Array.from(fotkyInput.files).slice(0,5);for(const file of files){if(!file.type.startsWith("image/"))continue;const item=document.createElement("div");item.classList.add("preview-item");const img=document.createElement("img");const bar=document.createElement("div");bar.classList.add("progress-bar");item.appendChild(bar);preview.appendChild(item);const reader=new FileReader();reader.onload=e=>{img.src=e.target.result;item.appendChild(img);};reader.readAsDataURL(file);const blob=await compressImage(file);compressedFiles.push({name:file.name,blob});let w=0;const t=setInterval(()=>{w+=10;bar.style.width=w+"%";if(w>=100)clearInterval(t);},40);}});

    const selectZpracoval=document.getElementById("zpracoval"),jinaSekce=document.getElementById("jinaSekce"),jinaInputs=jinaSekce.querySelectorAll("input");
    selectZpracoval.onchange=()=>{if(selectZpracoval.value==="Jin√°"){jinaSekce.classList.remove("hidden");jinaInputs.forEach(i=>i.required=true);}else{jinaSekce.classList.add("hidden");jinaInputs.forEach(i=>i.required=false);}};

    function playSuccessSound(){try{const ctx=new(window.AudioContext||window.webkitAudioContext)();const o=ctx.createOscillator();const g=ctx.createGain();o.type="sine";o.frequency.setValueAtTime(880,ctx.currentTime);g.gain.setValueAtTime(0.1,ctx.currentTime);o.connect(g);g.connect(ctx.destination);o.start();o.stop(ctx.currentTime+0.25);}catch{}}
    function showSuccess(){playSuccessSound();document.getElementById("waitOverlay").classList.remove("active");const s=document.getElementById("successCheck");s.classList.add("active");setTimeout(()=>{window.location.href="index.html";},2500);}

    document.getElementById("reklamaceForm").addEventListener("submit",async e=>{
      e.preventDefault();document.getElementById("waitOverlay").classList.add("active");
      const f=e.target;const fields=f.querySelectorAll("input[required],textarea[required],select[required]");let valid=true;
      fields.forEach(i=>{if(!i.value.trim()){i.classList.add("invalid");valid=false;}else i.classList.remove("invalid");});
      if(!validateTelefon()){telefonInput.classList.add("invalid");valid=false;}
      if(!validateEmail()){emailInput.classList.add("invalid");valid=false;}
      if(!adresaPlatna){alert("Vyber pros√≠m adresu z na≈°ept√°vaƒçe.");uliceInput.classList.add("invalid");valid=false;}
      if(!valid){document.getElementById("waitOverlay").classList.remove("active");return alert("Zkontroluj ƒçervenƒõ oznaƒçen√° pole.");}
      const owner="radecek222-boop",repo="reklamace",token=prompt("Zadej GitHub token:"),cislo=f.cislo.value.trim().toUpperCase()||"REK";
      const dataObj={typ:"reklamace",contract:f.zpracoval.value,cislo,zakaznik:f.zakaznik.value,adresa:`${f.ulice.value}, ${f.mesto.value}, ${f.psc.value}`,telefon:`${predvolba.value} ${f.telefon.value}`,email:f.email.value,produkt:f.produkt.value,datum_prodeje:f.datum_prodeje.value,datum_reklamace:f.datum_reklamace.value,popis:f.popis.value,fotky:[],jinaZadavatel:f.zpracoval.value==="Jin√°"?{jmeno:f.jinaJmeno.value,email:f.jinaEmail.value,telefon:f.jinaTelefon.value}:null};
      async function uploadToGitHub(owner,repo,path,blob,msg,token){const base64=await new Promise(r=>{const reader=new FileReader();reader.onloadend=()=>r(reader.result.split(",")[1]);reader.readAsDataURL(blob);});const res=await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`,{method:"PUT",headers:{"Authorization":`token ${token}`,"Accept":"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify({message:msg,content:base64,branch:"main"})});if(!res.ok)throw new Error(await res.text());}
      async function submitToGitHub(dataObj,owner,repo,path,msg,token){const url=`https://api.github.com/repos/${owner}/${repo}/contents/${path}`;const res=await fetch(url,{headers:{"Authorization":`token ${token}`,"Accept":"application/vnd.github.v3+json"}});let old="[]",sha=null;if(res.ok){const j=await res.json();old=atob(j.content.replace(/\n/g,""));sha=j.sha;}const arr=JSON.parse(old);arr.push(dataObj);const base64=btoa(unescape(encodeURIComponent(JSON.stringify(arr,null,2))));const body={message:msg,content:base64,branch:"main"};if(sha)body.sha=sha;const put=await fetch(url,{method:"PUT",headers:{"Authorization":`token ${token}`,"Accept":"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify(body)});if(!put.ok)throw new Error(await put.text());}
      try{for(const fch of compressedFiles){const safe=`${cislo}_${fch.name.replace(/\s+/g,"_")}`;await uploadToGitHub(owner,repo,`foto/${safe}`,fch.blob,`Nov√° fotka k reklamaci ${cislo}`,token);dataObj.fotky.push(safe);}await submitToGitHub(dataObj,owner,repo,"orders.json",`Nov√° reklamace ${cislo}`,token);showSuccess();f.reset();}
      catch(err){document.getElementById("waitOverlay").classList.remove("active");alert("Chyba: "+err.message);}
    });
  </script>
</body>
</html>
