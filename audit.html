<!-- 
====================================================================
üíé WHITE GLOVE SERVICE ‚Äì AUDIT SYSTEM v6.0 (ƒç√°st 1/4)
====================================================================
Autor: Radek Zikmund & Hugo (GPT-5)
Datum: 2025-10-12
Popis:
  ‚Äì Vzhled a rozlo≈æen√≠ UI v stylu ‚Äûseznam.html‚Äú
  ‚Äì Horn√≠ panel s tlaƒç√≠tky Zpƒõt | Konzole | N√°vrh oprav | V√Ωbƒõr str√°nky
  ‚Äì Z√°kladn√≠ container pro logy a n√°hled
====================================================================
-->
<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Audit ‚Äì White Glove Service</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
<style>
body{font-family:"Inter",sans-serif;background:#f6f7fb;margin:0;padding:0;color:#111;}
header{
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 20px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,0.1);
  position:sticky;top:0;z-index:100;
}
h1{font-size:1.2em;font-weight:800;margin:0;color:#222;}
.btn-bar{display:flex;gap:10px;align-items:center;}
button,a.btn{
  display:inline-block;padding:10px 18px;font-weight:600;font-family:"Inter",sans-serif;
  border:none;border-radius:8px;cursor:pointer;text-decoration:none;color:#fff;
  box-shadow:0 3px 8px rgba(0,0,0,0.15);transition:transform 0.15s ease,opacity 0.25s;
  font-size:0.95em;min-width:140px;text-align:center;
}
button:hover,a.btn:hover{transform:scale(1.05);opacity:0.9;}
.btn-back{background:linear-gradient(135deg,#888,#b5b5b5);}
.btn-console{background:linear-gradient(135deg,#1976d2,#2196f3);}
.btn-fix{background:linear-gradient(135deg,#e53935,#ff7043);}
select{
  padding:9px 14px;border-radius:8px;border:1px solid #ccc;font-family:"Inter",sans-serif;
  font-weight:600;background:#fff;cursor:pointer;min-width:160px;
}
main{
  display:flex;flex-direction:row;gap:0;height:calc(100vh - 80px);
  overflow:hidden;padding:10px;
}
#logPanel{
  flex:0 0 40%;background:#fff;border-radius:10px;overflow:auto;
  box-shadow:0 2px 8px rgba(0,0,0,0.1);padding:10px;font-size:0.9em;
}
#previewPanel{
  flex:1;background:#fff;border-radius:10px;overflow:hidden;
  box-shadow:0 2px 8px rgba(0,0,0,0.1);display:flex;flex-direction:column;
}
iframe{
  flex:1;width:100%;border:none;background:#fafafa;
}
.log{margin:4px 0;padding:6px 8px;border-left:4px solid transparent;line-height:1.4;}
.log.info{border-color:#2196f3;}
.log.warn{border-color:#ffa000;background:#fff8e1;}
.log.error{border-color:#e53935;background:#ffebee;}
footer{
  background:#fff;text-align:center;padding:8px;font-size:12px;
  border-top:1px solid #eee;color:#777;
}
.hidden{display:none!important;}
/* üì± Responzivn√≠ */
@media(max-width:768px){
  main{flex-direction:column;}
  #logPanel{flex:1 1 50%;max-height:45vh;}
  #previewPanel{flex:1 1 50%;max-height:55vh;margin-top:8px;}
  button,a.btn{min-width:120px;padding:8px 14px;}
}
</style>
</head>

<body>
<header>
  <h1>WHITE GLOVE SERVICE ‚Äì AUDIT SYSTEM v6.0</h1>
  <div class="btn-bar">
    <a href="index.html" class="btn btn-back">‚¨Ö Zpƒõt</a>
    <button id="consoleBtn" class="btn btn-console">üß≠ Konzole</button>
    <button id="fixBtn" class="btn btn-fix">üí° N√°vrh oprav</button>
    <select id="pageSelect">
      <option value="index.html">index.html</option>
      <option value="seznam.html">seznam.html</option>
      <option value="orders.html">orders.html</option>
      <option value="hotove.html">hotove.html</option>
      <option value="photocustomer.html">photocustomer.html</option>
      <option value="protokol.html">protokol.html</option>
    </select>
  </div>
</header>

<main>
  <div id="logPanel"></div>
  <div id="previewPanel">
    <iframe id="auditFrame" sandbox="allow-scripts allow-same-origin"></iframe>
  </div>
</main>

<footer>¬© White Glove Service s.r.o. ‚Äì Audit System v6.0 (ƒç√°st 1/4)</footer>
<!-- 
====================================================================
üíé WHITE GLOVE SERVICE ‚Äì AUDIT SYSTEM v6.0 (ƒç√°st 2/4)
====================================================================
Popis:
  ‚Äì naƒç√≠t√°n√≠ zvolen√© str√°nky do iframe
  ‚Äì odchyt√°v√°n√≠ chyb, warning≈Ø a logov√°n√≠
  ‚Äì automatick√° vizualizace funkc√≠ v Canvas
====================================================================
-->
<script>
// üü© Inicializace promƒõnn√Ωch
const frame = document.getElementById("auditFrame");
const logPanel = document.getElementById("logPanel");
const pageSelect = document.getElementById("pageSelect");

// üßæ Log syst√©m
function log(type, message, hint = "") {
  const div = document.createElement("div");
  div.className = `log ${type}`;
  div.innerHTML = `<b>${type.toUpperCase()}</b> ${message}`;
  if (hint) {
    const hintDiv = document.createElement("div");
    hintDiv.style.fontSize = "0.85em";
    hintDiv.style.color = "#333";
    hintDiv.style.marginTop = "4px";
    hintDiv.textContent = "üí° " + hint;
    div.appendChild(hintDiv);
  }
  logPanel.appendChild(div);
  logPanel.scrollTop = logPanel.scrollHeight;
}

// üü® Naƒçten√≠ str√°nky do iframe
function runAudit() {
  const file = pageSelect.value;
  logPanel.innerHTML = "";
  frame.src = file + "?" + Date.now();
  log("info", `üîç Naƒç√≠t√°m str√°nku: ${file}`);
}

// üü¶ Po naƒçten√≠ str√°nky v iframe
frame.addEventListener("load", () => {
  const win = frame.contentWindow;
  const doc = frame.contentDocument;
  log("info", "‚úÖ Str√°nka √∫spƒõ≈°nƒõ naƒçtena.");
  
  // Odchyt√°v√°n√≠ chyb
  win.addEventListener("error", e => {
    log("error", e.message, "Zkontroluj element nebo po≈ôad√≠ skript≈Ø.");
  });
  win.addEventListener("unhandledrejection", e => {
    log("error", "Promise: " + e.reason, "Mo≈æn√° chyb√≠ await nebo .catch().");
  });

  // Automatick√° vizualizace funkc√≠
  drawFunctionGraph(win);

  // Rychl√Ω audit DOM
  const expected = ["#search", "#tableContainer", "#planModal", "#calendarContainer", "#mapContainer"];
  expected.forEach(sel => {
    if (!doc.querySelector(sel))
      log("warn", `Chyb√≠ prvek ${sel}`, "Dopl≈à do HTML nebo uprav JS vol√°n√≠.");
    else
      log("info", `‚úî Nalezen prvek ${sel}`);
  });
});

// üéØ Spu≈°tƒõn√≠ auditu po zmƒõnƒõ v√Ωbƒõru str√°nky
pageSelect.addEventListener("change", runAudit);
window.addEventListener("DOMContentLoaded", runAudit);

// üß≠ Automatick√° vizualizace funkc√≠
function drawFunctionGraph(win) {
  const fns = Object.keys(win).filter(k => typeof win[k] === "function").slice(0, 40);
  if (!fns.length) {
    log("warn", "Nenalezeny ≈æ√°dn√© funkce v global scope.");
    return;
  }
  
  const canvas = document.createElement("canvas");
  canvas.width = 800;
  canvas.height = 500;
  canvas.style.margin = "10px auto";
  canvas.style.display = "block";
  canvas.style.background = "#fafafa";
  canvas.style.border = "1px solid #ddd";
  
  const ctx = canvas.getContext("2d");
  ctx.font = "12px Inter";
  ctx.fillStyle = "#333";
  ctx.textAlign = "center";
  const cols = 10;
  
  fns.forEach((fn, i) => {
    const x = 70 + (i % cols) * 70;
    const y = 70 + Math.floor(i / cols) * 70;
    ctx.beginPath();
    ctx.arc(x, y, 25, 0, Math.PI * 2);
    ctx.fillStyle = "#2196f3";
    ctx.fill();
    ctx.fillStyle = "#fff";
    ctx.fillText(fn.substring(0, 6), x, y + 4);
  });

  log("info", `üß† Vykresleno ${fns.length} funkc√≠ v grafu.`);
  logPanel.appendChild(canvas);
}
</script>
<!-- 
====================================================================
üíé WHITE GLOVE SERVICE ‚Äì AUDIT SYSTEM v6.0 (ƒç√°st 3/4)
====================================================================
Popis:
  ‚Äì konzolov√© okno s p≈ô√≠m√Ωm v√Ωpisem log≈Ø
  ‚Äì mod√°ln√≠ okno s AI n√°vrhy oprav
====================================================================
-->
<style>
/* üîß Mod√°ln√≠ okno n√°vrhu oprav */
#fixModal {
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 3000;
  backdrop-filter: blur(4px);
}
#fixBox {
  background: #fff;
  border-radius: 12px;
  padding: 20px 25px;
  max-width: 600px;
  width: 90%;
  box-shadow: 0 6px 25px rgba(0,0,0,0.3);
  animation: fadeIn 0.25s ease;
}
#fixBox h2 {
  margin: 0 0 10px 0;
  font-size: 1.2em;
  font-weight: 800;
  color: #222;
}
#fixList {
  max-height: 400px;
  overflow-y: auto;
  font-size: 0.95em;
  color: #333;
  padding-right: 6px;
}
.fix-item {
  border-left: 4px solid #e53935;
  padding: 8px 10px;
  margin-bottom: 6px;
  background: #ffebee;
  border-radius: 6px;
  line-height: 1.4em;
}
.fix-suggestion {
  margin-top: 4px;
  font-size: 0.85em;
  color: #1565c0;
}
#closeFix {
  margin-top: 12px;
  background: linear-gradient(135deg,#888,#b5b5b5);
  color: #fff;
  padding: 8px 18px;
  border:none;
  border-radius:8px;
  font-weight:600;
  cursor:pointer;
  float:right;
}
@keyframes fadeIn {
  from {opacity:0; transform:scale(0.95);}
  to {opacity:1; transform:scale(1);}
}
</style>

<!-- üîß Mod√°ln√≠ okno pro n√°vrh oprav -->
<div id="fixModal">
  <div id="fixBox">
    <h2>üí° N√°vrhy na opravu</h2>
    <div id="fixList">≈Ω√°dn√© chyby zat√≠m nezaznamen√°ny.</div>
    <button id="closeFix">Zav≈ô√≠t</button>
  </div>
</div>

<script>
// üß† AI n√°vrhy oprav ‚Äì gener√°tor
function aiSuggestion(errorMsg) {
  const msg = errorMsg.toLowerCase();
  if (msg.includes("null is not an object") || msg.includes("undefined")) {
    return "Zkontroluj, zda existuje element v DOM, ne≈æ na nƒõj p≈ôistupuje≈°. Pou≈æij `if (el)` podm√≠nku.";
  } else if (msg.includes("failed to fetch")) {
    return "Zkontroluj s√≠≈•ov√© vol√°n√≠ nebo CORS. Ovƒõ≈ô Worker URL a opr√°vnƒõn√≠.";
  } else if (msg.includes("syntaxerror")) {
    return "Zkontroluj uvozovky, z√°vorky nebo chybƒõj√≠c√≠ st≈ôedn√≠k.";
  } else if (msg.includes("not a function")) {
    return "Vol√°≈° funkci d≈ô√≠v, ne≈æ je definovan√°. P≈ôesu≈à definici v√Ω≈° nebo pou≈æij atribut `defer`.";
  } else {
    return "Zkontroluj logy a posloupnost skript≈Ø ‚Äì m≈Ø≈æe chybƒõt import nebo promƒõnn√°.";
  }
}

// üì¶ Ukl√°d√°n√≠ chyb pro modal
const errorList = [];
function addError(type, message) {
  if (type !== "error") return;
  const suggestion = aiSuggestion(message);
  errorList.push({ message, suggestion });
}

// üß≠ Aktualizace log funkce ‚Äì p≈ôid√° i AI n√°vrhy
const oldLog = log;
log = function(type, message, hint = "") {
  oldLog(type, message, hint);
  addError(type, message);
};

// üü© Ovl√°d√°n√≠ mod√°lu
const fixModal = document.getElementById("fixModal");
const fixList = document.getElementById("fixList");
const fixBtn = document.getElementById("fixBtn");
const closeFix = document.getElementById("closeFix");

fixBtn.addEventListener("click", () => {
  if (errorList.length === 0) {
    fixList.innerHTML = "<p>‚úÖ ≈Ω√°dn√© chyby nenalezeny.</p>";
  } else {
    fixList.innerHTML = "";
    errorList.forEach(err => {
      const div = document.createElement("div");
      div.className = "fix-item";
      div.innerHTML = `
        <div><b>Chyba:</b> ${err.message}</div>
        <div class="fix-suggestion">üí° ${err.suggestion}</div>
      `;
      fixList.appendChild(div);
    });
  }
  fixModal.style.display = "flex";
});

closeFix.addEventListener("click", () => {
  fixModal.style.display = "none";
});

// üß≠ Konzole ‚Äì otev≈ôe se nov√© okno s logy
document.getElementById("consoleBtn").addEventListener("click", () => {
  const win = window.open("", "WGSConsole", "width=800,height=600");
  win.document.write(`
    <html><head><title>WGS Konzole</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
    body{font-family:'Inter',sans-serif;background:#f6f7fb;margin:0;padding:10px;}
    h2{font-size:1.2em;margin-top:0;}
    .log{padding:6px 8px;border-left:4px solid transparent;margin:4px 0;font-size:0.9em;}
    .info{border-color:#2196f3;}
    .warn{border-color:#ffa000;background:#fff8e1;}
    .error{border-color:#e53935;background:#ffebee;}
    </style></head><body>
    <h2>üß≠ Konzole ‚Äì White Glove Service</h2>
    <div id="consoleLogs"></div>
    </body></html>
  `);
  const target = win.document.getElementById("consoleLogs");
  [...document.querySelectorAll(".log")].forEach(l => {
    target.appendChild(l.cloneNode(true));
  });
});
</script>
<!-- 
====================================================================
üíé WHITE GLOVE SERVICE ‚Äì AUDIT SYSTEM v6.0 (ƒç√°st 4/4)
====================================================================
Popis:
  ‚Äì bezpeƒçnostn√≠ kontrola skript≈Ø a integrita
  ‚Äì kontrola HTTPS, hash skript≈Ø, verze knihoven
  ‚Äì √∫vodn√≠ syst√©mov√© logy a spu≈°tƒõn√≠
====================================================================
-->

<script>
// üîí Bezpeƒçnostn√≠ kontrola a integrita knihoven
async function securityAudit() {
  log("info", "üîê Spou≈°t√≠m bezpeƒçnostn√≠ kontrolu...");

  const scripts = [...document.scripts].map(s => s.src).filter(Boolean);
  const foundLibs = {};
  const libs = ["leaflet", "vanilla-calendar", "jspdf", "signature_pad"];

  scripts.forEach(src => {
    if (src.startsWith("http://"))
      log("warn", `Nezabezpeƒçen√Ω skript: ${src}`, "Pou≈æij HTTPS m√≠sto HTTP.");
    libs.forEach(lib => {
      if (src.toLowerCase().includes(lib)) foundLibs[lib] = src;
    });
  });

  Object.entries(foundLibs).forEach(([lib, src]) => {
    log("info", `üì¶ Knihovna ${lib}: ${src.split("/").pop()}`);
  });

  // Hash kontrola integrity
  const hashObj = {};
  for (const s of scripts) {
    try {
      const r = await fetch(s, { cache: "no-store" });
      const t = await r.text();
      const hash = await crypto.subtle.digest("SHA-1", new TextEncoder().encode(t));
      const hex = [...new Uint8Array(hash)].map(b => b.toString(16).padStart(2, "0")).join("");
      hashObj[s] = hex;
    } catch (e) {
      log("warn", `Nelze naƒç√≠st: ${s.split("/").pop()}`);
    }
  }

  log("info", `üßæ Hash kontrola dokonƒçena (${Object.keys(hashObj).length} skript≈Ø).`);
}

// üß© Hlub≈°√≠ audit DOM struktury
function deepAudit(win, doc) {
  log("info", "üîé Prov√°d√≠m hlub≈°√≠ kontrolu DOM...");

  const criticalIDs = ["search", "calendarContainer", "mapContainer", "planModal"];
  criticalIDs.forEach(id => {
    if (!doc.querySelector(`#${id}`))
      log("warn", `Chyb√≠ kl√≠ƒçov√Ω element #${id}`, "Ovƒõ≈ô, ≈æe HTML obsahuje v≈°echny ƒç√°sti str√°nky.");
  });

  const forms = doc.querySelectorAll("form");
  if (forms.length > 5) log("warn", "P≈ô√≠li≈° mnoho formul√°≈ô≈Ø", "Mo≈æn√° duplicita nebo chybn√© renderov√°n√≠.");
  if (doc.querySelectorAll("script").length === 0)
    log("error", "Na str√°nce nejsou ≈æ√°dn√© skripty!", "Zkontroluj build nebo odkazy na JS soubory.");
}

// üß≠ Automatick√© spu≈°tƒõn√≠ po naƒçten√≠ str√°nky v iframe
frame.addEventListener("load", () => {
  const win = frame.contentWindow;
  const doc = frame.contentDocument;

  // Provede z√°kladn√≠ audit
  deepAudit(win, doc);

  // Bezpeƒçnostn√≠ kontrola po 4 sekund√°ch
  setTimeout(securityAudit, 4000);
});

// üß≠ √övodn√≠ zpr√°vy
console.log("%c‚úÖ WHITE GLOVE SERVICE ‚Äì AUDIT SYSTEM v6.0 spu≈°tƒõno", "color:#2196f3;font-weight:700;");
log("info", "Audit System v6.0 inicializov√°n.");
log("info", "Vyber str√°nku z menu pro spu≈°tƒõn√≠ auditu.");

// üß© Z√°kladn√≠ z√°znam o stavu prost≈ôed√≠
setTimeout(() => {
  const memory = performance.memory || {};
  const used = memory.usedJSHeapSize ? (memory.usedJSHeapSize / 1048576).toFixed(1) + " MB" : "N/A";
  log("info", `üíæ Pamƒõ≈• JS: ${used}`);
  log("info", `üåê Prohl√≠≈æeƒç: ${navigator.userAgent.split(") ")[1] || navigator.userAgent}`);
  log("info", `üìÖ ƒåas spu≈°tƒõn√≠: ${new Date().toLocaleString("cs-CZ")}`);
}, 800);
</script>

</body>
</html>
<!-- üü© KONEC AUDIT SYSTEM v6.0 -->
