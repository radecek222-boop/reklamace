<!doctype html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WHITE GLOVE SERVICE ‚Äì Hotov√© reklamace</title>
<style>
:root { font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif; color:#111; }
body { margin:0; padding:20px; background:#f6f7fb; }
h1 { text-align:center; font-size:2em; font-weight:900; margin:0 0 10px; }
h2 { text-align:center; font-size:1.1em; font-weight:600; margin:0 0 20px; color:#555; }

.btn-gradient {
  display:inline-block; text-decoration:none; padding:10px 22px; border-radius:8px;
  font-weight:600; font-size:1em; color:#fff; border:none; cursor:pointer;
  box-shadow:0 2px 8px rgba(0,0,0,0.15);
  transition:transform 0.15s ease-in-out, opacity 0.2s; margin:4px;
}
.btn-gradient:hover { transform:scale(1.04); opacity:0.9; }
.btn-green { background:linear-gradient(135deg,#00b36b,#3cd67a); }
.btn-gray { background:linear-gradient(135deg,#6c757d,#a0a4a7); }
.btn-blue { background:linear-gradient(135deg,#0046ff,#357aff); }

.top-actions { text-align:center; margin-bottom:20px; }
.searchbox {
  width:100%; max-width:400px; margin:0 auto 20px; display:block;
  padding:10px; border:1px solid #ccc; border-radius:8px; font-size:1em; background:#fff;
}

table { width:100%; border-collapse:collapse; background:white; border-radius:8px; overflow:hidden; }
th, td { padding:10px 12px; text-align:left; border-bottom:1px solid #ddd; font-size:0.95em; }
th { background:#eee; font-weight:700; }
tr:hover { background:#f1f3f5; cursor:pointer; }

.row-hotovo { background:linear-gradient(135deg,#a3e6b3,#66cc99); }
.badge-poz {
  background:#6c757d; color:white; font-size:0.8em; padding:2px 6px; border-radius:6px; margin-right:6px;
}

#detailModal, #photoView {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.5); display:none; justify-content:center; align-items:center;
  padding:20px; z-index:1000;
}
.modal-box {
  background:white; border-radius:10px; padding:20px; max-width:600px; width:100%;
  max-height:85vh; overflow-y:auto; box-shadow:0 4px 15px rgba(0,0,0,0.2);
}
.photo-gallery { display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-top:10px; }
.photo-gallery img { max-width:100px; border-radius:6px; cursor:pointer; transition:transform 0.2s ease; }
.photo-gallery img:hover { transform:scale(1.1); }
#photoView img { max-width:90%; max-height:90%; border-radius:10px; }

@media(max-width:768px){
  .modal-box{max-width:90%;height:90vh;}
}
</style>
</head>
<body>
<h1>WHITE GLOVE SERVICE</h1>
<h2>Hotov√© reklamace</h2>

<div class="top-actions">
  <a href="seznam.html" class="btn-gradient btn-gray">Zpƒõt na seznam</a>
  <a href="index.html" class="btn-gradient btn-blue">Hlavn√≠ str√°nka</a>
</div>

<input type="text" id="searchInput" class="searchbox" placeholder="Hledat podle jm√©na, adresy nebo telefonu...">

<table id="dataTable">
<thead>
<tr><th>Z√ÅKAZN√çK</th><th>ADRESA</th><th>TELEFON</th><th>DATUM</th></tr>
</thead>
<tbody id="tableBody"><tr><td colspan="4" style="text-align:center;padding:20px;">Naƒç√≠t√°n√≠ dat...</td></tr></tbody>
</table>

<!-- DETAIL -->
<div id="detailModal"><div class="modal-box">
  <h3 id="dName"></h3>
  <p id="dInfo"></p>
  <div id="photoGallery" class="photo-gallery"></div>
  <div style="text-align:center;margin-top:20px;">
    <button class="btn-gradient btn-green" onclick="openProtocol()">Otev≈ô√≠t protokol</button>
    <button class="btn-gradient btn-gray" onclick="closeDetail()">Zav≈ô√≠t</button>
  </div>
</div></div>

<!-- FOTKY -->
<div id="photoView" onclick="this.style.display='none'">
  <img id="photoLarge" src="">
</div>

<script>
const GITHUB_USER="radecek222-boop",REPO="reklamace";
let allData=[], currentItem=null;

async function loadHotove(){
  const tbody=document.getElementById("tableBody");
  tbody.innerHTML=`<tr><td colspan="4" style="text-align:center;padding:20px;">Naƒç√≠t√°n√≠...</td></tr>`;
  try{
    const res=await fetch(`https://raw.githubusercontent.com/${GITHUB_USER}/${REPO}/main/hotove.json?${Date.now()}`);
    const data=await res.json();
    allData=data;
    renderTable(data);
  }catch(e){
    tbody.innerHTML=`<tr><td colspan="4" style="color:red;text-align:center;">Chyba: ${e.message}</td></tr>`;
  }
}

function renderTable(data){
  const tbody=document.getElementById("tableBody");
  tbody.innerHTML="";
  const search=document.getElementById("searchInput").value.toLowerCase();

  const filtered=data.filter(d=>
    (d["Z√°kazn√≠k"]||"").toLowerCase().includes(search) ||
    (d["Adresa"]||"").toLowerCase().includes(search) ||
    (d["Telefon"]||"").toLowerCase().includes(search)
  );

  if(filtered.length===0){
    tbody.innerHTML=`<tr><td colspan="4" style="text-align:center;padding:20px;">≈Ω√°dn√© v√Ωsledky</td></tr>`;
    return;
  }

  filtered.forEach(item=>{
    const tr=document.createElement("tr");
    tr.classList.add("row-hotovo");
    let nameCell=item["Z√°kazn√≠k"]||"";
    if(item.source==="aftersales") nameCell=`<span class="badge-poz">POZ</span>${nameCell}`;
    const waze=item["Adresa"]?`<a href="https://waze.com/ul?q=${encodeURIComponent(item["Adresa"])}" target="_blank">${item["Adresa"]}</a>`:"";
    const phone=item["Telefon"]?`<a href="tel:${item["Telefon"].replace(/\s+/g,'')}" style="text-decoration:none;color:#0046ff;">üìû ${item["Telefon"]}</a>`:"";
    tr.innerHTML=`<td>${nameCell}</td><td>${waze}</td><td>${phone}</td><td>${item["Datum vytvo≈ôen√≠"]||""}</td>`;
    tr.addEventListener("click",()=>openDetail(item));
    tbody.appendChild(tr);
  });
}

function openDetail(item){
  currentItem=item;
  document.getElementById("detailModal").style.display="flex";
  document.getElementById("dName").textContent=item["Z√°kazn√≠k"]||"Nezn√°m√Ω z√°kazn√≠k";
  document.getElementById("dInfo").innerHTML=`
    <p><b>Adresa:</b> ${item["Adresa"]||""}</p>
    <p><b>Telefon:</b> ${item["Telefon"]||""}</p>
    <p><b>E-mail:</b> ${item["Email"]||""}</p>
    <p><b>Popis:</b> ${item["Popis CZ"]||""}</p>
    <p><b>Vy≈ôe≈°eno:</b> ${item["Vy≈ôe≈°eno"]||"ANO"}</p>
  `;
  const gal=document.getElementById("photoGallery");gal.innerHTML="";
  ["Foto1","Foto2","Foto3","Foto4"].forEach(k=>{
    if(item[k]){const img=document.createElement("img");img.src=item[k];img.onclick=()=>openPhoto(img.src);gal.appendChild(img);}
  });
}

function closeDetail(){document.getElementById("detailModal").style.display="none";}
function openPhoto(src){document.getElementById("photoLarge").src=src;document.getElementById("photoView").style.display="flex";}

// P≈ôenos dat do protokolu
function openProtocol(){
  if(!currentItem) return;
  localStorage.setItem("selectedCustomer", JSON.stringify(currentItem));
  window.location.href = "protokol.html";
}

document.getElementById("searchInput").addEventListener("input",()=>renderTable(allData));
window.addEventListener("pageshow",loadHotove);
loadHotove();
</script>
</body>
</html>
