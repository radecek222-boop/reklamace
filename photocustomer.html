<!-- üü® ZAƒå√ÅTEK SEKCE 1/10 ‚Äì Z√ÅKLADN√ç STRUKTURA -->
<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Fotodokumentace / Photo documentation ‚Äì White Glove Service</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">

<style>
body{
  font-family:"Inter",system-ui,sans-serif;
  background:#f6f7fb;
  margin:0;
  padding:0;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  min-height:100vh;
}
.wrapper{
  background:#fff;
  padding:25px;
  margin:40px 15px;
  border-radius:12px;
  box-shadow:0 2px 8px rgba(0,0,0,0.1);
  width:100%;
  max-width:750px;
  box-sizing:border-box;
}
h1{ text-align:center;font-size:2.1em;font-weight:900;color:#111;margin:0 0 5px; }
h2{ text-align:center;font-size:1em;font-weight:500;color:#666;margin:0 0 20px; }

/* üîπ Box z√°kazn√≠ka */
#customerHeader{
  background:#f3f3f3;
  border:1px solid #ddd;
  border-radius:10px;
  padding:14px;
  margin-bottom:20px;
  text-align:left;
  box-shadow:0 1px 3px rgba(0,0,0,0.08);
}
#customerHeader p{ margin:6px 0; font-weight:600; }
#customerHeader span{ font-weight:400; color:#666; }

/* üü¢ WGS styl tlaƒç√≠tek */
.btn-wgs{
  display:inline-block;
  border:none;
  border-radius:8px;
  padding:10px 22px;
  color:#fff;
  font-weight:600;
  cursor:pointer;
  box-shadow:0 3px 8px rgba(0,0,0,0.15);
  transition:transform .15s ease,opacity .2s ease;
}
.btn-wgs:hover{ transform:scale(1.04);opacity:.9; }
.btn-green{ background:linear-gradient(135deg,#28a745,#60d06a); }
.btn-blue{ background:linear-gradient(135deg,#0046ff,#357aff); }
.btn-gray{ background:linear-gradient(135deg,#6c757d,#a0a4a7); }

/* üñºÔ∏è Fotobloky */
.photo-block{
  border:1px solid #ccc;
  border-radius:10px;
  padding:12px;
  margin-top:18px;
  background:linear-gradient(180deg,#f8f8f8 0%,#ececec 100%);
}
.photo-header{ display:flex;justify-content:space-between;align-items:center;margin-bottom:8px; }
.photo-header h4{ margin:0;font-size:1.05em;font-weight:700;color:#111; }
.photo-preview{ display:flex;flex-wrap:wrap;gap:10px; }
.photo-thumb{ width:90px;height:90px;border-radius:8px;object-fit:cover;box-shadow:0 2px 5px rgba(0,0,0,0.15);position:relative; }
.progress-bar{
  position:absolute;bottom:0;left:0;height:5px;width:0%;
  background:linear-gradient(90deg,#34d058,#22863a);
  border-radius:0 0 8px 8px;
  transition:width .3s ease;
}
.photo-remove{
  position:absolute;top:2px;right:2px;width:22px;height:22px;border:none;border-radius:50%;
  background:rgba(255,255,255,0.9);color:#d40000;font-weight:bold;cursor:pointer;
  line-height:18px;font-size:16px;box-shadow:0 1px 3px rgba(0,0,0,0.25);
}

/* Ulo≈æen√© fotografie */
.saved-photos{border:1px solid #ddd;border-radius:10px;background:#fafafa;margin-top:15px;padding:15px;}
.saved-section{margin-bottom:18px;}
.saved-section h4{font-size:1em;font-weight:700;margin-bottom:6px;color:#222;}
.saved-grid{display:flex;flex-wrap:wrap;gap:10px;}
.saved-thumb{width:90px;height:90px;border-radius:8px;object-fit:cover;box-shadow:0 2px 5px rgba(0,0,0,0.15);}
.placeholder{text-align:center;color:#777;font-size:.9em;padding:20px 0;}
</style>
</head>

<body>
<div class="wrapper">
<h1>WHITE GLOVE SERVICE</h1>
<h2>Fotodokumentace / Photo documentation</h2>

<!-- üßæ ≈†ed√Ω box se z√°kazn√≠kem -->
<div id="customerHeader">
  <p><b>ƒå√≠slo zak√°zky / Order number:</b> <span id="hCislo">‚Äì</span></p>
  <p><b>Z√°kazn√≠k / Customer:</b> <span id="hZakaznik">‚Äì</span></p>
  <p><b>Adresa / Address:</b> <span id="hAdresa">‚Äì</span></p>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  const d=JSON.parse(localStorage.getItem("currentCustomer")||"{}");
  if(d.zakaznik){
    document.getElementById("hCislo").textContent=d.cislo||"‚Äì";
    document.getElementById("hZakaznik").textContent=d.zakaznik;
    document.getElementById("hAdresa").textContent=d.adresa||"";
    document.getElementById("cislo").value=d.cislo||"";
    document.getElementById("zakaznik").value=d.zakaznik||"";
    document.getElementById("adresa").value=d.adresa||"";
  }
});
</script>

<form id="photoCustomerForm" novalidate>
<label><b>ƒå√≠slo zak√°zky / Order number:</b></label>
<input type="text" id="cislo" name="cislo" required placeholder="nap≈ô. NBU25 / e.g. NBU25"/>

<label><b>Z√°kazn√≠k / Customer:</b></label>
<input type="text" id="zakaznik" name="zakaznik" required placeholder="nap≈ô. Ji≈ô√≠ Nov√°k / e.g. John Doe"/>

<label><b>Adresa / Address:</b></label>
<input type="text" id="adresa" name="adresa" required placeholder="nap≈ô. Vinohradsk√° 120, Praha / e.g. Main Street 12"/>

<h3>Fotodokumentace / Photo documentation</h3>
<p style="font-size:.9em;color:#555;margin-bottom:10px;">
  <b>Ka≈æd√Ω blok umo≈æ≈àuje nahr√°t v√≠ce fotografi√≠.</b> Obr√°zky se automaticky zmen≈°√≠ a ulo≈æ√≠. / 
  Each section allows multiple photos ‚Äì images will be compressed and saved automatically.
</p>

<!-- üü© 4 bloky fotodokumentace -->
<div class="photo-block"><div class="photo-header"><h4><b>P≈ôed opravou</b> / Before repair</h4><button type="button" class="btn-wgs btn-gray" data-section="before">P≈ôidat / Add</button></div><div class="photo-preview" id="preview-before"></div></div>
<div class="photo-block"><div class="photo-header"><h4><b>ID ≈°t√≠tek</b> / ID label</h4><button type="button" class="btn-wgs btn-gray" data-section="id">P≈ôidat / Add</button></div><div class="photo-preview" id="preview-id"></div></div>
<div class="photo-block"><div class="photo-header"><h4><b>Bƒõhem opravy</b> / During repair</h4><button type="button" class="btn-wgs btn-gray" data-section="repair">P≈ôidat / Add</button></div><div class="photo-preview" id="preview-repair"></div></div>
<div class="photo-block"><div class="photo-header"><h4><b>Po opravƒõ</b> / After repair</h4><button type="button" class="btn-wgs btn-gray" data-section="after">P≈ôidat / Add</button></div><div class="photo-preview" id="preview-after"></div></div>

<input type="file" id="photoInput" accept="image/jpeg,image/png,image/heic" multiple hidden>

<script>
(function(){
const input=document.getElementById("photoInput");
const photoSections={before:[],id:[],repair:[],after:[]};
document.querySelectorAll(".btn-wgs[data-section]").forEach(b=>b.addEventListener("click",()=>{input.dataset.section=b.dataset.section;input.click();}));

// Komprese 180 px
async function compressImage(file,maxDim=180){
  const img=await createImageBitmap(file);
  let [w,h]=[img.width,img.height];
  if(w>h&&w>maxDim){h=Math.round(h*(maxDim/w));w=maxDim;}
  else if(h>w&&h>maxDim){w=Math.round(w*(maxDim/h));h=maxDim;}
  const c=document.createElement("canvas");c.width=w;c.height=h;
  const ctx=c.getContext("2d");ctx.drawImage(img,0,0,w,h);
  return await new Promise(r=>c.toBlob(r,"image/jpeg",0.85));
}

// Vykreslen√≠ preview
function renderPreviews(section){
  const c=document.getElementById("preview-"+section);c.innerHTML="";
  photoSections[section].forEach((p,i)=>{
    const wrap=document.createElement("div");wrap.style.position="relative";
    const img=document.createElement("img");img.src=p.url;img.className="photo-thumb";
    const bar=document.createElement("div");bar.className="progress-bar";bar.id=`bar-${section}-${i}`;
    const btn=document.createElement("button");btn.className="photo-remove";btn.textContent="√ó";
    btn.onclick=()=>{photoSections[section].splice(i,1);renderPreviews(section);};
    wrap.append(img,bar,btn);c.append(wrap);
  });
}

input.addEventListener("change",async()=>{
  const sec=input.dataset.section;if(!sec)return;
  for(const f of Array.from(input.files)){
    const blob=await compressImage(f);
    const url=URL.createObjectURL(blob);
    photoSections[sec].push({blob,url});
  }
  renderPreviews(sec);input.value="";
  saveToOrdersTemp();
});

// Ulo≈æen√≠ do orders.json
async function saveToOrdersTemp(){
  const cislo=document.getElementById("cislo").value.trim().toUpperCase();
  const zak=document.getElementById("zakaznik").value.trim();
  const adr=document.getElementById("adresa").value.trim();
  const all=Object.values(photoSections).flat();
  if(!cislo||!zak||!all.length)return;
  for(const [s,files] of Object.entries(photoSections)){
    for(const [i,p] of files.entries()){uploadPhoto(cislo,s,i,p);}
  }
}

async function uploadPhoto(cislo,section,index,p){
  const bar=document.getElementById(`bar-${section}-${index}`);
  const formData=new FormData();
  formData.append("file",p.blob,`${cislo}_${section}_${Date.now()}.jpg`);
  const xhr=new XMLHttpRequest();
  xhr.open("POST","https://wgs-token.72nvwf4pb2.workers.dev/orders",true);
  xhr.upload.onprogress=e=>{
    if(e.lengthComputable){
      const pr=Math.round((e.loaded/e.total)*100);
      bar.style.width=pr+"%";
    }
  };
  xhr.onload=()=>{
    if(xhr.status===200){bar.style.width="100%";bar.style.background="#2e7d32";}
    else{bar.style.background="#e63946";}
  };
  xhr.send(formData);
}
})();
</script>

<!-- üü© KONEC SEKCE 1‚Äì5 -->




  <!-- üü® ZAƒå√ÅTEK SEKCE 6/10 ‚Äì EXPORT DO PDF -->

<div class="actions" style="text-align:center;margin-top:30px;">
  <button type="button" id="btnExportPDF" class="btn-wgs btn-blue">
    Exportovat do PDF / Export to PDF
  </button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
(async function(){
  const { jsPDF } = window.jspdf;
  document.getElementById("btnExportPDF").addEventListener("click",async()=>{
    const cislo=document.getElementById("cislo").value.trim().toUpperCase();
    if(!cislo)return alert("Zadejte ƒç√≠slo zak√°zky / Enter order number.");

    const pdf=new jsPDF({orientation:"p",unit:"mm",format:"a4"});
    const w=pdf.internal.pageSize.getWidth();
    let y=20;

    pdf.setFont("helvetica","bold");pdf.setFontSize(18);
    pdf.text("WHITE GLOVE SERVICE",w/2,y,{align:"center"});y+=8;
    pdf.setFontSize(13);
    pdf.text(`Fotodokumentace / Photo documentation ‚Äì ${cislo}`,w/2,y,{align:"center"});y+=12;

    const res=await fetch("https://wgs-token.72nvwf4pb2.workers.dev/orders");
    const all=await res.json();
    const rec=all.find(r=>r.id===cislo);
    if(!rec)return alert("≈Ω√°dn√© fotografie nenalezeny / No photos found.");

    const secNames={before:"P≈ôed opravou / Before repair",id:"ID ≈°t√≠tek / ID label",repair:"Bƒõhem opravy / During repair",after:"Po opravƒõ / After repair"};
    for(const [sekce,list] of Object.entries(rec.sekce||{})){
      if(!list.length)continue;
      pdf.setFontSize(14);pdf.text(secNames[sekce]||sekce,10,y);y+=6;
      for(const name of list){
        const imgUrl=`https://raw.githubusercontent.com/radecek222-boop/reklamace/main/foto/${name}`;
        const img=new Image();img.crossOrigin="anonymous";img.src=imgUrl;
        await new Promise(r=>img.onload=r);
        const canvas=document.createElement("canvas");
        const ctx=canvas.getContext("2d");
        const scale=0.4;
        const iw=img.width*scale,ih=img.height*scale;
        canvas.width=iw;canvas.height=ih;
        ctx.drawImage(img,0,0,iw,ih);
        const dataUrl=canvas.toDataURL("image/jpeg",0.7);
        if(y+60>280){pdf.addPage();y=20;}
        pdf.addImage(dataUrl,"JPEG",10,y,90,60);
        y+=65;
      }
    }
    pdf.save(`Fotodokumentace_${cislo}.pdf`);
  });
})();
</script>

<!-- üü® KONEC SEKCE 6/10 ‚Äì EXPORT DO PDF -->





<!-- üü® ZAƒå√ÅTEK SEKCE 7/10 ‚Äì NOTIFIKACE -->

<div id="notif" class="notif"></div>
<style>
.notif{
  position:fixed;top:15px;left:50%;transform:translateX(-50%);
  min-width:260px;max-width:90%;padding:10px 18px;
  border-radius:10px;font-weight:600;font-size:.9em;color:#fff;
  text-align:center;box-shadow:0 4px 10px rgba(0,0,0,0.15);
  opacity:0;pointer-events:none;z-index:9999;
  transition:opacity .3s ease,transform .3s ease;
}
.notif.show{opacity:1;transform:translateX(-50%) translateY(0);}
.notif.success{background:linear-gradient(135deg,#00b56a,#00da80);}
.notif.error{background:linear-gradient(135deg,#e63946,#ff6b6b);}
</style>
<script>
(function(){
  const n=document.getElementById("notif");let t=null;
  window.showNotif=(type="success",text="Ulo≈æeno / Saved")=>{
    n.className=`notif ${type}`;n.textContent=text;n.classList.add("show");
    clearTimeout(t);t=setTimeout(()=>n.classList.remove("show"),2500);
  };
})();
</script>

<!-- üü® KONEC SEKCE 7/10 ‚Äì NOTIFIKACE -->





<!-- üü® ZAƒå√ÅTEK SEKCE 8/10 ‚Äì LOK√ÅLN√ç ULO≈ΩEN√ç + VALIDACE -->

<script>
(function(){
  const fields=["cislo","zakaznik","adresa"];
  const key="wgs_photo_data_v1";
  window.addEventListener("DOMContentLoaded",()=>{
    const s=JSON.parse(localStorage.getItem(key)||"{}");
    for(const f of fields){if(s[f])document.getElementById(f).value=s[f];}
  });
  fields.forEach(id=>document.getElementById(id).addEventListener("input",saveLocal));
  function saveLocal(){
    const o={};fields.forEach(f=>o[f]=document.getElementById(f).value.trim());
    localStorage.setItem(key,JSON.stringify(o));
  }
})();
</script>

<!-- üü® KONEC SEKCE 8/10 ‚Äì LOK√ÅLN√ç ULO≈ΩEN√ç + VALIDACE -->





<!-- üü® ZAƒå√ÅTEK SEKCE 9/10 ‚Äì OVL√ÅD√ÅN√ç -->

<div class="actions" style="text-align:center;margin:40px 0 10px;">
  <a href="index.html" class="btn-wgs btn-gray">Zpƒõt / Back</a>
  <button type="button" id="btnReload" class="btn-wgs btn-green">Naƒç√≠st ulo≈æen√© / Reload saved</button>
</div>

<script>
document.getElementById("btnReload").addEventListener("click",()=>{
  showNotif("success","Data obnovena / Data reloaded");
  setTimeout(()=>location.reload(),800);
});
</script>

<!-- üü® KONEC SEKCE 9/10 ‚Äì OVL√ÅD√ÅN√ç -->





<!-- üü® ZAƒå√ÅTEK SEKCE 10/10 ‚Äì FOOTER -->

<footer style="text-align:center;margin:25px 0 20px;font-size:0.8em;color:#888;">
  White Glove Service s.r.o. ‚Ä¢ ¬© 2025
</footer>

</form>
</div>
</body>
</html>

<!-- üü® KONEC SEKCE 10/10 ‚Äì FOOTER -->
