<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>P≈ôehled ‚Äì White Glove Service</title>
<style>
body {
  font-family: "Inter", system-ui, sans-serif;
  background: #f6f7fb;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
  color: #111;
}

.wrapper {
  background: #fff;
  padding: 30px;
  margin: 40px 15px;
  border-radius: 14px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 1100px;
  box-sizing: border-box;
  position: relative;
}

h1 {
  text-align: center;
  font-size: 2.2em;
  font-weight: 900;
  margin: 0;
  color: #111;
}
.sub {
  text-align: center;
  color: #666;
  margin-top: 6px;
  margin-bottom: 35px;
  font-size: 1em;
}

#logoutBtn {
  position: absolute;
  top: 15px;
  right: 20px;
  background: linear-gradient(135deg, #c2c2c2, #e2e2e2);
  border: none;
  border-radius: 8px;
  padding: 8px 16px;
  color: #333;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: background 0.3s ease;
}
#logoutBtn:hover {
  background: linear-gradient(135deg, #b6b6b6, #d6d6d6);
}

.top-bar {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
  gap: 12px;
  margin-bottom: 25px;
}

.btn {
  color: #fff;
  font-weight: 600;
  padding: 12px 26px;
  font-size: 0.95em;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
  transition: transform 0.1s ease-in-out, opacity 0.2s;
  text-decoration: none;
  min-width: 180px;
  text-align: center;
}
.btn:hover { transform: scale(1.04); opacity: 0.9; }

.btn-light { background: linear-gradient(135deg, #888, #b5b5b5); }
.btn-dark  { background: linear-gradient(135deg, #444, #707070); }

.info-box {
  background: linear-gradient(135deg, #ececec, #fafafa);
  border-radius: 10px;
  padding: 12px 20px;
  min-width: 180px;
  text-align: center;
  font-weight: 700;
  color: #333;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

#resultsTable {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
#resultsTable th, #resultsTable td {
  padding: 10px 8px;
  border-bottom: 1px solid #eee;
  text-align: left;
  font-size: 0.95em;
}
#resultsTable th {
  background: #f8f8f8;
  font-weight: 700;
  color: #333;
}
#resultsTable td:last-child {
  text-align: right;
}

.summary {
  margin-top: 25px;
  font-weight: 600;
  text-align: center;
  color: #444;
}

@media (max-width: 760px) {
  .btn, .info-box { min-width: unset; width: 100%; }
  .top-bar { flex-direction: column; }
}
</style>
</head>




  <!-- üü© SEKCE 2/5 ‚Äì OBSAH -->
<body>
  <div class="wrapper">
    <button id="logoutBtn">Odej√≠t</button>

    <h1>P≈ôehled WGS</h1>
    <div class="sub">Statistiky reklamac√≠ a servisn√≠ch zak√°zek</div>

    <!-- üîπ Horn√≠ panel -->
    <div class="top-bar">
      <button id="selectClientBtn" class="btn btn-light">Vyber zadavatele</button>
      <button id="selectPeriodBtn" class="btn btn-dark">Obdob√≠</button>
      <div id="infoObrat" class="info-box">Obrat: 0 Kƒç</div>
      <div id="infoPocet" class="info-box">Zak√°zek: 0</div>
    </div>

    <!-- üîπ Tabulka v√Ωsledk≈Ø -->
    <div id="resultsContainer">
      <table id="resultsTable">
        <thead>
          <tr>
            <th>Jm√©no z√°kazn√≠ka</th>
            <th>ƒå√≠slo reklamace</th>
            <th>Datum</th>
            <th>Zadavatel</th>
            <th>ƒå√°stka</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="5" style="text-align:center;color:#888;padding:20px;">Zat√≠m nejsou vybran√° ≈æ√°dn√° data</td></tr>
        </tbody>
      </table>
    </div>

    <!-- üîπ Shrnut√≠ -->
    <div id="summary" class="summary">
      Celkem zak√°zek v obdob√≠: 0  |  Celkov√Ω obrat: 0 Kƒç
    </div>
  </div>
</body>
<!-- üü® SEKCE 3/5 ‚Äì MOD√ÅLN√ç OKNA: ZADAVATEL + OBDOB√ç -->

<!-- üîπ MOD√ÅL PRO V√ùBƒöR ZADAVATEL≈Æ -->
<div id="clientModal" class="modal-overlay">
  <div class="modal-box">
    <h2>Vyber zadavatele</h2>
    <div id="loadingClients" class="loading">Naƒç√≠t√°m...</div>

    <div id="clientList" class="client-list" style="display:none;"></div>

    <div class="modal-actions">
      <button id="confirmClients" class="btn btn-dark">Potvrdit</button>
      <button id="closeClients" class="btn btn-light">Zav≈ô√≠t</button>
    </div>
  </div>
</div>

<!-- üîπ MOD√ÅL PRO V√ùBƒöR OBDOB√ç -->
<div id="periodModal" class="modal-overlay">
  <div class="modal-box">
    <h2>Vyber obdob√≠</h2>

    <div class="period-fields">
      <label>Od:</label>
      <input type="date" id="dateFrom">
      <label>Do:</label>
      <input type="date" id="dateTo">
    </div>

    <div class="modal-actions">
      <button id="confirmPeriod" class="btn btn-dark">Potvrdit</button>
      <button id="closePeriod" class="btn btn-light">Zav≈ô√≠t</button>
    </div>
  </div>
</div>

<style>
/* üé® Spoleƒçn√Ω styl mod√°ln√≠ch oken */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 4000;
  backdrop-filter: blur(4px);
  opacity: 0;
  transition: opacity .25s ease;
}
.modal-overlay.active {
  display: flex;
  opacity: 1;
}
.modal-box {
  background: rgba(40,40,40,0.95);
  color: #fff;
  padding: 40px 30px;
  border-radius: 14px;
  box-shadow: 0 4px 25px rgba(0,0,0,0.45);
  text-align: center;
  max-width: 380px;
  width: 90%;
  animation: fadeIn .3s ease;
}
.modal-box h2 {
  font-size: 1.3em;
  font-weight: 700;
  margin-top: 0;
  margin-bottom: 20px;
}
.modal-actions {
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
}
.loading {
  font-size: 1em;
  color: #ccc;
  padding: 10px;
}
.client-list {
  text-align: left;
  margin-bottom: 25px;
  max-height: 240px;
  overflow-y: auto;
  border-radius: 8px;
  background: rgba(255,255,255,0.08);
  padding: 10px;
}
.client-list label {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  font-size: 0.95em;
  cursor: pointer;
}
.client-list input {
  transform: scale(1.1);
}

/* üìÖ Styl pol√≠ obdob√≠ */
.period-fields {
  display: flex;
  flex-direction: column;
  gap: 12px;
  background: rgba(255,255,255,0.08);
  border-radius: 10px;
  padding: 15px 12px;
  margin-bottom: 20px;
}
.period-fields label {
  font-size: 0.9em;
  color: #ccc;
}
.period-fields input[type="date"] {
  width: 100%;
  background: #222;
  color: #fff;
  border: 1px solid #555;
  border-radius: 8px;
  padding: 10px;
  font-size: 1em;
  outline: none;
  box-sizing: border-box;
  transition: all 0.25s ease;
}
.period-fields input[type="date"]:focus {
  border-color: #00c851;
  box-shadow: 0 0 6px rgba(0,200,81,0.4);
}

/* ‚úÖ Animace potvrzen√≠ */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>

<script>
const selectClientBtn = document.getElementById("selectClientBtn");
const selectPeriodBtn = document.getElementById("selectPeriodBtn");

/* üü¢ Otev≈ôen√≠ mod√°lu pro zadavatele */
selectClientBtn.addEventListener("click", async () => {
  const modal = document.getElementById("clientModal");
  modal.classList.add("active");
  document.getElementById("loadingClients").style.display = "block";
  document.getElementById("clientList").style.display = "none";

  // Simulace naƒç√≠t√°n√≠ (v praxi se bude naƒç√≠tat z hotove.json)
  await new Promise(r => setTimeout(r, 600));

  const clients = [
    "Natuzzi Editions ‚Äì Strejƒçek",
    "Natuzzi Editions ‚Äì Vimrov√°",
    "Natuzzi Italia ‚Äì Bratislava",
    "Natuzzi Italia ‚Äì Jama",
    "Natuzzi Italia ‚Äì River",
    "Natuzzi Italia ‚Äì SOHO",
    "Softaly",
    "Phase ‚Äì Klucarova",
    "Phase ‚Äì Jancova",
    "WGS (Poz√°ruƒçn√≠ servis)",
    "Jin√©"
  ];

  const list = document.getElementById("clientList");
  list.innerHTML = clients.map(c =>
    `<label><input type="checkbox" value="${c}"> ${c}</label>`
  ).join("");

  document.getElementById("loadingClients").style.display = "none";
  list.style.display = "block";
});

/* üî¥ Zav≈ô√≠t v√Ωbƒõr zadavatel≈Ø */
document.getElementById("closeClients").addEventListener("click", () => {
  document.getElementById("clientModal").classList.remove("active");
});

/* üü¢ Potvrdit v√Ωbƒõr zadavatel≈Ø */
document.getElementById("confirmClients").addEventListener("click", () => {
  const checked = [...document.querySelectorAll("#clientList input:checked")].map(i => i.value);
  if (!checked.length) {
    alert("Vyberte alespo≈à jednoho zadavatele.");
    return;
  }
  localStorage.setItem("selectedClients", JSON.stringify(checked));

  const box = document.querySelector("#clientModal .modal-box");
  box.innerHTML = `<div style='font-size:2.2em;color:#00c851;'>‚úÖ</div><p>Ulo≈æeno</p>`;
  setTimeout(() => document.getElementById("clientModal").classList.remove("active"), 900);
});

/* üü¢ Otev≈ôen√≠ mod√°lu pro obdob√≠ */
selectPeriodBtn.addEventListener("click", () => {
  document.getElementById("periodModal").classList.add("active");
});

/* üî¥ Zav≈ô√≠t obdob√≠ */
document.getElementById("closePeriod").addEventListener("click", () => {
  document.getElementById("periodModal").classList.remove("active");
});

/* üü¢ Potvrdit obdob√≠ */
document.getElementById("confirmPeriod").addEventListener("click", () => {
  const from = document.getElementById("dateFrom").value;
  const to = document.getElementById("dateTo").value;
  if (!from || !to) {
    alert("Zadejte datum od i do.");
    return;
  }
  localStorage.setItem("selectedPeriod", JSON.stringify({ from, to }));

  const box = document.querySelector("#periodModal .modal-box");
  box.innerHTML = `<div style='font-size:2.2em;color:#00c851;'>‚úÖ</div><p>Obdob√≠ ulo≈æeno</p>`;
  setTimeout(() => document.getElementById("periodModal").classList.remove("active"), 900);
});
</script>
<!-- üüß SEKCE 4/5 ‚Äì NAƒå√çT√ÅN√ç DAT A ZOBRAZEN√ç -->
<script>
const resultsTable = document.querySelector("#resultsTable tbody");
const infoObrat = document.getElementById("infoObrat");
const infoPocet = document.getElementById("infoPocet");
const summaryBox = document.getElementById("summary");

let allOrders = [];

/* ================================
   üü© 1Ô∏è‚É£  Naƒçten√≠ hotove.json z GitHubu
================================ */
async function loadHotoveData() {
  try {
    const res = await fetch("https://radecek222-boop.github.io/reklamace/hotove.json?t=" + Date.now());
    if (!res.ok) throw new Error("Nepoda≈ôilo se naƒç√≠st hotove.json");
    allOrders = await res.json();
    console.log("‚úÖ Naƒçteno z GitHubu:", allOrders.length, "z√°znam≈Ø");
    renderFilteredResults();
  } catch (err) {
    console.error("‚ùå Chyba p≈ôi naƒç√≠t√°n√≠:", err);
    resultsTable.innerHTML = `<tr><td colspan="5" style="text-align:center;color:red;">Chyba naƒç√≠t√°n√≠ dat</td></tr>`;
  }
}

/* ================================
   üü© 2Ô∏è‚É£  Filtrace podle zadavatel≈Ø a obdob√≠
================================ */
function renderFilteredResults() {
  const selected = JSON.parse(localStorage.getItem("selectedClients") || "[]");
  const period = JSON.parse(localStorage.getItem("selectedPeriod") || "{}");

  if (!selected.length || !period.from || !period.to) {
    resultsTable.innerHTML = `<tr><td colspan="5" style="text-align:center;color:#777;padding:15px;">Vyberte zadavatele a obdob√≠</td></tr>`;
    return;
  }

  const fromDate = new Date(period.from);
  const toDate = new Date(period.to);
  let filtered = allOrders.filter(o => {
    const datum = new Date(o.datum_reklamace || o.datum || o.date || "2000-01-01");
    const inDate = datum >= fromDate && datum <= toDate;

    // üí° speci√°ln√≠ p≈ô√≠pad pro poz√°ruƒçn√≠ servis
    const kontrakt = o.contract || "";
    const isPozarucni = (o.typ || "").toLowerCase().includes("poz√°ruƒçn√≠");
    const inClient = selected.includes(kontrakt) || (selected.includes("WGS (Poz√°ruƒçn√≠ servis)") && isPozarucni);

    return inDate && inClient;
  });

  // Se≈ôazen√≠ podle data (novƒõj≈°√≠ naho≈ôe)
  filtered.sort((a, b) =>
    new Date(b.datum_reklamace || b.datum || "") - new Date(a.datum_reklamace || a.datum || "")
  );

  renderTable(filtered);
}

/* ================================
   üü© 3Ô∏è‚É£  Vykreslen√≠ tabulky
================================ */
function renderTable(arr) {
  if (!arr.length) {
    resultsTable.innerHTML = `<tr><td colspan="5" style="text-align:center;color:#999;padding:15px;">≈Ω√°dn√© zak√°zky v tomto obdob√≠</td></tr>`;
    infoObrat.textContent = "Obrat: 0 Kƒç";
    infoPocet.textContent = "Zak√°zek: 0";
    summaryBox.textContent = "Celkem zak√°zek: 0 | Celkov√Ω obrat: 0 Kƒç";
    return;
  }

  let totalSum = 0;
  const rows = arr.map(o => {
    const zakaznik = o.zakaznik || o["Jm√©no a p≈ô√≠jmen√≠ z√°kazn√≠ka"] || "-";
    const cislo = o.cislo || "-";
    const datum = o.datum_reklamace || o.datum || "-";
    const contract = o.contract || "-";
    const cena = parseFloat(o.cenaCelkem || o.total || 0);
    totalSum += cena;

    return `
      <tr>
        <td>${zakaznik}</td>
        <td>${cislo}</td>
        <td>${datum}</td>
        <td>${contract}</td>
        <td>${cena.toLocaleString("cs-CZ")} Kƒç</td>
      </tr>`;
  }).join("");

  resultsTable.innerHTML = rows;

  // üìä Aktualizace horn√≠ch box≈Ø
  infoObrat.textContent = `Obrat: ${totalSum.toLocaleString("cs-CZ")} Kƒç`;
  infoPocet.textContent = `Zak√°zek: ${arr.length}`;
  summaryBox.textContent =
    `Celkem zak√°zek v obdob√≠: ${arr.length} | Celkov√Ω obrat: ${totalSum.toLocaleString("cs-CZ")} Kƒç`;
}

/* ================================
   üü© 4Ô∏è‚É£  Automatick√© naƒçten√≠ po zmƒõnƒõ v√Ωbƒõru
================================ */
window.addEventListener("DOMContentLoaded", loadHotoveData);

// Kdykoliv se zmƒõn√≠ v√Ωbƒõr ‚Üí obnov√≠ se v√Ωpis
window.addEventListener("storage", e => {
  if (["selectedClients", "selectedPeriod"].includes(e.key)) {
    renderFilteredResults();
  }
});
</script>
<!-- üü™ SEKCE 5/5 ‚Äì ANIMACE A INTERAKCE -->
<style>
/* üåÄ Animace naƒç√≠t√°n√≠ tabulky */
.loading-row td {
  text-align: center;
  padding: 18px;
  color: #777;
  animation: blinkLoading 1.2s infinite;
}
@keyframes blinkLoading {
  0%,100% { opacity: 0.4; }
  50% { opacity: 1; }
}

/* ‚ú® Zv√Ωraznƒõn√≠ aktualizace banner≈Ø */
.info-box {
  transition: background 0.4s ease, transform 0.25s ease;
}
.info-box.flash {
  background: linear-gradient(135deg, #d0ffd8, #ffffff);
  transform: scale(1.05);
}

/* ‚öôÔ∏è Jemn√© fade-in tabulky p≈ôi zmƒõnƒõ */
#resultsTable tbody {
  transition: opacity 0.3s ease;
}
#resultsTable.fadeout tbody {
  opacity: 0.4;
}
</style>

<script>
/* üïì Zobraz√≠ "Naƒç√≠t√°m..." ne≈æ se data p≈ôiprav√≠ */
function showLoading() {
  resultsTable.innerHTML = `
    <tr class="loading-row">
      <td colspan="5">Naƒç√≠t√°m data...</td>
    </tr>`;
}

/* üí° Bliknut√≠ p≈ôi aktualizaci banner≈Ø */
function flashBox(el) {
  el.classList.add("flash");
  setTimeout(() => el.classList.remove("flash"), 700);
}

/* üåÄ Vylep≈°en√≠ funkce renderTable ‚Äì s animacemi */
function renderTable(arr) {
  const tbody = resultsTable;
  document.querySelector("#resultsTable").classList.add("fadeout");
  showLoading();

  setTimeout(() => {
    document.querySelector("#resultsTable").classList.remove("fadeout");

    if (!arr.length) {
      tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;color:#888;padding:15px;">≈Ω√°dn√© zak√°zky v tomto obdob√≠</td></tr>`;
      infoObrat.textContent = "Obrat: 0 Kƒç";
      infoPocet.textContent = "Zak√°zek: 0";
      summaryBox.textContent = "Celkem zak√°zek: 0 | Celkov√Ω obrat: 0 Kƒç";
      return;
    }

    let totalSum = 0;
    const rows = arr.map(o => {
      const zakaznik = o.zakaznik || o["Jm√©no a p≈ô√≠jmen√≠ z√°kazn√≠ka"] || "-";
      const cislo = o.cislo || "-";
      const datum = o.datum_reklamace || o.datum || "-";
      const contract = o.contract || "-";
      const cena = parseFloat(o.cenaCelkem || o.total || 0);
      totalSum += cena;
      return `
        <tr>
          <td>${zakaznik}</td>
          <td>${cislo}</td>
          <td>${datum}</td>
          <td>${contract}</td>
          <td>${cena.toLocaleString("cs-CZ")} Kƒç</td>
        </tr>`;
    }).join("");

    tbody.innerHTML = rows;

    // üìä Aktualizace banner≈Ø + animace
    infoObrat.textContent = `Obrat: ${totalSum.toLocaleString("cs-CZ")} Kƒç`;
    infoPocet.textContent = `Zak√°zek: ${arr.length}`;
    flashBox(infoObrat);
    flashBox(infoPocet);

    summaryBox.textContent =
      `Celkem zak√°zek v obdob√≠: ${arr.length} | Celkov√Ω obrat: ${totalSum.toLocaleString("cs-CZ")} Kƒç`;
  }, 350);
}

/* üö™ Tlaƒç√≠tko Odej√≠t zpƒõt na index */
document.getElementById("logoutBtn").addEventListener("click", () => {
  window.location.href = "index.html";
});
</script>
</html>
