<!-- 
====================================================================
üíé WHITE GLOVE SERVICE ‚Äì P≈òEHLED / STATISTIKY (BETA 2)
====================================================================
Verze syst√©mu:       v1.1
Datum sestaven√≠:     2025-10-08
Autor:               Hugo (White Glove Service) & GPT-5
Projekt:             WGS reklamace / servisn√≠ p≈ôehledy
Soubory:             prehled.html, prehled.json
Repozit√°≈ô:           https://github.com/radecek222-boop/reklamace
Popis:
  Administrativn√≠ p≈ôehled zak√°zek, v√Ωdƒõlk≈Ø technik≈Ø a obratu.
  - chr√°nƒõno heslem (Mikes332018)
  - filtrov√°n√≠ podle obdob√≠ a typu zak√°zky
  - statistiky podle zadavatele a technika
====================================================================
-->

<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>P≈ôehled ‚Äì White Glove Service</title>
<style>
body{
  font-family:"Inter",system-ui,sans-serif;
  background:#f6f7fb;margin:0;padding:0;
  display:flex;justify-content:center;align-items:flex-start;
  min-height:100vh;
}
.wrapper{
  background:#fff;padding:25px;margin:40px 15px;
  border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);
  width:100%;max-width:900px;box-sizing:border-box;
}
h1{text-align:center;font-size:2em;font-weight:900;margin:0 0 8px;}
h2{text-align:center;font-size:1em;color:#666;margin:0 0 25px;}
.actions{
  text-align:center;margin-bottom:20px;
  display:flex;justify-content:center;gap:15px;flex-wrap:wrap;
}
.btn{
  padding:10px 22px;border:none;border-radius:8px;
  font-weight:600;font-size:1em;color:white;
  box-shadow:0 3px 8px rgba(0,0,0,0.15);
  cursor:pointer;transition:transform .15s,opacity .2s;
}
.btn:hover{transform:scale(1.04);opacity:.9;}
.btn-admin{background:linear-gradient(135deg,#0046ff,#357aff);}
.btn-filter{background:linear-gradient(135deg,#28a745,#5bd85b);}
.btn-back{background:linear-gradient(135deg,#6c757d,#a0a4a7);}
.hidden{display:none;}
.filter-bar{
  display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-bottom:20px;
}
select,input[type="date"]{
  padding:6px 10px;font-size:0.9em;border:1px solid #ccc;border-radius:6px;
}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{padding:8px;border-bottom:1px solid #eee;text-align:left;font-size:.9em;}
th{background:#f8f8f8;font-weight:700;}
tr:hover{background:#f1f6ff;}
.loading{text-align:center;padding:30px;color:#666;}
.login-dialog{
  text-align:center;padding:20px;margin-top:30px;
  background:#f8f8f8;border-radius:10px;box-shadow:0 1px 6px rgba(0,0,0,0.1);
}
.login-dialog input{
  padding:8px 10px;font-size:1em;border:1px solid #ccc;border-radius:6px;margin-bottom:10px;
}
</style>
</head>
<body>
<div class="wrapper">
  <!-- üü® B ‚Äì HLAVIƒåKA -->
  <h1>WHITE GLOVE SERVICE</h1>
  <h2>P≈ôehled zak√°zek a statistik</h2>
  <div class="actions">
    <a href="index.html" class="btn btn-back">Zpƒõt</a>
    <button id="adminBtn" class="btn btn-admin">P≈ôej√≠t na statistiku</button>
  </div>

  <!-- üü® C ‚Äì P≈òIHL√Å≈†EN√ç -->
  <div id="loginSection" class="login-dialog hidden">
    <p>Zadejte heslo pro p≈ô√≠stup:</p>
    <input type="password" id="adminPass" placeholder="Heslo">
    <br>
    <button id="loginBtn" class="btn btn-admin">P≈ôihl√°sit</button>
  </div>

  <!-- üü® D ‚Äì FILTRY -->
  <div id="filters" class="filter-bar hidden">
    <select id="periodSelect">
      <option value="week">Posledn√≠ t√Ωden</option>
      <option value="month">Posledn√≠ mƒõs√≠c</option>
      <option value="year">Posledn√≠ rok</option>
      <option value="all" selected>V≈°e</option>
    </select>
    <label>Od: <input type="date" id="dateFrom"></label>
    <label>Do: <input type="date" id="dateTo"></label>
    <select id="typeSelect">
      <option value="all" selected>V≈°echny typy</option>
      <option value="reklamace">Reklamace</option>
      <option value="poz√°ruƒçn√≠">Poz√°ruƒçn√≠ servis</option>
    </select>
    <button class="btn btn-filter" id="applyFilter">Zobrazit</button>
  </div>

  <!-- üü® E ‚Äì TABULKY -->
  <div id="statsContent" class="hidden">
    <h3>üì¶ P≈ôehled podle zadavatele</h3>
    <div id="byClient" class="loading">Naƒç√≠t√°m...</div>

    <h3>üí∞ Souhrn √∫ƒçtovan√Ωch slu≈æeb</h3>
    <div id="byRevenue" class="loading">Naƒç√≠t√°m...</div>

    <h3>üë®‚Äçüîß V√Ωdƒõlky technik≈Ø</h3>
    <div id="byTechnician" class="loading">Naƒç√≠t√°m...</div>
  </div>

  <!-- üü® F ‚Äì SCRIPTY -->
  <script>
  let allData=[];

  // üîí P≈ôihl√°≈°en√≠
  adminBtn.onclick=()=>loginSection.classList.remove("hidden");
  loginBtn.onclick=()=>{
    if(adminPass.value.trim()==="Mikes332018"){
      loginSection.classList.add("hidden");
      filters.classList.remove("hidden");
      statsContent.classList.remove("hidden");
      loadStats();
    }else alert("Nespr√°vn√© heslo!");
  };

  // üì• Naƒçten√≠ dat
  async function loadStats(){
    try{
      const res=await fetch("prehled.json?t="+Date.now());
      allData=await res.json();
      renderStats();
    }catch(e){
      console.error(e);
      byClient.innerText="‚ùå Chyba naƒç√≠t√°n√≠ dat";
    }
  }

  applyFilter.onclick=renderStats;

  // üßÆ Filtr + v√Ωpoƒçet statistik
  function renderStats(){
    if(!allData.length) return;
    const type=typeSelect.value;
    const now=new Date();
    let from,to;
    const period=periodSelect.value;

    // obdob√≠
    switch(period){
      case"week":from=new Date(now);from.setDate(now.getDate()-7);break;
      case"month":from=new Date(now);from.setMonth(now.getMonth()-1);break;
      case"year":from=new Date(now);from.setFullYear(now.getFullYear()-1);break;
      default:from=new Date("2000-01-01");
    }
    to=now;

    // pokud jsou ruƒçnƒõ zad√°na data
    if(dateFrom.value) from=new Date(dateFrom.value);
    if(dateTo.value) to=new Date(dateTo.value);

    // filtrov√°n√≠
    const filtered=allData.filter(r=>{
      const d=new Date(r.datum||r.date||r.visit||"2000-01-01");
      const inDate=d>=from && d<=to;
      const inType=(type==="all" || (r.typ||"").toLowerCase().includes(type));
      return inDate && inType;
    });

    if(!filtered.length){
      byClient.innerHTML=byRevenue.innerHTML=byTechnician.innerHTML=
        "<div class='loading'>≈Ω√°dn√© z√°znamy v tomto obdob√≠</div>";
      return;
    }

    // v√Ωpoƒçty
    const byClient={},byTech={}; let total=0;
    filtered.forEach(r=>{
      const client=r.contract||"Nezn√°m√Ω";
      const tech=r.technician||r.technik||"Neuvedeno";
      const price=parseFloat(r.total||r.cenaCelkem||0);
      byClient[client]=(byClient[client]||0)+price;
      byTech[tech]=(byTech[tech]||0)+price;
      total+=price;
    });

    byClient.innerHTML=makeTable(byClient,"Zadavatel","Celkem [Kƒç]");
    byRevenue.innerHTML=`<b>Celkov√Ω obrat:</b> ${total.toLocaleString("cs-CZ")} Kƒç`;
    byTechnician.innerHTML=makeTable(byTech,"Technik","V√Ωdƒõlek [Kƒç]");
  }

  function makeTable(obj,a,b){
    let h="<table><tr><th>"+a+"</th><th>"+b+"</th></tr>";
    for(const[k,v]of Object.entries(obj)){
      h+=`<tr><td>${k}</td><td>${v.toLocaleString("cs-CZ")} Kƒç</td></tr>`;
    }
    return h+"</table>";
  }
  </script>
</div>
</body>
</html>
