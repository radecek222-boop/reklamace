<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WHITE GLOVE SERVICE – Protokol</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      margin:0;
      padding:20px;
      background:#f6f7fb;
      font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif;
      color:#111;
    }
    h1 {
      text-align:center;
      font-size:2em;
      font-weight:900;
      margin-bottom:20px;
    }
    form {
      max-width:800px;
      margin:0 auto;
      background:#fff;
      padding:20px;
      border-radius:8px;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
    }
    label { display:block; margin-top:10px; font-weight:600; }
    input, textarea {
      width:100%;
      padding:8px;
      margin-top:5px;
      border:1px solid #ccc;
      border-radius:6px;
      font-size:1em;
    }

    /* tlačítka */
    .btn {
      background:#6c757d;
      color:#fff;
      padding:10px 20px;
      margin:10px 5px 0 0;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-size:1em;
      box-shadow:0 2px 5px rgba(0,0,0,0.15);
    }
    .btn:hover { background:#5a6268; }

    .save-btn {
      background:#28a745;
      color:#fff;
      padding:10px 20px;
      margin:10px 5px 0 0;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-size:1em;
      font-weight:600;
      box-shadow:0 2px 5px rgba(0,0,0,0.2);
    }
    .save-btn:hover { background:#218838; }

    /* podpis */
    #signature-pad {
      border:1px solid #ccc;
      border-radius:6px;
      width:100%;
      height:200px;
      margin-top:10px;
      touch-action: none;
    }
  </style>
</head>
<body>
  <h1>Servisní protokol</h1>

  <form id="protocolForm">
    <label>Zákazník</label>
    <input type="text" id="customer">

    <label>Adresa</label>
    <input type="text" id="address">

    <label>Kontakt</label>
    <input type="text" id="kontakt">

    <label>Popis reklamace / opravy</label>
    <textarea id="description" rows="4"></textarea>

    <label>Podpis zákazníka</label>
    <canvas id="signature-pad"></canvas>
    <button type="button" class="btn" onclick="clearSignature()">Vymazat podpis</button>

    <br><br>
    <button type="button" class="save-btn" onclick="savePDF()">Uložit protokol do PDF</button>
    <button type="button" class="btn" onclick="location.href='seznam.html'">Zpět na seznam</button>
    <button type="button" class="btn" onclick="location.href='index.html'">Zpět na hlavní stránku</button>
  </form>

<script>
const canvas = document.getElementById("signature-pad");
const ctx = canvas.getContext("2d");
let drawing = false;

// --- kreslení podpisu ---
canvas.addEventListener("mousedown", startDraw);
canvas.addEventListener("mousemove", draw);
canvas.addEventListener("mouseup", endDraw);
canvas.addEventListener("mouseout", endDraw);

canvas.addEventListener("touchstart", startDraw);
canvas.addEventListener("touchmove", draw);
canvas.addEventListener("touchend", endDraw);

function getPos(e){
  const rect = canvas.getBoundingClientRect();
  if (e.touches){
    return {
      x: e.touches[0].clientX - rect.left,
      y: e.touches[0].clientY - rect.top
    };
  } else {
    return {
      x: e.clientX - rect.left,
      y: e.clientY - rect.top
    };
  }
}

function startDraw(e){
  e.preventDefault();
  drawing = true;
  ctx.beginPath();
  const pos = getPos(e);
  ctx.moveTo(pos.x, pos.y);
}

function draw(e){
  if(!drawing) return;
  e.preventDefault();
  const pos = getPos(e);
  ctx.lineTo(pos.x, pos.y);
  ctx.strokeStyle = "#000";
  ctx.lineWidth = 2;
  ctx.stroke();
}

function endDraw(e){
  if(!drawing) return;
  drawing = false;
}

function clearSignature(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
}

// --- generování PDF ---
async function savePDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const customer = document.getElementById("customer").value;
  const address = document.getElementById("address").value;
  const kontakt = document.getElementById("kontakt").value;
  const description = document.getElementById("description").value;

  doc.setFont("helvetica","bold");
  doc.setFontSize(16);
  doc.text("Servisní protokol", 105, 20, {align:"center"});

  doc.setFontSize(12);
  doc.setFont("helvetica","normal");
  doc.text("Zákazník: " + customer, 20, 40);
  doc.text("Adresa: " + address, 20, 50);
  doc.text("Kontakt: " + kontakt, 20, 60);

  doc.text("Popis reklamace / opravy:", 20, 80);
  doc.setFont("helvetica","italic");
  doc.text(description, 20, 90, {maxWidth:170});

  doc.setFont("helvetica","normal");
  doc.text("Podpis zákazníka:", 20, 130);

  // podpis jako obrázek
  const signatureImg = canvas.toDataURL("image/png");
  if (signatureImg){
    doc.addImage(signatureImg, "PNG", 20, 135, 80, 40);
  }

  // uložit
  doc.save("protokol.pdf");
}
</script>
</body>
</html>
