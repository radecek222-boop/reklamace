<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Protokol - White Glove Service</title>
<style>
body { font-family: Inter, sans-serif; background:#f6f7fb; margin:0; padding:20px; font-size:12px; display:flex; justify-content:center; }
.wrapper { width:100%; max-width:900px; background:white; padding:20px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
.header { text-align:center; margin-bottom:20px; }
.header div:first-child { font-size:28px; font-weight:900; }
.header div:last-child { font-size:12px; margin-top:4px; font-weight:normal; }
table { width:100%; border-collapse:collapse; margin:10px 0; }
td { padding:6px; vertical-align:top; }
.label { font-weight:600; display:block; }
.label .en-label { display:block; font-size:0.85em; color:#666; font-weight:normal; margin:0; }
.section-title { font-weight:700; margin-top:20px; display:flex; flex-direction:column; align-items:flex-start; }
.section-title .en-label { font-size:0.9em; color:#666; font-weight:normal; margin-top:2px; }

input, select { width:100%; height:36px; line-height:36px; padding:4px 8px; font-size:1em; border:1px solid #ccc; border-radius:4px; box-sizing:border-box; color:#111; background:#fff; }
textarea { width:100%; min-height:80px; resize:vertical; padding:4px 8px; font-size:1em; border:1px solid #ccc; border-radius:4px; box-sizing:border-box; color:#111; background:#fff; }

.split-section { display:flex; gap:10px; margin:10px 0; }
.two-col-table { display:flex; gap:30px; flex-wrap:wrap; }
.two-col-table .col { flex:1; min-width:300px; }

#signature-pad { border:2px dashed #888; width:100%; height:200px; background:white; touch-action: none; }
.signature-label { font-size:0.9em; color:#444; margin:4px 0 20px; }

.btns { margin-top:20px; display:grid; grid-template-columns: repeat(2, 1fr); gap:12px; }
.btns button { height:42px; font-size:0.9em; border:none; border-radius:8px; cursor:pointer; font-weight:600; color:white; box-shadow:0 2px 5px rgba(0,0,0,0.2); display:flex; align-items:center; justify-content:center; gap:8px; transition:transform 0.1s ease-in-out, box-shadow 0.2s; width:100%; }
.btns button:hover { transform:scale(1.02); box-shadow:0 4px 8px rgba(0,0,0,0.3); }

.btn-clear { background: linear-gradient(145deg, #7a0f0f, #ff4d4d, #a83232); }
.btn-back { background: linear-gradient(145deg, #808080, #dcdcdc, #a9a9a9); color:#000; }
.btn-back svg { width:20px; height:20px; fill:#000; }
.btn-pdf { background: linear-gradient(145deg, #004080, #1e90ff, #003366); }
.btn-email { background: linear-gradient(145deg, #006600, #28a745, #004d00); }

/* Mobiln√≠ p≈ôizp≈Øsoben√≠ */
@media screen and (max-width:768px){
  .two-col-table, .split-section { flex-direction: column !important; gap:10px; }
  .two-col-table .col, .split-section textarea { min-width:auto; width:100%; }
  input, select, textarea { font-size:1em; height:36px; box-sizing:border-box; }
  textarea { min-height:80px; }
  #signature-pad { height:180px; }
}

/* Force desktop pro PDF export */
.force-desktop { width:794px !important; max-width:794px !important; }
</style>
</head>
<body>
<div class="wrapper">
  <div class="header">
    <div>WHITE GLOVE SERVICE</div>
    <div>Do Dubƒçe 364, Bƒõchovice 190 11 ¬∑ +420 725 965 826 ¬∑ reklamace-wgs@email.cz ¬∑ IƒåO: 09769684</div>
  </div>

  <div class="two-col-table">
    <div class="col">
      <table>
        <tr><td class="label">ƒå√≠slo objedn√°vky<span class="en-label">Order number</span></td><td><input id="order-number"></td></tr>
        <tr><td class="label">ƒå√≠slo reklamace<span class="en-label">Claim number</span></td><td><input id="claim-number"></td></tr>
        <tr><td class="label">Z√°kazn√≠k<span class="en-label">Customer</span></td><td><input id="customer"></td></tr>
        <tr><td class="label">Adresa z√°kazn√≠ka<span class="en-label">Customer address</span></td><td><input id="address"></td></tr>
        <tr><td class="label">Telefon<span class="en-label">Phone</span></td><td><input id="phone"></td></tr>
        <tr><td class="label">Email<span class="en-label">Email</span></td><td><input id="email"></td></tr>
      </table>
    </div>
    <div class="col">
      <table>
        <tr><td class="label">Technik<span class="en-label">Technician</span></td><td>
          <select id="technician">
            <option>Milan Kol√≠n</option>
            <option>Radek Zikmund</option>
            <option>Kol√≠n/Zikmund</option>
          </select>
        </td></tr>
        <tr><td class="label">Datum n√°v≈°tƒõvy<span class="en-label">Visit date</span></td><td><input id="visit-date" type="date"></td></tr>
        <tr><td class="label">Datum doruƒçen√≠<span class="en-label">Delivery date</span></td><td><input id="delivery-date" type="date"></td></tr>
        <tr><td class="label">Datum pod√°n√≠ reklamace<span class="en-label">Complaint date</span></td><td><input id="claim-date" type="date"></td></tr>
        <tr><td class="label">Znaƒçka / Contract<span class="en-label">Brand / Contract</span></td><td><input id="brand"></td></tr>
        <tr><td class="label">Model<span class="en-label">Model</span></td><td><input id="model"></td></tr>
      </table>
    </div>
  </div>

  <div class="section-title">Z√°kazn√≠k reklamuje<span class="en-label">Customer complaint</span></div>
  <div class="split-section">
    <textarea id="description-cz" placeholder="CZ" oninput="autoTranslate('description-cz','description-en')"></textarea>
    <textarea id="description-en" placeholder="EN"></textarea>
  </div>

  <div class="section-title">Probl√©m zji≈°tƒõn√Ω technikem<span class="en-label">Detected problem</span></div>
  <div class="split-section">
    <textarea id="problem-cz" placeholder="CZ" oninput="autoTranslate('problem-cz','problem-en')"></textarea>
    <textarea id="problem-en" placeholder="EN"></textarea>
  </div>

  <div class="section-title">N√°vrh opravy<span class="en-label">Repair proposal</span></div>
  <div class="split-section">
    <textarea id="repair-cz" placeholder="CZ" oninput="autoTranslate('repair-cz','repair-en')"></textarea>
    <textarea id="repair-en" placeholder="EN"></textarea>
  </div>
  <div class="two-col-table">
    <div class="col">
      <table>
        <tr><td class="label">Poƒçet opravovan√Ωch d√≠l≈Ø<span class="en-label">Number of repaired parts</span></td><td><input id="parts"></td></tr>
        <tr><td class="label">Cena za pr√°ci<span class="en-label">Work cost</span></td><td><input id="price-work"></td></tr>
        <tr><td class="label">Cena za materi√°l<span class="en-label">Material cost</span></td><td><input id="price-material"></td></tr>
        <tr><td class="label">Cena za druh√©ho technika<span class="en-label">Second technician cost</span></td><td><input id="price-second"></td></tr>
        <tr><td class="label">Cena za dopravu<span class="en-label">Transport cost</span></td><td><input id="price-transport"></td></tr>
        <tr><td class="label">Cena celkem<span class="en-label">Total cost</span></td><td><input id="price-total"></td></tr>
      </table>
    </div>
    <div class="col">
      <table>
        <tr><td class="label">Reklamace vy≈ôe≈°ena?<span class="en-label">Complaint solved?</span></td><td><select id="solved"><option>ANO</option><option>NE</option></select></td></tr>
        <tr><td class="label">ƒåek√° se na vyj√°d≈ôen√≠ prodejce?<span class="en-label">Waiting for dealer statement?</span></td><td><select id="dealer"><option>NE</option><option>ANO</option></select></td></tr>
        <tr><td class="label">Po≈°kozen√≠ technikem?<span class="en-label">Damage by technician?</span></td><td><select id="damage"><option>NE</option><option>ANO</option></select></td></tr>
        <tr><td class="label">√öhradu provede z√°kazn√≠k?<span class="en-label">Customer will pay?</span></td><td><select id="payment"><option>NE</option><option>ANO</option></select></td></tr>
        <tr><td class="label">Datum podpisu<span class="en-label">Signature date</span></td><td><input id="sign-date" type="date"></td></tr>
      </table>
    </div>
  </div>

  <div class="section-title">Podpis z√°kazn√≠ka<span class="en-label">Customer signature</span></div>
  <canvas id="signature-pad"></canvas>
  <div class="signature-label">Podepi≈°te se prstem nebo my≈°√≠</div>

  <div class="btns">
    <button class="btn-clear" type="button" onclick="signaturePad.clear()">üóëÔ∏è Vymazat podpis</button>
    <button class="btn-back" type="button" onclick="window.location.href='index.html'">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
      ZPƒöT
    </button>
    <button class="btn-pdf" type="button" onclick="downloadPDF()">üìÑ Exportovat do PDF</button>
    <button class="btn-email" type="button" onclick="saveAndMail()">‚úâÔ∏è Odeslat e-mail z√°kazn√≠kovi</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
let signaturePad;
let lastPdfName = "protokol.pdf";

window.addEventListener("DOMContentLoaded", () => {
  const canvas = document.getElementById("signature-pad");
  function resizeCanvas() { canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight; }
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas, { passive: true });
  signaturePad = new SignaturePad(canvas, { backgroundColor: "white" });
  const today = new Date().toISOString().split("T")[0];
  document.getElementById("visit-date").value = today;
  document.getElementById("sign-date").value = today;
});

function stripDiacritics(str){ return (str||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"_").replace(/[<>:"/\\|?*\u0000-\u001F]/g,"-"); }
function buildPdfFileName(){ 
  const today = new Date().toISOString().split("T")[0];
  const customer = stripDiacritics(document.getElementById("customer").value || "neznamy_zakaznik");
  const claim = stripDiacritics(document.getElementById("claim-number").value || "bez_claimu");
  const order = stripDiacritics(document.getElementById("order-number").value || "bez_objednavky");
  return `${customer}_${claim}_${order}_${today}.pdf`;
}

function generatePdf(callback){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p","mm","a4");
  const lineHeight = 7;
  let y = 20;

  // Horn√≠ hlaviƒçka
  doc.setFontSize(18); doc.setFont("helvetica","bold");
  doc.text("WHITE GLOVE SERVICE", 105, y, {align:"center"});
  y += lineHeight*2;
  doc.setFontSize(10); doc.setFont("helvetica","normal");
  doc.text("Do Dubƒçe 364, Bƒõchovice 190 11 ¬∑ +420 725 965 826 ¬∑ reklamace-wgs@email.cz ¬∑ IƒåO: 09769684", 105, y, {align:"center"});
  y += lineHeight*2;

  doc.setFontSize(12);

  // Funkce pro kreslen√≠ text + label
  function drawField(label, value){
    doc.setFont("helvetica","bold"); doc.text(label+":", 10, y);
    doc.setFont("helvetica","normal"); doc.text(value||"", 60, y);
    y += lineHeight;
  }

  drawField("ƒå√≠slo objedn√°vky", document.getElementById("order-number").value);
  drawField("ƒå√≠slo reklamace", document.getElementById("claim-number").value);
  drawField("Z√°kazn√≠k", document.getElementById("customer").value);
  drawField("Adresa z√°kazn√≠ka", document.getElementById("address").value);
  drawField("Telefon", document.getElementById("phone").value);
  drawField("Email", document.getElementById("email").value);
  drawField("Technik", document.getElementById("technician").value);
  drawField("Datum n√°v≈°tƒõvy", document.getElementById("visit-date").value);
  drawField("Datum doruƒçen√≠", document.getElementById("delivery-date").value);
  drawField("Datum pod√°n√≠ reklamace", document.getElementById("claim-date").value);
  drawField("Znaƒçka / Contract", document.getElementById("brand").value);
  drawField("Model", document.getElementById("model").value);

  // Textov√° pole: description, problem, repair
  function drawTextarea(label, value){
    doc.setFont("helvetica","bold"); doc.text(label+":", 10, y);
    doc.setFont("helvetica","normal");
    const lines = doc.splitTextToSize(value||"", 180);
    doc.text(lines, 10, y+lineHeight);
    y += lines.length*lineHeight + lineHeight;
  }

  drawTextarea("Z√°kazn√≠k reklamuje", document.getElementById("description-cz").value);
  drawTextarea("Probl√©m zji≈°tƒõn√Ω technikem", document.getElementById("problem-cz").value);
  drawTextarea("N√°vrh opravy", document.getElementById("repair-cz").value);
