<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Protokol - White Glove Service</title>
  <style>
    body {
      font-family: Inter, sans-serif;
      background:#f6f7fb;
      margin:0;
      padding: 20px;
      font-size:12px;
      display: flex;
      justify-content: center;
    }
    .wrapper {
      width: 100%;
      max-width: 900px;
      background: white;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .header { text-align:center; margin-bottom:20px; }
    .header div:first-child { font-size:28px; font-weight:900; }
    .header div:last-child { font-size:12px; margin-top:4px; font-weight:normal; }
    table { width:100%; border-collapse:collapse; margin:10px 0; }
    td { padding:6px; vertical-align:top; }
    .label { font-weight:600; width:40%; }
    input, select, textarea { width:100%; padding:4px; font-size:1em; }
    .split-section { display:flex; gap:10px; margin:10px 0; }
    .two-col-table { display:flex; gap:30px; flex-wrap:wrap; }
    .two-col-table .col { flex: 1; min-width: 300px; }
    .section-title { font-weight:700; margin-top:20px; }
    .side-label { font-size:11px; font-weight:500; color:#555; margin-bottom:4px; }
    #signature-pad {
      border:2px dashed #888;
      width:100%;
      height:150px;
      background:white;
    }
    .signature-label { font-size:0.9em; color:#444; margin:4px 0 20px; }
    .btns { margin-top:20px; display:flex; gap:10px; flex-wrap:wrap; }
    .btns button { padding:10px 20px; font-size:1em; border:none; background:#333; color:white; border-radius:6px; cursor:pointer; }
    @media (max-width: 768px) {
      .wrapper { padding: 10px; }
      .two-col-table { flex-direction: column; }
      .split-section { flex-direction: column; }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    let signaturePad;
    window.addEventListener("DOMContentLoaded", () => {
      const canvas = document.getElementById("signature-pad");
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
      signaturePad = new SignaturePad(canvas);

      const today = new Date().toISOString().split("T")[0];
      document.getElementById("visit-date").value = today;
      document.getElementById("sign-date").value = today;
    });

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'mm', 'a4');
      const wrapper = document.querySelector('.wrapper');

      html2canvas(wrapper, { scale: 2 }).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const pageWidth = doc.internal.pageSize.getWidth();
        const pageHeight = doc.internal.pageSize.getHeight();
        const imgProps = doc.getImageProperties(imgData);
        const imgHeight = (imgProps.height * pageWidth) / imgProps.width;
        doc.addImage(imgData, 'PNG', 0, 0, pageWidth, imgHeight);

        // Přidání podpisu zvlášť, pokud existuje
        if (signaturePad && !signaturePad.isEmpty()) {
          const signData = signaturePad.toDataURL();
          doc.addImage(signData, 'PNG', 15, 260, 60, 20);
        }

        doc.save("protokol.pdf");
      });
    }

    function autoTranslate(srcId, tgtId) {
      const sourceText = document.getElementById(srcId).value;
      const targetEl = document.getElementById(tgtId);
      if (!sourceText.trim()) return targetEl.value = "";
      fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=cs&tl=en&dt=t&q=${encodeURIComponent(sourceText)}`)
        .then(res => res.json())
        .then(data => {
          if (data && data[0]) {
            targetEl.value = data[0].map(pair => pair[0]).join("");
          }
        });
    }

    function calculateTotal() {
      const work = parseFloat(document.getElementById("price-work").value) || 0;
      const material = parseFloat(document.getElementById("price-material").value) || 0;
      const second = parseFloat(document.getElementById("price-second").value) || 0;
      const transport = parseFloat(document.getElementById("price-transport").value) || 0;
      const total = work + material + second + transport;
      document.getElementById("price-total").value = total.toFixed(2);
    }
  </script>
</head>
<body>
  <div class="wrapper">
    <!-- ... celý obsah zůstává beze změn ... -->
  </div>
</body>
</html>
