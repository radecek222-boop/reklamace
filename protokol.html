<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Protokol - White Glove Service</title>
  <style>
    body {
      font-family: Inter, sans-serif;
      background:#f6f7fb;
      margin:0;
      padding: 20px;
      font-size:12px;
      display: flex;
      justify-content: center;
    }
    .wrapper {
      width: 100%;
      max-width: 900px;
      background: white;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .header { text-align:center; margin-bottom:20px; }
    .header div:first-child { font-size:28px; font-weight:900; }
    .header div:last-child { font-size:12px; margin-top:4px; font-weight:normal; }
    table { width:100%; border-collapse:collapse; margin:10px 0; }
    td { padding:6px; vertical-align:top; }
    .label { font-weight:600; width:25%; }
    input, select, textarea { width:100%; padding:4px; font-size:1em; }
    .split-section { display:flex; gap:10px; margin:10px 0; }
    .split-box { flex:1; min-height:80px; border:1px solid #ccc; padding:8px; background:white; }
    .two-col-table { display:flex; gap:30px; }
    .two-col-table table { width:100%; }
    .section-title { font-weight:700; margin-top:20px; }
    #signature-pad { border:2px dashed #888; width:100%; height:150px; background:white; }
    .signature-label { font-size:0.9em; color:#444; margin:4px 0 20px; }
    .btns { margin-top:20px; display:flex; gap:10px; flex-wrap:wrap; }
    .btns button { padding:10px 20px; font-size:1em; border:none; background:#333; color:white; border-radius:6px; cursor:pointer; }
    @media (max-width: 768px) {
      .wrapper { padding: 10px; }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    let signaturePad;

    window.addEventListener("DOMContentLoaded", () => {
      const canvas = document.getElementById("signature-pad");
      if (canvas) {
        signaturePad = new SignaturePad(canvas);
      }

      // P콏ij칤m치 data z openeru
      window.addEventListener("message", (event) => {
        if (event.data.type === "openProtocol") {
          const d = event.data.row;
          if (!d) return;
          document.getElementById("order-number").value = d["Order number"] || "";
          document.getElementById("claim-number").value = d["Label"] || "";
          document.getElementById("customer").value = d["Customer"] || "";
          document.getElementById("address").value = d["Address"] || "";
          document.getElementById("brand").value = d["Label"] || "";
          document.getElementById("model").value = d["Model"] || "";
          document.getElementById("description-cz").value = d["POPIS REKLAMACE - OPRAVY"] || "";
          autoTranslate();
        }
      });

      // Automatick칳 p콏eklad s prodlevou
      let translateTimer;
      document.getElementById("description-cz").addEventListener("input", () => {
        clearTimeout(translateTimer);
        translateTimer = setTimeout(autoTranslate, 800);
      });
    });

    function autoTranslate() {
      const sourceText = document.getElementById("description-cz").value;
      const targetEl = document.getElementById("description-en");
      if (!sourceText.trim()) return targetEl.value = "";
      fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=cs&tl=en&dt=t&q=${encodeURIComponent(sourceText)}`)
        .then(res => res.json())
        .then(data => {
          if (data && data[0]) {
            targetEl.value = data[0].map(pair => pair[0]).join("");
          }
        });
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation: "portrait", unit: "mm", format: "a4" });
      doc.html(document.querySelector(".wrapper"), {
        callback: function (pdf) {
          if (signaturePad && !signaturePad.isEmpty()) {
            const imgData = signaturePad.toDataURL();
            pdf.addImage(imgData, 'PNG', 15, 270, 60, 20);
          }
          pdf.save("protokol.pdf");
        },
        margin: [10, 10, 10, 10],
        autoPaging: true,
        html2canvas: { scale: 0.8 }
      });
    }
  </script>
</head>
<body>
  <div class="wrapper">
    <div class="header">
      <div>WHITE GLOVE SERVICE</div>
      <div>Do Dub캜e 364, B캩chovice 190 11 췅 +420 725 965 826 췅 reklamace-wgs@email.cz 췅 I캛O: 09769684</div>
    </div>

    <div class="two-col-table">
      <table>
        <tr><td class="label">캛칤slo objedn치vky</td><td><input id="order-number"></td></tr>
        <tr><td class="label">캛칤slo reklamace</td><td><input id="claim-number"></td></tr>
        <tr><td class="label">Z치kazn칤k</td><td><input id="customer"></td></tr>
        <tr><td class="label">Adresa z치kazn칤ka</td><td><input id="address"></td></tr>
        <tr><td class="label">Zna캜ka / Contract</td><td><input id="brand"></td></tr>
        <tr><td class="label">Model</td><td><input id="model"></td></tr>
      </table>

      <table>
        <tr><td class="label">Technik</td><td><select><option>Milan Kol칤n</option><option>Radek Zikmund</option><option>Kol칤n/Zikmund</option></select></td></tr>
        <tr><td class="label">Datum n치v코t캩vy</td><td><input value="" id="visit-date"></td></tr>
        <tr><td class="label">Datum doru캜en칤</td><td><input></td></tr>
        <tr><td class="label">Datum pod치n칤 reklamace</td><td><input></td></tr>
      </table>
    </div>

    <div class="section-title">Z치kazn칤k reklamuje / Customer complaint</div>
    <div class="split-section">
      <textarea id="description-cz" placeholder="Popis v 캜e코tin캩"></textarea>
      <textarea id="description-en" placeholder="Translation" readonly></textarea>
    </div>

    <div class="section-title">Podpis z치kazn칤ka / Customer signature:</div>
    <canvas id="signature-pad"></canvas>
    <div class="signature-label">Podepi코te se pros칤m prstem nebo my코칤 / Sign using finger or mouse</div>

    <div class="btns">
      <button onclick="window.close()">拘勇 Zp캩t na hlavn칤 str치nku</button>
      <button onclick="downloadPDF()">游늯 Exportovat do PDF</button>
    </div>
  </div>
</body>
</html>
