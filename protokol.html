<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Protokol - White Glove Service</title>
<style>
body {
  font-family: "Inter", system-ui, sans-serif;
  background:#f6f7fb;
  margin:0;
  padding:20px;
  font-size:12px;
  display:flex;
  justify-content:center;
}
.wrapper {
  width:100%;
  max-width:900px;
  background:white;
  padding:20px;
  box-shadow:0 0 10px rgba(0,0,0,0.1);
  border-radius:10px;
}
.header {
  text-align:center;
  margin-bottom:20px;
}
.header div:first-child {
  font-size:28px;
  font-weight:900;
}
.header div:last-child {
  font-size:12px;
  margin-top:4px;
  font-weight:normal;
}
table {
  width:100%;
  border-collapse:collapse;
  margin:10px 0;
}
td {
  padding:6px;
  vertical-align:top;
}
.label {
  font-weight:600;
  display:block;
}
.en-label {
  display:block;
  font-size:11px;
  font-weight:400;
  color:#666;
}
input, textarea {
  width:100%;
  border:1px solid #ddd;
  border-radius:4px;
  padding:6px;
  font-family:inherit;
  font-size:12px;
  box-sizing:border-box;
}
textarea { resize:vertical; min-height:60px; }
.signature-pad {
  border:1px solid #ccc;
  border-radius:6px;
  width:100%;
  height:150px;
}
.buttons {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:10px;
  margin-top:20px;
}
button {
  padding:10px 20px;
  border:none;
  border-radius:6px;
  background:linear-gradient(145deg,#666,  <table>
    <tr>
      <td><span class="label">ƒå√≠slo reklamace</span><span class="en-label">Claim number</span></td>
      <td><input id="cisloReklamace" type="text" readonly></td>
      <td><span class="label">Datum</span><span class="en-label">Date</span></td>
      <td><input id="datum" type="date"></td>
    </tr>
    <tr>
      <td><span class="label">Zadavatel</span><span class="en-label">Assigned by</span></td>
      <td><input id="zadavatel" type="text" readonly></td>
      <td><span class="label">Technik</span><span class="en-label">Technician</span></td>
      <td><input id="technik" type="text"></td>
    </tr>
    <tr>
      <td><span class="label">Z√°kazn√≠k</span><span class="en-label">Customer</span></td>
      <td><input id="zakaznik" type="text" readonly></td>
      <td><span class="label">Typ zak√°zky</span><span class="en-label">Type of case</span></td>
      <td><input id="typ" type="text" readonly></td>
    </tr>
    <tr>
      <td><span class="label">Adresa</span><span class="en-label">Address</span></td>
      <td colspan="3"><input id="adresa" type="text" readonly></td>
    </tr>
    <tr>
      <td><span class="label">Telefon</span><span class="en-label">Phone</span></td>
      <td><input id="telefon" type="text" readonly></td>
      <td><span class="label">E-mail</span><span class="en-label">Email</span></td>
      <td><input id="email" type="text" readonly></td>
    </tr>
    <tr>
      <td><span class="label">Popis z√°vady / servisn√≠ho √∫konu</span><span class="en-label">Description of issue / service</span></td>
      <td colspan="3"><textarea id="popis"></textarea></td>
    </tr>
    <tr>
      <td><span class="label">Pozn√°mka technika</span><span class="en-label">Technician note</span></td>
      <td colspan="3"><textarea id="poznamka"></textarea></td>
    </tr>
    <tr>
      <td><span class="label">Podpis z√°kazn√≠ka</span><span class="en-label">Customer signature</span></td>
      <td colspan="3">
        <canvas id="signature-pad" class="signature-pad"></canvas>
        <div class="buttons" style="margin-top:8px;">
          <button type="button" onclick="clearSignature()">Vymazat podpis / Clear signature</button>
        </div>
      </td>
    </tr>
  </table>

  <div class="buttons">
    <button id="backBtn" onclick="window.location.href='index.html'">‚¨Ö Zpƒõt</button>
    <button id="exportBtn" onclick="exportPDF()">üíæ Export PDF</button>
  </div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"></script>

<script>
// === Inicializace podpisu ===
const canvas = document.getElementById('signature-pad');
const signaturePad = new SignaturePad(canvas);

function clearSignature() {
  signaturePad.clear();
}

// === Automatick√© p≈ôedvyplnƒõn√≠ dat z URL ===
window.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  const fields = [
    'cisloReklamace', 'zadavatel', 'zakaznik', 'typ',
    'adresa', 'telefon', 'email', 'popis'
  ];
  fields.forEach(id => {
    const el = document.getElementById(id);
    if (el && params.has(id)) el.value = decodeURIComponent(params.get(id));
  });

  // Automatick√© vyplnƒõn√≠ dne≈°n√≠ho data, pokud nen√≠ zad√°no
  const dnes = new Date().toISOString().split('T')[0];
  document.getElementById('datum').value = dnes;
});

// === Export do PDF ===
async function exportPDF() {
  const { jsPDF } = window.jspdf;
  const exportBtn = document.getElementById('exportBtn');
  const backBtn = document.getElementById('backBtn');
  exportBtn.style.display = 'none';
  backBtn.style.display = 'none';

  const canvasSig = document.getElementById('signature-pad');
  const sigData = signaturePad.isEmpty() ? null : signaturePad.toDataURL();

  if (sigData) {
    const img = document.createElement('img');
    img.src = sigData;
    img.style.width = '200px';
    img.style.marginTop = '10px';
    canvasSig.replaceWith(img);
  }

  await html2canvas(document.querySelector('.wrapper'), { scale: 2 }).then(canvas => {
    const imgData = canvas.toDataURL('image/png');
    const pdf = new jsPDF('p', 'pt', 'a4');
    const pageWidth = pdf.internal.pageSize.getWidth();
    const pageHeight = pdf.internal.pageSize.getHeight();
    const imgWidth = pageWidth - 40;
    const imgHeight = canvas.height * imgWidth / canvas.width;
    pdf.addImage(imgData, 'PNG', 20, 20, imgWidth, imgHeight);

    const zakaznik = document.getElementById('zakaznik').value.replace(/[^\w\s]/gi, '').replace(/\s+/g, '');
    const cislo = document.getElementById('cisloReklamace').value || 'bezcisla';
    const datum = new Date().toISOString().split('T')[0];
    const fileName = `${zakaznik}_${cislo}_${datum}.pdf`;

    pdf.save(fileName);
  });

  location.reload(); // obnov√≠ p≈Øvodn√≠ stav s tlaƒç√≠tky
}
</script>

</div>
</body>
</html>
#444);
  color:white;
  font-weight:600;
  cursor:pointer;
}
button:hover {
  background:linear-gradient(145deg,#555,#333);
}
@media(max-width:600px){
  body{padding:10px;}
  .wrapper{padding:15px;}
}
</style>
</head>
<body>
<div class="wrapper">
  <div class="header">
    <div>WHITE GLOVE SERVICE</div>
    <div>Servisn√≠ protokol / Service Protocol</div>
  </div>
