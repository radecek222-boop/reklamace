<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Servisn√≠ protokol - White Glove Service</title>
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.5/dist/signature_pad.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root {
      font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif;
      color: #111;
    }
    body {
      margin: 0;
      padding: 20px;
      background: #f6f7fb;
    }
    h1 {
      font-size: 20px;
      margin: 0 0 12px;
    }
    .wrapper {
      max-width: 960px;
      margin: auto;
      background: white;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 14px;
    }
    input, textarea {
      width: 100%;
      padding: 8px;
      font-size: 14px;
      margin-top: 4px;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .section {
      margin-top: 30px;
    }
    .signature {
      width: 100%;
      height: 160px;
      border: 1px solid #aaa;
      background: #fff;
    }
    .btns {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }
    button {
      padding: 10px 16px;
      font-size: 14px;
      background: #444;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #000;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <h1>Servisn√≠ protokol / Service Report</h1>

    <div class="grid">
      <div>
        <label>ƒå√≠slo objedn√°vky / Order number</label>
        <input id="order-number" type="text">

        <label>ƒå√≠slo reklamace / Complaint number</label>
        <input id="claim-number" type="text">

        <label>Z√°kazn√≠k / Customer</label>
        <input id="customer" type="text">

        <label>Adresa z√°kazn√≠ka / Address</label>
        <input id="address" type="text">

        <label>Znaƒçka / Contract</label>
        <input id="brand" type="text">

        <label>Model</label>
        <input id="model" type="text">
      </div>
      <div>
        <label>Technik / Technician</label>
        <input id="technician" type="text">

        <label>Datum n√°v≈°tƒõvy / Visit date</label>
        <input id="visit-date" type="date">

        <label>Datum doruƒçen√≠ / Delivery date</label>
        <input id="delivery-date" type="date">

        <label>Datum pod√°n√≠ reklamace / Complaint date</label>
        <input id="complaint-date" type="date">
      </div>
    </div>

    <div class="grid section">
      <div>
        <label>Z√°kazn√≠k reklamuje / Customer complaint</label>
        <textarea id="description-cz"></textarea>
      </div>
      <div>
        <label>Customer complaint (EN)</label>
        <textarea id="description-en"></textarea>
      </div>
    </div>
<div class="grid section">
  <div>
    <label>Poƒçet opravovan√Ωch d√≠l≈Ø / Number of parts repaired</label>
    <input id="repair-count" type="text">

    <label>Cena za pr√°ci / Labor cost</label>
    <input id="labor-cost" type="text">

    <label>Cena za materi√°l / Material cost</label>
    <input id="material-cost" type="text">

    <label>Cena za druh√©ho technika / Second technician cost</label>
    <input id="second-tech-cost" type="text">

    <label>Cena za dopravu / Transport cost</label>
    <input id="transport-cost" type="text">

    <label>Cena celkem / Total cost</label>
    <input id="total-cost" type="text">
  </div>
  <div>
    <label>Reklamace vy≈ôe≈°ena? / Complaint resolved?</label>
    <input id="resolved" type="text">

    <label>ƒåek√° se na vyj√°d≈ôen√≠ prodejce? / Waiting for seller response?</label>
    <input id="waiting" type="text">

    <label>Po≈°kozen√≠ technikem? / Damaged by technician?</label>
    <input id="damage" type="text">

    <label>√öhradu provede z√°kazn√≠k? / Will customer pay?</label>
    <input id="payment" type="text">

    <label>Datum podpisu / Date of signature</label>
    <input id="signature-date" type="date">
  </div>
</div>

<div class="section">
  <label>Podpis z√°kazn√≠ka / Customer signature</label>
  <canvas id="signature" class="signature"></canvas>
</div>
<div class="btns">
  <button onclick="signaturePad.clear()">üóëÔ∏è Vymazat podpis</button>
  <button onclick="window.location.href='index.html'">‚¨ÖÔ∏è Zpƒõt na hlavn√≠ str√°nku</button>
  <button onclick="downloadPDF()">üìÑ Exportovat do PDF</button>
</div>
</div>

<script>
  const signaturePad = new SignaturePad(document.getElementById("signature"));

  window.addEventListener("message", (event) => {
    if (event.data.type === "openProtocol") {
      const d = event.data.row;
      if (!d) return;
      document.getElementById("order-number").value = d["Order number"] || "";
      document.getElementById("claim-number").value = d["Label"] || "";
      document.getElementById("customer").value = d["Customer"] || "";
      document.getElementById("address").value = d["Address"] || "";
      document.getElementById("brand").value = d["Contract"] || d["Label"] || "";
      document.getElementById("model").value = d["Model"] || "";
      document.getElementById("description-cz").value = d["POPIS REKLAMACE - OPRAVY"] || "";
      autoTranslate("description-cz", "description-en");
      const today = new Date().toISOString().split("T")[0];
      document.getElementById("visit-date").value = today;
      document.getElementById("signature-date").value = today;
    }
  });

  function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ orientation: "portrait", unit: "mm", format: "a4" });
    const wrapper = document.querySelector(".wrapper");
    window.scrollTo(0, 0);
    setTimeout(() => {
      doc.html(wrapper, {
        callback: function (pdf) {
          if (signaturePad && !signaturePad.isEmpty()) {
            const imgData = signaturePad.toDataURL();
            pdf.addImage(imgData, 'PNG', 15, 260, 60, 20);
          }
          pdf.save("protokol.pdf");
        },
        margin: [10, 10, 10, 10],
        autoPaging: true,
        html2canvas: { scale: 1.5, scrollY: 0 }
      });
    }, 500);
  }

  function autoTranslate(fromId, toId) {
    const text = document.getElementById(fromId).value;
    if (!text.trim()) return;
    const prompt = encodeURIComponent("P≈ôelo≈æ do angliƒçtiny: " + text);
    fetch(`https://api.mymemory.translated.net/get?q=${prompt}&langpair=cs|en`)
      .then(res => res.json())
      .then(data => {
        const translated = data.responseData.translatedText;
        document.getElementById(toId).value = translated;
      });
  }
</script>
</body>
</html>
