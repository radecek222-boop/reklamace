<!-- 
====================================================================
üíé WHITE GLOVE SERVICE ‚Äì PROTOKOL REKLAMACE
====================================================================
Verze syst√©mu:       v1.0
Datum sestaven√≠:     2025-10-08
Autor:               Hugo (White Glove Service) & GPT-5
Projekt:             WGS reklamace / servisn√≠ protokoly
Soubory:             protokol.html (export protokolu s podpisem)
Worker:              https://wgs-token.72nvwf4pb2.workers.dev/protokol
Repozit√°≈ô:           https://github.com/radecek222-boop/reklamace
Popis:
  Formul√°≈ô pro z√°pis servisn√≠ho protokolu.
  - Automatick√© p≈ôedvyplnƒõn√≠ √∫daj≈Ø z√°kazn√≠ka
  - Podpis prstem / my≈°√≠ (SignaturePad)
  - Export do PDF (jsPDF + html2canvas)
  - Odesl√°n√≠ dat na server (Cloudflare Worker)
  - Odesl√°n√≠ e-mailu z√°kazn√≠kovi

Struktura souboru:
  A ‚Äì Z√°klad dokumentu (HTML, meta, styly)
  B ‚Äì Hlaviƒçka firmy
  C ‚Äì √ödaje o z√°kazn√≠kovi a reklamaci
  D ‚Äì Textov√© sekce (popis, probl√©m, oprava)
  E ‚Äì Ceny a stavy (≈ôe≈°eno, dealer, po≈°kozen√≠, platba)
  F ‚Äì Podpis a ovl√°dac√≠ tlaƒç√≠tka
  G ‚Äì P≈ôekryvn√© vrstvy (naƒç√≠t√°n√≠, potvrzen√≠ ‚úì)
  H ‚Äì Extern√≠ knihovny (SignaturePad, jsPDF, html2canvas)
  I ‚Äì Auto-p≈ôedvyplnƒõn√≠ dat z localStorage
  J ‚Äì Hlavn√≠ logika (podpis, export, upload, e-mail)

Posledn√≠ √∫prava:     2025-10-08 / 17:20  
====================================================================
-->




<!-- üü® ZAƒå√ÅTEK ƒå√ÅSTI A (Z√°klad dokumentu: HTML, HEAD, STYL) -->
<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Protokol ‚Äì White Glove Service</title>

<style>
body {
  font-family: Inter, sans-serif;
  background:#f6f7fb;
  margin:0;
  padding:20px;
  font-size:12px;
  display:flex;
  justify-content:center;
}
.wrapper {
  width:100%;
  max-width:900px;
  background:white;
  padding:20px;
  box-shadow:0 0 10px rgba(0,0,0,0.1);
}
.header {
  text-align:center;
  margin-bottom:20px;
}
.header div:first-child {
  font-size:28px;
  font-weight:900;
}
.header div:last-child {
  font-size:12px;
  margin-top:4px;
  font-weight:normal;
}
table {
  width:100%;
  border-collapse:collapse;
  margin:10px 0;
}
td { padding:6px; vertical-align:top; }
.label { font-weight:600; display:block; }
.label .en-label { display:block; font-size:0.85em; color:#666; font-weight:normal; margin:0; }
.section-title { font-weight:700; margin-top:20px; display:flex; flex-direction:column; align-items:flex-start; }
.section-title .en-label { font-size:0.9em; color:#666; font-weight:normal; margin-top:2px; }

input, select, textarea {
  width:100%; padding:6px 8px;
  border:1px solid #ccc; border-radius:4px;
  font-size:1em; color:#111; background:#fff;
  box-sizing:border-box;
}
textarea { min-height:80px; resize:vertical; }

.split-section { display:flex; gap:10px; margin:10px 0; }
.two-col-table { display:flex; gap:30px; flex-wrap:wrap; }
.two-col-table .col { flex:1; min-width:300px; }

#signature-pad {
  border:2px dashed #888;
  width:100%;
  height:200px;
  background:white;
  touch-action: none;
}
.signature-label { font-size:0.9em; color:#444; margin:4px 0 20px; }

.btns {
  margin-top:20px;
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:12px;
}
button {
  height:44px; font-size:0.9em; border:none; border-radius:8px;
  cursor:pointer; font-weight:600; color:white;
  box-shadow:0 2px 5px rgba(0,0,0,0.2);
  transition:transform 0.1s ease-in-out, opacity 0.2s;
}
button:hover { transform:scale(1.03); opacity:0.9; }

.btn-clear { background:linear-gradient(135deg,#a83232,#ff4d4d); }
.btn-back { background:linear-gradient(135deg,#6c757d,#a0a4a7); }
.btn-pdf { background:linear-gradient(135deg,#0046ff,#357aff); }
.btn-email { background:linear-gradient(135deg,#00b36b,#3cd67a); }

.wait-overlay {
  display:none; position:fixed; inset:0;
  background:rgba(255,255,255,0.85);
  backdrop-filter:blur(2px);
  justify-content:center; align-items:center;
  flex-direction:column; font-weight:600; color:#333;
  z-index:2000;
}
.wait-overlay.active { display:flex; }
.hourglass {
  border:4px solid #ccc; border-top:4px solid #0046ff;
  border-radius:50%; width:40px; height:40px;
  animation:spin 1s linear infinite; margin-bottom:10px;
}
@keyframes spin { 0%{transform:rotate(0)}100%{transform:rotate(360deg)} }

.success-check {
  display:none; position:fixed; inset:0;
  justify-content:center; align-items:center;
  background:rgba(255,255,255,0.9);
  z-index:2100;
}
.success-check.active { display:flex; }
.checkmark {
  width:80px; height:80px; stroke-width:3;
  stroke:url(#grad1); fill:none;
  stroke-dasharray:48; stroke-dashoffset:48;
  animation:draw 1s ease forwards;
}
@keyframes draw { to{stroke-dashoffset:0;} }

.force-desktop { width:794px !important; max-width:794px !important; }

@media screen and (max-width:768px){
  .two-col-table, .split-section { flex-direction:column !important; gap:10px; }
  input, select, textarea { font-size:1em; height:auto; }
  #signature-pad { height:180px; }
}
</style>
</head>
<!-- üü© KONEC ƒå√ÅSTI A -->



<!-- üü® ZAƒå√ÅTEK ƒå√ÅSTI B (Hlaviƒçka firmy) -->
<body>
<div class="wrapper">
  <div class="header">
    <div>WHITE GLOVE SERVICE</div>
    <div>
      Do Dubƒçe 364, Bƒõchovice 190 11 ¬∑ +420 725 965 826 ¬∑ reklamace-wgs@email.cz ¬∑ IƒåO: 09769684
    </div>
  </div>
<!-- üü© KONEC ƒå√ÅSTI B -->



<!-- üü® ZAƒå√ÅTEK ƒå√ÅSTI C (√ödaje o z√°kazn√≠kovi a reklamaci) -->
  <div class="two-col-table">
    <!-- üß© Lev√Ω sloupec ‚Äì z√°kazn√≠k -->
    <div class="col">
      <table>
        <tr>
          <td class="label">ƒå√≠slo objedn√°vky<span class="en-label">Order number</span></td>
          <td><input id="order-number"></td>
        </tr>
        <tr>
          <td class="label">ƒå√≠slo reklamace<span class="en-label">Claim number</span></td>
          <td><input id="claim-number"></td>
        </tr>
        <tr>
          <td class="label">Z√°kazn√≠k<span class="en-label">Customer</span></td>
          <td><input id="customer"></td>
        </tr>
        <tr>
          <td class="label">Adresa z√°kazn√≠ka<span class="en-label">Customer address</span></td>
          <td><input id="address"></td>
        </tr>
        <tr>
          <td class="label">Telefon<span class="en-label">Phone</span></td>
          <td><input id="phone"></td>
        </tr>
        <tr>
          <td class="label">Email<span class="en-label">Email</span></td>
          <td><input id="email"></td>
        </tr>
      </table>
    </div>

    <!-- üß© Prav√Ω sloupec ‚Äì technick√© √∫daje -->
    <div class="col">
      <table>
        <tr>
          <td class="label">Technik<span class="en-label">Technician</span></td>
          <td>
            <select id="technician">
              <option>Milan Kol√≠n</option>
              <option>Radek Zikmund</option>
              <option>Kol√≠n/Zikmund</option>
            </select>
          </td>
        </tr>
        <tr>
          <td class="label">Datum n√°v≈°tƒõvy<span class="en-label">Visit date</span></td>
          <td><input id="visit-date" type="date"></td>
        </tr>
        <tr>
          <td class="label">Datum doruƒçen√≠<span class="en-label">Delivery date</span></td>
          <td><input id="delivery-date" type="date"></td>
        </tr>
        <tr>
          <td class="label">Datum pod√°n√≠ reklamace<span class="en-label">Complaint date</span></td>
          <td><input id="claim-date" type="date"></td>
        </tr>
        <tr>
          <td class="label">Znaƒçka / Contract<span class="en-label">Brand / Contract</span></td>
          <td><input id="brand"></td>
        </tr>
        <tr>
          <td class="label">Model<span class="en-label">Model</span></td>
          <td><input id="model"></td>
        </tr>
      </table>
    </div>
  </div>
<!-- üü© KONEC ƒå√ÅSTI C -->





<!-- üü® ZAƒå√ÅTEK ƒå√ÅSTI D (Textov√© sekce: reklamace, probl√©m, oprava + auto-p≈ôeklad) -->

<style>
.split-section {
  display: flex;
  gap: 10px;
  margin: 10px 0;
}
textarea {
  width: 100%;
  min-height: 80px;
  resize: vertical;
  border: 1px solid #ccc;
  border-radius: 4px;
  padding: 6px 8px;
  font-size: 1em;
  color: #111;
  background: #fff;
  box-sizing: border-box;
}
textarea[readonly] {
  background: #f7f7f7;
  color: #444;
}
</style>

<!-- üß© Sekce: Z√°kazn√≠k reklamuje -->
<div class="section-title">
  Z√°kazn√≠k reklamuje<span class="en-label">Customer complaint</span>
</div>
<div class="split-section">
  <textarea id="description-cz" placeholder="CZ"></textarea>
  <textarea id="description-en" placeholder="EN" readonly></textarea>
</div>

<!-- üß© Sekce: Probl√©m zji≈°tƒõn√Ω technikem -->
<div class="section-title">
  Probl√©m zji≈°tƒõn√Ω technikem<span class="en-label">Detected problem</span>
</div>
<div class="split-section">
  <textarea id="problem-cz" placeholder="CZ"></textarea>
  <textarea id="problem-en" placeholder="EN" readonly></textarea>
</div>

<!-- üß© Sekce: N√°vrh opravy -->
<div class="section-title">
  N√°vrh opravy<span class="en-label">Repair proposal</span>
</div>
<div class="split-section">
  <textarea id="repair-cz" placeholder="CZ"></textarea>
  <textarea id="repair-en" placeholder="EN" readonly></textarea>
</div>

<script>
// üåç jednoduch√Ω p≈ôekladaƒç CZ ‚Üí EN
async function fastTranslateCZtoEN(text) {
  if (!text || !text.trim()) return "";
  try {
    const res = await fetch("https://libretranslate.de/translate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ q: text, source: "cs", target: "en", format: "text" })
    });
    const data = await res.json();
    return data.translatedText || "";
  } catch (e) {
    console.warn("‚ö†Ô∏è Chyba p≈ôekladu:", e.message);
    return "";
  }
}

// ‚úçÔ∏è automatick√Ω p≈ôeklad p≈ôi psan√≠
function initAutoTranslation(prefix) {
  const cz = document.getElementById(`${prefix}-cz`);
  const en = document.getElementById(`${prefix}-en`);
  if (!cz || !en) return;

  let timeout;
  cz.addEventListener("input", () => {
    clearTimeout(timeout);
    timeout = setTimeout(async () => {
      if (cz.value.trim().length === 0) { en.value = ""; return; }
      en.value = "‚è≥ P≈ôekl√°d√°m...";
      en.value = await fastTranslateCZtoEN(cz.value);
    }, 700);
  });
}

// üîÅ p≈ôeklad po naƒçten√≠ z localStorage (pokud EN pr√°zdn√©)
async function translateLoadedFields() {
  const fields = ["description", "problem", "repair"];
  for (const f of fields) {
    const cz = document.getElementById(`${f}-cz`);
    const en = document.getElementById(`${f}-en`);
    if (cz && en && cz.value && !en.value.trim()) {
      en.value = "‚è≥ P≈ôekl√°d√°m...";
      en.value = await fastTranslateCZtoEN(cz.value);
    }
  }
}

// inicializace
window.addEventListener("DOMContentLoaded", () => {
  ["description","problem","repair"].forEach(initAutoTranslation);
  translateLoadedFields();
});
</script>

<!-- üü© KONEC ƒå√ÅSTI D -->




<!-- üü® ZAƒå√ÅTEK ƒå√ÅSTI E (Ceny a stavy: vy≈ôe≈°eno, dealer, po≈°kozen√≠, platba) -->
  <div class="two-col-table">
    <!-- üß© Lev√Ω sloupec ‚Äì ceny -->
    <div class="col">
      <table>
        <tr>
          <td class="label">Poƒçet opravovan√Ωch d√≠l≈Ø<span class="en-label">Number of repaired parts</span></td>
          <td><input id="parts" type="number" min="0"></td>
        </tr>
        <tr>
          <td class="label">Cena za pr√°ci<span class="en-label">Work cost</span></td>
          <td><input id="price-work" type="number" min="0" step="0.01" oninput="updateTotal()"></td>
        </tr>
        <tr>
          <td class="label">Cena za materi√°l<span class="en-label">Material cost</span></td>
          <td><input id="price-material" type="number" min="0" step="0.01" oninput="updateTotal()"></td>
        </tr>
        <tr>
          <td class="label">Cena za druh√©ho technika<span class="en-label">Second technician cost</span></td>
          <td><input id="price-second" type="number" min="0" step="0.01" oninput="updateTotal()"></td>
        </tr>
        <tr>
          <td class="label">Cena za dopravu<span class="en-label">Transport cost</span></td>
          <td><input id="price-transport" type="number" min="0" step="0.01" oninput="updateTotal()"></td>
        </tr>
        <tr>
          <td class="label">Cena celkem<span class="en-label">Total cost</span></td>
          <td><input id="price-total" type="number" readonly></td>
        </tr>
      </table>
    </div>

    <!-- üß© Prav√Ω sloupec ‚Äì stavy -->
    <div class="col">
      <table>
        <tr>
          <td class="label">Reklamace vy≈ôe≈°ena?<span class="en-label">Complaint solved?</span></td>
          <td><select id="solved"><option>ANO</option><option>NE</option></select></td>
        </tr>
        <tr>
          <td class="label">ƒåek√° se na vyj√°d≈ôen√≠ prodejce?<span class="en-label">Waiting for dealer?</span></td>
          <td><select id="dealer"><option>NE</option><option>ANO</option></select></td>
        </tr>
        <tr>
          <td class="label">Po≈°kozen√≠ technikem?<span class="en-label">Damage by technician?</span></td>
          <td><select id="damage"><option>NE</option><option>ANO</option></select></td>
        </tr>
        <tr>
          <td class="label">√öhradu provede z√°kazn√≠k?<span class="en-label">Customer will pay?</span></td>
          <td><select id="payment"><option>NE</option><option>ANO</option></select></td>
        </tr>
        <tr>
          <td class="label">Datum podpisu<span class="en-label">Signature date</span></td>
          <td><input id="sign-date" type="date"></td>
        </tr>
      </table>
    </div>
  </div>

  <!-- üß© Skript pro automatick√Ω souƒçet ceny -->
  <script>
  function updateTotal() {
    const work = parseFloat(document.getElementById("price-work").value) || 0;
    const material = parseFloat(document.getElementById("price-material").value) || 0;
    const second = parseFloat(document.getElementById("price-second").value) || 0;
    const transport = parseFloat(document.getElementById("price-transport").value) || 0;
    const total = work + material + second + transport;
    document.getElementById("price-total").value = total.toFixed(2);
  }
  </script>
<!-- üü© KONEC ƒå√ÅSTI E -->




<!-- üü® ZAƒå√ÅTEK ƒå√ÅSTI F (Podpis a ovl√°dac√≠ tlaƒç√≠tka) -->

  <!-- üß© Sekce: Podpis z√°kazn√≠ka -->
  <div class="section-title">
    Podpis z√°kazn√≠ka<span class="en-label">Customer signature</span>
  </div>

  <canvas id="signature-pad"></canvas>
  <div class="signature-label">Podepi≈°te se prstem nebo my≈°√≠</div>

  <!-- üß© Tlaƒç√≠tka ovl√°d√°n√≠ -->
  <div class="btns">
    <button class="btn-clear" type="button" onclick="signaturePad.clear()">Vymazat podpis</button>
    <button class="btn-back" type="button" onclick="window.location.href='index.html'">Zpƒõt</button>
    <button class="btn-pdf" type="button" onclick="uploadProtocol()">Odeslat na server</button>
    <button class="btn-email" type="button" onclick="saveAndMail()">Odeslat e-mail</button>
  </div>

<!-- üü© KONEC ƒå√ÅSTI F -->




<!-- üü® ZAƒå√ÅTEK ƒå√ÅSTI G (P≈ôekryvn√© vrstvy: naƒç√≠t√°n√≠ + potvrzen√≠) -->

  <!-- üß© Overlay: Odes√≠l√°n√≠ protokolu -->
  <div class="wait-overlay" id="waitOverlay">
    <div class="hourglass"></div>
    <p>Odes√≠l√°m protokol‚Ä¶</p>
  </div>

  <!-- üß© Overlay: Potvrzen√≠ √∫spƒõchu -->
  <div class="success-check" id="successCheck">
    <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
      <defs>
        <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#00d084;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#00a86b;stop-opacity:1" />
        </linearGradient>
      </defs>
      <circle cx="26" cy="26" r="25" fill="none"/>
      <path fill="none" d="M14 27l7 7 16-16" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>

<!-- üü© KONEC ƒå√ÅSTI G -->





<!-- üü® ZAƒå√ÅTEK ƒå√ÅSTI H (Extern√≠ knihovny) -->
  <!-- üìö SignaturePad pro podpis -->
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"></script>

  <!-- üìö jsPDF pro export do PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- üìö html2canvas pro sn√≠mek str√°nky -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<!-- üü© KONEC ƒå√ÅSTI H -->




<!-- üü® ZAƒå√ÅTEK ƒå√ÅSTI I (Auto-p≈ôedvyplnƒõn√≠ dat z localStorage) -->
<script>
window.addEventListener("DOMContentLoaded", () => {
  try {
    const saved = localStorage.getItem("protokolData");
    if (!saved) return;

    const data = JSON.parse(saved);
    console.log("üßæ Naƒç√≠t√°m data z localStorage.protokolData:", data);

    if (data.cislo) document.getElementById("claim-number").value = data.cislo;
    if (data.contract) document.getElementById("brand").value = data.contract;
    if (data.zakaznik) document.getElementById("customer").value = data.zakaznik;
    if (data.adresa) document.getElementById("address").value = data.adresa;
    if (data.telefon) document.getElementById("phone").value = data.telefon;
    if (data.email) document.getElementById("email").value = data.email;
    if (data.produkt) document.getElementById("model").value = data.produkt;

    if (data.popis) {
      document.getElementById("description-cz").value = data.popis;
      document.getElementById("description-en").value = data.popis;
    }

    if (data.datum_reklamace)
      document.getElementById("claim-date").value = data.datum_reklamace;
    if (data.datum)
      document.getElementById("visit-date").value = data.datum;

  } catch (err) {
    console.error("‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ dat pro protokol:", err);
  }
});
</script>
<!-- üü© KONEC ƒå√ÅSTI I -->

  <!-- üü© ZAƒå√ÅTEK ƒå√ÅSTI I.2 ‚Äì Expresn√≠ p≈ôekladaƒç CZ ‚Üí EN -->
<script>
/**
 * üåç Expresn√≠ p≈ôekladaƒç CZ ‚Üí EN (LibreTranslate)
 * - ≈æ√°dn√Ω API kl√≠ƒç
 * - pou≈æ√≠v√° ve≈ôejnou instanci libretranslate.de
 * - p≈ôekl√°d√° i automaticky text z localStorage p≈ôi naƒçten√≠
 */

async function fastTranslateCZtoEN(text) {
  if (!text || text.trim() === "") return "";
  try {
    const res = await fetch("https://libretranslate.de/translate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        q: text,
        source: "cs",
        target: "en",
        format: "text"
      })
    });
    const data = await res.json();
    if (data.translatedText) return data.translatedText;
  } catch (e) {
    console.warn("‚ö†Ô∏è Chyba p≈ôi p≈ôekladu:", e.message);
  }
  return text; // fallback ‚Äì vr√°t√≠ p≈Øvodn√≠ text
}

// üîÑ P≈ôelo≈æ√≠ text z ƒçesk√©ho pole do anglick√©ho
async function autoTranslateField(prefix) {
  const cz = document.getElementById(`${prefix}-cz`);
  const en = document.getElementById(`${prefix}-en`);
  if (!cz || !en) return;
  en.value = "‚è≥ P≈ôekl√°d√°m...";
  en.value = await fastTranslateCZtoEN(cz.value);
}

// üí° Po naƒçten√≠ localStorage automaticky p≈ôelo≈æ√≠ popis, probl√©m a n√°vrh
window.addEventListener("DOMContentLoaded", async () => {
  const czFields = ["description", "problem", "repair"];
  for (const prefix of czFields) {
    const cz = document.getElementById(`${prefix}-cz`);
    const en = document.getElementById(`${prefix}-en`);
    if (cz && en && cz.value && !en.value.trim()) {
      en.value = "‚è≥ P≈ôekl√°d√°m...";
      en.value = await fastTranslateCZtoEN(cz.value);
    }
  }
});
</script>
<!-- üü© KONEC ƒå√ÅSTI I.2 -->





<!-- üü® ZAƒå√ÅTEK ƒå√ÅSTI J (Hlavn√≠ logika: podpis, PDF export, upload, e-mail) -->
<script>
let signaturePad;
let lastPdfName = "protokol.pdf";

window.addEventListener("DOMContentLoaded", () => {
  const canvas = document.getElementById("signature-pad");

  // üñäÔ∏è P≈ôizp≈Øsoben√≠ pl√°tna podpisu
  function resizeCanvas() {
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
  }
  resizeCanvas();
  window.addEventListener("resize", resizeCanvas, { passive: true });

  // ‚úçÔ∏è Inicializace podpisu
  signaturePad = new SignaturePad(canvas, { backgroundColor: "white" });

  // üìÖ P≈ôedvyplnƒõn√≠ dne≈°n√≠ho data
  const today = new Date().toISOString().split("T")[0];
  document.getElementById("visit-date").value = today;
  document.getElementById("sign-date").value = today;
});

function collectFormData() {
  return {
    order: order-number.value,
    claim: claim-number.value,
    customer: customer.value,
    address: address.value,
    phone: phone.value,
    email: email.value,
    technician: technician.value,
    visit: visit-date.value,
    delivery: delivery-date.value,
    claimDate: claim-date.value,
    brand: brand.value,
    model: model.value,
    descriptionCZ: description-cz.value,
    descriptionEN: description-en.value,
    problemCZ: problem-cz.value,
    problemEN: problem-en.value,
    repairCZ: repair-cz.value,
    repairEN: repair-en.value,
    prices: {
      parts: parts.value,
      work: price-work.value,
      material: price-material.value,
      second: price-second.value,
      transport: price-transport.value,
      total: price-total.value
    },
    solved: solved.value,
    dealer: dealer.value,
    damage: damage.value,
    payment: payment.value,
    signDate: sign-date.value
  };
}

// üì§ Odesl√°n√≠ protokolu na server + export do PDF
async function uploadProtocol() {
  const wait = document.getElementById("waitOverlay");
  wait.classList.add("active");

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p", "mm", "a4");

  // üíß VODOZNAK
  doc.setFont("helvetica", "bold");
  doc.setFontSize(48);
  doc.setTextColor(220, 220, 220);
  doc.text("WHITE GLOVE SERVICE", 105, 150, { align: "center", angle: 45 });

  // üßæ P≈ôevod obsahu str√°nky do PDF
  const wrapper = document.querySelector(".wrapper");
  wrapper.classList.add("force-desktop");
  const canvas = await html2canvas(wrapper, { scale: 2 });
  const imgData = canvas.toDataURL("image/jpeg", 0.95);
  doc.addImage(imgData, "JPEG", 0, 0, 210, 297);

  const pdfBlob = doc.output("blob");
  const pdfFile = new File([pdfBlob], buildPdfFileName(), { type: "application/pdf" });
  const data = collectFormData();
  data.signature = signaturePad.toDataURL();

  try {
    const formData = new FormData();
    formData.append("pdf", pdfFile);
    formData.append("data", JSON.stringify(data));

    const res = await fetch("https://wgs-token.72nvwf4pb2.workers.dev/protokol", {
      method: "POST",
      body: formData
    });

    if (!res.ok) throw new Error(await res.text());
    wait.classList.remove("active");
    document.getElementById("successCheck").classList.add("active");
    setTimeout(() => window.location.href = "index.html", 2500);

  } catch (err) {
    wait.classList.remove("active");
    alert("Chyba p≈ôi odes√≠l√°n√≠: " + err.message);
  } finally {
    wrapper.classList.remove("force-desktop");
  }
}

// üßæ Generov√°n√≠ n√°zvu PDF souboru
function buildPdfFileName() {
  const today = new Date().toISOString().split("T")[0];
  return `${customer.value || "zakaznik"}_${claim-number.value || "reklamace"}_${today}.pdf`;
}

// üìß Odesl√°n√≠ e-mailu
function saveAndMail() {
  const email = document.getElementById("email").value || "";
  const subject = "Reklamaƒçn√≠ protokol White Glove Service";
  const body = "Dobr√Ω den,\n\nv p≈ô√≠loze zas√≠l√°me protokol z n√°v≈°tƒõvy.\n\nS pozdravem,\nWHITE GLOVE SERVICE";
  window.location.href = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
}
</script>
  
<!-- üü© KONEC ƒå√ÅSTI J -->



  </div>
</body>
</html>

