<!-- üü® ZAƒå√ÅTEK ƒå√ÅSTI 1/5 ‚Äì Z√ÅKLADN√ç STRUKTURA + STYL NEON TYRKYS -->
<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Nov√° reklamace ‚Äì White Glove Service</title>

<!-- Leaflet pro mapu -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body{
  margin:0;
  font-family:"Inter",system-ui,sans-serif;
  background:#0f1816;
  color:#eafffa;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  min-height:100vh;
}
body::before{
  content:"";
  position:fixed;inset:0;
  background:
    radial-gradient(circle at 25% 25%,#00c89a33,#0f1816 70%),
    radial-gradient(circle at 80% 80%,#00ffcc22,#0f1816 60%);
  filter:blur(70px);
  z-index:-1;
}
.wrapper{
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.08);
  border-radius:16px;
  backdrop-filter:blur(15px);
  padding:40px 28px;
  margin:40px 15px 100px;
  max-width:760px;width:100%;
  box-shadow:0 0 35px rgba(0,255,200,0.25);
}
h1{
  text-align:center;
  font-size:2.4em;
  font-weight:900;
  margin:0 0 6px;
  background:linear-gradient(90deg,#00ffc8,#00a87d);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
h2{
  text-align:center;
  font-size:1.1em;
  font-weight:500;
  color:#aefcd8;
  margin-bottom:25px;
}
label{display:block;font-weight:600;margin-top:14px;margin-bottom:5px;color:#d9fff0;}
input,textarea,select{
  width:100%;
  padding:12px;
  font-size:1em;
  border:none;
  border-radius:10px;
  background:#fff;
  color:#111;
  box-sizing:border-box;
}
input:focus,textarea:focus,select:focus{
  outline:2px solid #00c89a;
}
textarea{height:100px;resize:vertical;}
.btn{
  display:inline-block;
  padding:12px 26px;
  border:none;
  border-radius:10px;
  font-weight:600;
  color:#fff;
  cursor:pointer;
  box-shadow:0 0 12px rgba(0,255,200,0.3);
  transition:transform .15s ease,opacity .25s;
}
.btn:hover{transform:scale(1.05);opacity:.9;}
.btn-send{background:linear-gradient(135deg,#00b56a,#00ffb0);}
.btn-back{background:linear-gradient(135deg,#666,#999);}
.actions{display:flex;justify-content:center;gap:20px;flex-wrap:wrap;margin-top:25px;}
@media(max-width:600px){.wrapper{padding:25px 18px;}}
</style>
</head>
<body>
<div class="wrapper">
<h1>WHITE GLOVE SERVICE</h1>
<h2>Nov√° reklamace</h2>
<form id="reklamaceForm" novalidate>

<!-- üü© AUTO-DETEKCE TYPU Z URL (prodejce vs z√°kazn√≠k) -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  const typ = params.get("typ");

  // ulo≈æ√≠me do localStorage pro pozdƒõj≈°√≠ pou≈æit√≠
  localStorage.setItem("wgs_form_typ", typ || "prodejce");

  if (typ === "zakaznik") {
    console.log("üìã Re≈æim: z√°kazn√≠k (poz√°ruƒçn√≠ servis)");

    // Skryjeme nebo znep≈ô√≠stupn√≠me vybran√© ƒç√°sti
    const hideFields = [
      "cislo", "zpracoval", "datum_prodeje", "datum_reklamace"
    ];

    hideFields.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        const wrapper = el.closest("label") || el.parentElement;
        if (wrapper) wrapper.style.display = "none";
        el.disabled = true;
      }
    });

    // Skryjeme cel√Ω blok s v√Ωbƒõrem zadavatele (a p≈ô√≠padnƒõ "jin√° sekce")
    const jina = document.getElementById("jinaSekce");
    if (jina) jina.style.display = "none";

    // P≈ôep√≠≈°eme nadpis
    const h2 = document.querySelector("h2");
    if (h2) h2.textContent = "Poz√°ruƒçn√≠ servis";
  } else {
    console.log("üìã Re≈æim: prodejce (nov√° reklamace)");
  }
});
</script>
<!-- üü® KONEC ƒå√ÅSTI 1/5 -->



  <!-- üü© ZAƒå√ÅTEK ƒå√ÅSTI 2/5 ‚Äì FORMUL√Å≈ò + ADRESY + ZADAVATEL + VALIDACE -->
<label>ƒå√≠slo reklamace / objedn√°vky:</label>
<input type="text" id="cislo" name="cislo" required>

<label>Z√°kazn√≠k:</label>
<input type="text" id="zakaznik" name="zakaznik" required placeholder="nap≈ô. Ji≈ô√≠ Nov√°k">

<label>Ulice a ƒç√≠slo popisn√©:</label>
<div class="address-wrapper">
  <input type="text" id="ulice" name="ulice" required placeholder="nap≈ô. Vinohradsk√° 120" autocomplete="off">
  <div id="suggestions" class="suggestions"></div>
</div>
<div id="mapPreview" style="margin-top:10px;height:250px;border-radius:14px;overflow:hidden;"></div>

<label>Mƒõsto:</label>
<input type="text" id="mesto" name="mesto" required placeholder="nap≈ô. Praha">

<label>PSƒå:</label>
<input type="text" id="psc" name="psc" required pattern="\\d{3}\\s?\\d{2}" placeholder="nap≈ô. 110 00">

<label>Telefon:</label>
<div style="display:flex;gap:8px;">
  <select id="predvolba" style="max-width:130px;">
    <option value="+420">üá®üáø +420</option>
    <option value="+421">üá∏üá∞ +421</option>
    <option value="+43">üá¶üáπ +43</option>
  </select>
  <input type="tel" id="telefon" name="telefon" required placeholder="nap≈ô. 777123456">
</div>

<label>E-mail:</label>
<input type="email" id="email" name="email" required placeholder="nap≈ô. info@firma.cz">

<label>Model / N√°zev produktu:</label>
<input type="text" id="produkt" name="produkt" required placeholder="nap≈ô. C142">

<script>
// üö´ Zamezit odesl√°n√≠ Enterem
document.querySelectorAll("input").forEach(el=>{
  el.addEventListener("keydown",e=>{
    if(e.key==="Enter") e.preventDefault();
  });
});

// üß© ZABR√ÅNƒöN√ç P≈òEDƒåASN√âMU SUBMITU P≈òI V√ùBƒöRU DATUMU
document.querySelectorAll("input[type='date']").forEach(el=>{
  el.addEventListener("change",e=>{
    e.stopPropagation();
    e.preventDefault();
    // jen ulo≈æ√≠me aktu√°ln√≠ draft, ale nic neodes√≠l√°me
    if(typeof saveDraft==="function") saveDraft();
  });
  el.addEventListener("click",e=>{
    e.stopPropagation();
  });
});

// üåç Geoapify ‚Äì na≈°ept√°vaƒç adres

let geoTimeout;
const ulice=document.getElementById("ulice");
const suggestions=document.getElementById("suggestions");
const map=L.map("mapPreview").setView([50.08,14.6],12);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:""}).addTo(map);
let marker;

ulice.addEventListener("input",()=>{
  clearTimeout(geoTimeout);
  const query=ulice.value.trim();
  if(!query){suggestions.innerHTML="";return;}
  geoTimeout=setTimeout(async()=>{
  const res=await fetch(`https://api.geoapify.com/v1/geocode/autocomplete?text=${encodeURIComponent(query)}&format=json&apiKey=b363199bb14e47189558d03b81ca9ba1`);
    const data=await res.json();
    suggestions.innerHTML="";
    data.results.slice(0,5).forEach(r=>{
      const div=document.createElement("div");
      div.textContent=r.formatted;
      div.onclick=()=>{
        ulice.value=r.address_line1||"";
        document.getElementById("mesto").value=r.city||"";
        document.getElementById("psc").value=r.postcode||"";
        suggestions.innerHTML="";
        if(marker) map.removeLayer(marker);
        marker=L.marker([r.lat,r.lon]).addTo(map);
        map.setView([r.lat,r.lon],15);
      };
      suggestions.appendChild(div);
    });
  },400);
});

// üé® Styl na≈°ept√°vaƒçe
const css=document.createElement("style");
css.textContent=`
.suggestions{position:absolute;z-index:1000;background:#fff;color:#111;width:100%;border-radius:0 0 10px 10px;overflow:hidden;box-shadow:0 4px 10px rgba(0,0,0,0.15);}
.suggestions div{padding:8px 12px;cursor:pointer;}
.suggestions div:hover{background:#e0fff8;}
.address-wrapper{position:relative;}
`;
document.head.appendChild(css);
</script>
<!-- üü© KONEC ƒå√ÅSTI 2/5 -->



<!-- üü© ZAƒå√ÅTEK ƒå√ÅSTI 3/5 ‚Äì INTERAKTIVN√ç KALEND√Å≈ò (tyrkys styl ‚Äì OPRAVEN√Å VERZE) -->
<label>Datum prodeje:</label>
<div class="calendar-group">
  <input type="hidden" id="datum_prodeje" name="datum_prodeje">
  <button type="button" class="btn-calendar" data-target="datum_prodeje">Vyber datum</button>
  <span id="datum_prodeje_text" class="calendar-text">Nezvoleno</span>
</div>

<label>Datum reklamace:</label>
<div class="calendar-group">
  <input type="hidden" id="datum_reklamace" name="datum_reklamace">
  <button type="button" class="btn-calendar" data-target="datum_reklamace">Vyber datum</button>
  <span id="datum_reklamace_text" class="calendar-text">Nezvoleno</span>
</div>

<!-- üî∑ Modal kalend√°≈ô -->
<div id="calendarModal" class="calendar-modal">
  <div class="calendar-box">
    <div class="calendar-header">
      <button id="prevMonth">‚óÄ</button>
      <span id="monthLabel"></span>
      <button id="nextMonth">‚ñ∂</button>
    </div>
    <div class="calendar-weekdays">
      <div>Po</div><div>√öt</div><div>St</div><div>ƒåt</div><div>P√°</div><div>So</div><div>Ne</div>
    </div>
    <div id="calendarGrid" class="calendar-grid"></div>
    <div class="calendar-actions">
      <button type="button" id="cancelCalendar" class="btn-cancel">Zru≈°it</button>
      <button type="button" id="confirmCalendar" class="btn-ok">Potvrdit</button>
    </div>
  </div>
</div>

<style>
.calendar-group{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.btn-calendar{padding:10px 18px;border-radius:8px;border:none;
background:linear-gradient(135deg,#00bfa5,#00e0c0);
color:#fff;font-weight:600;cursor:pointer;box-shadow:0 0 12px rgba(0,255,200,.3);}
.btn-calendar:hover{transform:scale(1.05);opacity:.95;}
.calendar-text{font-size:.9em;color:#aefcd8;}
.calendar-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);
justify-content:center;align-items:center;z-index:9999;}
.calendar-box{background:#fafffd;border-radius:12px;padding:20px;width:320px;
box-shadow:0 0 25px rgba(0,0,0,0.3);color:#004d44;}
.calendar-header{display:flex;justify-content:space-between;align-items:center;
font-weight:700;margin-bottom:10px;color:#008b7a;}
.calendar-weekdays{display:grid;grid-template-columns:repeat(7,1fr);
font-weight:600;font-size:.85em;text-align:center;color:#007f73;margin-bottom:4px;}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;}
.calendar-grid div{padding:8px;text-align:center;border-radius:6px;cursor:pointer;}
.calendar-grid div:hover{background:#00e0c033;}
.calendar-grid div.selected{background:#00bfa5;color:#fff;}
.calendar-actions{display:flex;justify-content:space-between;margin-top:10px;}
.btn-ok{background:#00bfa5;color:#fff;border:none;border-radius:8px;padding:6px 14px;font-weight:600;}
.btn-cancel{background:#ccc;border:none;border-radius:8px;padding:6px 14px;font-weight:600;}
</style>

<script>
let activeInput=null,selectedDate=null,selectedCell=null,currentMonth=new Date();

function renderCalendar(){
  const grid=document.getElementById("calendarGrid");
  const monthLabel=document.getElementById("monthLabel");
  const year=currentMonth.getFullYear();
  const month=currentMonth.getMonth();
  const firstDay=(new Date(year,month,1).getDay()+6)%7;
  const daysInMonth=new Date(year,month+1,0).getDate();

  monthLabel.textContent=`${["Leden","√önor","B≈ôezen","Duben","Kvƒõten","ƒåerven","ƒåervenec","Srpen","Z√°≈ô√≠","≈ò√≠jen","Listopad","Prosinec"][month]} ${year}`;
  grid.innerHTML="";
  selectedCell=null;

  for(let i=0;i<firstDay;i++){grid.append(document.createElement("div"));}

  for(let d=1;d<=daysInMonth;d++){
    const cell=document.createElement("div");
    cell.textContent=d;
    cell.onclick=()=>{
      grid.querySelectorAll(".selected").forEach(c=>c.classList.remove("selected"));
      cell.classList.add("selected");
      selectedDate=new Date(year,month,d);
      selectedCell=cell;
    };
    grid.append(cell);
  }
}

document.querySelectorAll(".btn-calendar").forEach(btn=>{
  btn.onclick=()=>{
    activeInput=btn.dataset.target;
    document.getElementById("calendarModal").style.display="flex";
    renderCalendar();
  };
});
document.getElementById("prevMonth").onclick=()=>{currentMonth.setMonth(currentMonth.getMonth()-1);renderCalendar();};
document.getElementById("nextMonth").onclick=()=>{currentMonth.setMonth(currentMonth.getMonth()+1);renderCalendar();};
document.getElementById("cancelCalendar").onclick=()=>{document.getElementById("calendarModal").style.display="none";};
document.getElementById("confirmCalendar").onclick=()=>{
  if(!selectedDate||!selectedCell)return;
  const iso=selectedDate.toISOString().split("T")[0];
  document.getElementById(activeInput).value=iso;
  document.getElementById(activeInput+"_text").textContent=
    selectedDate.toLocaleDateString("cs-CZ",{day:"2-digit",month:"2-digit",year:"numeric"});
  document.getElementById("calendarModal").style.display="none";
};
</script>
<!-- üü© KONEC ƒå√ÅSTI 3/5 -->



<!-- üü© ZAƒå√ÅTEK ƒå√ÅSTI 4/5 ‚Äì FOTKY + VALIDACE + LOCALSTORAGE + ZADAVATEL + EMAIL -->

<label>Popis z√°vady:</label>
<textarea id="popis" name="popis" required placeholder="Popi≈°te z√°vadu nebo probl√©m..."></textarea>

<!-- üü© BLOK ‚Äì Fotodokumentace -->
<div class="photo-frame">
  <div class="photo-frame__header">
    <div class="photo-frame__title">Fotodokumentace</div>
    <button type="button" id="addPhotoBtn" class="btn-photo">P≈ôidat fotografie</button>
  </div>
  <div class="photo-frame__info">Max. 10 fotografi√≠ (JPG/PNG/HEIC, ‚â§ 0,5 MB ka≈æd√°)</div>
  <div id="photoPreviewMain" class="photo-preview-main"></div>
</div>
<input type="file" id="photoInput" accept="image/jpeg,image/png,image/heic" multiple hidden>

<!-- üîç Lightbox -->
<div id="lightbox" class="lightbox"><img id="lightboxImg" src=""></div>

<!-- üü© BLOK ‚Äì Zadavatel -->
<div style="margin-top:25px;">
  <label>Objedn√°vku zpracoval:</label>
  <select id="zpracoval" name="zpracoval" style="height:48px;font-size:1em;border-radius:10px;">
    <option value="">Vyber...</option>
    <option>Natuzzi Editions ‚Äì Strejƒçek</option>
    <option>Natuzzi Editions ‚Äì Vimrov√°</option>
    <option>Natuzzi Italia ‚Äì Jama</option>
    <option>Natuzzi Italia ‚Äì River</option>
    <option>Phase ‚Äì Kl√∫ƒçarov√°</option>
    <option>Phase ‚Äì Janƒçov√°</option>
    <option>Softaly ‚Äì Soho</option>
    <option>Natuzzi Editions ‚Äì Bratislava</option>
    <option>Natuzzi Editions ‚Äì SOHO Design</option>
    <option>Natuzzi Editions ‚Äì JAMA</option>
    <option value="Jin√°">Jin√°</option>
  </select>
</div>

<!-- üü© BLOK ‚Äì Jin√Ω zadavatel -->
<div id="jinaSekce" style="display:none;margin-top:16px;padding:16px;border-radius:10px;border:1px solid #00c8a0;background:rgba(255,255,255,0.05);">
  <label>Jm√©no:</label>
  <input type="text" id="jinaJmeno" name="jinaJmeno" placeholder="nap≈ô. Jan">

  <label>P≈ô√≠jmen√≠:</label>
  <input type="text" id="jinaPrijmeni" name="jinaPrijmeni" placeholder="nap≈ô. Nov√°k">

  <label>Obchod / Firma:</label>
  <input type="text" id="jinaFirma" name="jinaFirma" placeholder="nap≈ô. Design Studio Praha">

  <label>Telefon:</label>
  <input type="tel" id="jinaTelefon" name="jinaTelefon" placeholder="nap≈ô. 777123456">

  <label>E-mail:</label>
  <input type="email" id="jinaEmail" name="jinaEmail" placeholder="nap≈ô. info@firma.cz">
</div>

<!-- üü© BLOK ‚Äì Email pro zpƒõtnou vazbu -->
<div style="margin-top:25px;">
  <label>Email pro zpƒõtnou vazbu:</label>
  <input type="email" id="feedbackEmail" name="feedbackEmail" placeholder="nap≈ô. servis@natuzzi.cz">
  <small style="display:block;margin-top:4px;color:#ccefe8;font-size:0.85em;">
    Na tento e-mail bude zasl√°n protokol a fotografie po vy≈ô√≠zen√≠ reklamace.
  </small>
</div>

<div class="actions">
  <button type="button" class="btn btn-back" onclick="window.location.href='index.html'">Zpƒõt</button>
  <button type="submit" class="btn btn-send">Odeslat</button>
</div>

<style>
.photo-frame {
  border:1px solid #00bfa5;border-radius:10px;padding:14px;margin-top:18px;
  background:linear-gradient(180deg,#f8fdfd 0%,#eefafa 100%);
}
.photo-frame__header{display:flex;justify-content:space-between;align-items:center;}
.photo-frame__title{font-weight:700;color:#007f73;font-size:1.05em;}
.btn-photo{
  padding:10px 18px;border-radius:8px;
  border:none;background:linear-gradient(135deg,#00bfa5,#00d4b0);
  color:#fff;font-weight:600;cursor:pointer;transition:all .2s ease;
  box-shadow:0 0 15px rgba(0,200,160,0.4);
}
.btn-photo:hover{transform:scale(1.05);opacity:.9;}
.photo-frame__info{font-size:.8em;color:#444;margin-top:3px;}
.photo-preview-main{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px;}
.photo-item{position:relative;width:90px;height:90px;border-radius:8px;overflow:hidden;
  box-shadow:0 2px 6px rgba(0,0,0,.2);cursor:pointer;background:#fff;}
.photo-item img{width:100%;height:100%;object-fit:contain;}
.photo-remove{position:absolute;top:3px;right:3px;width:20px;height:20px;
  border:none;border-radius:50%;background:rgba(255,255,255,.85);color:#d40000;
  font-weight:bold;font-size:14px;cursor:pointer;}
.photo-remove:hover{background:#fff;transform:scale(1.15);}
.lightbox{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);
  justify-content:center;align-items:center;z-index:9999;}
.lightbox.active{display:flex;}
.lightbox img{max-width:95vw;max-height:90vh;border-radius:12px;box-shadow:0 0 20px #000;}
</style>

<script>
const photoInput=document.getElementById("photoInput");
const photoPreviewMain=document.getElementById("photoPreviewMain");
const addPhotoBtn=document.getElementById("addPhotoBtn");
const lightbox=document.getElementById("lightbox");
const lightboxImg=document.getElementById("lightboxImg");

let photos=[];

// üì∏ P≈ôid√°n√≠ fotek
addPhotoBtn.onclick=()=>photoInput.click();

photoInput.onchange=async()=>{
  const files=Array.from(photoInput.files);
  for(const f of files.slice(0,10-photos.length)){
    const blob=await compressImage(f);
    const reader=new FileReader();
    reader.onload=e=>{
      photos.push({name:f.name,blob,preview:e.target.result});
      renderPhotos();
      saveDraft();
    };
    reader.readAsDataURL(blob);
  }
  photoInput.value="";
};

// üß© Komprese obr√°zku (zachov√°n√≠ proporc√≠)
async function compressImage(file,maxKB=500,maxDim=1280){
  const img=await createImageBitmap(file);
  const canvas=document.createElement("canvas");
  let [w,h]=[img.width,img.height];
  if(w>h&&w>maxDim){h=Math.round(h*(maxDim/w));w=maxDim;}
  else if(h>=w&&h>maxDim){w=Math.round(w*(maxDim/h));h=maxDim;}
  canvas.width=w;canvas.height=h;
  const ctx=canvas.getContext("2d");
  ctx.drawImage(img,0,0,w,h);
  let q=0.9,blob;
  do{blob=await new Promise(r=>canvas.toBlob(r,"image/jpeg",q));q-=0.1;}
  while(blob.size/1024>maxKB&&q>0.4);
  return blob;
}

// üñºÔ∏è Miniatury
function renderPhotos(){
  photoPreviewMain.innerHTML="";
  photos.forEach((p,i)=>{
    const item=document.createElement("div");
    item.className="photo-item";
    const img=document.createElement("img");
    img.src=p.preview;
    img.onclick=()=>showLightbox(p.preview);
    const del=document.createElement("button");
    del.className="photo-remove";
    del.textContent="√ó";
    del.onclick=(e)=>{e.stopPropagation();photos.splice(i,1);renderPhotos();saveDraft();};
    item.append(img,del);
    photoPreviewMain.append(item);
  });
}

// üîç Lightbox
function showLightbox(src){lightboxImg.src=src;lightbox.classList.add("active");}
lightbox.onclick=()=>lightbox.classList.remove("active");

// üíæ Ulo≈æen√≠ rozpracovan√Ωch dat
function saveDraft(){
  const form=document.getElementById("reklamaceForm");
  const data=new FormData(form);
  const obj=Object.fromEntries(data.entries());
  obj.photos=photos.map(p=>p.preview);
  localStorage.setItem("novaReklamaceDraft",JSON.stringify(obj));
}

// üîÅ Obnoven√≠ dat p≈ôi otev≈ôen√≠
window.addEventListener("DOMContentLoaded",()=>{
  const draft=localStorage.getItem("novaReklamaceDraft");
  if(draft){
    const obj=JSON.parse(draft);
    Object.keys(obj).forEach(k=>{
      const el=document.querySelector(`[name='${k}']`);
      if(el)el.value=obj[k];
    });
    if(obj.photos){
      photos=obj.photos.map(p=>({preview:p,name:"ulo≈æeno",blob:null}));
      renderPhotos();
    }
  }

  // üîÑ Logika rozbalen√≠ "Jin√°"
  const select=document.getElementById("zpracoval");
  const jinaSekce=document.getElementById("jinaSekce");
  select.addEventListener("change",()=>{
    jinaSekce.style.display = select.value==="Jin√°" ? "block" : "none";
  });
});

// üßæ Validace jm√©na, emailu, telefonu
const nameField=document.querySelector("input[name='zakaznik']");
nameField.addEventListener("input",()=>{
  nameField.value=nameField.value
    .split(" ")
    .map(w=>w.charAt(0).toUpperCase()+w.slice(1).toLowerCase())
    .join(" ");
});
document.getElementById("email").addEventListener("input",e=>{
  e.target.setCustomValidity(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.target.value)?"":"Neplatn√Ω email");
});
document.getElementById("telefon").addEventListener("input",e=>{
  e.target.setCustomValidity(/^\d{6,}$/.test(e.target.value)?"":"Min. 6 ƒç√≠sel");
});
</script>

<!-- üü© KONEC ƒå√ÅSTI 4/5 -->

<!-- üü© ZAƒå√ÅTEK ƒå√ÅSTI 5/5 ‚Äì ODESL√ÅN√ç, ANIMACE, P≈òESMƒöROV√ÅN√ç -->
<div class="wait-overlay" id="waitOverlay">
  <div class="hourglass"></div>
  <p>ƒåekejte pros√≠m, prob√≠h√° odes√≠l√°n√≠‚Ä¶</p>
</div>

<div class="success-check" id="successCheck">
  <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
    <defs><linearGradient id="gradTurq" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#00e0c0;stop-opacity:1"/>
      <stop offset="100%" style="stop-color:#00a88f;stop-opacity:1"/>
    </linearGradient></defs>
    <circle cx="26" cy="26" r="25" fill="none" stroke="#e0e0e0"/>
    <path fill="none" stroke="url(#gradTurq)" d="M14 27l7 7 16-16" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
</div>

<style>
.wait-overlay{display:none;position:fixed;inset:0;z-index:3000;background:rgba(255,255,255,0.9);
  backdrop-filter:blur(3px);justify-content:center;align-items:center;flex-direction:column;
  color:#007f73;font-weight:600;font-size:1.1em;}
.wait-overlay.active{display:flex;}
.hourglass{border:4px solid #ccc;border-top:4px solid #00bfa5;border-radius:50%;
  width:40px;height:40px;animation:spin 1s linear infinite;margin-bottom:10px;}
@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
.success-check{display:none;position:fixed;inset:0;justify-content:center;align-items:center;
  background:rgba(255,255,255,0.95);z-index:3100;}
.success-check.active{display:flex;}
.checkmark{width:90px;height:90px;stroke-width:3;fill:none;stroke-dasharray:48;stroke-dashoffset:48;
  animation:draw 1s ease forwards;}
@keyframes draw{to{stroke-dashoffset:0;}}
</style>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  const form=document.getElementById("reklamaceForm");
  const wait=document.getElementById("waitOverlay");
  const success=document.getElementById("successCheck");

  form.addEventListener("submit",async(e)=>{
    e.preventDefault();
    wait.classList.add("active");

    const f=e.target;
    const predvolba=document.getElementById("predvolba");
    const photos=(window.photos||[]).map(p=>p.preview);

    const dataObj={
      typ:"reklamace",
      cislo:f.cislo.value.trim()||"Poz√°ruƒçn√≠ servis",
      zakaznik:f.zakaznik.value,
      adresa:`${f.ulice.value}, ${f.mesto.value}, ${f.psc.value}`,
      telefon:`${predvolba.value} ${f.telefon.value}`,
      email:f.email.value,
      produkt:f.produkt.value,
      datum_prodeje:f.datum_prodeje?.value||"",
      datum_reklamace:f.datum_reklamace?.value||"",
      popis:f.popis.value,
      contract:f.contract?.value||"",
      jinaJmeno:f.jinaJmeno?.value||"",
      jinaPrijmeni:f.jinaPrijmeni?.value||"",
      jinaFirma:f.jinaFirma?.value||"",
      jinaTelefon:f.jinaTelefon?.value||"",
      jinaEmail:f.jinaEmail?.value||"",
      feedbackEmail:f.feedbackEmail?.value||"",
      fotky:photos
    };

   try {
  // üü© P≈ô√≠m√Ω z√°pis p≈ôes PHP na wgs-service.cz
  const form = new FormData();
  form.append("file", "temporaryfiles.json");
  form.append("data", JSON.stringify([{ record: dataObj }]));

  const res = await fetch("https://www.wgs-service.cz/save.php", {
    method: "POST",
    body: form
  });

  if (!res.ok) throw new Error("Chybn√° odpovƒõƒè: " + res.status);
  await res.json();

  localStorage.removeItem("novaReklamaceDraft");
  wait.classList.remove("active");
  success.classList.add("active");
  setTimeout(() => window.location.href = "index.html", 2500);

} catch (err) {
  console.error(err);
  alert("Chyba p≈ôi odes√≠l√°n√≠: " + err.message);
  wait.classList.remove("active");
}

  // üö´ Zamezit odesl√°n√≠ formul√°≈ôe p≈ôi v√Ωbƒõru data
document.querySelectorAll('input[type="date"]').forEach(el=>{
  el.addEventListener("keydown",e=>{
    if(e.key==="Enter") e.preventDefault();
  });
});
  // üß© Oprava ‚Äì potvrzen√≠ datumu neukonƒçuje zapisov√°n√≠
document.addEventListener("click", e => {
  if (e.target.closest(".vanilla-calendar-confirm")) {
    e.stopPropagation();
    e.preventDefault();
    console.log("‚úÖ Datum potvrzeno ‚Äì formul√°≈ô se neukonƒç√≠.");
  }
});


</script>
<!-- üü© KONEC ƒå√ÅSTI 5/5 -->
