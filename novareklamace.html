<!-- üü® ZAƒå√ÅTEK ƒå√ÅSTI 1/5 ‚Äì Z√ÅKLADN√ç STRUKTURA + STYL NEON TYRKYS -->
<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Nov√° reklamace ‚Äì White Glove Service</title>

<!-- Leaflet pro mapu -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body{
  margin:0;
  font-family:"Inter",system-ui,sans-serif;
  background:#0f1816;
  color:#eafffa;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  min-height:100vh;
}
body::before{
  content:"";
  position:fixed;inset:0;
  background:
    radial-gradient(circle at 25% 25%,#00c89a33,#0f1816 70%),
    radial-gradient(circle at 80% 80%,#00ffcc22,#0f1816 60%);
  filter:blur(70px);
  z-index:-1;
}
.wrapper{
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.08);
  border-radius:16px;
  backdrop-filter:blur(15px);
  padding:40px 28px;
  margin:40px 15px 100px;
  max-width:760px;width:100%;
  box-shadow:0 0 35px rgba(0,255,200,0.25);
}
h1{
  text-align:center;
  font-size:2.4em;
  font-weight:900;
  margin:0 0 6px;
  background:linear-gradient(90deg,#00ffc8,#00a87d);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
h2{
  text-align:center;
  font-size:1.1em;
  font-weight:500;
  color:#aefcd8;
  margin-bottom:25px;
}
label{display:block;font-weight:600;margin-top:14px;margin-bottom:5px;color:#d9fff0;}
input,textarea,select{
  width:100%;
  padding:12px;
  font-size:1em;
  border:none;
  border-radius:10px;
  background:#fff;
  color:#111;
  box-sizing:border-box;
}
input:focus,textarea:focus,select:focus{
  outline:2px solid #00c89a;
}
textarea{height:100px;resize:vertical;}
.btn{
  display:inline-block;
  padding:12px 26px;
  border:none;
  border-radius:10px;
  font-weight:600;
  color:#fff;
  cursor:pointer;
  box-shadow:0 0 12px rgba(0,255,200,0.3);
  transition:transform .15s ease,opacity .25s;
}
.btn:hover{transform:scale(1.05);opacity:.9;}
.btn-send{background:linear-gradient(135deg,#00b56a,#00ffb0);}
.btn-back{background:linear-gradient(135deg,#666,#999);}
.actions{display:flex;justify-content:center;gap:20px;flex-wrap:wrap;margin-top:25px;}
@media(max-width:600px){.wrapper{padding:25px 18px;}}
</style>
</head>
<body>
<div class="wrapper">
<h1>WHITE GLOVE SERVICE</h1>
<h2>Nov√° reklamace</h2>
<form id="reklamaceForm" novalidate>
<!-- üü® KONEC ƒå√ÅSTI 1/5 -->
<!-- üü® ZAƒå√ÅTEK ƒå√ÅSTI 2/5 ‚Äì LOGIKA + ADRESY + M√çSTO -->
<label>ƒå√≠slo reklamace / objedn√°vky:</label>
<input type="text" id="cislo" name="cislo" required>

<label>Z√°kazn√≠k:</label>
<input type="text" id="zakaznik" name="zakaznik" required placeholder="nap≈ô. Ji≈ô√≠ Nov√°k">

<label>Ulice a ƒç√≠slo popisn√©:</label>
<div class="address-wrapper">
  <input type="text" id="ulice" name="ulice" required placeholder="nap≈ô. Vinohradsk√° 120">
  <div id="suggestions" class="suggestions"></div>
</div>
<div id="mapPreview" style="margin-top:10px;height:250px;border-radius:14px;overflow:hidden;"></div>

<label>Mƒõsto:</label>
<input type="text" id="mesto" name="mesto" required placeholder="nap≈ô. Praha">

<label>PSƒå:</label>
<input type="text" id="psc" name="psc" required pattern="\d{3}\s?\d{2}" placeholder="nap≈ô. 110 00">

<label>Telefon:</label>
<div style="display:flex;gap:8px;">
  <select id="predvolba" style="max-width:130px;">
    <option value="+420">üá®üáø +420</option>
    <option value="+421">üá∏üá∞ +421</option>
    <option value="+43">üá¶üáπ +43</option>
  </select>
  <input type="tel" id="telefon" name="telefon" required placeholder="nap≈ô. 777123456">
</div>

<label>E-mail:</label>
<input type="email" id="email" name="email" required placeholder="nap≈ô. info@firma.cz">

<label>Model / N√°zev produktu:</label>
<input type="text" id="produkt" name="produkt" required placeholder="nap≈ô. C142">

<div id="dealerFields">
  <label>Objedn√°vku zpracoval:</label>
  <select id="zpracoval" name="zpracoval">
    <option value="">Vyber‚Ä¶</option>
    <option>Natuzzi Editions ‚Äì Strejcek</option>
    <option>Natuzzi Editions ‚Äì Vimrova</option>
    <option>Natuzzi Italia ‚Äì Jama</option>
    <option>Natuzzi Italia ‚Äì River</option>
    <option>Phase ‚Äì Klucarova</option>
    <option>Phase ‚Äì Jancova</option>
    <option>Softaly ‚Äì Soho</option>
    <option value="Jin√°">Jin√°</option>
  </select>

  <div id="jinaSekce" style="display:none;margin-top:10px;">
    <label>Zadej jin√©ho zadavatele:</label>
    <input type="text" id="jinaJmeno" placeholder="Jm√©no firmy">
    <label>Email:</label>
    <input type="email" id="jinaEmail" placeholder="nap≈ô. info@firma.cz">
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  // üîπ Rozpozn√°n√≠ typu (z index.html)
  const params=new URLSearchParams(window.location.search);
  const typ=params.get("typ");
  const poleCislo=document.getElementById("cislo");
  const dealerBox=document.getElementById("dealerFields");
  if(typ==="prodejce"){
    localStorage.setItem("isDealer","true");
    dealerBox.style.display="block";
    poleCislo.removeAttribute("readonly");
    if(poleCislo.value==="Poz√°ruƒçn√≠ servis") poleCislo.value="";
  }else{
    localStorage.removeItem("isDealer");
    dealerBox.style.display="none";
    poleCislo.value="Poz√°ruƒçn√≠ servis";
    poleCislo.readOnly=true;
  }

  // üîπ Sekce ‚ÄûJin√°‚Äú zadavatele
  const select=document.getElementById("zpracoval");
  select.addEventListener("change",()=>{
    document.getElementById("jinaSekce").style.display=
      select.value==="Jin√°"?"block":"none";
  });

  // üîπ Na≈°ept√°vaƒç adres (Geoapify fallback Nominatim)
  const addr=document.getElementById("ulice");
  const sugg=document.getElementById("suggestions");
  const map=L.map("mapPreview").setView([50.08,14.60],12);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OSM"}).addTo(map);
  let marker=null;

  addr.addEventListener("input",async()=>{
    const val=addr.value.trim();
    if(val.length<3){sugg.innerHTML="";return;}
    const res=await fetch(`https://api.geoapify.com/v1/geocode/autocomplete?text=${encodeURIComponent(val)}&format=json&apiKey=YOUR_API_KEY`);
    const data=await res.json();
    sugg.innerHTML=data.results.slice(0,5).map(x=>`<div class="suggItem">${x.formatted}</div>`).join("");
    [...sugg.children].forEach(d=>d.onclick=()=>{
      addr.value=d.textContent;sugg.innerHTML="";
      fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(d.textContent)}`)
        .then(r=>r.json()).then(j=>{
          if(j[0]){
            const {lat,lon}=j[0];
            if(marker)map.removeLayer(marker);
            marker=L.marker([lat,lon]).addTo(map);
            map.setView([lat,lon],15);
          }
        });
    });
  });
});
</script>
<!-- üü® KONEC ƒå√ÅSTI 2/5 -->


<!-- üü© ZAƒå√ÅTEK ƒå√ÅSTI 3/5 ‚Äì INTERAKTIVN√ç KALEND√Å≈ò -->
<label>Datum prodeje:</label>
<div class="calendar-group">
  <input type="hidden" id="datum_prodeje" name="datum_prodeje">
  <button type="button" class="btn-calendar" data-target="datum_prodeje">Vyber datum</button>
  <span id="datum_prodeje_text" class="calendar-text">Nezvoleno</span>
</div>

<label>Datum reklamace:</label>
<div class="calendar-group">
  <input type="hidden" id="datum_reklamace" name="datum_reklamace">
  <button type="button" class="btn-calendar" data-target="datum_reklamace">Vyber datum</button>
  <span id="datum_reklamace_text" class="calendar-text">Nezvoleno</span>
</div>

<!-- üî∑ Modal kalend√°≈ô -->
<div id="calendarModal" class="calendar-modal">
  <div class="calendar-box">
    <div class="calendar-header">
      <button id="prevMonth">‚óÄ</button>
      <span id="monthLabel"></span>
      <button id="nextMonth">‚ñ∂</button>
    </div>
    <div id="calendarGrid" class="calendar-grid"></div>
    <div class="calendar-actions">
      <button id="cancelCalendar" class="btn-cancel">Zru≈°it</button>
      <button id="confirmCalendar" class="btn-ok">Potvrdit</button>
    </div>
  </div>
</div>

<style>
.calendar-group{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.btn-calendar{padding:8px 16px;border-radius:8px;border:none;
background:linear-gradient(135deg,#00d0b3,#00a891);
color:#fff;font-weight:600;cursor:pointer;}
.calendar-text{font-size:.9em;color:#aefcd8;}
.calendar-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);
justify-content:center;align-items:center;z-index:9999;}
.calendar-box{background:#fff;border-radius:12px;padding:20px;width:300px;
box-shadow:0 0 20px rgba(0,0,0,0.3);}
.calendar-header{display:flex;justify-content:space-between;align-items:center;
font-weight:700;margin-bottom:10px;}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;}
.calendar-grid div{padding:8px;text-align:center;border-radius:6px;cursor:pointer;}
.calendar-grid div:hover{background:#00e0c033;}
.calendar-grid div.selected{background:#00bfa5;color:#fff;}
.calendar-actions{display:flex;justify-content:space-between;margin-top:10px;}
.btn-ok{background:#00bfa5;color:#fff;border:none;border-radius:8px;padding:6px 14px;}
.btn-cancel{background:#ccc;border:none;border-radius:8px;padding:6px 14px;}
</style>

<script>
let activeInput=null,selectedDate=null,currentMonth=new Date();

function renderCalendar(){
  const grid=document.getElementById("calendarGrid");
  const monthLabel=document.getElementById("monthLabel");
  const year=currentMonth.getFullYear();
  const month=currentMonth.getMonth();
  const firstDay=new Date(year,month,1).getDay()||7;
  const daysInMonth=new Date(year,month+1,0).getDate();
  monthLabel.textContent=`${year} ‚Äì ${["Leden","√önor","B≈ôezen","Duben","Kvƒõten","ƒåerven","ƒåervenec","Srpen","Z√°≈ô√≠","≈ò√≠jen","Listopad","Prosinec"][month]}`;
  grid.innerHTML="";
  for(let i=1;i<firstDay;i++){grid.append(document.createElement("div"));}
  for(let d=1;d<=daysInMonth;d++){
    const cell=document.createElement("div");
    cell.textContent=d;
    cell.onclick=()=>{
      grid.querySelectorAll(".selected").forEach(c=>c.classList.remove("selected"));
      cell.classList.add("selected");
      selectedDate=new Date(year,month,d);
    };
    grid.append(cell);
  }
}

document.querySelectorAll(".btn-calendar").forEach(btn=>{
  btn.onclick=()=>{
    activeInput=btn.dataset.target;
    document.getElementById("calendarModal").style.display="flex";
    renderCalendar();
  };
});
document.getElementById("prevMonth").onclick=()=>{currentMonth.setMonth(currentMonth.getMonth()-1);renderCalendar();};
document.getElementById("nextMonth").onclick=()=>{currentMonth.setMonth(currentMonth.getMonth()+1);renderCalendar();};
document.getElementById("cancelCalendar").onclick=()=>{document.getElementById("calendarModal").style.display="none";};
document.getElementById("confirmCalendar").onclick=()=>{
  if(!selectedDate)return;
  const iso=selectedDate.toISOString().split("T")[0];
  document.getElementById(activeInput).value=iso;
  document.getElementById(activeInput+"_text").textContent=
    selectedDate.toLocaleDateString("cs-CZ",{day:"2-digit",month:"2-digit",year:"numeric"});
  document.getElementById("calendarModal").style.display="none";
};
</script>
<!-- üü© KONEC ƒå√ÅSTI 3/5 -->



  <!-- üü© ZAƒå√ÅTEK ƒå√ÅSTI 4/5 ‚Äì FOTKY + ZADAVATEL + VALIDACE + TLAƒå√çTKA -->
<label>Popis z√°vady:</label>
<textarea id="popis" name="popis" required placeholder="Popi≈°te z√°vadu nebo probl√©m..."></textarea>

<div class="photo-frame">
  <div class="photo-frame__header">
    <div class="photo-frame__title">Fotodokumentace</div>
    <button type="button" id="addPhotoBtn" class="btn-photo">üì∑ P≈ôidat fotografie</button>
  </div>
  <div class="photo-frame__info">Max. 10 fotografi√≠ (JPG/PNG/HEIC, ‚â§ 0,5 MB ka≈æd√°)</div>
  <div id="photoPreviewMain" class="photo-preview-main"></div>
</div>
<input type="file" id="photoInput" accept="image/jpeg,image/png,image/heic" multiple hidden>

<!-- üîç Lightbox -->
<div id="lightbox" class="lightbox"><img id="lightboxImg" src=""></div>

<!-- üßæ V√Ωbƒõr zadavatele -->
<label>Zadavatel:</label>
<select id="zadavatel" name="zadavatel" required>
  <option value="">Vyber zadavatele...</option>
  <option value="Milan Kol√≠n">Milan Kol√≠n</option>
  <option value="Radek Zikmund">Radek Zikmund</option>
  <option value="Kol√≠n / Zikmund">Kol√≠n / Zikmund</option>
</select>

<div class="actions">
  <button type="button" class="btn btn-back" onclick="window.location.href='index.html'">Zpƒõt</button>
  <button type="submit" class="btn btn-send">Odeslat po≈æadavek</button>
</div>

<!-- (zde z≈Øst√°v√° stejn√Ω JS jako p≈Øvodnƒõ: komprese, lightbox, validace jm√©na/emailu/telefonu, localStorage) -->
<!-- üü© KONEC ƒå√ÅSTI 4/5 -->
<!-- üü© ZAƒå√ÅTEK ƒå√ÅSTI 5/5 ‚Äì ODESL√ÅN√ç A ANIMACE -->
<div class="wait-overlay" id="waitOverlay">
  <div class="hourglass"></div>
  <p>ƒåekejte pros√≠m, odes√≠l√°m po≈æadavek‚Ä¶</p>
</div>

<div class="success-check" id="successCheck">
  <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
    <defs>
      <linearGradient id="gradTurq" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#00e0c0;stop-opacity:1"/>
        <stop offset="100%" style="stop-color:#00a88f;stop-opacity:1"/>
      </linearGradient>
    </defs>
    <circle cx="26" cy="26" r="25" fill="none" stroke="#e0e0e0"/>
    <path fill="none" stroke="url(#gradTurq)" d="M14 27l7 7 16-16"
      stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
</div>

<style>
.wait-overlay{display:none;position:fixed;inset:0;background:rgba(255,255,255,0.9);
backdrop-filter:blur(3px);justify-content:center;align-items:center;flex-direction:column;
color:#007f73;font-weight:600;font-size:1.1em;z-index:3000;}
.wait-overlay.active{display:flex;}
.hourglass{border:4px solid #ccc;border-top:4px solid #00bfa5;
border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin-bottom:10px;}
@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
.success-check{display:none;position:fixed;inset:0;justify-content:center;align-items:center;
background:rgba(255,255,255,0.95);z-index:3100;}
.success-check.active{display:flex;}
.checkmark{width:90px;height:90px;stroke-width:3;fill:none;stroke-dasharray:48;stroke-dashoffset:48;
animation:draw 1s ease forwards;}
@keyframes draw{to{stroke-dashoffset:0;}}
</style>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  const form=document.getElementById("reklamaceForm");
  const wait=document.getElementById("waitOverlay");
  const success=document.getElementById("successCheck");
  if(!form)return;

  form.addEventListener("submit",async(e)=>{
    e.preventDefault();
    wait.classList.add("active");

    const f=e.target;
    const predvolba=document.getElementById("predvolba");
    const photos=(window.photos||[]).map(p=>p.preview);

    const dataObj={
      typ:"reklamace",
      cislo:f.cislo.value.trim()||"Poz√°ruƒçn√≠ servis",
      zakaznik:f.zakaznik.value,
      adresa:`${f.ulice.value}, ${f.mesto.value}, ${f.psc.value}`,
      telefon:`${predvolba.value} ${f.telefon.value}`,
      email:f.email.value,
      produkt:f.produkt.value,
      datum_prodeje:f.datum_prodeje.value||"",
      datum_reklamace:f.datum_reklamace.value||"",
      popis:f.popis.value,
      zadavatel:f.zadavatel.value,
      fotky:photos
    };

    try{
      const res=await fetch("https://wgs-token.72nvwf4pb2.workers.dev/temporaryfiles",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({record:dataObj})
      });

      if(!res.ok)throw new Error("Chybn√° odpovƒõƒè: "+res.status);
      await res.json();

      localStorage.removeItem("novaReklamaceDraft");
      wait.classList.remove("active");
      success.classList.add("active");
      setTimeout(()=>window.location.href="index.html",2500);
    }catch(err){
      console.error(err);
      alert("‚ùå Chyba p≈ôi odes√≠l√°n√≠: "+err.message);
      wait.classList.remove("active");
    }
  });
});
</script>
<!-- üü© KONEC ƒå√ÅSTI 5/5 -->
