<!doctype html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WHITE GLOVE SERVICE ‚Äì Poz√°ruƒçn√≠ servis</title>
<style>
:root { font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif; color:#111; }
body { margin:0; padding:20px; background:#f6f7fb; }
h1 { text-align:center; font-size:2em; font-weight:900; margin:0 0 10px; }
h2 { text-align:center; font-size:1.1em; font-weight:600; margin:0 0 20px; color:#555; }

form { max-width:700px; margin:0 auto; background:white; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
label { display:block; margin-top:12px; font-weight:600; }
input, textarea, select {
  width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; margin-top:4px;
  font-size:1em; font-family:inherit;
}
textarea { resize:vertical; min-height:80px; }

.btn {
  display:inline-block; padding:10px 22px; border:none; border-radius:8px;
  font-weight:600; color:white; cursor:pointer; margin:10px 5px 0 0;
  background:linear-gradient(135deg,#0046ff,#357aff);
  transition:transform 0.15s ease-in-out, opacity 0.2s;
}
.btn:hover { transform:scale(1.04); opacity:0.9; }
.btn-gray { background:linear-gradient(135deg,#6c757d,#a0a4a7); }

#suggestions {
  list-style:none; margin:0; padding:0;
  position:absolute; background:white;
  border:1px solid #ccc; border-radius:6px;
  width:calc(100% - 2px);
  max-height:180px; overflow-y:auto;
  z-index:1000; display:none;
}
#suggestions li { padding:8px 10px; cursor:pointer; }
#suggestions li:hover { background:#f1f3f5; }

.photo-preview { display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
.photo-preview img { width:90px; border-radius:6px; border:1px solid #ccc; object-fit:cover; }
</style>
</head>
<body>
<h1>WHITE GLOVE SERVICE</h1>
<h2>Poz√°ruƒçn√≠ servisn√≠ po≈æadavek</h2>

<form id="aftersalesForm">
  <label>Z√°kazn√≠k</label>
  <input type="text" id="zakaznik" required>

  <label>Adresa z√°kazn√≠ka</label>
  <div style="position:relative;">
    <input type="text" id="adresa" name="adresa" placeholder="Zadejte ulici a ƒç√≠slo..." autocomplete="off" required>
    <ul id="suggestions"></ul>
  </div>

  <label>Telefon</label>
  <input type="tel" id="telefon">

  <label>E-mail</label>
  <input type="email" id="email">

  <label>Popis z√°vady</label>
  <textarea id="popis"></textarea>

  <label>Odhadovan√° cena opravy (Kƒç)</label>
  <input type="number" id="cena" placeholder="Nap≈ô. 1500">

  <label>Fotky (max 3)</label>
  <input type="file" id="fotky" accept="image/*" multiple>
  <div class="photo-preview" id="preview"></div>

  <div style="text-align:center;margin-top:20px;">
    <button type="submit" class="btn">Odeslat po≈æadavek</button>
    <button type="button" class="btn btn-gray" onclick="window.history.back()">Zpƒõt</button>
  </div>
</form>

<script>
const GITHUB_USER = "radecek222-boop";
const REPO = "reklamace";
const TOKEN = "TV≈ÆJ_TOKEN"; // ‚ö†Ô∏è vlo≈æ sv≈Øj GitHub token
const ORDERS_FILE = "orders.json";

// üß† Adresn√≠ na≈°ept√°vaƒç (OpenStreetMap Nominatim)
const adresaInput = document.getElementById("adresa");
const suggestions = document.getElementById("suggestions");
let timer = null;

adresaInput.addEventListener("input", () => {
  clearTimeout(timer);
  const query = adresaInput.value.trim();
  if (query.length < 3) {
    suggestions.style.display = "none";
    return;
  }
  timer = setTimeout(() => searchAddress(query), 400);
});

async function searchAddress(query) {
  try {
    const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=cz&q=${encodeURIComponent(query)}`);
    const data = await res.json();
    showSuggestions(data);
  } catch (e) {
    console.warn("Chyba p≈ôi naƒç√≠t√°n√≠ adres:", e);
  }
}

function showSuggestions(results) {
  suggestions.innerHTML = "";
  if (!results.length) {
    suggestions.style.display = "none";
    return;
  }
  results.slice(0, 8).forEach(r => {
    const li = document.createElement("li");
    li.textContent = r.display_name;
    li.style.padding = "8px 10px";
    li.style.cursor = "pointer";
    li.addEventListener("click", () => selectAddress(r.display_name));
    li.addEventListener("mouseenter", () => li.style.background="#f1f3f5");
    li.addEventListener("mouseleave", () => li.style.background="white");
    suggestions.appendChild(li);
  });
  suggestions.style.display = "block";
}

function selectAddress(address) {
  adresaInput.value = address;
  suggestions.style.display = "none";
}

// üì∏ N√°hled fotek
document.getElementById("fotky").addEventListener("change", e => {
  const preview = document.getElementById("preview");
  preview.innerHTML = "";
  [...e.target.files].slice(0,3).forEach(file => {
    const img = document.createElement("img");
    img.src = URL.createObjectURL(file);
    preview.appendChild(img);
  });
});

// üíæ Ulo≈æen√≠ po≈æadavku
document.getElementById("aftersalesForm").addEventListener("submit", async e => {
  e.preventDefault();
  try {
    const newRecord = {
      "ƒå√≠slo objedn√°vky": "AFS-" + new Date().getFullYear() + "-" + Math.floor(Math.random()*9999),
      "Z√°kazn√≠k": zakaznik.value.trim(),
      "Adresa": adresa.value.trim(),
      "Telefon": telefon.value.trim(),
      "Email": email.value.trim(),
      "Popis CZ": popis.value,
      "Cena pr√°ce": cena.value || "0",
      "Stav": "Poz√°ruƒçn√≠ po≈æadavek",
      "Vy≈ôe≈°eno": "NE",
      "Typ": "Poz√°ruƒçn√≠",
      "Datum pod√°n√≠": new Date().toISOString().split("T")[0]
    };

    const files = [...document.getElementById("fotky").files].slice(0,3);
    for (let i=0;i<files.length;i++) {
      const url = await uploadFile(files[i]);
      newRecord[`Foto${i+1}`] = url;
    }

    const res = await fetch(`https://raw.githubusercontent.com/${GITHUB_USER}/${REPO}/main/${ORDERS_FILE}?${Date.now()}`);
    const data = await res.json().catch(()=>[]);
    data.push(newRecord);

    await updateFile(ORDERS_FILE, JSON.stringify(data, null, 2));
    alert("Poz√°ruƒçn√≠ servisn√≠ po≈æadavek byl ulo≈æen.");
    e.target.reset();
    document.getElementById("preview").innerHTML = "";
  } catch (err) {
    alert("Chyba p≈ôi ukl√°d√°n√≠: " + err.message);
  }
});

// üì§ Upload fotek
async function uploadFile(file){
  const reader = new FileReader();
  return new Promise((resolve,reject)=>{
    reader.onload = async ()=>{
      const base64 = reader.result.split(",")[1];
      const path = `uploads/${Date.now()}_${file.name}`;
      const res = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${REPO}/contents/${path}`, {
        method:"PUT",
        headers:{Authorization:`token ${TOKEN}`,"Content-Type":"application/json"},
        body:JSON.stringify({message:`Nahr√°na fotka ${file.name}`,content:base64})
      });
      if(res.ok) resolve(`https://raw.githubusercontent.com/${GITHUB_USER}/${REPO}/main/${path}`);
      else reject("Chyba p≈ôi nahr√°v√°n√≠ fotky");
    };
    reader.readAsDataURL(file);
  });
}

// üìÑ Aktualizace JSON souboru
async function updateFile(filename,content){
  const metaRes=await fetch(`https://api.github.com/repos/${GITHUB_USER}/${REPO}/contents/${filename}`,{headers:{Authorization:`token ${TOKEN}`}});
  const meta=await metaRes.json();
  await fetch(`https://api.github.com/repos/${GITHUB_USER}/${REPO}/contents/${filename}`,{
    method:"PUT",
    headers:{Authorization:`token ${TOKEN}`,"Content-Type":"application/json"},
    body:JSON.stringify({message:`Aktualizace ${filename}`,content:btoa(unescape(encodeURIComponent(content))),sha:meta.sha})
  });
}
</script>
</body>
</html>
