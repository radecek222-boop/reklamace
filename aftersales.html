<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Poz√°ruƒçn√≠ servis ‚Äì White Glove Service</title>
  <style>
    body { font-family: "Inter", system-ui, sans-serif; background:#f6f7fb; margin:0; padding:0;
           display:flex; justify-content:center; align-items:flex-start; min-height:100vh; }
    .wrapper { background:#fff; padding:30px; margin-top:40px; border-radius:10px;
               box-shadow:0 2px 8px rgba(0,0,0,0.1); width:100%; max-width:700px; }
    h1, h2 { text-align:center; margin:0 0 20px; }
    label { display:block; font-weight:600; margin-top:15px; margin-bottom:5px; }
    input, textarea { width:100%; padding:10px; font-size:1em; border:1px solid #ccc;
                      border-radius:6px; box-sizing:border-box; }
    textarea { height:100px; resize:vertical; }
    .btn { display:inline-block; background:#6c757d; color:#fff; text-decoration:none;
           padding:12px 28px; border-radius:8px; font-weight:600; font-size:1em;
           transition:background 0.2s; margin:10px 5px 0 0; border:none; cursor:pointer; }
    .btn:hover { background:#5a6268; }
    .actions { text-align:center; margin-top:25px; }
  </style>
</head>
<body>
  <div class="wrapper">
    <h1>WHITE GLOVE SERVICE</h1>
    <h2>Poz√°ruƒçn√≠ servis</h2>

    <form id="servisForm">
      <label>Jm√©no a p≈ô√≠jmen√≠:</label>
      <input type="text" name="zakaznik">
      <label>Adresa:</label>
      <input type="text" name="adresa">
      <label>Telefon:</label>
      <input type="tel" name="telefon">
      <label>E-mail:</label>
      <input type="email" name="email">
      <label>Model / N√°zev produktu:</label>
      <input type="text" name="produkt">
      <label>Datum n√°kupu (pokud je zn√°mo):</label>
      <input type="date" name="datum_nakupu">
      <label>Popis po≈æadovan√© opravy / z√°vady:</label>
      <textarea name="popis"></textarea>
      <label>P≈ôilo≈æit fotografie (max. 3):</label>
      <input type="file" id="fotky" accept="image/*" multiple>
      <label>Jm√©no zadavatele:</label>
      <input type="text" name="zadavatel_jmeno">
      <label>E-mail zadavatele:</label>
      <input type="email" name="zadavatel_email">
      <label>Telefon zadavatele:</label>
      <input type="tel" name="zadavatel_telefon">

      <div class="actions">
        <a href="index.html" class="btn">Zpƒõt</a>
        <button type="submit" class="btn">Odeslat</button>
      </div>
    </form>
  </div>

  <script>
    async function submitToGitHub(dataObj, owner, repo, path, message, token) {
      const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
      const resp = await fetch(url, { headers:{ "Authorization":`token ${token}`,"Accept":"application/vnd.github.v3+json"}});
      let existing="[]", sha=null;
      if(resp.ok){const j=await resp.json();existing=atob(j.content.replace(/\n/g,""));sha=j.sha;}
      const arr=JSON.parse(existing);arr.push(dataObj);
      const base64=btoa(unescape(encodeURIComponent(JSON.stringify(arr,null,2))));
      const body={message,content:base64,branch:"main"};if(sha)body.sha=sha;
      const put=await fetch(url,{method:"PUT",headers:{"Authorization":`token ${token}`,"Accept":"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify(body)});
      if(!put.ok)throw new Error(await put.text());
    }

    document.getElementById("servisForm").addEventListener("submit", async e=>{
      e.preventDefault();
      const files=document.getElementById("fotky").files;
      if(!confirm("Opravdu odeslat po≈æadavek?"))return;
      const f=e.target;
      const dataObj={
        typ:"poz√°ruƒçn√≠",
        contract:"POZ", // üî• zkratka pro poz√°ruƒçn√≠ servis
        zakaznik:f.zakaznik.value,
        adresa:f.adresa.value,
        telefon:f.telefon.value,
        email:f.email.value,
        produkt:f.produkt.value,
        datum_nakupu:f.datum_nakupu.value,
        popis:f.popis.value,
        fotky:Array.from(files).map(x=>x.name),
        zadavatel:{jmeno:f.zadavatel_jmeno.value,email:f.zadavatel_email.value,telefon:f.zadavatel_telefon.value}
      };

      try{
        const owner="radecek222-boop",repo="reklamace",path="orders.json";
        const message=`Nov√Ω poz√°ruƒçn√≠ servis od ${dataObj.zadavatel.jmeno}`;
        const token=prompt("Zadej GitHub token:");
        await submitToGitHub(dataObj,owner,repo,path,message,token);
        alert("Dƒõkujeme, po≈æadavek byl odesl√°n.");
        f.reset();
      }catch(err){alert("Chyba: "+err.message);}
    });
  </script>
</body>
</html>
